import{a as ce}from"./chunk-PU57OF2V.js";import{a as pe}from"./chunk-JJ6L3UIW.js";import{a as I}from"./chunk-IYGYDPGO.js";import{b as J,c as K,e as X,f as Y,h as ee,k as te,l as ie,m as ne,n as oe,o as le,s as re,t as ae,u as se}from"./chunk-GFCFUV6K.js";import{b as de}from"./chunk-PJLGVUHH.js";import{a as me}from"./chunk-MXHSEERB.js";import"./chunk-MPC7SZEK.js";import{c as k,d as D,j as A}from"./chunk-CF2QCA26.js";import{h as Q,i as Z,l as W}from"./chunk-NUA5R5QO.js";import{$a as z,$b as E,Ab as $,Ac as H,Bb as L,Cb as _,D as M,Da as o,Eb as y,Fb as l,Gb as f,H as N,Hb as h,Na as R,Ra as B,Rb as F,_ as w,ab as V,bb as p,cb as u,da as b,ea as v,eb as U,fb as T,fc as G,gb as d,hb as n,ia as P,ib as i,jb as m,ma as C,qb as S,rb as x,tb as c,tc as q,yb as j,zb as O}from"./chunk-6O7NOF42.js";import"./chunk-LJ5XHLMQ.js";import"./chunk-FK42CRUA.js";var ve=["confirmModal"],fe=r=>["/usuarios",r],ge=r=>["/usuarios",r,"editar"];function xe(r,t){if(r&1&&(n(0,"span",15),l(1),i()),r&2){let e=c();o(),f(e.totalItems())}}function _e(r,t){r&1&&m(0,"span",19)}function Ce(r,t){r&1&&m(0,"i",20)}function he(r,t){if(r&1){let e=S();n(0,"li")(1,"button",65),x("click",function(){b(e);let s=c(2);return v(s.exportSelectedToCSV())}),m(2,"i",67),l(3),i()()}if(r&2){let e=c(2);o(3),h(" Solo seleccionados (",e.selectedUsers().length,") ")}}function Se(r,t){if(r&1){let e=S();n(0,"div",24)(1,"button",62),m(2,"i",63),n(3,"span",9),l(4,"Exportar"),i()(),n(5,"ul",64)(6,"li")(7,"button",65),x("click",function(){b(e);let s=c();return v(s.exportToCSV())}),m(8,"i",66),l(9," Todos los usuarios (CSV) "),i()(),p(10,he,4,1,"li"),i()()}if(r&2){let e=c();o(10),u(e.selectedUsers().length>0?10:-1)}}function ye(r,t){if(r&1&&(n(0,"span",32),l(1),i()),r&2){let e=c();o(),f(e.activeFiltersCount())}}function Ee(r,t){if(r&1){let e=S();n(0,"button",68),x("click",function(){b(e);let s=c();return v(s.clearAllFilters())}),m(1,"i",69),i()}}function we(r,t){if(r&1){let e=S();n(0,"button",105),x("click",function(){b(e),c();let s=$(10);return c().clearSearch(),v(s.focus())}),m(1,"i",106),i()}}function Ve(r,t){if(r&1&&(n(0,"option",81),l(1),i()),r&2){let e=t.$implicit,a=c(2);d("value",e),o(),f(a.getUserRoleLabel(e))}}function Ue(r,t){if(r&1&&(n(0,"option",81),l(1),i()),r&2){let e=t.$implicit;d("value",e.code),o(),f(e.name)}}function Te(r,t){if(r&1&&(n(0,"div",37)(1,"form",70)(2,"div",71)(3,"div",72)(4,"label",73),l(5,"Buscar por texto"),i(),n(6,"div",74)(7,"span",75),m(8,"i",76),i(),m(9,"input",77,1),p(11,we,2,0,"button",78),i()(),n(12,"div",79)(13,"label",73),l(14,"Rol"),i(),n(15,"select",80)(16,"option",81),l(17,"Todos los roles"),i(),U(18,Ve,2,2,"option",81,V().trackByRole,!0),i()(),n(20,"div",82)(21,"label",73),l(22,"Departamento"),i(),n(23,"select",83)(24,"option",81),l(25,"Todos"),i(),U(26,Ue,2,2,"option",81,V().trackByDepartmentCode,!0),i()(),n(28,"div",79)(29,"label",73),l(30,"Estado"),i(),n(31,"select",84)(32,"option",81),l(33,"Todos"),i(),n(34,"option",81),l(35,"Activos"),i(),n(36,"option",81),l(37,"Inactivos"),i()()(),n(38,"div",85)(39,"label",73),l(40,"Email"),i(),n(41,"select",86)(42,"option",81),l(43,"Todos"),i(),n(44,"option",81),l(45,"\u2713"),i(),n(46,"option",81),l(47,"\u2717"),i()()(),n(48,"div",85)(49,"label",73),l(50,"Tel\xE9fono"),i(),n(51,"select",87)(52,"option",81),l(53,"Todos"),i(),n(54,"option",81),l(55,"\u2713"),i(),n(56,"option",81),l(57,"\u2717"),i()()(),n(58,"div",79)(59,"label",73),l(60,"Desde"),i(),m(61,"input",88),i(),n(62,"div",79)(63,"label",73),l(64,"Hasta"),i(),m(65,"input",89),i(),n(66,"div",90)(67,"label",73),l(68,"Filtros adicionales"),i(),n(69,"div",91)(70,"div",92),m(71,"input",93),n(72,"label",94),l(73," Solo perfiles completos "),i()()()(),n(74,"div",95)(75,"label",73),l(76,"Ordenar por"),i(),n(77,"div",96)(78,"select",97)(79,"option",98),l(80,"Fecha registro"),i(),n(81,"option",99),l(82,"Nombre"),i(),n(83,"option",100),l(84,"\xDAltimo acceso"),i(),n(85,"option",101),l(86,"Eventos asistidos"),i()(),n(87,"select",102)(88,"option",103),l(89,"Desc"),i(),n(90,"option",104),l(91,"Asc"),i()()()()()()()),r&2){let e,a=c();o(),d("formGroup",a.filtersForm),o(10),u((e=a.filtersForm.get("searchText"))!=null&&e.value?11:-1),o(5),d("value",null),o(2),T(a.userRoles),o(6),d("value",null),o(2),T(a.departments()),o(6),d("value",null),o(2),d("value",!0),o(2),d("value",!1),o(6),d("value",null),o(2),d("value",!0),o(2),d("value",!1),o(6),d("value",null),o(2),d("value",!0),o(2),d("value",!1),o(15),d("value",!0)}}function Fe(r,t){if(r&1&&(n(0,"span",42),l(1),i()),r&2){let e=c();o(),f(e.totalItems())}}function Ie(r,t){if(r&1&&(n(0,"span",43),l(1),i()),r&2){let e=c();o(),h("",e.selectedUsers().length," seleccionados")}}function Le(r,t){if(r&1&&(n(0,"option",81),l(1),i()),r&2){let e=t.$implicit;d("value",e),o(),f(e)}}function ke(r,t){r&1&&(n(0,"div",59)(1,"div",107)(2,"div",108)(3,"span",109),l(4,"Cargando..."),i()(),n(5,"p",110),l(6,"Cargando usuarios..."),i()()())}function De(r,t){if(r&1){let e=S();n(0,"h5",113),l(1,"No se encontraron usuarios"),i(),n(2,"p",111),l(3,"Intenta ajustar los filtros de b\xFAsqueda"),i(),n(4,"button",114),x("click",function(){b(e);let s=c(2);return v(s.clearAllFilters())}),m(5,"i",115),l(6,"Limpiar filtros "),i()}}function Ae(r,t){r&1&&(n(0,"h5",113),l(1,"No hay usuarios registrados"),i(),n(2,"p",111),l(3,"Comienza creando el primer usuario"),i(),n(4,"a",116),m(5,"i",117),l(6,"Nuevo Usuario "),i())}function Me(r,t){if(r&1&&(n(0,"div",60)(1,"div",111),m(2,"i",112),i(),p(3,De,7,0)(4,Ae,7,0),i()),r&2){let e=c();o(3),u(e.hasActiveFilters()?3:4)}}function Ne(r,t){if(r&1&&(n(0,"div",136),m(1,"i",150),n(2,"span",151),l(3),i()()),r&2){let e=c().$implicit;o(2),d("title",e.institution),o(),h(" ",e.institution," ")}}function Pe(r,t){if(r&1&&(n(0,"div",136),m(1,"i",152),n(2,"span",151),l(3),i()()),r&2){let e=c().$implicit;o(2),d("title",e.jobTitle),o(),h(" ",e.jobTitle," ")}}function Re(r,t){if(r&1&&(n(0,"div",136),m(1,"i",153),n(2,"span",154),l(3),i()()),r&2){let e=c().$implicit;o(3),f(e.departmentName)}}function Be(r,t){if(r&1){let e=S();n(0,"div",121)(1,"div",122)(2,"div",123)(3,"div",124)(4,"input",125),x("change",function(){let s=b(e).$implicit,g=c(3);return v(g.toggleSelection(s.id))}),i(),n(5,"label",126),l(6," Seleccionar usuario "),i()(),n(7,"span",127),l(8),i()(),n(9,"div",128)(10,"div",129)(11,"div",130)(12,"span",131),l(13),i()(),n(14,"div",132)(15,"h6",133),l(16),i(),n(17,"p",134),l(18),i()()(),n(19,"div",135),p(20,Ne,4,2,"div",136),p(21,Pe,4,2,"div",136),p(22,Re,4,1,"div",136),i(),n(23,"div",135)(24,"div",136)(25,"span",137),l(26),i()(),n(27,"div",138)(28,"div"),m(29,"i",35),i(),n(30,"div"),m(31,"i",35),i(),n(32,"div",139)(33,"div",140),m(34,"div",141),i()()()(),n(35,"div",142)(36,"div")(37,"div",143),l(38),i(),n(39,"div"),l(40,"Eventos"),i()(),n(41,"div")(42,"div",143),l(43),i(),n(44,"div"),l(45,"Certificados"),i()(),n(46,"div")(47,"div",143),l(48),i(),n(49,"div"),l(50,"Perfil"),i()()()(),n(51,"div",144)(52,"div",145)(53,"button",146),m(54,"i",147),i(),n(55,"button",148),m(56,"i",149),i()()()()()}if(r&2){let e=t.$implicit,a=c(3);o(),y(a.getTableRowClass(e)),_("border-primary",a.selectedUsers().includes(e.id))("shadow",a.selectedUsers().includes(e.id)),o(3),d("id","card-select-"+e.id)("checked",a.selectedUsers().includes(e.id)),o(),d("for","card-select-"+e.id),o(2),y(a.getRoleBadgeClass(e.role)),o(),h(" ",a.getUserRoleLabel(e.role)," "),o(5),f(a.getUserInitials(e.fullName)),o(3),f(e.fullName),o(2),f(e.email),o(2),u(e.institution?20:-1),o(),u(e.jobTitle?21:-1),o(),u(e.departmentName?22:-1),o(3),y(a.getUserStatusBadgeClass(e)),o(),h(" ",a.getUserStatusText(e)," "),o(2),_("text-success",e.emailVerified)("text-muted",!e.emailVerified),o(),_("bi-envelope-check-fill",e.emailVerified)("bi-envelope-x",!e.emailVerified),o(),_("text-success",e.phoneVerified)("text-muted",!e.phoneVerified),o(),_("bi-telephone-check-fill",e.phoneVerified)("bi-telephone-x",!e.phoneVerified),o(2),d("title","Perfil "+e.profileCompletion+"% completo"),o(),L("width",e.profileCompletion,"%"),_("bg-success",e.profileCompletion>=80)("bg-warning",e.profileCompletion>=50&&e.profileCompletion<80)("bg-danger",e.profileCompletion<50),o(4),f(e.eventsCount),o(5),f(e.certificatesCount),o(5),h("",e.profileCompletion,"%"),o(5),d("routerLink",F(51,fe,e.id)),o(2),d("routerLink",F(53,ge,e.id))}}function ze(r,t){if(r&1&&(n(0,"div",118)(1,"div",120),U(2,Be,57,55,"div",121,V().trackByUserId,!0),i()()),r&2){let e=c(2);o(2),T(e.users())}}function je(r,t){if(r&1&&(n(0,"div",170),m(1,"i",178),l(2),i()),r&2){let e=c().$implicit;o(2),h("",e.institution," ")}}function Oe(r,t){if(r&1&&(n(0,"div",179),l(1),i(),n(2,"small",173),l(3),i()),r&2){let e=c().$implicit,a=c(3);o(),f(e.documentNumber),o(2),f(a.getDocumentTypeLabel(e.documentType))}}function $e(r,t){r&1&&(n(0,"span",154),l(1,"Sin informaci\xF3n"),i())}function Ge(r,t){if(r&1&&(n(0,"div",179),l(1),i(),n(2,"small",173),m(3,"i",35),l(4),i()),r&2){let e=c().$implicit;o(),f(e.phone),o(),_("text-success",e.phoneVerified)("text-warning",!e.phoneVerified),o(),_("bi-check-circle-fill",e.phoneVerified)("bi-exclamation-circle-fill",!e.phoneVerified),o(),h(" ",e.phoneVerified?"Verificado":"Sin verificar"," ")}}function qe(r,t){r&1&&(n(0,"span",154),l(1,"No registrado"),i())}function He(r,t){if(r&1&&(n(0,"span",154),l(1),i()),r&2){let e=c().$implicit;o(),f(e.lastActivity)}}function Qe(r,t){r&1&&(n(0,"span",154),l(1,"Nunca"),i())}function Ze(r,t){if(r&1){let e=S();n(0,"tr")(1,"td",165)(2,"div",92)(3,"input",125),x("change",function(){let s=b(e).$implicit,g=c(3);return v(g.toggleSelection(s.id))}),i(),n(4,"label",126),l(5," Seleccionar usuario "),i()()(),n(6,"td",165)(7,"div",28)(8,"div",166)(9,"span",131),l(10),i()(),n(11,"div",167)(12,"div",168),l(13),i(),n(14,"div",169),l(15),i(),p(16,je,3,1,"div",170),i()()(),n(17,"td",171),p(18,Oe,4,2)(19,$e,2,0,"span",154),i(),n(20,"td",172),p(21,Ge,5,10)(22,qe,2,0,"span",154),i(),n(23,"td",165)(24,"span",127),l(25),i()(),n(26,"td",172)(27,"span",173),l(28),i()(),n(29,"td",171)(30,"div",174)(31,"small"),m(32,"i",35),l(33),i(),n(34,"div",140),m(35,"div",141),i()()(),n(36,"td",165)(37,"span",127),l(38),i()(),n(39,"td",171)(40,"span",154),l(41),i()(),n(42,"td",172),p(43,He,2,1,"span",154)(44,Qe,2,0,"span",154),i(),n(45,"td",165)(46,"div",175)(47,"button",176),m(48,"i",147),i(),n(49,"button",177),m(50,"i",149),i()()()()}if(r&2){let e=t.$implicit,a=c(3);y(a.getTableRowClass(e)),_("table-active",a.selectedUsers().includes(e.id)),o(3),d("id","select-"+e.id)("checked",a.selectedUsers().includes(e.id)),o(),d("for","select-"+e.id),o(6),f(a.getUserInitials(e.fullName)),o(3),f(e.fullName),o(2),f(e.email),o(),u(e.institution?16:-1),o(2),u(e.documentType&&e.documentNumber?18:19),o(3),u(e.phone?21:22),o(3),y(a.getRoleBadgeClass(e.role)),o(),h(" ",a.getUserRoleLabel(e.role)," "),o(3),f(e.departmentName||"N/A"),o(3),_("text-success",e.emailVerified)("text-warning",!e.emailVerified),o(),_("bi-envelope-check-fill",e.emailVerified)("bi-envelope-exclamation-fill",!e.emailVerified),o(),h(" Email ",e.emailVerified?"verificado":"sin verificar"," "),o(),d("title","Perfil "+e.profileCompletion+"% completo"),o(),L("width",e.profileCompletion,"%"),_("bg-success",e.profileCompletion>=80)("bg-warning",e.profileCompletion>=50&&e.profileCompletion<80)("bg-danger",e.profileCompletion<50),o(2),y(a.getUserStatusBadgeClass(e)),o(),h(" ",a.getUserStatusText(e)," "),o(3),f(e.joinedDate),o(2),u(e.lastActivity?43:44),o(4),d("routerLink",F(42,fe,e.id)),o(2),d("routerLink",F(44,ge,e.id))}}function We(r,t){if(r&1){let e=S();n(0,"div",119)(1,"table",155)(2,"thead",156)(3,"tr")(4,"th",157)(5,"div",92)(6,"input",158),x("change",function(){b(e);let s=c(2);return v(s.toggleSelectAll())}),i(),n(7,"label",159),l(8," Seleccionar todos "),i()()(),n(9,"th",160),l(10,"Usuario"),i(),n(11,"th",161),l(12,"Documento"),i(),n(13,"th",162),l(14,"Tel\xE9fono"),i(),n(15,"th",160),l(16,"Rol"),i(),n(17,"th",162),l(18,"Departamento"),i(),n(19,"th",161),l(20,"Verificaci\xF3n"),i(),n(21,"th",160),l(22,"Estado"),i(),n(23,"th",161),l(24,"Registro"),i(),n(25,"th",162),l(26,"\xDAltimo acceso"),i(),n(27,"th",163),l(28,"Acciones"),i()()(),n(29,"tbody"),U(30,Ze,51,46,"tr",164,V().trackByUserId,!0),i()()()}if(r&2){let e=c(2);o(6),d("checked",e.areAllSelected())("indeterminate",e.areSomeSelected()),o(24),T(e.users())}}function Je(r,t){if(r&1&&(p(0,ze,4,0,"div",118),p(1,We,32,2,"div",119)),r&2){let e=c();u(e.viewMode()==="cards"?0:-1),o(),u(e.viewMode()==="table"?1:-1)}}function Ke(r,t){if(r&1){let e=S();n(0,"div",61)(1,"app-pagination",180),x("pageChange",function(s){b(e);let g=c();return v(g.goToPage(s))})("pageSizeChange",function(s){b(e);let g=c();return v(g.onPageSizeChange(s))}),i()()}if(r&2){let e=c();o(),d("totalItems",e.totalItems())("pageSize",e.pageSize())("currentPage",e.currentPage())("showPageSizeSelector",!0)("pageSizeOptions",e.pageSizeOptions)("showGoToPage",!0)("showRangeInfo",!0)("showFirstLastButtons",!0)("maxVisiblePages",5)("density","compact")}}var ue=class r{fb=w(re);router=w(Q);destroyRef=w(P);userService=w(de);staticDataService=w(me);confirmModal=G("confirmModal");pageSizeOptions=A.pagination.pageSizeOptions;loadingState=C("idle");loading=E(()=>this.loadingState()==="loading");error=C(null);showFilters=C(!0);viewMode=C("cards");currentPage=C(1);pageSize=C(A.pagination.defaultPageSize);totalItems=C(0);totalPages=E(()=>Math.ceil(this.totalItems()/this.pageSize()));users=C([]);departments=C([]);selectedUsers=C([]);filtersForm=this.fb.group({searchText:this.fb.control(null),role:this.fb.control(null),departmentId:this.fb.control(null),isActive:this.fb.control(null),emailVerified:this.fb.control(null),phoneVerified:this.fb.control(null),profileCompleted:this.fb.control(null),dateFrom:this.fb.control(null),dateTo:this.fb.control(null),sortBy:this.fb.control("created_at"),sortDirection:this.fb.control("desc")});userRoles=Object.values(k);documentTypes=Object.values(D);UserRole=k;DocumentType=D;confirmAction=C({title:"Confirmar Acci\xF3n",message:"\xBFEst\xE1 seguro?",confirmText:"Confirmar",callback:()=>{}});formFilters=C({searchText:null,role:null,departmentId:null,isActive:null,emailVerified:null,phoneVerified:null,profileCompleted:null,dateFrom:null,dateTo:null,sortBy:null,sortDirection:null});hasActiveFilters=E(()=>{let t=this.formFilters();return!!(t.searchText?.trim()||t.role||t.departmentId||t.isActive!==null||t.emailVerified!==null||t.phoneVerified!==null||t.profileCompleted!==null||t.dateFrom||t.dateTo)});activeFiltersCount=E(()=>{let t=this.formFilters(),e=0;return t.searchText?.trim()&&e++,t.role&&e++,t.departmentId&&e++,t.isActive!==null&&e++,t.emailVerified!==null&&e++,t.phoneVerified!==null&&e++,t.profileCompleted!==null&&e++,(t.dateFrom||t.dateTo)&&e++,e});areAllSelected=E(()=>{let t=this.users(),e=this.selectedUsers();return t.length>0&&t.every(a=>e.includes(a.id))});areSomeSelected=E(()=>{let t=this.users(),e=this.selectedUsers();return t.some(a=>e.includes(a.id))&&!this.areAllSelected()});trackByUserId=(t,e)=>e.id;trackByDepartmentCode=(t,e)=>e.code;trackByRole=(t,e)=>e;Math=Math;ngOnInit(){this.formFilters.set(this.filtersForm.value),this.loadInitialData(),this.setupSubscriptions(),this.loadViewMode()}loadInitialData(){this.staticDataService.getDepartmentsList().pipe(I(this.destroyRef)).subscribe({next:t=>{this.departments.set(t)},error:t=>console.error("Error loading departments:",t)}),this.loadUsers()}setupSubscriptions(){this.filtersForm.valueChanges.pipe(M(300),N(),I(this.destroyRef)).subscribe(t=>{this.formFilters.set(t),this.currentPage.set(1),this.loadUsers()})}loadViewMode(){let t=localStorage.getItem("user-view-mode");t&&this.viewMode.set(t)}loadUsers(){this.loadingState.set("loading"),this.error.set(null);let t=this.buildFilters();this.userService.getUsers(this.currentPage(),this.pageSize(),t,this.filtersForm.value.sortBy||"created_at",this.filtersForm.value.sortDirection||"desc").pipe(I(this.destroyRef)).subscribe({next:e=>{this.users.set(e.items),this.totalItems.set(e.pagination.totalItems),this.loadingState.set("success")},error:e=>{console.error("Error loading users:",e),this.error.set("Error al cargar los usuarios"),this.loadingState.set("error")}})}buildFilters(){let t=this.filtersForm.value,e={};return t.searchText?.trim()&&(e.search=t.searchText.trim()),t.role&&(e.role=t.role),t.departmentId&&(e.departmentId=t.departmentId),t.isActive!==null&&t.isActive!==void 0&&(e.isActive=t.isActive),t.emailVerified!==null&&t.emailVerified!==void 0&&(e.emailVerified=t.emailVerified),t.phoneVerified!==null&&t.phoneVerified!==void 0&&(e.phoneVerified=t.phoneVerified),t.profileCompleted!==null&&t.profileCompleted!==void 0&&(e.profileCompleted=t.profileCompleted),t.dateFrom&&(e.dateFrom=t.dateFrom),t.dateTo&&(e.dateTo=t.dateTo),e}toggleFiltersPanel(){this.showFilters.update(t=>!t)}clearAllFilters(){this.filtersForm.reset({sortBy:"created_at",sortDirection:"desc"}),this.selectedUsers.set([]),this.currentPage.set(1),this.formFilters.set({searchText:null,role:null,departmentId:null,isActive:null,emailVerified:null,phoneVerified:null,profileCompleted:null,dateFrom:null,dateTo:null,sortBy:"created_at",sortDirection:"desc"}),this.loadUsers()}clearSearch(){this.filtersForm.patchValue({searchText:""})}onSortChange(t){let e=t.target,[a,s]=e.value.split("|");this.filtersForm.patchValue({sortBy:a,sortDirection:s})}onPageSizeChange(t){if(typeof t=="number")this.pageSize.set(t);else{let e=t.target;this.pageSize.set(Number(e.value))}this.currentPage.set(1),this.loadUsers()}goToPage(t){t>=1&&t<=this.totalPages()&&(this.currentPage.set(t),this.loadUsers())}onPageChange(t){this.goToPage(t)}setViewMode(t){this.viewMode.set(t),localStorage.setItem("user-view-mode",t)}toggleSelection(t){this.selectedUsers.update(e=>e.indexOf(t)>=0?e.filter(s=>s!==t):[...e,t])}toggleSelectAll(){this.areAllSelected()?this.selectedUsers.set([]):this.selectedUsers.set(this.users().map(e=>e.id))}isSelected(t){return this.selectedUsers().includes(t)}getUserRoleLabel(t){return{admin:"Administrador",organizer:"Organizador",participant:"Participante"}[t]||t}getDocumentTypeLabel(t){return{DNI:"DNI",CE:"Carn\xE9 de Extranjer\xEDa",PASSPORT:"Pasaporte",RUC:"RUC"}[t]||t}getUserStatusBadgeClass(t){return t.isActive?"bg-success-subtle text-success-emphasis":"bg-danger-subtle text-danger-emphasis"}getUserStatusText(t){return t.isActive?"Activo":"Inactivo"}getRoleBadgeClass(t){return{admin:"bg-primary-subtle text-primary-emphasis",organizer:"bg-info-subtle text-info-emphasis",participant:"bg-secondary-subtle text-secondary-emphasis"}[t]||"bg-secondary-subtle text-secondary-emphasis"}getTableRowClass(t){return t.isActive?t.emailVerified?t.profileCompletion<50?"table-danger":"":"table-warning":"table-secondary"}getUserInitials(t){return t.split(" ").slice(0,2).map(e=>e.charAt(0).toUpperCase()).join("")}formatDate(t){if(!t)return"N/A";try{return new Date(t).toLocaleDateString("es-PE",{day:"2-digit",month:"2-digit",year:"numeric"})}catch{return t}}formatDateTime(t){if(!t)return"N/A";try{return new Date(t).toLocaleString("es-PE",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return t}}exportToCSV(){let t=this.generateCSVData(this.users());this.downloadCSV(t,"usuarios.csv")}exportSelectedToCSV(){let t=this.users().filter(a=>this.selectedUsers().includes(a.id)),e=this.generateCSVData(t);this.downloadCSV(e,"usuarios_seleccionados.csv")}generateCSVData(t){let a=[["ID","Nombre Completo","Email","Documento","N\xFAmero Documento","Tel\xE9fono","Instituci\xF3n","Cargo","Rol","Departamento","Estado","Email Verificado","Tel\xE9fono Verificado","Eventos Asistidos","Certificados","Fecha Registro","\xDAltimo Acceso"].join(",")];return t.forEach(s=>{let g=[s.id,`"${s.fullName}"`,s.email,s.documentType||"",s.documentNumber||"",s.phone||"",`"${s.institution||""}"`,`"${s.jobTitle||""}"`,this.getUserRoleLabel(s.role),`"${s.departmentName||""}"`,this.getUserStatusText(s),s.emailVerified?"S\xED":"No",s.phoneVerified?"S\xED":"No",s.eventsCount,s.certificatesCount,s.joinedDate,s.lastActivity||"Nunca"];a.push(g.join(","))}),a.join(`
`)}downloadCSV(t,e){let a=new Blob([t],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),g=URL.createObjectURL(a);s.setAttribute("href",g),s.setAttribute("download",e),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)}refreshData(){this.loadUsers()}onConfirmAccepted(){this.confirmAction().callback()}onConfirmCancelled(){}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=R({type:r,selectors:[["app-user-list"]],viewQuery:function(e,a){e&1&&j(a.confirmModal,ve,5),e&2&&O()},decls:82,vars:27,consts:[["confirmModal",""],["searchInput",""],[1,"container-fluid","py-3"],[3,"accepted","cancelled","title","message","confirmText"],["aria-label","breadcrumb",1,"mb-3"],[1,"breadcrumb","mb-0","fs-7"],[1,"breadcrumb-item"],["routerLink","/",1,"text-decoration-none","link-primary"],[1,"bi","bi-house-door","me-1"],[1,"d-none","d-sm-inline"],["aria-current","page",1,"breadcrumb-item","active"],[1,"d-flex","flex-column","flex-md-row","align-items-start","align-items-md-center","justify-content-between","gap-3","mb-4"],[1,"order-1","order-md-0"],[1,"h5","mb-1","fw-semibold","d-flex","align-items-center"],[1,"bi","bi-people","me-2","text-primary"],[1,"badge","bg-primary-subtle","text-primary","ms-2","fs-7"],[1,"text-muted","small","mb-0"],[1,"d-flex","flex-wrap","gap-2","order-0","order-md-1"],["type","button","title","Actualizar datos",1,"btn","btn-outline-secondary","btn-sm","d-flex","align-items-center",3,"click","disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-1"],[1,"bi","bi-arrow-clockwise","me-1"],["routerLink","/usuarios/nuevo","title","Crear nuevo usuario",1,"btn","btn-primary","btn-sm","d-flex","align-items-center"],[1,"bi","bi-plus-circle","me-1"],[1,"d-none","d-lg-inline","ms-1"],["role","group",1,"btn-group"],[1,"card","border-0","shadow-sm","mb-4"],[1,"card-header","bg-light","border-bottom","py-3"],[1,"d-flex","align-items-center","justify-content-between"],[1,"d-flex","align-items-center","gap-3"],[1,"d-flex","align-items-center","gap-2"],[1,"bi","bi-funnel","text-primary","fs-5"],[1,"mb-0","fw-semibold"],[1,"badge","bg-primary","rounded-pill"],["role","group",1,"btn-group","btn-group-sm"],["type","button",1,"btn","btn-outline-secondary","border-0",3,"click","title"],[1,"bi"],["type","button","title","Limpiar todos los filtros",1,"btn","btn-outline-danger","border-0"],[1,"card-body","py-4"],[1,"card","border-0","shadow-sm"],[1,"d-flex","flex-column","flex-lg-row","align-items-start","align-items-lg-center","gap-3"],[1,"d-flex","align-items-center","gap-3","flex-grow-1"],[1,"bi","bi-list-ul","text-primary","fs-5"],[1,"badge","bg-info-subtle","text-info"],[1,"badge","bg-primary-subtle","text-primary"],[1,"d-flex","flex-wrap","align-items-center","gap-3"],[1,"d-flex","align-items-center","gap-2","small"],[1,"form-label","mb-0","text-muted","d-none","d-md-inline"],[1,"form-select","form-select-sm",2,"width","auto","min-width","70px",3,"change","value"],[3,"value",4,"ngFor","ngForOf","ngForTrackBy"],[1,"text-muted","d-none","d-md-inline"],["role","group","aria-label","Modo de vista",1,"btn-group","btn-group-sm"],["type","radio","name","viewMode","id","cardsView","autocomplete","off",1,"btn-check",3,"change","checked"],["for","cardsView","title","Vista tarjetas",1,"btn","btn-outline-primary"],[1,"bi","bi-grid-3x3-gap","me-1"],[1,"d-none","d-xl-inline"],["type","radio","name","viewMode","id","tableView","autocomplete","off",1,"btn-check",3,"change","checked"],["for","tableView","title","Vista tabla",1,"btn","btn-outline-primary"],[1,"bi","bi-table","me-1"],[1,"card-body","p-0"],[1,"d-flex","justify-content-center","align-items-center","py-5"],[1,"text-center","py-5"],[1,"card-footer","bg-light","border-top","py-2"],["type","button","data-bs-toggle","dropdown","aria-expanded","false","title","Opciones de exportaci\xF3n",1,"btn","btn-success","btn-sm","dropdown-toggle","d-flex","align-items-center"],[1,"bi","bi-download","me-1"],[1,"dropdown-menu"],["type","button",1,"dropdown-item",3,"click"],[1,"bi","bi-file-earmark-spreadsheet","me-2"],[1,"bi","bi-file-earmark-check","me-2"],["type","button","title","Limpiar todos los filtros",1,"btn","btn-outline-danger","border-0",3,"click"],[1,"bi","bi-x-circle"],[3,"formGroup"],[1,"row","g-3"],[1,"col-12","col-md-6","col-lg-4","col-xl-3"],[1,"form-label","fw-semibold","small"],[1,"input-group"],[1,"input-group-text","bg-light","border-end-0"],[1,"bi","bi-search","text-muted"],["type","text","placeholder","Nombre, email, documento...","formControlName","searchText",1,"form-control","border-start-0","bg-light"],["type","button","title","Limpiar b\xFAsqueda",1,"btn","btn-outline-secondary","border-start-0"],[1,"col-6","col-md-3","col-lg-2","col-xl-2"],["formControlName","role",1,"form-select","bg-light"],[3,"value"],[1,"col-6","col-md-3","col-lg-3","col-xl-2"],["formControlName","departmentId",1,"form-select","bg-light"],["formControlName","isActive",1,"form-select","bg-light"],[1,"col-6","col-md-3","col-lg-2","col-xl-1"],["formControlName","emailVerified","title","Email verificado",1,"form-select","bg-light"],["formControlName","phoneVerified","title","Tel\xE9fono verificado",1,"form-select","bg-light"],["type","date","formControlName","dateFrom",1,"form-control","bg-light"],["type","date","formControlName","dateTo",1,"form-control","bg-light"],[1,"col-12"],[1,"d-flex","flex-wrap","gap-3","mt-2"],[1,"form-check"],["type","checkbox","id","profileCompleted","formControlName","profileCompleted",1,"form-check-input",3,"value"],["for","profileCompleted",1,"form-check-label","small"],[1,"col-12","col-md-6","col-lg-3"],[1,"d-flex","gap-2"],["formControlName","sortBy",1,"form-select","bg-light"],["value","created_at"],["value","full_name"],["value","last_login"],["value","events_attended"],["formControlName","sortDirection",1,"form-select","bg-light",2,"width","auto","min-width","100px"],["value","desc"],["value","asc"],["type","button","title","Limpiar b\xFAsqueda",1,"btn","btn-outline-secondary","border-start-0",3,"click"],[1,"bi","bi-x"],[1,"text-center"],["role","status",1,"spinner-border","text-primary","mb-3",2,"width","3rem","height","3rem"],[1,"visually-hidden"],[1,"text-muted","mb-0"],[1,"text-muted","mb-4"],[1,"bi","bi-people","display-1","opacity-25"],[1,"text-muted","mb-2"],[1,"btn","btn-outline-primary",3,"click"],[1,"bi","bi-funnel","me-2"],["routerLink","/usuarios/nuevo",1,"btn","btn-primary"],[1,"bi","bi-plus-circle","me-2"],[1,"p-3","p-md-4"],[1,"table-responsive"],[1,"row","row-cols-1","row-cols-sm-2","row-cols-md-3","row-cols-lg-4","row-cols-xl-5","row-cols-xxl-6","g-3"],[1,"col"],[1,"card","h-100","border-0","shadow-sm","position-relative"],[1,"card-header","bg-light","border-bottom-0","py-2","d-flex","align-items-center","justify-content-between"],[1,"form-check","mb-0"],["type","checkbox",1,"form-check-input",3,"change","id","checked"],[1,"form-check-label","visually-hidden",3,"for"],[1,"badge","rounded-pill"],[1,"card-body","py-3"],[1,"d-flex","align-items-start","gap-3","mb-3"],[1,"avatar","bg-primary-subtle","text-primary","rounded-circle","d-flex","align-items-center","justify-content-center","flex-shrink-0",2,"width","40px","height","40px"],[1,"fw-bold","small"],[1,"flex-grow-1","overflow-hidden"],[1,"card-title","mb-1","text-truncate","fw-semibold"],[1,"text-muted","small","mb-0","text-truncate"],[1,"mb-3"],[1,"d-flex","align-items-center","gap-2","mb-2"],[1,"badge"],[1,"d-flex","align-items-center","gap-3","small"],[1,"flex-grow-1"],[1,"progress",2,"height","4px",3,"title"],["role","progressbar",1,"progress-bar"],[1,"d-flex","justify-content-between","text-center","small","text-muted"],[1,"fw-semibold"],[1,"card-footer","bg-transparent","border-top","py-2"],[1,"d-flex","gap-1","justify-content-end"],["title","Ver detalles",1,"btn","btn-outline-info","btn-sm",3,"routerLink"],[1,"bi","bi-eye"],["title","Editar",1,"btn","btn-outline-primary","btn-sm",3,"routerLink"],[1,"bi","bi-pencil"],[1,"bi","bi-building","text-muted","small"],[1,"text-muted","small","text-truncate",3,"title"],[1,"bi","bi-briefcase","text-muted","small"],[1,"bi","bi-geo-alt","text-muted","small"],[1,"text-muted","small"],[1,"table","table-hover","mb-0"],[1,"table-light"],["scope","col",1,"border-0",2,"width","50px"],["type","checkbox","id","selectAll",1,"form-check-input",3,"change","checked","indeterminate"],["for","selectAll",1,"form-check-label","visually-hidden"],["scope","col",1,"fw-semibold","border-0"],["scope","col",1,"fw-semibold","border-0","d-none","d-lg-table-cell"],["scope","col",1,"fw-semibold","border-0","d-none","d-xl-table-cell"],["scope","col",1,"fw-semibold","border-0",2,"width","140px"],[3,"table-active","class"],[1,"border-0"],[1,"avatar","bg-primary-subtle","text-primary","rounded-circle","d-flex","align-items-center","justify-content-center","flex-shrink-0",2,"width","36px","height","36px"],[1,"overflow-hidden"],[1,"fw-medium","text-truncate"],[1,"text-muted","small","text-truncate"],[1,"text-muted","small","d-none","d-xl-block","text-truncate"],[1,"border-0","d-none","d-lg-table-cell"],[1,"border-0","d-none","d-xl-table-cell"],[1,"text-muted"],[1,"d-flex","flex-column","gap-1"],[1,"btn-group","btn-group-sm"],["title","Ver detalles",1,"btn","btn-outline-info",3,"routerLink"],["title","Editar",1,"btn","btn-outline-primary",3,"routerLink"],[1,"bi","bi-building","me-1"],[1,"fw-medium","text-nowrap"],["containerClass","justify-content-between align-items-center",1,"mb-0",3,"pageChange","pageSizeChange","totalItems","pageSize","currentPage","showPageSizeSelector","pageSizeOptions","showGoToPage","showRangeInfo","showFirstLastButtons","maxVisiblePages","density"]],template:function(e,a){if(e&1){let s=S();n(0,"div",2)(1,"app-confirm-modal",3,0),x("accepted",function(){return b(s),v(a.onConfirmAccepted())})("cancelled",function(){return b(s),v(a.onConfirmCancelled())}),i(),n(3,"nav",4)(4,"ol",5)(5,"li",6)(6,"a",7),m(7,"i",8),n(8,"span",9),l(9,"Inicio"),i()()(),n(10,"li",10),l(11,"Usuarios"),i()()(),n(12,"div",11)(13,"div",12)(14,"h1",13),m(15,"i",14),n(16,"span"),l(17,"Gesti\xF3n de Usuarios"),i(),p(18,xe,2,1,"span",15),i(),n(19,"p",16),l(20,"Administra los usuarios del sistema"),i()(),n(21,"div",17)(22,"button",18),x("click",function(){return b(s),v(a.refreshData())}),p(23,_e,1,0,"span",19)(24,Ce,1,0,"i",20),n(25,"span",9),l(26,"Actualizar"),i()(),n(27,"button",21),m(28,"i",22),n(29,"span"),l(30,"Nuevo"),i(),n(31,"span",23),l(32,"Usuario"),i()(),p(33,Se,11,1,"div",24),i()(),n(34,"div",25)(35,"div",26)(36,"div",27)(37,"div",28)(38,"div",29),m(39,"i",30),n(40,"h6",31),l(41,"Filtros de B\xFAsqueda"),i()(),p(42,ye,2,1,"span",32),i(),n(43,"div",33)(44,"button",34),x("click",function(){return b(s),v(a.toggleFiltersPanel())}),m(45,"i",35),i(),p(46,Ee,2,0,"button",36),i()()(),p(47,Te,92,14,"div",37),i(),n(48,"div",38)(49,"div",26)(50,"div",39)(51,"div",40)(52,"div",29),m(53,"i",41),n(54,"h6",31),l(55,"Lista de Usuarios"),i()(),p(56,Fe,2,1,"span",42),p(57,Ie,2,1,"span",43),i(),n(58,"div",44)(59,"div",45)(60,"label",46),l(61,"Mostrar:"),i(),n(62,"select",47),x("change",function(be){return b(s),v(a.onPageSizeChange(be))}),B(63,Le,2,2,"option",48),i(),n(64,"span",49),l(65,"por p\xE1gina"),i()(),n(66,"div",50)(67,"input",51),x("change",function(){return b(s),v(a.setViewMode("cards"))}),i(),n(68,"label",52),m(69,"i",53),n(70,"span",54),l(71,"Tarjetas"),i()(),n(72,"input",55),x("change",function(){return b(s),v(a.setViewMode("table"))}),i(),n(73,"label",56),m(74,"i",57),n(75,"span",54),l(76,"Tabla"),i()()()()()(),n(77,"div",58),p(78,ke,7,0,"div",59)(79,Me,5,1,"div",60)(80,Je,2,2),i(),p(81,Ke,2,10,"div",61),i()()}e&2&&(o(),d("title",a.confirmAction().title)("message",a.confirmAction().message)("confirmText",a.confirmAction().confirmText),o(17),u(a.totalItems()>0?18:-1),o(4),d("disabled",a.loading()),o(),u(a.loading()?23:24),o(10),u(a.users().length>0?33:-1),o(),_("border-primary",a.hasActiveFilters()),o(8),u(a.hasActiveFilters()?42:-1),o(2),d("title",a.showFilters()?"Ocultar filtros":"Mostrar filtros"),z("aria-expanded",a.showFilters()),o(),_("bi-chevron-up",a.showFilters())("bi-chevron-down",!a.showFilters()),o(),u(a.hasActiveFilters()?46:-1),o(),u(a.showFilters()?47:-1),o(9),u(a.totalItems()>0?56:-1),o(),u(a.selectedUsers().length>0?57:-1),o(5),d("value",a.pageSize()),o(),d("ngForOf",a.pageSizeOptions)("ngForTrackBy",a.trackByUserId),o(4),d("checked",a.viewMode()==="cards"),o(5),d("checked",a.viewMode()==="table"),o(6),u(a.loading()?78:a.users().length===0?79:80),o(3),u(a.totalPages()>1?81:-1))},dependencies:[H,q,W,Z,se,ee,oe,le,K,J,ne,X,Y,te,ie,ae,ce,pe],encapsulation:2,changeDetection:0})};export{ue as UserListComponent};

import{a as z}from"./chunk-3UQ6E4NA.js";import"./chunk-VF5TSERA.js";import"./chunk-YUNYRAF7.js";import"./chunk-FK6H3RFT.js";import{b as B}from"./chunk-TO7S5C7C.js";import{a as _}from"./chunk-IYGYDPGO.js";import{c as P,d as C,e as R,f as M,h as A,k as j,l as G,r as L,s as O,u as q}from"./chunk-GFCFUV6K.js";import{e as T}from"./chunk-CF2QCA26.js";import{f as N,l as k}from"./chunk-NUA5R5QO.js";import{$b as I,Ac as F,Cb as V,Da as a,Fb as n,Gb as p,Hb as f,Na as w,Ra as v,_ as u,da as b,ea as x,gb as c,hb as t,ia as E,ib as i,jb as d,ma as y,qb as h,rb as g,tb as m,uc as D}from"./chunk-6O7NOF42.js";import"./chunk-LJ5XHLMQ.js";import{h as S}from"./chunk-FK42CRUA.js";function U(r,o){if(r&1){let e=h();t(0,"div",16)(1,"div",17)(2,"div",18)(3,"div",19),d(4,"i",20),t(5,"h1",21),n(6,"Verificar Certificado"),i(),t(7,"p",22),n(8,"Ingrese c\xF3digo de verificaci\xF3n"),i()(),t(9,"div",23)(10,"form",24),g("ngSubmit",function(){b(e);let l=m();return x(l.verifyCertificate())}),t(11,"div",25)(12,"label",26),n(13,"C\xF3digo de Verificaci\xF3n"),i(),d(14,"input",27),t(15,"div",28),d(16,"i",29),n(17,"C\xF3digo requerido "),i()(),t(18,"button",30),d(19,"i",31),n(20,"Verificar "),i()()()()()()}if(r&2){let e,s,l=m();a(10),c("formGroup",l.verifyForm),a(4),V("is-invalid",((e=l.verifyForm.get("shortCode"))==null?null:e.invalid)&&((e=l.verifyForm.get("shortCode"))==null?null:e.touched))("border-success",(s=l.verifyForm.get("shortCode"))==null?null:s.valid),a(4),c("disabled",l.verifyForm.invalid||l.loading())}}function J(r,o){r&1&&(t(0,"div",16)(1,"div",32)(2,"div",18)(3,"div",33),d(4,"div",34),t(5,"h2",35),n(6,"Verificando..."),i(),t(7,"p",36),n(8,"Validando autenticidad"),i()()()()())}function $(r,o){if(r&1){let e=h();t(0,"div",16)(1,"div",37)(2,"div",18)(3,"div",38),d(4,"i",39),t(5,"h2",40),n(6,"No Encontrado"),i()(),t(7,"div",41)(8,"p",42),n(9),i(),t(10,"button",43),g("click",function(){b(e);let l=m();return x(l.resetVerification())}),d(11,"i",44),n(12,"Reintentar "),i()()()()()}if(r&2){let e=m();a(9),p(e.error())}}function K(r,o){if(r&1&&(t(0,"div",96)(1,"div",97),d(2,"i",98),t(3,"div")(4,"div",14),n(5,"Email"),i(),t(6,"div",85),n(7),i()()()()),r&2){let e=m(2);a(7),p(e.certificate().participant.email)}}function Q(r,o){if(r&1&&(t(0,"div",96)(1,"div",97),d(2,"i",99),t(3,"div")(4,"div",14),n(5,"Documento"),i(),t(6,"div",85),n(7),i()()()()),r&2){let e=m(2);a(7),f("DNI: ",e.certificate().participant.documentNumber)}}function W(r,o){if(r&1&&(t(0,"div",45)(1,"div",97),d(2,"i",100),t(3,"div")(4,"div",14),n(5,"Instituci\xF3n"),i(),t(6,"div",85),n(7),i()()()()),r&2){let e=m(2);a(7),p(e.certificate().participant.institution)}}function X(r,o){if(r&1&&(t(0,"div",96)(1,"div",97),d(2,"i",101),t(3,"div")(4,"div",14),n(5,"Fecha de inicio"),i(),t(6,"div",85),n(7),i()()()()),r&2){let e=m(2);a(7),p(e.formatDate(e.certificate().event.startDate))}}function Y(r,o){if(r&1&&(t(0,"div",96)(1,"div",97),d(2,"i",102),t(3,"div")(4,"div",14),n(5,"Fecha de fin"),i(),t(6,"div",85),n(7),i()()()()),r&2){let e=m(2);a(7),p(e.formatDate(e.certificate().event.endDate))}}function Z(r,o){if(r&1&&(t(0,"div",96)(1,"div",97),d(2,"i",103),t(3,"div")(4,"div",14),n(5,"Duraci\xF3n"),i(),t(6,"div",85),n(7),i()()()()),r&2){let e=m(2);a(7),f("",e.certificate().event.durationHours," hrs acad\xE9micas")}}function ee(r,o){if(r&1&&(t(0,"span"),n(1),i()),r&2){let e=m(3);a(),f(", ",e.certificate().event.venueCity)}}function te(r,o){if(r&1&&(t(0,"div",96)(1,"div",97),d(2,"i",104),t(3,"div")(4,"div",14),n(5,"Ubicaci\xF3n"),i(),t(6,"div",85),n(7),v(8,ee,2,1,"span",105),i()()()()),r&2){let e=m(2);a(7),f(" ",e.certificate().event.venueName," "),a(),c("ngIf",e.certificate().event.venueCity)}}function ie(r,o){if(r&1&&(t(0,"p",106),n(1),i()),r&2){let e=m(2);a(),f(" ",e.certificate().participantRole.certificateTitle," ")}}function ne(r,o){r&1&&(t(0,"div",107)(1,"div",108),d(2,"i",109),t(3,"small",110)(4,"strong"),n(5,"No disponible:"),i(),n(6," El certificado no se puede descargar en su estado actual. "),i()()())}function re(r,o){if(r&1){let e=h();t(0,"div",16)(1,"div",45)(2,"div",46)(3,"div",47)(4,"div",12)(5,"div",48)(6,"span",49),d(7,"i",50),n(8),i(),t(9,"h1",51),n(10,"Certificado Aut\xE9ntico"),i(),t(11,"p",52),n(12,"Validaci\xF3n exitosa del documento"),i()()()(),t(13,"div",53)(14,"div",54)(15,"div",55)(16,"div",56)(17,"div",57)(18,"div",45)(19,"div",58)(20,"div",59),d(21,"i",60),i(),t(22,"h2",61),n(23,"Informaci\xF3n del Participante"),i()(),t(24,"div",62)(25,"div",63)(26,"h3",64),n(27),i(),t(28,"div",65),v(29,K,8,1,"div",66)(30,Q,8,1,"div",66)(31,W,8,1,"div",67),i()()()()(),t(32,"div",57)(33,"div",45)(34,"div",58)(35,"div",68),d(36,"i",69),i(),t(37,"h2",61),n(38,"Informaci\xF3n del Evento"),i()(),t(39,"div",62)(40,"div",63)(41,"h3",70),n(42),i(),t(43,"div",65),v(44,X,8,1,"div",66)(45,Y,8,1,"div",66)(46,Z,8,1,"div",66)(47,te,9,2,"div",66),i()()()()()()(),t(48,"div",71)(49,"div",72)(50,"div",73)(51,"div",74),d(52,"i",75),n(53),i(),v(54,ie,2,1,"p",76),i(),t(55,"div",77)(56,"div",78)(57,"h3",79),d(58,"i",80),n(59," Detalles del Certificado "),i()(),t(60,"div",63)(61,"div",81)(62,"div",82)(63,"div",14),n(64,"N\xFAmero"),i(),t(65,"div",83),n(66),i()(),t(67,"div",82)(68,"div",14),n(69,"C\xF3digo"),i(),t(70,"div",84),n(71),i()(),t(72,"div",82)(73,"div",14),n(74,"Emisi\xF3n"),i(),t(75,"div",85),n(76),i()(),t(77,"div",82)(78,"div",14),n(79,"Verificaciones"),i(),t(80,"div",85),d(81,"i",86),n(82),i()()()()(),t(83,"div",87)(84,"div",25)(85,"button",88),g("click",function(){b(e);let l=m();return x(l.downloadCertificate())}),t(86,"div",89),d(87,"i",90),t(88,"div")(89,"div",5),n(90,"Descargar PDF"),i(),t(91,"small",91),n(92,"Certificado oficial"),i()()(),t(93,"span",92),d(94,"i",93),i()()(),t(95,"button",94),g("click",function(){b(e);let l=m();return x(l.resetVerification())}),d(96,"i",44),n(97," Verificar otro certificado "),i(),v(98,ne,7,0,"div",95),i()()()()()()()()}if(r&2){let e=m();a(8),f(" ",e.getStatusLabel(e.certificate().isValid)," "),a(19),f(" ",e.certificate().participant.fullName," "),a(2),c("ngIf",e.certificate().participant.email),a(),c("ngIf",e.certificate().participant.documentNumber),a(),c("ngIf",e.certificate().participant.institution),a(11),f(" ",e.certificate().event.title," "),a(2),c("ngIf",e.certificate().event.startDate),a(),c("ngIf",e.certificate().event.endDate),a(),c("ngIf",e.certificate().event.durationHours),a(),c("ngIf",e.certificate().event.venueName),a(6),f(" ",e.certificate().participantRole.name," "),a(),c("ngIf",e.certificate().participantRole.certificateTitle),a(12),f(" ",e.certificate().certificateNumber," "),a(5),f(" ",e.certificate().shortCode," "),a(5),p(e.formatDate(e.certificate().issueDate)),a(6),f("",e.certificate().verificationCount," "),a(3),c("disabled",!e.canDownload(e.certificate())),a(13),c("ngIf",!e.canDownload(e.certificate()))}}var H=class r{route=u(N);fb=u(O);destroyRef=u(E);certificateService=u(B);CertificateGeneratorService=u(z);loadingState=y("idle");loading=I(()=>this.loadingState()==="loading");error=y(null);certificate=y(null);verifyForm=this.fb.group({shortCode:["",[C.required,C.minLength(3)]]});CertificateStatus=T;ngOnInit(){this.route.paramMap.pipe(_(this.destroyRef)).subscribe(o=>{let e=o.get("codigo");e&&(this.verifyForm.patchValue({shortCode:e}),this.verifyCertificate())})}verifyCertificate(){if(this.verifyForm.invalid){this.verifyForm.markAllAsTouched();return}let o=this.verifyForm.value.shortCode;this.loadingState.set("loading"),this.error.set(null),this.certificateService.verifyPublicCertificate(o).pipe(_(this.destroyRef)).subscribe({next:e=>{e.success&&e.certificate?(this.certificate.set(e.certificate),this.loadingState.set("success")):(this.error.set(e.error||e.message||"No se pudo verificar el certificado"),this.loadingState.set("error"))},error:e=>{console.error("Error verifying certificate:",e),this.error.set(e.message||"No se pudo verificar el certificado"),this.loadingState.set("error")}})}resetVerification(){this.certificate.set(null),this.error.set(null),this.loadingState.set("idle"),this.verifyForm.reset()}getStatusBadgeClass(o){return o?"bg-success-subtle text-success-emphasis border border-success-subtle":"bg-danger-subtle text-danger-emphasis border border-danger-subtle"}getStatusIcon(o){return o?"bi-check-circle":"bi-x-circle"}getStatusLabel(o){return o?"Certificado V\xE1lido":"Certificado No V\xE1lido"}formatDate(o){if(!o)return"Fecha no disponible";try{return new Date(o).toLocaleDateString("es-PE",{day:"2-digit",month:"2-digit",year:"numeric"})}catch{return o}}canDownload(o){return o.isValid}downloadCertificate(){return S(this,null,function*(){let o=this.certificate();if(!(!o||!this.canDownload(o)))try{this.loadingState.set("loading");let e=yield fetch("/template/certificado-1756515494650.json");if(!e.ok)throw new Error("No se pudo cargar la plantilla del certificado");let s=yield e.json(),l=yield this.CertificateGeneratorService.generarCertificadoPDFPorCodigo(s,o.shortCode,{formato:"A4",orientacion:"landscape",nombreArchivo:`certificado-${o.certificateNumber}`});l.success?console.log("Certificado descargado exitosamente desde verificaci\xF3n"):(console.error("Error al generar certificado:",l.message),this.error.set("Error al generar el certificado PDF"))}catch(e){console.error("Error al descargar certificado:",e),this.error.set("Error al descargar el certificado")}finally{this.loadingState.set("success")}})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=w({type:r,selectors:[["app-certificate-verify"]],decls:24,vars:4,consts:[[1,"min-vh-100","bg-light"],[1,"navbar","navbar-light","bg-white","shadow-sm","sticky-top"],[1,"container-fluid","px-3"],[1,"navbar-brand","mb-0","h1"],[1,"bi","bi-shield-check","text-success","me-2"],[1,"fw-bold"],[1,"text-muted","d-none","d-sm-inline"],[1,"text-muted","d-none","d-md-block"],[1,"bi","bi-info-circle","me-1"],[1,"container-fluid","px-3","py-4"],["class","row justify-content-center",4,"ngIf"],[1,"bg-white","border-top","py-3","mt-auto"],[1,"row","align-items-center"],[1,"col","text-center"],[1,"text-muted"],[1,"bi","bi-shield-check","text-success","me-1"],[1,"row","justify-content-center"],[1,"col-12","col-sm-8","col-md-6","col-lg-5","col-xl-4"],[1,"card","border-0","shadow","rounded-4"],[1,"card-header","bg-primary","text-white","text-center","border-0","rounded-top-4","py-4"],[1,"bi","bi-qr-code-scan","fs-1","mb-3"],[1,"h4","mb-1","fw-bold"],[1,"mb-0","opacity-75","small"],[1,"card-body","p-4"],[3,"ngSubmit","formGroup"],[1,"mb-3"],[1,"form-label","fw-semibold"],["type","text","formControlName","shortCode","placeholder","Ej: ABC123","maxlength","20",1,"form-control","form-control-lg","text-center","border-2",2,"letter-spacing","2px","font-family","'Courier New', monospace","font-weight","600"],[1,"invalid-feedback","text-center"],[1,"bi","bi-x-circle","me-1"],["type","submit",1,"btn","btn-primary","btn-lg","w-100","rounded-3","fw-semibold",3,"disabled"],[1,"bi","bi-search","me-2"],[1,"col-12","col-sm-6","col-md-4"],[1,"card-body","text-center","py-5"],[1,"spinner-border","text-primary","mb-3",2,"width","2.5rem","height","2.5rem"],[1,"h5","mb-1"],[1,"text-muted","small","mb-0"],[1,"col-12","col-sm-6","col-md-5"],[1,"card-header","bg-danger","text-white","text-center","border-0","rounded-top-4","py-4"],[1,"bi","bi-exclamation-triangle","fs-1","mb-2"],[1,"h5","mb-1","fw-bold"],[1,"card-body","text-center","p-4"],[1,"text-muted","mb-3"],[1,"btn","btn-outline-primary","rounded-3",3,"click"],[1,"bi","bi-arrow-counterclockwise","me-2"],[1,"col-12"],[1,"card","border-0","shadow","rounded-4","overflow-hidden"],[1,"card-header","bg-gradient","text-white","text-center","border-0","py-4",2,"background","linear-gradient(135deg, #198754 0%, #20c997 100%)"],[1,"col"],[1,"badge","bg-white","text-success","fs-6","px-3","py-2","rounded-pill","mb-3"],[1,"bi","bi-patch-check-fill","me-2"],[1,"h3","mb-1","fw-bold"],[1,"mb-0","opacity-75"],[1,"card-body","p-0"],[1,"row","g-0"],[1,"col-12","col-lg-8"],[1,"p-4"],[1,"row","mb-4"],[1,"d-flex","align-items-center","mb-3"],[1,"bg-primary","text-white","rounded-circle","p-2","me-3"],[1,"bi","bi-person-fill"],[1,"h5","mb-0","fw-bold"],[1,"card","bg-light","border-0"],[1,"card-body","p-3"],[1,"h5","fw-bold","text-primary","mb-3"],[1,"row","g-3","small"],["class","col-12 col-sm-6",4,"ngIf"],["class","col-12",4,"ngIf"],[1,"bg-info","text-white","rounded-circle","p-2","me-3"],[1,"bi","bi-calendar-event"],[1,"h6","fw-bold","text-info","mb-3"],[1,"col-12","col-lg-4"],[1,"bg-light","h-100","p-4"],[1,"text-center","mb-4"],[1,"badge","bg-warning","text-dark","fs-6","px-3","py-2","rounded-pill","mb-2"],[1,"bi","bi-award","me-1"],["class","small text-muted mb-0",4,"ngIf"],[1,"card","border-0","shadow-sm","mb-4"],[1,"card-header","bg-white","border-bottom"],[1,"h6","mb-0","fw-bold"],[1,"bi","bi-info-circle","text-primary","me-2"],[1,"row","g-2","text-center","small"],[1,"col-6"],[1,"fw-bold","text-primary","text-break",2,"font-size","0.75rem","font-family","monospace"],[1,"fw-bold","text-primary",2,"font-family","monospace"],[1,"fw-medium"],[1,"bi","bi-eye","me-1"],[1,"text-center"],["type","button",1,"btn","btn-success","btn-lg","w-100","rounded-3","shadow-sm","position-relative",3,"click","disabled"],[1,"d-flex","align-items-center","justify-content-center"],[1,"bi","bi-download","me-2","fs-5"],[1,"opacity-75"],[1,"position-absolute","top-0","start-100","translate-middle","badge","rounded-pill","bg-light","text-success","border","border-success",2,"font-size","0.6rem"],[1,"bi","bi-shield-check"],["type","button",1,"btn","btn-outline-secondary","btn-sm","w-100","rounded-3",3,"click"],["class","alert alert-warning mt-3 p-2 rounded-3",4,"ngIf"],[1,"col-12","col-sm-6"],[1,"d-flex","align-items-center"],[1,"bi","bi-envelope","text-muted","me-2"],[1,"bi","bi-card-text","text-muted","me-2"],[1,"bi","bi-building","text-muted","me-2"],[1,"bi","bi-calendar3","text-muted","me-2"],[1,"bi","bi-calendar-check","text-muted","me-2"],[1,"bi","bi-clock","text-muted","me-2"],[1,"bi","bi-geo-alt","text-muted","me-2"],[4,"ngIf"],[1,"small","text-muted","mb-0"],[1,"alert","alert-warning","mt-3","p-2","rounded-3"],[1,"d-flex","align-items-start"],[1,"bi","bi-exclamation-triangle","me-2","mt-1","flex-shrink-0"],[1,"mb-0"]],template:function(e,s){e&1&&(t(0,"div",0)(1,"nav",1)(2,"div",2)(3,"span",3),d(4,"i",4),t(5,"span",5),n(6,"Verificaci\xF3n"),i(),t(7,"small",6),n(8," de Certificados"),i()(),t(9,"small",7),d(10,"i",8),n(11," Sistema oficial de validaci\xF3n "),i()()(),t(12,"main",9),v(13,U,21,6,"div",10)(14,J,9,0,"div",10)(15,$,13,1,"div",10)(16,re,99,18,"div",10),i(),t(17,"footer",11)(18,"div",2)(19,"div",12)(20,"div",13)(21,"small",14),d(22,"i",15),n(23," Sistema de verificaci\xF3n oficial y seguro "),i()()()()()()),e&2&&(a(13),c("ngIf",!s.certificate()&&!s.loading()&&!s.error()),a(),c("ngIf",s.loading()),a(),c("ngIf",s.error()),a(),c("ngIf",s.certificate()&&!s.loading()))},dependencies:[F,D,k,q,A,P,R,M,L,j,G],encapsulation:2})};export{H as CertificateVerifyComponent};

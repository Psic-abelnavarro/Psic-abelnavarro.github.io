import{$ as v,D as t,E as i,F as u,G as x,J as b,K as h,S as n,T as k,d as g,e as E,ea as y,f,ha as _,i as c,la as S,m as s,p as C,x as d,y as m}from"./chunk-N3ZHNQ6S.js";import"./chunk-LJ5XHLMQ.js";import{h as l}from"./chunk-FK42CRUA.js";function A(o,e){o&1&&(t(0,"div",4)(1,"span",5),n(2,"Processing authentication..."),i()(),t(3,"h5",6),n(4,"Completing GitHub Authentication"),i(),t(5,"p",7),n(6,"Please wait while we verify your credentials..."),i())}function P(o,e){if(o&1){let r=x();t(0,"div",2),u(1,"i",8),t(2,"strong"),n(3,"Authentication Failed"),i(),t(4,"p",9),n(5),i(),t(6,"button",10),b("click",function(){E(r);let p=h();return f(p.retry())}),u(7,"i",11),n(8," Retry "),i(),t(9,"button",12),b("click",function(){E(r);let p=h();return f(p.goToLogin())}),n(10," Back to Login "),i()()}if(o&2){let r=h();s(5),k(r.errorMessage())}}function M(o,e){o&1&&(t(0,"div",3),u(1,"i",13),t(2,"h5"),n(3,"Authentication Successful!"),i(),t(4,"p",7),n(5,"Redirecting to your certificate..."),i()())}var w=class o{router=g(_);authService=g(S);isProcessing=c(!0);hasError=c(!1);errorMessage=c(null);isAuthenticated=this.authService.isAuthenticated;authLoading=this.authService.loading;authError=this.authService.error;constructor(){v(()=>{this.isAuthenticated()&&(this.isProcessing.set(!1),this.hasError.set(!1),console.log("Authentication successful, redirecting to certificate"),setTimeout(()=>{this.router.navigate(["/certificate"])},1500))}),v(()=>{let e=this.authError();e&&!this.isAuthenticated()&&(this.isProcessing.set(!1),this.hasError.set(!0),this.errorMessage.set(e),console.error("Authentication error in callback:",e))})}ngOnInit(){return l(this,null,function*(){yield this.handleAuthCallback()})}handleAuthCallback(){return l(this,null,function*(){try{if(this.isProcessing.set(!0),this.hasError.set(!1),this.authService.clearError(),yield new Promise(e=>setTimeout(e,1e3)),yield this.authService.checkSession(),!this.isAuthenticated())throw new Error("Authentication verification failed")}catch(e){console.error("Callback handling error:",e),this.isProcessing.set(!1),this.hasError.set(!0),this.errorMessage.set(e?.message||"Failed to complete authentication")}})}retry(){return l(this,null,function*(){yield this.handleAuthCallback()})}goToLogin(){this.router.navigate(["/login"])}static \u0275fac=function(r){return new(r||o)};static \u0275cmp=C({type:o,selectors:[["app-callback"]],decls:5,vars:3,consts:[[1,"d-flex","justify-content-center","align-items-center","vh-100"],[1,"text-center"],[1,"alert","alert-danger"],[1,"text-success"],["role","status",1,"spinner-border","text-primary","mb-3"],[1,"visually-hidden"],[1,"text-primary"],[1,"text-muted"],[1,"bi","bi-exclamation-triangle-fill","me-2"],[1,"mb-2","mt-2"],[1,"btn","btn-outline-danger","btn-sm",3,"click"],[1,"bi","bi-arrow-clockwise","me-1"],[1,"btn","btn-link","btn-sm","ms-2",3,"click"],[1,"bi","bi-check-circle-fill","display-4","mb-3"]],template:function(r,a){r&1&&(t(0,"div",0)(1,"div",1),d(2,A,7,0),d(3,P,11,1,"div",2),d(4,M,6,0,"div",3),i()()),r&2&&(s(2),m(a.isProcessing()?2:-1),s(),m(a.hasError()?3:-1),s(),m(a.isAuthenticated()?4:-1))},dependencies:[y],encapsulation:2})};export{w as CallbackComponent};

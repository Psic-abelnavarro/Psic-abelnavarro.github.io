import{La as o,Ma as u,g as l,o as s,sa as a}from"./chunk-IWV4FJLC.js";import{i as t}from"./chunk-ODN5LVDJ.js";var c=class i{supabase;_currentUser=s(null);_loading=s(!1);_error=s(null);currentUser=this._currentUser.asReadonly();loading=this._loading.asReadonly();error=this._error.asReadonly();isAuthenticated=a(()=>this._currentUser()!==null);userEmail=a(()=>this._currentUser()?.email??null);userId=a(()=>this._currentUser()?.id??null);constructor(){this.supabase=u(o.supabase.url,o.supabase.anonKey),this.initializeAuth()}initializeAuth(){return t(this,null,function*(){try{yield this.checkSession(),this.supabase.auth.onAuthStateChange((r,e)=>{let n=e?.user??null;this._currentUser.set(n),this._error.set(null)})}catch{this._error.set("Failed to initialize authentication")}})}checkSession(){return t(this,null,function*(){try{this._loading.set(!0),this._error.set(null);let{data:{session:r},error:e}=yield this.supabase.auth.getSession();if(e)throw e;this._currentUser.set(r?.user??null)}catch(r){this._currentUser.set(null),this._error.set(r?.message||"Failed to check session")}finally{this._loading.set(!1)}})}signInWithGitHub(){return t(this,null,function*(){try{this._loading.set(!0),this._error.set(null);let{data:r,error:e}=yield this.supabase.auth.signInWithOAuth({provider:"github",options:{redirectTo:`${window.location.origin}/certificate`,scopes:"read:user user:email"}});return e?(this._error.set(e.message),{data:null,error:e}):{data:r,error:null}}catch(r){let e=r?.message||"Unexpected error during GitHub authentication";return this._error.set(e),{data:null,error:{message:e}}}finally{this._loading.set(!1)}})}signOut(){return t(this,null,function*(){try{this._loading.set(!0),this._error.set(null);let{error:r}=yield this.supabase.auth.signOut();return r?(this._error.set(r.message),{error:r}):(this._currentUser.set(null),{error:null})}catch(r){let e=r?.message||"Failed to sign out";return this._error.set(e),{error:{message:e}}}finally{this._loading.set(!1)}})}getCurrentUser(){return this._currentUser()}clearError(){this._error.set(null)}isCurrentUserAdmin(){return t(this,null,function*(){try{if(!this.userEmail())return!1;let{data:e,error:n}=yield this.supabase.rpc("is_admin");return n?!1:e||!1}catch{return!1}})}static \u0275fac=function(e){return new(e||i)};static \u0275prov=l({token:i,factory:i.\u0275fac,providedIn:"root"})};export{c as a};

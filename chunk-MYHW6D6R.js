import{b as Z}from"./chunk-22IHSIXM.js";import{b as R,c as V,d,e as M,f as G,h as O,i as $,k as B,l as j,m as H,n as U,o as z,p as K,q as Y,r as J,s as Q,u as W}from"./chunk-KBXA6SDK.js";import{a as X}from"./chunk-CYLPXQIR.js";import"./chunk-MPC7SZEK.js";import{a as u,c as L}from"./chunk-TMGCMHHJ.js";import{b as A}from"./chunk-IIPOJGOQ.js";import{f as F,h as P,i as _,l as w}from"./chunk-C3HOFUSH.js";import{Bc as k,Da as l,Db as p,Gb as n,Hb as T,Na as h,Sb as b,Vb as I,Wb as q,_ as c,bb as v,cb as f,fb as g,gb as x,hb as s,ia as S,ib as e,jb as i,kb as o,ma as E,sb as C,ub as D,zc as N}from"./chunk-5W5GNUFO.js";import"./chunk-LJ5XHLMQ.js";import"./chunk-FK42CRUA.js";var ee=m=>["/eventos",m],ne=(m,t)=>t.key;function re(m,t){if(m&1&&(e(0,"option",43),n(1),i()),m&2){let r=t.$implicit;s("value",r.key),l(),T(r.value.name)}}function oe(m,t){if(m&1&&(g(0,re,2,2,"option",43,ne),I(2,"keyvalue")),m&2){let r=D();x(q(2,0,r.eventTypes()))}}function ae(m,t){m&1&&(o(0,"i",65),e(1,"span",12),n(2,"Guardar Cambios"),i())}function le(m,t){m&1&&(o(0,"span",66),e(1,"span",12),n(2,"Guardando..."),i())}var te=class m{fb=c(Q);router=c(P);route=c(F);destroyRef=c(S);staticData=c(X);eventService=c(Z);LocationType=A;form;eventId;submittingSig=E(!1);eventTypesSig=L(this.staticData.eventTypes$,{initialValue:null});ngOnInit(){this.form=this.fb.group({title:["",[d.required,d.minLength(5)]],shortDescription:[""],description:[""],eventTypeId:["",d.required],startDate:["",d.required],endDate:["",d.required],locationType:["",d.required],maxParticipants:[null],cost:[0,[d.min(0)]],isPublic:[!0],requiresApproval:[!1],requiresCertificate:[!1]}),this.staticData.loadEventTypes().pipe(u(this.destroyRef)).subscribe(),this.route.paramMap.pipe(u(this.destroyRef)).subscribe(t=>{let r=Number(t.get("id"));this.eventId=r,this.load()})}eventTypes(){return this.eventTypesSig()}isSubmitting(){return this.submittingSig()}invalid(t){let r=this.form.get(t);return!!r&&r.invalid&&(r.dirty||r.touched)}fromIso(t){if(!t)return null;let r=new Date(t),a=r.getFullYear(),y=String(r.getMonth()+1).padStart(2,"0"),ie=String(r.getDate()).padStart(2,"0");return`${a}-${y}-${ie}`}toIso(t){if(t)return new Date(t+"T00:00:00").toISOString()}load(){this.eventService.getEventById(this.eventId).pipe(u(this.destroyRef)).subscribe({next:t=>{this.form.patchValue({title:t.title,shortDescription:t.shortDescription||"",description:t.description||"",eventTypeId:t.eventTypeId,startDate:this.fromIso(t.startDate),endDate:this.fromIso(t.endDate),locationType:t.locationType,maxParticipants:t.maxParticipants||null,cost:t.cost||0,isPublic:t.isPublic,requiresApproval:t.requiresApproval,requiresCertificate:t.requiresCertificate})},error:()=>this.router.navigate(["/eventos"])})}onSubmit(){if(this.form.invalid||this.isSubmitting())return;this.submittingSig.set(!0);let t=this.form.value,r={title:t.title.trim(),shortDescription:t.shortDescription||void 0,description:t.description||void 0,eventTypeId:Number(t.eventTypeId),startDate:this.toIso(t.startDate),endDate:this.toIso(t.endDate),locationType:t.locationType,maxParticipants:t.maxParticipants?Number(t.maxParticipants):void 0,cost:t.cost!==null&&t.cost!==void 0?Number(t.cost):0,isPublic:!!t.isPublic,requiresApproval:!!t.requiresApproval,requiresCertificate:!!t.requiresCertificate};this.eventService.updateEvent(this.eventId,r).pipe(u(this.destroyRef)).subscribe({next:()=>{this.router.navigate(["/eventos",this.eventId])},error:a=>{console.error("Actualizar evento error",a),this.submittingSig.set(!1)},complete:()=>this.submittingSig.set(!1)})}static \u0275fac=function(r){return new(r||m)};static \u0275cmp=h({type:m,selectors:[["app-event-edit"]],decls:136,vars:23,consts:[[1,"container-fluid","py-3"],["aria-label","breadcrumb",1,"mb-3"],[1,"breadcrumb","mb-0","small"],[1,"breadcrumb-item"],["routerLink","/",1,"text-decoration-none","link-primary"],[1,"bi","bi-house-door","me-1"],[1,"d-none","d-sm-inline"],["routerLink","/eventos",1,"text-decoration-none","link-primary"],["aria-current","page",1,"breadcrumb-item","active"],[1,"d-flex","flex-column","flex-md-row","align-items-start","align-items-md-center","justify-content-between","gap-2","mb-4"],[1,"h6","mb-1","fw-normal","d-flex","align-items-center"],[1,"bi","bi-pencil-square","me-2","text-primary"],[1,"small"],[1,"text-muted","fs-8","mb-0"],[1,"d-flex","gap-2"],["title","Ver evento",1,"btn","btn-outline-info","btn-sm",3,"routerLink"],[1,"bi","bi-eye","me-1"],[1,"small","d-none","d-sm-inline"],["novalidate","","aria-label","Formulario de edici\xF3n de evento",1,"needs-validation",3,"ngSubmit","formGroup"],[1,"row","g-3"],[1,"col-12","col-lg-8"],[1,"card","border-0","shadow-sm"],[1,"card-header","bg-light","border-0","py-2"],[1,"mb-0","fw-normal","small","d-flex","align-items-center"],[1,"bi","bi-pencil-square","me-1","text-primary"],[1,"card-body","py-3"],[1,"mb-3"],[1,"form-label","fw-normal","small","mb-1"],["type","text","formControlName","title","required","","placeholder","Ingrese el t\xEDtulo del evento...",1,"form-control","form-control-sm"],[1,"invalid-feedback","fs-8"],["type","text","formControlName","shortDescription","maxlength","160","placeholder","Resumen breve del evento...",1,"form-control","form-control-sm"],[1,"form-text","fs-8"],["rows","4","formControlName","description","placeholder","Descripci\xF3n detallada del evento...",1,"form-control","form-control-sm"],[1,"row","g-2"],[1,"col-12","col-md-6"],["formControlName","eventTypeId","required","",1,"form-select","form-select-sm"],["value",""],[1,"col-6","col-md-3"],["type","date","formControlName","startDate","required","",1,"form-control","form-control-sm"],["type","date","formControlName","endDate","required","",1,"form-control","form-control-sm"],[1,"row","g-2","mt-2"],[1,"col-12","col-md-4"],["formControlName","locationType","required","",1,"form-select","form-select-sm"],[3,"value"],[1,"col-6","col-md-4"],["type","number","min","1","formControlName","maxParticipants","placeholder","Ej: 50",1,"form-control","form-control-sm"],["type","number","min","0","step","0.01","formControlName","cost","placeholder","0.00",1,"form-control","form-control-sm"],[1,"col-12","col-lg-4"],[1,"card","border-0","shadow-sm","mb-3"],[1,"bi","bi-toggles","me-1","text-primary"],[1,"form-check","form-switch","mb-3"],["type","checkbox","id","isPublic","formControlName","isPublic",1,"form-check-input"],["for","isPublic",1,"form-check-label","fw-normal","small"],[1,"bi","bi-globe","me-1","text-info"],["type","checkbox","id","requiresApproval","formControlName","requiresApproval",1,"form-check-input"],["for","requiresApproval",1,"form-check-label","fw-normal","small"],[1,"bi","bi-check-circle","me-1","text-warning"],[1,"form-check","form-switch","mb-0"],["type","checkbox","id","requiresCertificate","formControlName","requiresCertificate",1,"form-check-input"],["for","requiresCertificate",1,"form-check-label","fw-normal","small"],[1,"bi","bi-award","me-1","text-success"],[1,"d-grid","gap-2"],["type","submit",1,"btn","btn-primary","btn-sm",3,"disabled"],[1,"btn","btn-outline-secondary","btn-sm",3,"routerLink"],[1,"bi","bi-x","me-1"],[1,"bi","bi-save","me-1"],["aria-hidden","true",1,"spinner-border","spinner-border-sm","me-1"]],template:function(r,a){r&1&&(e(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),o(5,"i",5),e(6,"span",6),n(7,"Inicio"),i()()(),e(8,"li",3)(9,"a",7),n(10,"Eventos"),i()(),e(11,"li",8),n(12,"Editar evento"),i()()(),e(13,"div",9)(14,"div")(15,"h1",10),o(16,"i",11),e(17,"span",12),n(18,"Editar Evento"),i()(),e(19,"p",13),n(20,"Modificar informaci\xF3n del evento existente"),i()(),e(21,"div",14)(22,"a",15),o(23,"i",16),e(24,"span",17),n(25,"Ver Evento"),i()()()(),e(26,"form",18),C("ngSubmit",function(){return a.onSubmit()}),e(27,"div",19)(28,"div",20)(29,"div",21)(30,"div",22)(31,"h6",23),o(32,"i",24),n(33," Informaci\xF3n del Evento "),i()(),e(34,"div",25)(35,"div",26)(36,"label",27),n(37,"T\xEDtulo del evento"),i(),o(38,"input",28),e(39,"div",29),n(40,"T\xEDtulo es requerido (m\xEDn. 5 caracteres)."),i()(),e(41,"div",26)(42,"label",27),n(43,"Descripci\xF3n corta"),i(),o(44,"input",30),e(45,"div",31),n(46,"M\xE1ximo 160 caracteres para vista previa"),i()(),e(47,"div",26)(48,"label",27),n(49,"Descripci\xF3n completa"),i(),o(50,"textarea",32),i(),e(51,"div",33)(52,"div",34)(53,"label",27),n(54,"Tipo de evento"),i(),e(55,"select",35)(56,"option",36),n(57,"Seleccione un tipo..."),i(),v(58,oe,3,2),i(),e(59,"div",29),n(60,"Seleccione un tipo de evento."),i()(),e(61,"div",37)(62,"label",27),n(63,"Fecha inicio"),i(),o(64,"input",38),e(65,"div",29),n(66,"Fecha requerida."),i()(),e(67,"div",37)(68,"label",27),n(69,"Fecha fin"),i(),o(70,"input",39),e(71,"div",29),n(72,"Fecha requerida."),i()()(),e(73,"div",40)(74,"div",41)(75,"label",27),n(76,"Modalidad"),i(),e(77,"select",42)(78,"option",36),n(79,"Seleccione modalidad..."),i(),e(80,"option",43),n(81,"Presencial"),i(),e(82,"option",43),n(83,"Virtual"),i(),e(84,"option",43),n(85,"H\xEDbrido"),i()(),e(86,"div",29),n(87,"Seleccione la modalidad."),i()(),e(88,"div",44)(89,"label",27),n(90,"Aforo m\xE1ximo"),i(),o(91,"input",45),e(92,"div",31),n(93,"Opcional"),i()(),e(94,"div",44)(95,"label",27),n(96,"Costo (PEN)"),i(),o(97,"input",46),e(98,"div",31),n(99,"0 = Gratuito"),i()()()()()(),e(100,"div",47)(101,"div",48)(102,"div",22)(103,"h6",23),o(104,"i",49),n(105," Configuraci\xF3n del Evento "),i()(),e(106,"div",25)(107,"div",50),o(108,"input",51),e(109,"label",52),o(110,"i",53),n(111," Evento p\xFAblico "),i(),e(112,"div",31),n(113,"Visible para todos los usuarios"),i()(),e(114,"div",50),o(115,"input",54),e(116,"label",55),o(117,"i",56),n(118," Requiere aprobaci\xF3n "),i(),e(119,"div",31),n(120,"Las inscripciones deben ser aprobadas"),i()(),e(121,"div",57),o(122,"input",58),e(123,"label",59),o(124,"i",60),n(125," Emite certificado "),i(),e(126,"div",31),n(127,"Genera certificados autom\xE1ticamente"),i()()()(),e(128,"div",61)(129,"button",62),v(130,ae,3,0)(131,le,3,0),i(),e(132,"a",63),o(133,"i",64),e(134,"span",12),n(135,"Cancelar"),i()()()()()()()),r&2&&(l(22),s("routerLink",b(19,ee,a.eventId)),l(4),s("formGroup",a.form),l(12),p("is-invalid",a.invalid("title")),l(17),p("is-invalid",a.invalid("eventTypeId")),l(3),f(a.eventTypes()?58:-1),l(6),p("is-invalid",a.invalid("startDate")),l(6),p("is-invalid",a.invalid("endDate")),l(7),p("is-invalid",a.invalid("locationType")),l(3),s("value",a.LocationType.PRESENCIAL),l(2),s("value",a.LocationType.VIRTUAL),l(2),s("value",a.LocationType.HIBRIDO),l(45),s("disabled",a.isSubmitting()||a.form.invalid),l(),f(a.isSubmitting()?131:130),l(2),s("routerLink",b(21,ee,a.eventId)))},dependencies:[k,W,O,U,z,V,$,R,H,M,G,Y,J,K,B,j,w,_,N],encapsulation:2})};export{te as EventEditComponent};

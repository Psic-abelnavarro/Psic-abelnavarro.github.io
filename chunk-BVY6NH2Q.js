import{c as E}from"./chunk-TMGCMHHJ.js";import{l as P}from"./chunk-IIPOJGOQ.js";import{h as k}from"./chunk-C3HOFUSH.js";import{Bc as S,Da as d,Gb as n,Hb as w,Na as _,_ as b,bb as h,bc as x,cb as p,da as v,ea as f,lb as t,ma as u,mb as i,nb as l,q as m,rb as y,tb as C,ub as g}from"./chunk-5W5GNUFO.js";import"./chunk-LJ5XHLMQ.js";import{h as c}from"./chunk-FK42CRUA.js";function T(o,e){o&1&&(t(0,"div",5)(1,"div",6)(2,"span",7),n(3,"Processing authentication..."),i()(),t(4,"h5",8),n(5,"Procesando autenticaci\xF3n"),i(),t(6,"p",9),n(7,"Verificando tus credenciales con Google..."),i(),t(8,"div",10),l(9,"div",11),i()())}function D(o,e){if(o&1){let r=y();t(0,"div",5),l(1,"i",12),t(2,"h5",13),n(3,"Error de autenticaci\xF3n"),i(),t(4,"div",14)(5,"small"),n(6),i()(),t(7,"div",15)(8,"button",16),C("click",function(){v(r);let s=g();return f(s.retry())}),l(9,"i",17),n(10," Intentar de nuevo "),i(),t(11,"button",18),C("click",function(){v(r);let s=g();return f(s.goToLogin())}),l(12,"i",19),n(13," Volver al login "),i()()()}if(o&2){let r=g();d(6),w(r.errorMessage())}}function I(o,e){o&1&&(t(0,"div",5),l(1,"i",20),t(2,"h5",21),n(3,"\xA1Autenticaci\xF3n exitosa!"),i(),t(4,"p",9),n(5,"Redirigiendo..."),i(),t(6,"div",10),l(7,"div",22),i()())}var A=class o{router=b(k);authService=b(P);DEFAULT_REDIRECT="/";isProcessing=u(!0);hasError=u(!1);errorMessage=u(null);isAuthenticated=E(this.authService.authState$.pipe(m(e=>e.isAuthenticated)),{initialValue:!1});authLoading=E(this.authService.authState$.pipe(m(e=>e.loading)),{initialValue:!0});authError=E(this.authService.authState$.pipe(m(e=>e.error)),{initialValue:null});constructor(){x(()=>{this.isAuthenticated()&&(this.isProcessing.set(!1),this.hasError.set(!1),setTimeout(()=>{this.redirectToIntendedDestination()},1e3))}),x(()=>{let e=this.authError();e&&!this.isAuthenticated()&&(this.isProcessing.set(!1),this.hasError.set(!0),this.errorMessage.set(e))})}ngOnInit(){return c(this,null,function*(){yield this.handleAuthCallback()})}handleAuthCallback(){return c(this,null,function*(){try{this.isProcessing.set(!0),this.hasError.set(!1),this.authService.clearError();let{searchParams:e}=new URL(window.location.href);if(e.has("code")||e.has("access_token")||e.has("error")){let s=e.get("error");if(s)throw new Error(`OAuth error: ${s} - ${e.get("error_description")||"Error desconocido"}`)}yield new Promise(s=>setTimeout(s,1500));let a=yield this.authService.handleAuthCallback();if(!a.success)throw new Error(a.error||"Error de verificaci\xF3n de autenticaci\xF3n. Por favor, int\xE9ntalo de nuevo.")}catch(e){this.isProcessing.set(!1),this.hasError.set(!0),this.errorMessage.set(e?.message||"Error al completar la autenticaci\xF3n")}})}retry(){return c(this,null,function*(){yield this.handleAuthCallback()})}goToLogin(){this.router.navigate(["/ingresar"])}redirectToIntendedDestination(){let r=sessionStorage.getItem("intended-url")||this.DEFAULT_REDIRECT;sessionStorage.removeItem("intended-url"),this.router.navigateByUrl(r)}static \u0275fac=function(r){return new(r||o)};static \u0275cmp=_({type:o,selectors:[["app-callback"]],decls:8,vars:3,consts:[[1,"container-fluid","vh-100","d-flex","justify-content-center","align-items-center","bg-light"],[1,"row","justify-content-center","w-100"],[1,"col-12","col-sm-8","col-md-6","col-lg-4"],[1,"card","shadow","border-0"],[1,"card-body","p-4","text-center"],[1,"mb-4"],["role","status",1,"spinner-border","text-primary","mb-3",2,"width","3rem","height","3rem"],[1,"visually-hidden"],[1,"text-primary","mb-2"],[1,"text-muted","small"],[1,"progress",2,"height","4px"],["role","progressbar",1,"progress-bar","progress-bar-striped","progress-bar-animated",2,"width","100%"],[1,"bi","bi-exclamation-triangle-fill","text-danger","display-4","mb-3"],[1,"text-danger","mb-2"],[1,"alert","alert-danger","text-start"],[1,"d-grid","gap-2"],[1,"btn","btn-outline-danger",3,"click"],[1,"bi","bi-arrow-clockwise","me-2"],[1,"btn","btn-link","text-muted",3,"click"],[1,"bi","bi-arrow-left","me-1"],[1,"bi","bi-check-circle-fill","text-success","display-4","mb-3"],[1,"text-success","mb-2"],["role","progressbar",1,"progress-bar","bg-success","progress-bar-striped","progress-bar-animated",2,"width","100%"]],template:function(r,a){r&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),h(5,T,10,0,"div",5),h(6,D,14,1,"div",5),h(7,I,8,0,"div",5),i()()()()()),r&2&&(d(5),p(a.isProcessing()?5:-1),d(),p(a.hasError()?6:-1),d(),p(a.isAuthenticated()?7:-1))},dependencies:[S],encapsulation:2})};export{A as CallbackComponent};

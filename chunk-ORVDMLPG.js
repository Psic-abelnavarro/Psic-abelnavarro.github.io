import{b as z}from"./chunk-P2TS72RO.js";import{a as G}from"./chunk-IWJALEKK.js";import"./chunk-MPC7SZEK.js";import{a as B}from"./chunk-G3MWZKLR.js";import{d as h,e as S}from"./chunk-2UJ2GV6T.js";import{f as F,i as j,l as V}from"./chunk-GBIZ2ZL5.js";import{Cb as M,Cc as O,Da as o,Fb as E,Gb as n,Hb as m,Ib as c,Kb as A,Na as R,Q as D,Sb as T,_ as v,bb as b,cb as g,cc as f,da as I,dc as L,ea as w,gc as y,hb as P,ia as U,ib as i,jb as t,kb as l,ma as x,o as _,rb as N,sb as k,ub as p}from"./chunk-DWRMJDZW.js";import"./chunk-LJ5XHLMQ.js";import{h as C}from"./chunk-FK42CRUA.js";var Z=s=>["/usuarios",s,"editar"];function Y(s,r){s&1&&(i(0,"div",1)(1,"div",3)(2,"div",4)(3,"span",5),n(4,"Cargando..."),t()(),i(5,"p",6),n(6,"Cargando usuario..."),t()()())}function q(s,r){if(s&1){let e=N();i(0,"div",2)(1,"div",7)(2,"div",8),l(3,"i",9),i(4,"div",10)(5,"h6",11),n(6,"Error al cargar"),t(),i(7,"p",12),n(8),t(),i(9,"div",13)(10,"button",14),k("click",function(){I(e);let d=p();return w(d.retryLoad())}),l(11,"i",15),n(12," Reintentar "),t(),i(13,"button",16),l(14,"i",17),n(15," Volver a la lista "),t()()()()()()}if(s&2){let e=p();o(8),m(e.error())}}function J(s,r){if(s&1&&(i(0,"div",13)(1,"button",64),l(2,"i",65),n(3," Editar "),t(),i(4,"div",66)(5,"button",67),l(6,"i",68),t(),i(7,"ul",69)(8,"li")(9,"a",70),l(10,"i",71),n(11,"Restablecer contrase\xF1a"),t()(),i(12,"li")(13,"a",70),l(14,"i",72),n(15,"Cambiar rol"),t()(),i(16,"li"),l(17,"hr",73),t(),i(18,"li")(19,"a",74),l(20,"i",75),n(21,"Desactivar usuario"),t()()()()()),s&2){let e=p();o(),P("routerLink",T(1,Z,e.id))}}function K(s,r){s&1&&(i(0,"span",38),l(1,"i",76),n(2," Verificado "),t())}function Q(s,r){s&1&&(i(0,"span",39),l(1,"i",77),n(2," Sin verificar "),t())}function W(s,r){if(s&1&&(i(0,"div",36)(1,"span",78),n(2),t(),n(3),t()),s&2){let e=p(),a=p();o(2),m(a.getDocumentTypeLabel(e.documentType)),o(),c(" ",e.documentNumber," ")}}function X(s,r){s&1&&(i(0,"div",6),n(1,"No especificado"),t())}function $(s,r){if(s&1&&(i(0,"div",18)(1,"div",19)(2,"div",20)(3,"div",21)(4,"button",22),l(5,"i",23),t(),i(6,"div")(7,"h1",24),n(8),t(),i(9,"div",25),l(10,"i",26),n(11),t()()(),b(12,J,22,3,"div",13),t()()(),i(13,"div",27)(14,"div",28)(15,"div",29)(16,"div",30)(17,"h6",31),l(18,"i",32),n(19," Informaci\xF3n Personal "),t()(),i(20,"div",33)(21,"div",27)(22,"div",34)(23,"label",35),n(24,"Nombre completo"),t(),i(25,"div",36),n(26),t()(),i(27,"div",34)(28,"label",35),n(29,"Email"),t(),i(30,"div",21)(31,"span",37),n(32),t(),b(33,K,3,0,"span",38)(34,Q,3,0,"span",39),t()(),i(35,"div",34)(36,"label",35),n(37,"Tel\xE9fono"),t(),i(38,"div",36),n(39),t()(),i(40,"div",34)(41,"label",35),n(42,"Documento"),t(),b(43,W,4,2,"div",36)(44,X,2,0,"div",6),t()()()(),i(45,"div",29)(46,"div",30)(47,"h6",31),l(48,"i",40),n(49," Ubicaci\xF3n "),t()(),i(50,"div",33)(51,"div",27)(52,"div",34)(53,"label",35),n(54,"Departamento"),t(),i(55,"div",36),n(56),t()(),i(57,"div",34)(58,"label",35),n(59,"Provincia"),t(),i(60,"div",41),n(61,"No especificado"),t()()()()(),i(62,"div",29)(63,"div",30)(64,"h6",31),l(65,"i",42),n(66," Informaci\xF3n Profesional "),t()(),i(67,"div",33)(68,"div",27)(69,"div",34)(70,"label",35),n(71,"Instituci\xF3n"),t(),i(72,"div",36),n(73),t()(),i(74,"div",34)(75,"label",35),n(76,"Cargo"),t(),i(77,"div",36),n(78),t()()()()(),i(79,"div",29)(80,"div",30)(81,"h6",31),l(82,"i",43),n(83," Actividad "),t()(),i(84,"div",33)(85,"div",27)(86,"div",34)(87,"label",35),n(88,"Eventos asistidos"),t(),i(89,"div",36),n(90),t()(),i(91,"div",34)(92,"label",35),n(93,"Certificados obtenidos"),t(),i(94,"div",36),n(95),t()(),i(96,"div",34)(97,"label",35),n(98,"\xDAltimo acceso"),t(),i(99,"div",36),n(100),t()(),i(101,"div",34)(102,"label",35),n(103,"Fecha de registro"),t(),i(104,"div",36),n(105),t()()()()()(),i(106,"div",44)(107,"div",29)(108,"div",30)(109,"h6",31),n(110,"Estado y Permisos"),t()(),i(111,"div",45)(112,"div",46),n(113),t(),i(114,"div",47)(115,"span"),l(116,"i",48),n(117),t()(),i(118,"div",47)(119,"span"),n(120),t()(),i(121,"div",47)(122,"label",35),n(123,"Completitud del perfil"),t(),i(124,"div",49),l(125,"div",50),t(),i(126,"small",6),n(127),t()()()(),i(128,"div",29)(129,"div",30)(130,"h6",31),n(131,"Acciones R\xE1pidas"),t()(),i(132,"div",33)(133,"div",51)(134,"button",52),l(135,"i",26),n(136," Enviar Email "),t(),i(137,"button",53),l(138,"i",54),n(139," Ver Eventos "),t(),i(140,"button",55),l(141,"i",56),n(142," Ver Certificados "),t(),l(143,"hr"),i(144,"button",57),l(145,"i",58),n(146," Restablecer Contrase\xF1a "),t()()()(),i(147,"div",59)(148,"div",30)(149,"h6",31),n(150,"Informaci\xF3n del Sistema"),t()(),i(151,"div",33)(152,"div",60)(153,"div",61)(154,"small",6),n(155,"ID del usuario:"),t(),i(156,"div",62),n(157),t()(),i(158,"div",61)(159,"small",6),n(160,"Creado:"),t(),i(161,"div",63),n(162),t()(),i(163,"div",19)(164,"small",6),n(165,"Actualizado:"),t(),i(166,"div",63),n(167),t()()()()()()()),s&2){let e=r,a=p();o(8),m(e.fullName),o(3),c(" ",e.email," "),o(),g(a.showEditActions()?12:-1),o(14),m(e.fullName),o(6),m(e.email),o(),g(e.emailVerified?33:34),o(6),c(" ",e.phone||"No especificado"," "),o(4),g(e.documentNumber?43:44),o(13),c(" ",(e.departmentInfo==null?null:e.departmentInfo.name)||a.getDepartmentName(e.departmentId)," "),o(17),c(" ",e.institution||"No especificado"," "),o(5),c(" ",e.jobTitle||"No especificado"," "),o(12),m(e.eventsAttended),o(5),m(e.certificatesEarned),o(5),m(a.formatDateTime(e.lastLogin)),o(5),m(a.formatDate(e.createdAt)),o(8),c(" ",e.fullName.charAt(0).toUpperCase()," "),o(2),E(a.getStatusBadgeClass(e.isActive)),o(2),c(" ",a.getStatusText(e.isActive)," "),o(2),E(a.getRoleBadgeClass(e.role)),o(),c(" ",a.getUserRoleLabel(e.role)," "),o(5),E(a.profileCompletion().cssClass),M("width",a.profileCompletion().percentage,"%"),o(2),A(" ",a.profileCompletion().percentage,"% completado (",a.profileCompletion().completedFields,"/",a.profileCompletion().totalFields," campos) "),o(30),m(e.id),o(5),m(a.formatDateTime(e.createdAt)),o(5),m(a.formatDateTime(e.updatedAt))}}var H=class s{route=v(F);destroyRef=v(U);userService=v(z);staticDataService=v(G);userId=y();showEditActions=y(!0);loadingState=x("idle");loading=f(()=>this.loadingState()==="loading");user=x(null);error=x(null);success=x(!1);departmentsResource=L({loader:()=>C(this,null,function*(){try{return yield _(this.staticDataService.getDepartmentsList())}catch(r){let e=this.processResourceError(r);throw console.error("Departments Resource Error:",e),e}}),defaultValue:[]});departments=f(()=>this.departmentsResource.value()||[]);departmentMap=f(()=>{let r=this.departments(),e={};return r.forEach((a,d)=>{let u=d+1;e[u]=a}),e});profileCompletion=f(()=>{let r=this.user();if(!r)return{percentage:0,completedFields:0,totalFields:8,cssClass:"bg-secondary"};let e=0,a=8;r.fullName&&e++,r.email&&e++,r.phone&&e++,r.documentNumber&&e++,r.departmentId&&e++,r.institution&&e++,r.jobTitle&&e++,r.emailVerified&&e++;let d=Math.round(e/a*100),u="bg-danger";return d>=80?u="bg-success":d>=60&&(u="bg-warning"),{percentage:d,completedFields:e,totalFields:a,cssClass:u}});userRoles=Object.values(h);documentTypes=Object.values(S);UserRole=h;DocumentType=S;constructor(){this.departmentsResource.value(),this.loadUser()}processResourceError(r){if(!r){let u=new Error("Error desconocido en el recurso");return u.canRetry=!0,u}let e=r,a="Error al cargar los departamentos";e.status===0||e.name==="NetworkError"?a="Error de conexi\xF3n. Verifica tu conexi\xF3n a internet.":e.status&&e.status>=400&&e.status<500?a=e.error?.message||"Error en la solicitud.":e.status===401||e.status===403?a="No tienes permisos para acceder a esta informaci\xF3n.":e.status&&e.status>=500?a="Error del servidor. Intenta nuevamente en unos momentos.":a=e.message||e.error?.message||"Error al procesar la solicitud.";let d=new Error(a);return d.details=e.error?.details,d.canRetry=!e.status||e.status>=500||e.status===0,d}retryLoad=()=>{this.loadUser()};clearError=()=>{this.error.set(null)};takeUntilDestroyed=B(this.destroyRef);loadUser(){this.loadingState.set("loading"),this.error.set(null);let r=this.userId();r?this.loadUserById(r):this.route.params.pipe(D(e=>{let a=+e.id;return this.userService.getUserById(a)}),this.takeUntilDestroyed).subscribe({next:e=>{this.handleUserLoadSuccess(e)},error:e=>{this.handleUserLoadError(e)}})}loadUserById(r){this.userService.getUserById(r).pipe(this.takeUntilDestroyed).subscribe({next:e=>{this.handleUserLoadSuccess(e)},error:e=>{this.handleUserLoadError(e)}})}handleUserLoadSuccess(r){this.user.set(r),this.loadingState.set("success"),this.success.set(!0)}handleUserLoadError(r){let e={message:r.message||"Error cargando usuario",details:r.error?.message,canRetry:!0,timestamp:new Date().toISOString()};this.error.set(e),this.loadingState.set("error"),console.error("Error cargando usuario:",r)}getUserRoleLabel=r=>({admin:"Administrador",organizer:"Organizador",participant:"Participante"})[r]||r;getDocumentTypeLabel=r=>({DNI:"DNI",CE:"Carn\xE9 de Extranjer\xEDa",PASSPORT:"Pasaporte",RUC:"RUC"})[r]||r;getDepartmentName=r=>this.departments().find(d=>parseInt(d.code)===r)?.name||"N/A";getRoleBadgeClass=r=>({admin:"badge bg-primary badge-role",organizer:"badge bg-info badge-role",participant:"badge bg-secondary badge-role"})[r]||"badge bg-secondary badge-role";getStatusBadgeClass=r=>r?"badge bg-success":"badge bg-danger";getStatusText=r=>r?"Activo":"Inactivo";formatDate=r=>r?new Date(r).toLocaleDateString("es-PE",{year:"numeric",month:"long",day:"numeric"}):"N/A";formatDateTime=r=>r?new Date(r).toLocaleString("es-PE",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A";static \u0275fac=function(e){return new(e||s)};static \u0275cmp=R({type:s,selectors:[["app-user-detail"]],inputs:{userId:[1,"userId"],showEditActions:[1,"showEditActions"]},decls:4,vars:2,consts:[[1,"container-fluid","py-3"],[1,"d-flex","justify-content-center","align-items-center","py-5",2,"min-height","400px"],[1,"row","justify-content-center"],[1,"text-center"],["role","status",1,"spinner-border","text-primary","mb-3",2,"width","3rem","height","3rem"],[1,"visually-hidden"],[1,"text-muted"],[1,"col-md-6"],["role","alert",1,"alert","alert-danger","d-flex","align-items-center"],[1,"bi","bi-exclamation-triangle-fill","me-3","fs-4"],[1,"flex-grow-1"],[1,"alert-heading","mb-1"],[1,"mb-2"],[1,"d-flex","gap-2"],[1,"btn","btn-outline-danger","btn-sm",3,"click"],[1,"bi","bi-arrow-clockwise","me-1"],["routerLink","/usuarios",1,"btn","btn-outline-secondary","btn-sm"],[1,"bi","bi-arrow-left","me-1"],[1,"row","mb-4"],[1,"col-12"],[1,"d-flex","justify-content-between","align-items-start"],[1,"d-flex","align-items-center"],["type","button","routerLink","/usuarios",1,"btn","btn-outline-secondary","btn-sm","me-3"],[1,"bi","bi-arrow-left"],[1,"h4","mb-1"],[1,"text-muted","small"],[1,"bi","bi-envelope","me-1"],[1,"row"],[1,"col-md-8"],[1,"card","mb-4"],[1,"card-header"],[1,"card-title","mb-0"],[1,"bi","bi-person","me-2"],[1,"card-body"],[1,"col-md-6","mb-3"],[1,"form-label","text-muted","small"],[1,"fw-semibold"],[1,"fw-semibold","me-2"],[1,"badge","bg-success"],[1,"badge","bg-warning"],[1,"bi","bi-geo-alt","me-2"],[1,"fw-semibold","text-muted"],[1,"bi","bi-briefcase","me-2"],[1,"bi","bi-activity","me-2"],[1,"col-md-4"],[1,"card-body","text-center"],[1,"bg-primary","text-white","rounded-circle","d-flex","align-items-center","justify-content-center","mx-auto","mb-3",2,"width","80px","height","80px","font-size","2rem"],[1,"mb-3"],[1,"bi","bi-circle-fill","me-1",2,"font-size","0.5rem"],[1,"progress",2,"height","8px"],[1,"progress-bar"],[1,"d-grid","gap-2"],["type","button",1,"btn","btn-outline-primary","btn-sm"],["type","button",1,"btn","btn-outline-secondary","btn-sm"],[1,"bi","bi-calendar-event","me-1"],["type","button",1,"btn","btn-outline-info","btn-sm"],[1,"bi","bi-award","me-1"],["type","button",1,"btn","btn-outline-warning","btn-sm"],[1,"bi","bi-key","me-1"],[1,"card"],[1,"row","g-0"],[1,"col-12","mb-2"],[1,"font-monospace"],[1,"small"],["type","button",1,"btn","btn-outline-primary","btn-sm",3,"routerLink"],[1,"bi","bi-pencil","me-1"],[1,"dropdown"],["type","button","data-bs-toggle","dropdown",1,"btn","btn-outline-secondary","btn-sm","dropdown-toggle"],[1,"bi","bi-three-dots"],[1,"dropdown-menu"],["href","#",1,"dropdown-item"],[1,"bi","bi-key","me-2"],[1,"bi","bi-shield-check","me-2"],[1,"dropdown-divider"],["href","#",1,"dropdown-item","text-danger"],[1,"bi","bi-trash","me-2"],[1,"bi","bi-check-circle","me-1"],[1,"bi","bi-exclamation-triangle","me-1"],[1,"badge","bg-light","text-dark","me-2"]],template:function(e,a){if(e&1&&(i(0,"div",0),b(1,Y,7,0,"div",1)(2,q,16,1,"div",2),b(3,$,168,32),t()),e&2){let d;o(),g(a.loading()?1:a.error()?2:-1),o(2),g((d=a.user())?3:-1,d)}},dependencies:[O,V,j],styles:[".user-detail-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{border:none;box-shadow:0 2px 4px #0000001a}.user-detail-container[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{font-size:.875rem}.user-detail-container[_ngcontent-%COMP%]   .text-muted[_ngcontent-%COMP%]{color:#6c757d!important}",".profile-completion-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,var(--bs-primary-bg-subtle),var(--bs-secondary-bg-subtle));border:1px solid var(--bs-border-color-translucent);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.user-avatar[_ngcontent-%COMP%]{width:120px;height:120px;background:linear-gradient(135deg,var(--bs-primary),var(--bs-primary-dark));border:4px solid rgba(255,255,255,.2);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.stats-card[_ngcontent-%COMP%]{transition:all .3s ease;border:1px solid rgba(255,255,255,.1);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.stats-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 8px 25px #0000001a}.badge-role[_ngcontent-%COMP%]{font-size:.75rem;padding:.375rem .75rem;border-radius:25px}.success-animation[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_successPulse .6s ease-out}@keyframes _ngcontent-%COMP%_successPulse{0%{transform:scale(1)}50%{transform:scale(1.05)}to{transform:scale(1)}}"],changeDetection:0})};export{H as UserDetailComponent};

import{a as B}from"./chunk-VXK4KFJ3.js";import"./chunk-PLLGRK62.js";import"./chunk-FK6H3RFT.js";import{b as q}from"./chunk-BWDGGP5N.js";import{c as P,d as _,e as R,f as j,j as M,m as A,n as z,u as G,v as L,x as O}from"./chunk-XPHFKPJP.js";import{a as C}from"./chunk-TVASKIN6.js";import{f as T}from"./chunk-EDRQHDMA.js";import{f as k,l as N}from"./chunk-PZ46FPEX.js";import{Cc as F,Da as o,Db as V,Gb as n,Hb as g,Ib as f,Na as E,Ra as p,_ as v,ac as I,da as u,ea as b,hb as m,ia as w,ib as t,jb as i,kb as c,ma as y,rb as h,sb as x,ub as s,wc as D}from"./chunk-DCXCOY7M.js";import"./chunk-LJ5XHLMQ.js";import{h as S}from"./chunk-FK42CRUA.js";function U(r,a){if(r&1){let e=h();t(0,"div",18)(1,"div",19)(2,"div",20)(3,"div",21),c(4,"i",22),t(5,"h2",23),n(6,"Verificar Certificado"),i(),t(7,"small",24),n(8,"Ingrese c\xF3digo de verificaci\xF3n"),i()(),t(9,"div",25)(10,"form",26),x("ngSubmit",function(){u(e);let l=s();return b(l.verifyCertificate())}),t(11,"div",27)(12,"label",28),n(13,"C\xF3digo de Verificaci\xF3n"),i(),c(14,"input",29),t(15,"div",30),c(16,"i",31),n(17,"C\xF3digo requerido "),i()(),t(18,"button",32),c(19,"i",33),n(20,"Verificar "),i()()()()()()}if(r&2){let e,d,l=s();o(10),m("formGroup",l.verifyForm),o(4),V("is-invalid",((e=l.verifyForm.get("shortCode"))==null?null:e.invalid)&&((e=l.verifyForm.get("shortCode"))==null?null:e.touched))("border-success",(d=l.verifyForm.get("shortCode"))==null?null:d.valid),o(4),m("disabled",l.verifyForm.invalid||l.loading())}}function J(r,a){r&1&&(t(0,"div",18)(1,"div",34)(2,"div",20)(3,"div",35),c(4,"div",36),t(5,"h3",37),n(6,"Verificando..."),i(),t(7,"small",16),n(8,"Validando autenticidad"),i()()()()())}function $(r,a){if(r&1){let e=h();t(0,"div",18)(1,"div",34)(2,"div",20)(3,"div",38),c(4,"i",39),t(5,"h3",6),n(6,"No Encontrado"),i()(),t(7,"div",40)(8,"p",41),n(9),i(),t(10,"button",42),x("click",function(){u(e);let l=s();return b(l.resetVerification())}),c(11,"i",43),n(12,"Reintentar "),i()()()()()}if(r&2){let e=s();o(9),g(e.error())}}function K(r,a){if(r&1&&(t(0,"div",91)(1,"div",92),c(2,"i",93),t(3,"div",94)(4,"div",16),n(5,"Fecha inicio"),i(),t(6,"div",85),n(7),i()()()()),r&2){let e=s(2);o(7),g(e.formatDate(e.certificate().event.startDate))}}function Q(r,a){if(r&1&&(t(0,"div",91)(1,"div",92),c(2,"i",95),t(3,"div",94)(4,"div",16),n(5,"Fecha fin"),i(),t(6,"div",85),n(7),i()()()()),r&2){let e=s(2);o(7),g(e.formatDate(e.certificate().event.endDate))}}function W(r,a){if(r&1&&(t(0,"div",91)(1,"div",92),c(2,"i",96),t(3,"div",94)(4,"div",16),n(5,"Duraci\xF3n"),i(),t(6,"div",85),n(7),i()()()()),r&2){let e=s(2);o(7),f("",e.certificate().event.durationHours," hrs acad\xE9micas")}}function X(r,a){if(r&1&&(t(0,"span"),n(1),i()),r&2){let e=s(3);o(),f(", ",e.certificate().event.venueCity)}}function Y(r,a){if(r&1&&(t(0,"div",91)(1,"div",92),c(2,"i",97),t(3,"div",94)(4,"div",16),n(5,"Ubicaci\xF3n"),i(),t(6,"div",85),n(7),p(8,X,2,1,"span",98),i()()()()),r&2){let e=s(2);o(7),f(" ",e.certificate().event.venueName," "),o(),m("ngIf",e.certificate().event.venueCity)}}function Z(r,a){if(r&1&&(t(0,"div",76),n(1),i()),r&2){let e=s(2);o(),f(" ",e.certificate().participantRole.certificateTitle," ")}}function ee(r,a){r&1&&(t(0,"div",99)(1,"div",92),c(2,"i",100),t(3,"small",101)(4,"strong"),n(5,"No disponible:"),i(),n(6," El certificado no se puede descargar en su estado actual. "),i()()())}function te(r,a){if(r&1){let e=h();t(0,"div",18)(1,"div",44)(2,"div",20)(3,"div",45)(4,"div",46)(5,"span",47),c(6,"i",48),n(7),i()(),t(8,"h2",23),n(9,"Certificado Aut\xE9ntico"),i(),t(10,"small",24),n(11,"Validaci\xF3n exitosa del documento"),i()(),t(12,"div",49)(13,"div",50)(14,"div",51)(15,"div",52)(16,"div",27)(17,"div",53)(18,"div",54),c(19,"i",55),i(),t(20,"h3",6),n(21,"Participante"),i()(),t(22,"div",56)(23,"div",25)(24,"h4",57),n(25),i(),c(26,"div",58),i()()(),t(27,"div",27)(28,"div",53)(29,"div",59),c(30,"i",60),i(),t(31,"h3",6),n(32,"Evento"),i()(),t(33,"div",56)(34,"div",25)(35,"h4",61),n(36),i(),t(37,"div",58),p(38,K,8,1,"div",62)(39,Q,8,1,"div",62)(40,W,8,1,"div",62)(41,Y,9,2,"div",62),i()()()()()(),t(42,"div",63)(43,"div",64)(44,"div",65)(45,"span",66),c(46,"i",67),n(47),i(),p(48,Z,2,1,"div",68),i(),t(49,"div",69)(50,"div",70)(51,"h4",71),c(52,"i",72),n(53," Detalles "),i()(),t(54,"div",73)(55,"div",74)(56,"div",75)(57,"div",76),n(58,"N\xFAmero"),i(),t(59,"div",77),n(60),i()(),t(61,"div",75)(62,"div",76),n(63,"C\xF3digo"),i(),t(64,"div",78),n(65),i()(),t(66,"div",75)(67,"div",76),n(68,"Emisi\xF3n"),i(),t(69,"div",79),n(70),i()(),t(71,"div",75)(72,"div",76),n(73,"Verificaciones"),i(),t(74,"div",79),c(75,"i",80),n(76),i()()()()(),t(77,"div",81)(78,"button",82),x("click",function(){u(e);let l=s();return b(l.downloadCertificate())}),t(79,"div",83),c(80,"i",84),t(81,"div")(82,"div",85),n(83,"Descargar PDF"),i(),t(84,"small",24),n(85,"Certificado oficial"),i()()(),t(86,"span",86),c(87,"i",87),i()(),t(88,"button",88),x("click",function(){u(e);let l=s();return b(l.resetVerification())}),c(89,"i",89),n(90," Verificar otro "),i(),p(91,ee,7,0,"div",90),i()()()()()()()()}if(r&2){let e=s();o(7),f(" ",e.getStatusLabel(e.certificate().isValid)," "),o(18),f(" ",e.certificate().participant.fullName," "),o(11),f(" ",e.certificate().event.title," "),o(2),m("ngIf",e.certificate().event.startDate),o(),m("ngIf",e.certificate().event.endDate),o(),m("ngIf",e.certificate().event.durationHours),o(),m("ngIf",e.certificate().event.venueName),o(6),f(" ",e.certificate().participantRole.name," "),o(),m("ngIf",e.certificate().participantRole.certificateTitle),o(12),f(" ",e.certificate().certificateNumber," "),o(5),f(" ",e.certificate().shortCode," "),o(5),g(e.formatDate(e.certificate().issueDate)),o(6),f("",e.certificate().verificationCount," "),o(2),m("disabled",!e.canDownload(e.certificate())),o(13),m("ngIf",!e.canDownload(e.certificate()))}}var H=class r{route=v(k);fb=v(L);destroyRef=v(w);certificateService=v(q);CertificateGeneratorService=v(B);loadingState=y("idle");loading=I(()=>this.loadingState()==="loading");error=y(null);certificate=y(null);verifyForm=this.fb.group({shortCode:["",[_.required,_.minLength(3)]]});CertificateStatus=T;ngOnInit(){this.route.paramMap.pipe(C(this.destroyRef)).subscribe(a=>{let e=a.get("codigo");e&&(this.verifyForm.patchValue({shortCode:e}),this.verifyCertificate())})}verifyCertificate(){if(this.verifyForm.invalid){this.verifyForm.markAllAsTouched();return}let a=this.verifyForm.value.shortCode;this.loadingState.set("loading"),this.error.set(null),this.certificateService.verifyPublicCertificate(a).pipe(C(this.destroyRef)).subscribe({next:e=>{e.success&&e.certificate?(this.certificate.set(e.certificate),this.loadingState.set("success")):(this.error.set(e.error||e.message||"No se pudo verificar el certificado"),this.loadingState.set("error"))},error:e=>{console.error("Error verifying certificate:",e),this.error.set(e.message||"No se pudo verificar el certificado"),this.loadingState.set("error")}})}resetVerification(){this.certificate.set(null),this.error.set(null),this.loadingState.set("idle"),this.verifyForm.reset()}getStatusBadgeClass(a){return a?"bg-success-subtle text-success-emphasis border border-success-subtle":"bg-danger-subtle text-danger-emphasis border border-danger-subtle"}getStatusIcon(a){return a?"bi-check-circle":"bi-x-circle"}getStatusLabel(a){return a?"Certificado V\xE1lido":"Certificado No V\xE1lido"}formatDate(a){if(!a)return"Fecha no disponible";try{return new Date(a).toLocaleDateString("es-PE",{day:"2-digit",month:"2-digit",year:"numeric"})}catch{return a}}canDownload(a){return a.isValid}downloadCertificate(){return S(this,null,function*(){let a=this.certificate();if(!(!a||!this.canDownload(a)))try{this.loadingState.set("loading");let e=yield fetch("/template/certificado-1756515494650.json");if(!e.ok)throw new Error("No se pudo cargar la plantilla del certificado");let d=yield e.json(),l=yield this.CertificateGeneratorService.generarCertificadoPDFPorCodigo(d,a.shortCode,{formato:"A4",orientacion:"landscape",nombreArchivo:`certificado-${a.certificateNumber}`});l.success?console.log("Certificado descargado exitosamente desde verificaci\xF3n"):(console.error("Error al generar certificado:",l.message),this.error.set("Error al generar el certificado PDF"))}catch(e){console.error("Error al descargar certificado:",e),this.error.set("Error al descargar el certificado")}finally{this.loadingState.set("success")}})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=E({type:r,selectors:[["app-certificate-verify"]],decls:26,vars:4,consts:[[1,"min-vh-100","bg-body-secondary"],[1,"bg-white","border-bottom","sticky-top"],[1,"container-fluid","py-2","px-3"],[1,"d-flex","align-items-center","justify-content-between"],[1,"d-flex","align-items-center"],[1,"bi","bi-patch-check-fill","text-success","fs-5","me-2"],[1,"fs-6","fw-semibold","mb-0"],[1,"text-muted","d-none","d-sm-block"],[1,"badge","bg-success-subtle","text-success","border","border-success-subtle","px-2","py-1","d-none","d-md-inline"],[1,"bi","bi-shield-check","me-1"],[1,"container-fluid","p-3"],["class","row justify-content-center",4,"ngIf"],[1,"bg-white","border-top","py-3","mt-auto"],[1,"container-fluid","px-3"],[1,"row","align-items-center"],[1,"col","text-center"],[1,"text-muted"],[1,"bi","bi-shield-check","text-success","me-1"],[1,"row","justify-content-center"],[1,"col-12","col-sm-10","col-md-8","col-lg-6","col-xl-5"],[1,"card","border-0","shadow-sm"],[1,"card-header","bg-primary","text-white","text-center","py-3"],[1,"bi","bi-qr-code-scan","fs-2","mb-2"],[1,"fs-5","fw-semibold","mb-1"],[1,"opacity-75"],[1,"card-body","p-3"],[3,"ngSubmit","formGroup"],[1,"mb-3"],[1,"form-label","small","fw-medium","mb-2"],["type","text","formControlName","shortCode","placeholder","Ej: ABC123","maxlength","20",1,"form-control","text-center","border-2","py-2",2,"letter-spacing","1px","font-family","ui-monospace, 'Courier New', monospace","font-weight","500"],[1,"invalid-feedback","text-center","small"],[1,"bi","bi-x-circle","me-1"],["type","submit",1,"btn","btn-primary","w-100","py-2","fw-medium",3,"disabled"],[1,"bi","bi-search","me-2"],[1,"col-12","col-sm-8","col-md-6"],[1,"card-body","text-center","py-4"],[1,"spinner-border","text-primary","mb-3",2,"width","2rem","height","2rem"],[1,"fs-6","fw-medium","mb-1"],[1,"card-header","bg-danger","text-white","text-center","py-3"],[1,"bi","bi-exclamation-triangle","fs-2","mb-2"],[1,"card-body","text-center","p-3"],[1,"text-muted","mb-3","small"],[1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"bi","bi-arrow-counterclockwise","me-2"],[1,"col-12"],[1,"card-header","bg-success","text-white","text-center","py-3"],[1,"d-flex","align-items-center","justify-content-center","mb-2"],[1,"badge","bg-white","text-success","px-3","py-2","me-3"],[1,"bi","bi-patch-check-fill","me-1"],[1,"card-body","p-0"],[1,"row","g-0"],[1,"col-12","col-lg-8"],[1,"p-3"],[1,"d-flex","align-items-center","mb-2"],[1,"bg-primary","text-white","rounded-circle","d-flex","align-items-center","justify-content-center","me-2",2,"width","28px","height","28px"],[1,"bi","bi-person-fill","small"],[1,"card","bg-body-secondary","border-0"],[1,"fs-6","fw-bold","text-primary","mb-2"],[1,"row","g-2"],[1,"bg-info","text-white","rounded-circle","d-flex","align-items-center","justify-content-center","me-2",2,"width","28px","height","28px"],[1,"bi","bi-calendar-event","small"],[1,"small","fw-bold","text-info","mb-2"],["class","col-12 col-sm-6",4,"ngIf"],[1,"col-12","col-lg-4"],[1,"bg-body-tertiary","h-100","p-3"],[1,"text-center","mb-3"],[1,"badge","bg-warning","text-dark","px-2","py-1","mb-1"],[1,"bi","bi-award","me-1"],["class","small text-muted",4,"ngIf"],[1,"card","border-0","shadow-sm","mb-3"],[1,"card-header","bg-white","py-2"],[1,"small","fw-semibold","mb-0"],[1,"bi","bi-info-circle","text-primary","me-1"],[1,"card-body","p-2"],[1,"row","g-1","text-center"],[1,"col-6"],[1,"small","text-muted"],[1,"fw-bold","text-primary","text-break",2,"font-size","0.7rem","font-family","ui-monospace, monospace"],[1,"fw-bold","text-primary",2,"font-size","0.8rem","font-family","ui-monospace, monospace"],[1,"fw-medium","small"],[1,"bi","bi-eye","me-1"],[1,"text-center"],["type","button",1,"btn","btn-success","w-100","py-2","mb-2","position-relative",3,"click","disabled"],[1,"d-flex","align-items-center","justify-content-center"],[1,"bi","bi-download","me-2"],[1,"fw-medium"],[1,"position-absolute","top-0","start-100","translate-middle","badge","rounded-pill","bg-light","text-success","border","border-success",2,"font-size","0.5rem"],[1,"bi","bi-shield-check"],["type","button",1,"btn","btn-outline-secondary","btn-sm","w-100",3,"click"],[1,"bi","bi-arrow-counterclockwise","me-1"],["class","alert alert-warning mt-2 p-2",4,"ngIf"],[1,"col-12","col-sm-6"],[1,"d-flex","align-items-start"],[1,"bi","bi-calendar3","text-muted","me-2","mt-1","flex-shrink-0",2,"font-size","0.75rem"],[1,"small"],[1,"bi","bi-calendar-check","text-muted","me-2","mt-1","flex-shrink-0",2,"font-size","0.75rem"],[1,"bi","bi-clock","text-muted","me-2","mt-1","flex-shrink-0",2,"font-size","0.75rem"],[1,"bi","bi-geo-alt","text-muted","me-2","mt-1","flex-shrink-0",2,"font-size","0.75rem"],[4,"ngIf"],[1,"alert","alert-warning","mt-2","p-2"],[1,"bi","bi-exclamation-triangle","me-2","mt-1","flex-shrink-0","small"],[1,"mb-0"]],template:function(e,d){e&1&&(t(0,"div",0)(1,"header",1)(2,"div",2)(3,"div",3)(4,"div",4),c(5,"i",5),t(6,"div")(7,"h1",6),n(8,"Verificaci\xF3n"),i(),t(9,"small",7),n(10,"Sistema oficial"),i()()(),t(11,"span",8),c(12,"i",9),n(13,"Seguro "),i()()()(),t(14,"main",10),p(15,U,21,6,"div",11)(16,J,9,0,"div",11)(17,$,13,1,"div",11)(18,te,92,15,"div",11),i(),t(19,"footer",12)(20,"div",13)(21,"div",14)(22,"div",15)(23,"small",16),c(24,"i",17),n(25," Sistema de verificaci\xF3n oficial y seguro "),i()()()()()()),e&2&&(o(15),m("ngIf",!d.certificate()&&!d.loading()&&!d.error()),o(),m("ngIf",d.loading()),o(),m("ngIf",d.error()),o(),m("ngIf",d.certificate()&&!d.loading()))},dependencies:[F,D,N,O,M,P,R,j,G,A,z],encapsulation:2})};export{H as CertificateVerifyComponent};

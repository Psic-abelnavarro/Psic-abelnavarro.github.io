import{a as xe,b as Pe}from"./chunk-VF5TSERA.js";import{a as L,b as ee,c as ye,d as _e,e as Oe,f as H,g as Ae,h as De,i as Z,j as W,l as Fe,m as Y}from"./chunk-YUNYRAF7.js";import"./chunk-FK6H3RFT.js";import{$b as $,Bb as J,Bc as we,Da as f,Db as D,Gb as h,Hb as he,Ib as q,Kb as Se,Na as B,Pb as ve,Ta as ge,V as _,Va as Q,_ as w,ac as y,bb as j,bc as K,cb as P,cc as Ee,da as u,ea as m,ga as fe,hb as E,ia as T,ib as a,jb as s,kb as g,lb as pe,ma as p,mb as be,nb as Ce,rb as z,sb as v,ub as M,wb as R,xb as N,yb as V}from"./chunk-5W5GNUFO.js";import{a as S,b as me,f as je,h as C}from"./chunk-FK42CRUA.js";var te={A4:{nombre:"A4",anchura:210,altura:297,dpi:300},A3:{nombre:"A3",anchura:297,altura:420,dpi:300}},ke={formato:te.A4,orientacion:"horizontal"},O={size:20,color:"#f0f0f0",grosor:.5,opacidad:.8},x={cornerStyle:"circle",cornerSize:8,transparentCorners:!1,padding:0},F={min:.05,max:5,factorIn:1.25,factorOut:.8,tolerancia:4,escalaBase:.23,wheelSensitivity:.001,touchSensitivity:.01};var ie=class d{cachedDimensions=p(new Map);cachedScales=p(new Map);MM_TO_INCH=y(()=>25.4);MAX_DISPLAY_WIDTH=y(()=>800);MAX_DISPLAY_HEIGHT=y(()=>600);mmToPixels(e,t){return!isFinite(e)||!isFinite(t)||t<=0?(console.warn("Par\xE1metros inv\xE1lidos en mmToPixels:",{mm:e,dpi:t}),0):Math.round(e*t/this.MM_TO_INCH())}pixelsToMm(e,t){return!isFinite(e)||!isFinite(t)||t<=0?(console.warn("Par\xE1metros inv\xE1lidos en pixelsToMm:",{pixels:e,dpi:t}),0):Math.round(e*this.MM_TO_INCH()/t*100)/100}calcularDimensionesCanvas(e){let t=`${e.formato.anchura}x${e.formato.altura}_${e.orientacion}_${e.formato.dpi}`,i=this.cachedDimensions().get(t);if(i)return i;let{formato:o,orientacion:n}=e;if(!o.anchura||!o.altura||!o.dpi)return console.error("Configuraci\xF3n de formato inv\xE1lida:",e),{width:800,height:600};let r=n==="horizontal"?o.altura:o.anchura,c=n==="horizontal"?o.anchura:o.altura,l={width:this.mmToPixels(r,o.dpi),height:this.mmToPixels(c,o.dpi)},b=new Map(this.cachedDimensions());return b.set(t,l),this.cachedDimensions.set(b),this.maintainCacheSize(),l}calcularEscalaOptima(e){let t=`${e.width}x${e.height}`,i=this.cachedScales().get(t);if(i)return i;if(!e.width||!e.height||e.width<=0||e.height<=0)return console.warn("Dimensiones inv\xE1lidas para calcular escala:",e),1;let o=this.MAX_DISPLAY_WIDTH(),n=this.MAX_DISPLAY_HEIGHT(),r=o/e.width,c=n/e.height,l=Math.min(r,c,1);l=Math.max(l,.05),l=Math.round(l*1e3)/1e3;let A=new Map(this.cachedScales());return A.set(t,l),this.cachedScales.set(A),this.maintainCacheSize(),l}calcularDimensionesVisuales(e,t){if(!e.width||!e.height)return console.warn("Dimensiones reales inv\xE1lidas:",e),{width:800,height:600};let i=t??this.calcularEscalaOptima(e);return!isFinite(i)||i<=0?(console.warn("Escala inv\xE1lida:",i),e):{width:Math.round(e.width*i),height:Math.round(e.height*i)}}obtenerDimensionesMM(e,t){return!e.width||!e.height||!t||t<=0?(console.warn("Par\xE1metros inv\xE1lidos en obtenerDimensionesMM:",{dimensionesPx:e,dpi:t}),{ancho:0,alto:0}):{ancho:this.pixelsToMm(e.width,t),alto:this.pixelsToMm(e.height,t)}}calcularCentroCanvas(e){return!e.width||!e.height||e.width<=0||e.height<=0?(console.warn("Dimensiones inv\xE1lidas para calcular centro:",e),{x:0,y:0}):{x:Math.round(e.width/2),y:Math.round(e.height/2)}}clearCache(){this.cachedDimensions.set(new Map),this.cachedScales.set(new Map)}maintainCacheSize(){let t=this.cachedDimensions();if(t.size>50){let o=Array.from(t.entries()),n=new Map(o.slice(-50));this.cachedDimensions.set(n)}let i=this.cachedScales();if(i.size>50){let o=Array.from(i.entries()),n=new Map(o.slice(-50));this.cachedScales.set(n)}}static \u0275fac=function(t){return new(t||d)};static \u0275prov=_({token:d,factory:d.\u0275fac,providedIn:"root"})};var G=class d{snapToGridEnabled=!1;obtenerOpcionesCanvas(e){return{width:e.width,height:e.height,backgroundColor:"#ffffff",selection:!0,preserveObjectStacking:!0,imageSmoothingEnabled:!0,enableRetinaScaling:!0,fireRightClick:!0,stopContextMenu:!0,controlsAboveOverlay:!0,allowTouchScrolling:!1,renderOnAddRemove:!0,skipTargetFind:!1,perPixelTargetFind:!0,targetFindTolerance:F.tolerancia,uniformScaling:!1,uniformScalingKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,altSelectionKey:"shiftKey",interactive:!0}}configurarGrid(e,t,i=!1){let o=e.backgroundColor;if(this.limpiarGrid(e),e.backgroundImage)this.crearGridConLineas(e,t);else{let n=this.crearGridPattern(O.size,O.color,O.grosor,O.opacidad);n&&!i?e.backgroundColor=n:(i&&o?e.backgroundColor=o:i||(e.backgroundColor="#ffffff"),this.crearGridConLineas(e,t))}e.requestRenderAll()}crearGridPattern(e,t,i,o){try{let n=`${e}_${t}_${i}_${o}`,r=document.createElement("canvas");r.width=e,r.height=e;let c=r.getContext("2d",{alpha:!0,willReadFrequently:!1});return c?(c.imageSmoothingEnabled=!1,c.clearRect(0,0,e,e),c.strokeStyle=t,c.lineWidth=i,c.lineCap="square",c.lineJoin="miter",c.globalAlpha=o,c.beginPath(),c.moveTo(0,0),c.lineTo(e,0),c.moveTo(0,0),c.lineTo(0,e),c.stroke(),new Oe({source:r,repeat:"repeat",patternTransform:[1,0,0,1,0,0]})):null}catch(n){return console.error("Error creando grid pattern:",n),null}}crearGridConLineas(e,t){let{size:i,color:o,grosor:n,opacidad:r}=O;for(let c=0;c<=t.width;c+=i){let l=new Z([c,0,c,t.height],{stroke:o,strokeWidth:n,opacity:r,selectable:!1,evented:!1,excludeFromExport:!0,hoverCursor:"default",moveCursor:"default"});e.add(l)}for(let c=0;c<=t.height;c+=i){let l=new Z([0,c,t.width,c],{stroke:o,strokeWidth:n,opacity:r,selectable:!1,evented:!1,excludeFromExport:!0,hoverCursor:"default",moveCursor:"default"});e.add(l)}}limpiarGrid(e){e.getObjects().forEach(i=>{"excludeFromExport"in i&&i.excludeFromExport&&e.remove(i)})}actualizarGridPorImagenFondo(e,t){this.configurarGrid(e,t)}actualizarGridConColorPersonalizado(e,t){this.configurarGrid(e,t,!0)}actualizarGridInteligente(e,t){this.tieneColorPersonalizado(e)?this.actualizarGridConColorPersonalizado(e,t):this.actualizarGridPorImagenFondo(e,t)}tieneColorPersonalizado(e){return!!(e.backgroundColor&&typeof e.backgroundColor=="string"&&e.backgroundColor!=="#ffffff")}configurarEventos(e){e.on("selection:created",t=>{console.log("Objeto seleccionado:",t.selected)}),e.on("selection:updated",t=>{console.log("Selecci\xF3n actualizada:",t.selected)}),e.on("selection:cleared",()=>{console.log("Selecci\xF3n limpiada")}),e.on("object:modified",t=>{console.log("Objeto modificado:",t.target);let i=t.target;if(i&&!("excludeFromExport"in i&&i.excludeFromExport)&&typeof i.left=="number"&&typeof i.top=="number"){if(this.snapToGridEnabled){let o=O.size,n=Math.round(i.left/o)*o,r=Math.round(i.top/o)*o;i.set({left:n,top:r})}else i.set({left:Math.round(i.left),top:Math.round(i.top)});i.setCoords(),e.renderAll()}}),e.on("object:scaling",t=>{let i=t.target;i&&!("excludeFromExport"in i&&i.excludeFromExport)&&typeof i.scaleX=="number"&&typeof i.scaleY=="number"&&(i.scaleX<.1&&(i.scaleX=.1),i.scaleY<.1&&(i.scaleY=.1))})}setSnapToGrid(e){this.snapToGridEnabled=e}isSnapToGridEnabled(){return this.snapToGridEnabled}toggleSnapToGrid(){return this.snapToGridEnabled=!this.snapToGridEnabled,this.snapToGridEnabled}configurarPropiedadesGrid(e,t,i){let o=S({},O);i.size!==void 0&&(O.size=i.size),i.color!==void 0&&(O.color=i.color),i.grosor!==void 0&&(O.grosor=i.grosor),i.opacidad!==void 0&&(O.opacidad=i.opacidad);try{this.actualizarGridInteligente(e,t)}catch(n){Object.assign(O,o),console.error("Error configurando grid:",n)}}obtenerConfiguracionGrid(){return S({},O)}restaurarGridPorDefecto(e,t){O.size=20,O.color="#f0f0f0",O.grosor=.5,O.opacidad=.8,this.actualizarGridInteligente(e,t)}traerAlFrente(e){let t=e.getActiveObject();if(!t)return!1;let i=e.bringObjectToFront(t);return i&&e.requestRenderAll(),i}enviarAtras(e){let t=e.getActiveObject();if(!t)return!1;let i=e.sendObjectToBack(t);return i&&e.requestRenderAll(),i}static \u0275fac=function(t){return new(t||d)};static \u0275prov=_({token:d,factory:d.\u0275fac,providedIn:"root"})};var oe=class d{enviarAlFrente(e){let t=e.getActiveObject();if(t){let i=e.getObjects();e.moveObjectTo(t,i.length-1),e.requestRenderAll(),console.log("Objeto enviado al frente")}}enviarAlFondo(e){let t=e.getActiveObject();t&&(e.moveObjectTo(t,0),e.requestRenderAll(),console.log("Objeto enviado al fondo"))}eliminarSeleccionado(e){let t=e.getActiveObjects();t.length!==0&&(t.forEach(i=>{e.remove(i)}),e.discardActiveObject(),e.requestRenderAll(),console.log(`Eliminado(s) ${t.length} objeto(s)`))}centrarHorizontalmente(e){let t=e.getActiveObject();if(t){let i=e.getWidth(),o=(t.width||0)*(t.scaleX||1);t.left=i/2-o/2,t.setCoords(),e.requestRenderAll(),console.log("Objeto centrado horizontalmente")}}centrarVerticalmente(e){let t=e.getActiveObject();if(t){let i=e.getHeight(),o=(t.height||0)*(t.scaleY||1);t.top=i/2-o/2,t.setCoords(),e.requestRenderAll(),console.log("Objeto centrado verticalmente")}}centrarEnCanvas(e){let t=e.getActiveObject();if(t){let i=e.getWidth(),o=e.getHeight(),n=(t.width||0)*(t.scaleX||1),r=(t.height||0)*(t.scaleY||1);t.left=i/2-n/2,t.top=o/2-r/2,t.setCoords(),e.requestRenderAll(),console.log("Objeto centrado en canvas")}}aplicarZoom(e,t,i,o){let n=Math.max(F.min,Math.min(F.max,i*t));n!==i&&(o(n),console.log(`Zoom aplicado: ${n.toFixed(3)}x`))}exportarComoImagen(e,t="png",i=1,o){try{return e.toDataURL({format:t,quality:i,multiplier:1/o,enableRetinaScaling:!0,filter:n=>n&&typeof n=="object"&&"excludeFromExport"in n?!n.excludeFromExport:!0})}catch(n){return console.error("Error al exportar imagen:",n),null}}exportarComoBlob(e,t="png",i=1,o){return C(this,null,function*(){try{return yield e.toBlob({format:t,quality:i,multiplier:1/o,enableRetinaScaling:!0,filter:n=>n&&typeof n=="object"&&"excludeFromExport"in n?!n.excludeFromExport:!0})}catch(n){return console.error("Error al exportar Blob:",n),null}})}redimensionarCanvas(e,t,i,o,n){let r=i.width/t.width,c=i.height/t.height;e.getObjects().forEach(l=>{"excludeFromExport"in l&&l.excludeFromExport||(l.left=(l.left||0)*r,l.top=(l.top||0)*c,l.setCoords())}),e.setDimensions({width:i.width,height:i.height}),this.rescaleBackgroundImageWithDimensions(e,i),e.requestRenderAll(),console.log("Canvas redimensionado:"),console.log(`- Nuevas dimensiones: ${i.width}x${i.height}px`),console.log(`- Nueva escala: ${n.toFixed(3)}x`)}rescaleBackgroundImage(e){let t=e.backgroundImage;if(!t)return;let i=e.getWidth(),o=e.getHeight(),n=t.width||1,r=t.height||1,c=i/n,l=o/r;t.set({scaleX:c,scaleY:l,left:0,top:0,originX:"left",originY:"top"}),console.log(`Imagen de fondo reescalada - Escala: ${c.toFixed(3)}x${l.toFixed(3)}`)}rescaleBackgroundImageWithDimensions(e,t){let i=e.backgroundImage;if(!i)return;let o=i.width||1,n=i.height||1,r=t.width/o,c=t.height/n;i.set({scaleX:r,scaleY:c,left:0,top:0,originX:"left",originY:"top"}),console.log(`Imagen de fondo reescalada - Escala: ${r.toFixed(3)}x${c.toFixed(3)}`)}static \u0275fac=function(t){return new(t||d)};static \u0275prov=_({token:d,factory:d.\u0275fac,providedIn:"root"})};var ne=class d{crearTexto(e="Texto de muestra",t={}){let i=e.trim()||"Texto de muestra",o=S({left:t.left||100,top:t.top||100,fontFamily:t.fontFamily||"Arial",fontSize:Math.max(8,Math.min(200,t.fontSize||20)),fill:t.fill||"#000000",editable:!0,selectable:!0,hasControls:!0,hasBorders:!0,cornerSize:x.cornerSize,transparentCorners:x.transparentCorners,padding:x.padding,borderColor:"#007bff",cornerColor:"#007bff"},t);return new W(i,o)}crearRectangulo(e={}){return new ee(S({left:150,top:150,width:200,height:100,fill:e.fill||"rgba(0, 123, 255, 0.3)",stroke:e.stroke||"#007bff",strokeWidth:e.strokeWidth||2,selectable:!0,hasControls:!0,hasBorders:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,cornerSize:x.cornerSize,transparentCorners:x.transparentCorners,borderColor:"#007bff",cornerColor:"#007bff"},e))}crearCirculo(e={}){return new De(S({left:200,top:200,radius:50,fill:e.fill||"rgba(40, 167, 69, 0.3)",stroke:e.stroke||"#28a745",strokeWidth:e.strokeWidth||2,selectable:!0,hasControls:!0,hasBorders:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,cornerSize:x.cornerSize,transparentCorners:x.transparentCorners,borderColor:"#28a745",cornerColor:"#28a745"},e))}crearLinea(e={}){return new Z([50,50,250,50],S({stroke:e.stroke||"#6c757d",strokeWidth:e.strokeWidth||2,fill:"",selectable:!0,hasControls:!0,hasBorders:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,cornerSize:x.cornerSize,transparentCorners:x.transparentCorners,borderColor:"#6c757d",cornerColor:"#6c757d"},e))}static \u0275fac=function(t){return new(t||d)};static \u0275prov=_({token:d,factory:d.\u0275fac,providedIn:"root"})};var re=class d{obtenerConfiguracionBase(){return{selectable:!0,hasControls:!0,hasBorders:!0,cornerStyle:x.cornerStyle,cornerSize:x.cornerSize,transparentCorners:x.transparentCorners}}crearEstrella(e={}){let t="M 50,0 L 61,35 L 98,35 L 68,57 L 79,91 L 50,70 L 21,91 L 32,57 L 2,35 L 39,35 Z",i={left:300,top:100,fill:"#FFD700",stroke:"#FFA500",strokeWidth:2,scaleX:1.5,scaleY:1.5,borderColor:"#FFD700",cornerColor:"#FFD700"};return new H(t,S(S(S({},this.obtenerConfiguracionBase()),i),e))}crearSello(e={}){let t=`
      M 50,10 
      C 65,10 80,20 85,35
      C 80,50 65,60 50,60
      C 35,60 20,50 15,35
      C 20,20 35,10 50,10 Z
      M 50,20
      C 60,20 70,25 70,35
      C 70,45 60,50 50,50
      C 40,50 30,45 30,35
      C 30,25 40,20 50,20 Z
    `,i={left:400,top:300,fill:"rgba(138, 43, 226, 0.8)",stroke:"#4B0082",strokeWidth:3,scaleX:2,scaleY:2,borderColor:"#4B0082",cornerColor:"#4B0082"};return new H(t,S(S(S({},this.obtenerConfiguracionBase()),i),e))}crearFlecha(e={}){let t=`
      M 10,50 
      L 40,30 
      L 40,40
      L 80,40
      L 80,60
      L 40,60
      L 40,70
      Z
    `,i={left:200,top:400,fill:"#DC143C",stroke:"#8B0000",strokeWidth:2,scaleX:1.5,scaleY:1.5,borderColor:"#DC143C",cornerColor:"#DC143C"};return new H(t,S(S(S({},this.obtenerConfiguracionBase()),i),e))}crearMarcoOrnamental(e={}){let t=`
      M 0,0 
      L 100,0 
      C 105,0 110,5 110,10
      L 110,20
      C 110,25 105,30 100,30
      L 30,30
      C 25,30 20,35 20,40
      L 20,100
      C 20,105 15,110 10,110
      L 0,110
      C 5,105 10,100 10,90
      L 10,20
      C 10,15 5,10 0,10
      Z
    `,i={left:50,top:50,fill:"rgba(184, 134, 11, 0.8)",stroke:"#B8860B",strokeWidth:2,scaleX:1,scaleY:1,borderColor:"#B8860B",cornerColor:"#B8860B"};return new H(t,S(S(S({},this.obtenerConfiguracionBase()),i),e))}crearFirmaEstilizada(e={}){let t=`
      M 0,50 
      C 20,30 40,70 60,50
      C 80,30 100,70 120,50
      C 140,30 160,50 180,50
      M 0,60
      L 180,60
      M 0,70
      L 180,70
    `,i={left:300,top:500,fill:"",stroke:"#000080",strokeWidth:2,scaleX:1.2,scaleY:1.2,borderColor:"#000080",cornerColor:"#000080"};return new H(t,S(S(S({},this.obtenerConfiguracionBase()),i),e))}static \u0275fac=function(t){return new(t||d)};static \u0275prov=_({token:d,factory:d.\u0275fac,providedIn:"root"})};var ae=class d{DB_NAME="certificado-editor-db";DB_VERSION=1;STORE_NAME="canvas-data";STORAGE_KEY="certificado-editor-canvas";AUTO_SAVE_DELAY=2e3;autoSaveTimeout=null;db=null;constructor(){this.initDB()}initDB(){return C(this,null,function*(){return new Promise((e,t)=>{let i=indexedDB.open(this.DB_NAME,this.DB_VERSION);i.onerror=()=>{console.error("Error al abrir IndexedDB:",i.error),t(i.error)},i.onsuccess=()=>{this.db=i.result,console.log("IndexedDB inicializada correctamente"),e()},i.onupgradeneeded=o=>{let n=o.target.result;n.objectStoreNames.contains(this.STORE_NAME)||(n.createObjectStore(this.STORE_NAME,{keyPath:"id"}).createIndex("timestamp","timestamp",{unique:!1}),console.log("Object store creado en IndexedDB"))}})})}ensureDB(){return C(this,null,function*(){if(this.db||(yield this.initDB()),!this.db)throw new Error("No se pudo inicializar IndexedDB");return this.db})}guardarCanvas(e){return C(this,null,function*(){try{if(!e)return;let o=(yield this.ensureDB()).transaction([this.STORE_NAME],"readwrite").objectStore(this.STORE_NAME),n={id:this.STORAGE_KEY,version:"1.0",timestamp:Date.now(),objects:e.toJSON(),viewport:e.viewportTransform,zoom:e.getZoom(),dimensions:{width:e.width,height:e.height}};yield new Promise((r,c)=>{let l=o.put(n);l.onsuccess=()=>{console.log("Canvas guardado en IndexedDB"),r()},l.onerror=()=>{console.error("Error al guardar en IndexedDB:",l.error),c(l.error)}})}catch(t){throw console.error("Error al guardar canvas:",t),t}})}cargarCanvas(e){return C(this,null,function*(){try{let o=(yield this.ensureDB()).transaction([this.STORE_NAME],"readonly").objectStore(this.STORE_NAME),n=yield new Promise((c,l)=>{let b=o.get(this.STORAGE_KEY);b.onsuccess=()=>{c(b.result)},b.onerror=()=>{l(b.error)}});if(!n)return!1;if(!n.objects||!n.version)return console.warn("Datos de canvas inv\xE1lidos en IndexedDB"),!1;let r=e.getObjects().filter(c=>c.excludeFromExport);return e.clear(),yield new Promise((c,l)=>{e.loadFromJSON(n.objects).then(()=>{r.forEach(b=>e.add(b)),n.viewport&&e.setViewportTransform(n.viewport),n.zoom&&e.setZoom(n.zoom),e.renderAll(),c()}).catch(b=>{l(b)})}),console.log("Canvas cargado desde IndexedDB"),!0}catch(t){return console.error("Error al cargar canvas:",t),!1}})}programarAutoGuardado(e){this.autoSaveTimeout&&clearTimeout(this.autoSaveTimeout),this.autoSaveTimeout=setTimeout(()=>C(this,null,function*(){try{yield this.guardarCanvas(e)}catch(t){console.error("Error en auto-guardado:",t)}}),this.AUTO_SAVE_DELAY)}limpiarStorage(){return C(this,null,function*(){try{let i=(yield this.ensureDB()).transaction([this.STORE_NAME],"readwrite").objectStore(this.STORE_NAME);yield new Promise((o,n)=>{let r=i.delete(this.STORAGE_KEY);r.onsuccess=()=>{console.log("Datos del canvas eliminados de IndexedDB"),o()},r.onerror=()=>{console.error("Error al limpiar IndexedDB:",r.error),n(r.error)}})}catch(e){throw console.error("Error al limpiar storage:",e),e}})}tieneDataGuardada(){return C(this,null,function*(){try{let i=(yield this.ensureDB()).transaction([this.STORE_NAME],"readonly").objectStore(this.STORE_NAME);return new Promise(o=>{let n=i.get(this.STORAGE_KEY);n.onsuccess=()=>{o(n.result!==void 0)},n.onerror=()=>{o(!1)}})}catch{return!1}})}obtenerInfoDataGuardada(){return C(this,null,function*(){try{let i=(yield this.ensureDB()).transaction([this.STORE_NAME],"readonly").objectStore(this.STORE_NAME);return new Promise(o=>{let n=i.get(this.STORAGE_KEY);n.onsuccess=()=>{let r=n.result;o(r?{timestamp:r.timestamp||0,version:r.version||"unknown"}:null)},n.onerror=()=>{o(null)}})}catch{return null}})}exportarComoArchivo(e){return C(this,null,function*(){try{let t={version:"1.0",timestamp:Date.now(),objects:e.toJSON(),viewport:e.viewportTransform,zoom:e.getZoom(),dimensions:{width:e.width,height:e.height}},i=JSON.stringify(t,null,2),o=new Blob([i],{type:"application/json"}),n=document.createElement("a");n.href=URL.createObjectURL(o),n.download=`certificado-${new Date().getTime()}.json`,n.click(),URL.revokeObjectURL(n.href)}catch(t){throw console.error("Error al exportar canvas:",t),t}})}importarDesdeArchivo(e,t){return C(this,null,function*(){try{let i=yield t.text(),o=JSON.parse(i);if(!o.objects||!o.version)throw new Error("Archivo JSON inv\xE1lido");let n=e.getObjects().filter(r=>r.excludeFromExport);return e.clear(),yield new Promise((r,c)=>{e.loadFromJSON(o.objects).then(()=>{n.forEach(l=>e.add(l)),o.viewport&&e.setViewportTransform(o.viewport),o.zoom&&e.setZoom(o.zoom),e.renderAll(),r()}).catch(l=>{c(l)})}),yield this.guardarCanvas(e),!0}catch(i){return console.error("Error al importar archivo:",i),!1}})}obtenerTamanoAlmacenado(){return C(this,null,function*(){try{let i=(yield this.ensureDB()).transaction([this.STORE_NAME],"readonly").objectStore(this.STORE_NAME);return new Promise(o=>{let n=i.get(this.STORAGE_KEY);n.onsuccess=()=>{let r=n.result;if(r){let c=JSON.stringify(r);o(new Blob([c]).size)}else o(0)},n.onerror=()=>{o(0)}})}catch{return 0}})}static isSupported(){return"indexedDB"in window&&indexedDB!==null}static \u0275fac=function(t){return new(t||d)};static \u0275prov=_({token:d,factory:d.\u0275fac,providedIn:"root"})};var se=class d{canvasConfiguracionService=w(G);destroyRef=w(T);isLoading=p(!1);loadingProgress=p(0);loadingPercentage=y(()=>Math.round(this.loadingProgress()));canAddImage=y(()=>!this.isLoading());insertBackgroundImageFromFile(e,t,i){return this.isValidImageFile(e)?(this.isLoading.set(!0),this.loadingProgress.set(0),new Promise((o,n)=>{let r=new FileReader,c=new AbortController;this.destroyRef.onDestroy(()=>c.abort()),r.onprogress=l=>{l.lengthComputable&&this.loadingProgress.set(l.loaded/l.total*50)},r.onload=l=>{if(c.signal.aborted)return;let b=l.target?.result;this.addBackgroundImageFromUrl(b,t,i).then(A=>{this.isLoading.set(!1),this.loadingProgress.set(100),o(A)}).catch(A=>{this.isLoading.set(!1),this.loadingProgress.set(0),n(A)})},r.onerror=()=>{this.isLoading.set(!1),this.loadingProgress.set(0),n(new Error("Error leyendo archivo de imagen"))},r.readAsDataURL(e)})):Promise.reject(new Error("Archivo de imagen no v\xE1lido"))}isValidImageFile(e){return["image/jpeg","image/png","image/gif","image/webp"].includes(e.type)&&e.size<=10485760}addBackgroundImageFromUrl(e,t,i){return new Promise((o,n)=>{let r=new Image;r.crossOrigin="anonymous";let c=setTimeout(()=>{n(new Error("Timeout al cargar imagen - verificar conectividad"))},3e4);r.onload=()=>{clearTimeout(c),this.loadingProgress.set(75);try{let l=new Y(r),b=l.width||r.naturalWidth||r.width||1,A=l.height||r.naturalHeight||r.height||1;if(b<=0||A<=0||!isFinite(b)||!isFinite(A)){n(new Error("Imagen con dimensiones inv\xE1lidas o corruptas"));return}let I=i.width/b,X=i.height/A;l.set({scaleX:I,scaleY:X,left:0,top:0,originX:"left",originY:"top",selectable:!1,evented:!1}),t.backgroundColor="#ffffff",t.backgroundImage=l,t.requestRenderAll(),this.canvasConfiguracionService.actualizarGridPorImagenFondo(t,i),this.loadingProgress.set(100),o(l)}catch(l){let b=l instanceof Error?l.message:"Error desconocido";console.error("Error creando FabricImage:",b),n(new Error(`Error procesando imagen: ${b}`))}},r.onerror=()=>{clearTimeout(c),n(new Error("Error de red al cargar imagen - verificar URL o conectividad"))},r.src=e})}removeBackgroundImage(e,t){if(e.backgroundImage){let i=e.backgroundImage;try{i.removeTexture&&i.cacheKey&&i.removeTexture(i.cacheKey);let o=i.getElement();o&&"src"in o&&o.src&&o.src.startsWith("blob:")&&URL.revokeObjectURL(o.src)}catch(o){console.warn("Error limpiando cache de imagen:",o)}}e.backgroundImage=void 0,e.requestRenderAll(),this.canvasConfiguracionService.actualizarGridPorImagenFondo(e,t)}setBackgroundColor(e,t,i){e.backgroundImage&&this.removeBackgroundImage(e,i),e.backgroundColor=t,e.requestRenderAll(),this.canvasConfiguracionService.actualizarGridConColorPersonalizado(e,i)}clearBackgroundColor(e,t){e.backgroundColor="#ffffff",e.requestRenderAll(),this.canvasConfiguracionService.actualizarGridPorImagenFondo(e,t)}insertImageAsObject(e,t){return new Promise((i,o)=>{let n=new Image;n.crossOrigin="anonymous",n.onload=()=>{try{let r=new Y(n),c=t.getWidth()||800,l=t.getHeight()||600;r.set({left:c/2,top:l/2,originX:"center",originY:"center",selectable:!0,evented:!0}),t.add(r),t.setActiveObject(r),t.requestRenderAll(),i(r)}catch(r){console.error("Error creando FabricImage:",r),o(r)}},n.onerror=()=>{o(new Error("Error cargando imagen"))},n.src=e})}static \u0275fac=function(t){return new(t||d)};static \u0275prov=_({token:d,factory:d.\u0275fac,providedIn:"root"})};var ce=class d{destroyRef=w(T);currentZoom=p(1);isZoomModeActive=p(!1);zoomPercentage=y(()=>Math.round(this.currentZoom()*100));canZoomIn=y(()=>this.currentZoom()<F.max);canZoomOut=y(()=>this.currentZoom()>F.min);constructor(){this.destroyRef.onDestroy(()=>{this.isZoomModeActive.set(!1)})}getCurrentZoom(){return this.currentZoom()}setZoom(e){if(!isFinite(e)||e<=0){console.warn("Valor de zoom inv\xE1lido:",e);return}let t=this.aplicarLimitesZoom(e);this.currentZoom.set(t)}toggleZoomMode(e){this.isZoomModeActive.set(e)}getZoomModeState(){return this.isZoomModeActive()}aplicarLimitesZoom(e){return Math.max(F.min,Math.min(e,F.max))}aplicarZoomExterno(e,t,i,o,n){let r=o(i,t);return e.setDimensions({width:r.width,height:r.height}),n(e,r),e.requestRenderAll(),r}zoomInternoIn(e){let t=e.getZoom(),i=this.aplicarLimitesZoom(t*F.factorIn);e.setZoom(i),this.currentZoom.set(i),e.requestRenderAll()}zoomInternoOut(e){let t=e.getZoom(),i=this.aplicarLimitesZoom(t*F.factorOut);e.setZoom(i),this.currentZoom.set(i),e.requestRenderAll()}resetViewport(e){e.setZoom(1),this.currentZoom.set(1),e.absolutePan(new L(0,0)),e.requestRenderAll()}resetearZoom(e,t,i){i(t),e.setZoom(1),this.currentZoom.set(1),e.absolutePan(new L(0,0))}static \u0275fac=function(t){return new(t||d)};static \u0275prov=_({token:d,factory:d.\u0275fac,providedIn:"root"})};var le=class d{destroyRef=w(T);isScrollDragging=p(!1);isHandModeActive=p(!1);lastScrollPoint=p({x:0,y:0});cursorState=y(()=>({isActive:this.isHandModeActive(),isDragging:this.isScrollDragging(),cursor:this.isScrollDragging()?"grabbing":this.isHandModeActive()?"grab":"default"}));canvas=null;abortController=new AbortController;constructor(){K(()=>{let e=this.cursorState();e.isActive&&(document.body.style.cursor=e.cursor)}),this.destroyRef.onDestroy(()=>{this.limpiarRecursos()})}inicializar(e){this.canvas=e}toggleHandMode(e){this.canvas&&(this.isHandModeActive.set(e),e?(this.canvas.selection=!1,this.canvas.defaultCursor="grab",this.canvas.hoverCursor="grab",this.canvas.getObjects().forEach(t=>{t.selectable=!1,t.evented=!1}),this.configurarEventListeners(!0)):(this.canvas.selection=!0,this.canvas.defaultCursor="default",this.canvas.hoverCursor="move",this.canvas.getObjects().forEach(t=>{"excludeFromExport"in t&&t.excludeFromExport||(t.selectable=!0,t.evented=!0)}),document.body.style.cursor="default",this.isScrollDragging.set(!1),this.configurarEventListeners(!1)),this.canvas?.requestRenderAll())}getHandModeState(){return this.isHandModeActive()}configurarEventListeners(e){if(e){this.abortController.signal.aborted&&(this.abortController=new AbortController);let t=this.abortController.signal;document.addEventListener("mousedown",this.onMouseDown,{signal:t}),document.addEventListener("mousemove",this.onMouseMove,{signal:t}),document.addEventListener("mouseup",this.onMouseUp,{signal:t}),document.addEventListener("touchstart",this.onTouchStart,{passive:!1,signal:t}),document.addEventListener("touchmove",this.onTouchMove,{passive:!1,signal:t}),document.addEventListener("touchend",this.onTouchEnd,{passive:!1,signal:t})}else this.abortController.abort(),this.isScrollDragging.set(!1)}onMouseDown=e=>{if(!this.isHandModeActive())return;let t=e.target;(t.closest("app-editor-canvas")||t.closest(".canvas-container")||t.tagName==="CANVAS"||t.closest("canvas"))&&(this.isScrollDragging.set(!0),this.lastScrollPoint.set({x:e.clientX,y:e.clientY}),e.preventDefault(),document.body.style.cursor="grabbing")};onMouseMove=e=>{if(!this.isScrollDragging()||!this.isHandModeActive())return;let t=this.lastScrollPoint(),i=t.x-e.clientX,o=t.y-e.clientY;window.scrollBy(i,o),this.lastScrollPoint.set({x:e.clientX,y:e.clientY}),e.preventDefault()};onMouseUp=e=>{this.isHandModeActive()&&(this.isScrollDragging.set(!1),document.body.style.cursor=this.isHandModeActive()?"grab":"default",e.preventDefault())};onTouchStart=e=>{if(!this.isHandModeActive())return;let t=e.target;if(!(t.closest("app-editor-canvas")||t.closest(".canvas-container")||t.tagName==="CANVAS"||t.closest("canvas")))return;let o=e.touches[0];this.isScrollDragging.set(!0),this.lastScrollPoint.set({x:o.clientX,y:o.clientY}),e.preventDefault()};onTouchMove=e=>{if(!this.isScrollDragging()||!this.isHandModeActive())return;let t=e.touches[0],i=this.lastScrollPoint(),o=i.x-t.clientX,n=i.y-t.clientY;window.scrollBy(o,n),this.lastScrollPoint.set({x:t.clientX,y:t.clientY}),e.preventDefault()};onTouchEnd=e=>{this.isHandModeActive()&&(this.isScrollDragging.set(!1),e.preventDefault())};limpiarRecursos(){this.abortController.abort(),this.canvas=null,this.isHandModeActive.set(!1),this.isScrollDragging.set(!1),(document.body.style.cursor==="grab"||document.body.style.cursor==="grabbing")&&(document.body.style.cursor="default")}get handModeActivo(){return this.isHandModeActive()}static \u0275fac=function(t){return new(t||d)};static \u0275prov=_({token:d,factory:d.\u0275fac,providedIn:"root"})};var Te=je(Pe());var de=class d{crearQR(e){return C(this,null,function*(){try{let t=yield Te.toDataURL(e.url,{width:e.size,margin:e.showBorder?Math.max(1,e.borderWidth):0,color:{dark:"#000000",light:"#ffffff"},errorCorrectionLevel:"M"}),i=e.showBorder?e.borderWidth:0,o=yield this.crearImagenQR(t,e.size,i),n=this.crearTexto(e.codigo||"{{qr-code}}",e.size/2+i,e.size+i+2,e.fontSize,"#000000",e.fontFamily),r=e.size+e.fontSize+10+i*2,c=e.size+i*2,l=[];if(e.showBorder){let A=this.crearMarco(c,r,e.borderWidth);l.push(A)}l.push(o,n);let b=new ye(l,{left:e.left||100,top:e.top||100,selectable:!0,hasControls:!0,hasBorders:!0});return b.isQRGroup=!0,b.qrData={url:e.url,codigo:e.codigo||"{{qr-code}}",size:e.size,fontSize:e.fontSize,fontFamily:e.fontFamily,showBorder:e.showBorder,borderWidth:e.borderWidth},b}catch(t){throw console.error("Error al generar QR:",t),t}})}crearImagenQR(e,t,i=0){return C(this,null,function*(){return new Promise((o,n)=>{Y.fromURL(e).then(r=>{r.set({left:i,top:i,originX:"left",originY:"top",scaleX:t/(r.width||t),scaleY:t/(r.height||t),selectable:!1}),o(r)}).catch(n)})})}crearTexto(e,t,i,o,n,r="Arial"){return!e||e.trim()===""?new W("",{visible:!1}):new W(e,{left:t,top:i,fontSize:o,fill:n,fontFamily:r,textAlign:"center",originX:"center",originY:"top",selectable:!1,width:200})}crearMarco(e,t,i){return new ee({left:-i,top:-i,width:e+i*2,height:t+i*2,fill:"transparent",stroke:"#000000",strokeWidth:i,originX:"left",originY:"top",selectable:!1})}static \u0275fac=function(t){return new(t||d)};static \u0275prov=_({token:d,factory:d.\u0275fac,providedIn:"root"})};var Re=["canvasElement"],U=class d{canvasRef;destroyRef=w(T);calculosService=w(ie);configuracionService=w(G);operacionesService=w(oe);storageService=w(ae);imageService=w(se);zoomService=w(ce);scrollDragService=w(le);objetosBasicosFactory=w(ne);elementosDecorativosFactory=w(re);qrFactory=w(de);canvas=p(null);configuracion=p(ke);dimensionesActuales=p({width:0,height:0});dimensionesVisuales=p({width:0,height:0});currentScale=p(F.escalaBase);isGridVisible=p(!0);objectPropertiesChanged=new ge;objectSelected=new ge;currentFormat=y(()=>this.configuracion().formato.nombre);currentOrientation=y(()=>this.configuracion().orientacion);zoomPercentage=y(()=>Math.round(this.currentScale()/F.escalaBase*100));onSelectionChange;onSelectionCountChange;onBackgroundColorChange;constructor(){Q(()=>{this.inicializarCanvas()}),this.destroyRef.onDestroy(()=>{this.limpiarRecursos()})}inicializarCanvas(){if(!this.canvasRef?.nativeElement){console.error("Elemento canvas no encontrado");return}try{let e=this.calculosService.calcularDimensionesCanvas(this.configuracion()),t=this.calculosService.calcularDimensionesVisuales(e),i=this.calculosService.calcularEscalaOptima(e),o=this.configuracionService.obtenerOpcionesCanvas(t),n=new _e(this.canvasRef.nativeElement,o);this.canvas.set(n),this.dimensionesActuales.set(e),this.dimensionesVisuales.set(t),this.currentScale.set(i),this.configuracionService.configurarGrid(n,t),this.configuracionService.configurarEventos(n),this.configurarEventosSeleccion(n),this.configurarEventosTeclado(n),this.configurarAutoGuardado(n),this.cargarDatosGuardados(n),this.scrollDragService.inicializar(n)}catch(e){console.error("Error al inicializar el canvas:",e)}}cambiarFormato(e){if(!e||!te[e]){console.error("Formato inv\xE1lido:",e);return}let t=me(S({},this.configuracion()),{formato:te[e]});this.configuracion.set(t),this.redimensionarCanvas()}cambiarOrientacion(e){if(!e||!["horizontal","vertical"].includes(e)){console.error("Orientaci\xF3n inv\xE1lida:",e);return}let t=me(S({},this.configuracion()),{orientacion:e});this.configuracion.set(t),this.redimensionarCanvas()}zoomInternoIn(){let e=this.canvas();e&&this.zoomService.zoomInternoIn(e)}zoomInternoOut(){let e=this.canvas();e&&this.zoomService.zoomInternoOut(e)}zoomIn(){if(!this.canvas())return;let t=this.currentScale(),i=this.zoomService.aplicarLimitesZoom(t*F.factorIn);this.aplicarZoomExterno(i)}zoomOut(){if(!this.canvas())return;let t=this.currentScale(),i=this.zoomService.aplicarLimitesZoom(t*F.factorOut);this.aplicarZoomExterno(i)}aplicarZoomExterno(e){let t=this.canvas();if(!t)return;let i=this.dimensionesActuales(),o=this.zoomService.aplicarZoomExterno(t,e,i,(n,r)=>this.calculosService.calcularDimensionesVisuales(n,r),(n,r)=>{this.configuracionService.actualizarGridInteligente(n,r)});this.dimensionesVisuales.set(o),this.currentScale.set(e)}resetearZoom(){let e=this.canvas();if(!e)return;let t=this.dimensionesActuales(),i=this.calculosService.calcularEscalaOptima(t);this.zoomService.resetearZoom(e,i,o=>this.aplicarZoomExterno(o))}ajustarCanvas(){this.resetearZoom(),this.centerOnCanvas()}insertText(){this.addText("Haga clic para editar",{fontSize:24,fontFamily:"Arial",fill:"#000000",editable:!0})}insertBackgroundImage(e){let t=this.canvas();if(!t)return;let i=this.dimensionesVisuales();this.imageService.insertBackgroundImageFromFile(e,t,i).then(o=>{o&&console.log("Imagen de fondo insertada exitosamente")}).catch(o=>{console.error("Error insertando imagen de fondo:",o)})}clearBackgroundImage(){let e=this.canvas();if(!e)return;let t=this.dimensionesVisuales();this.imageService.removeBackgroundImage(e,t),console.log("Imagen de fondo removida exitosamente")}insertImageAsObject(e){let t=this.canvas();t&&this.imageService.insertImageAsObject(e,t).then(i=>{i&&console.log("Imagen insertada como objeto exitosamente")}).catch(i=>{console.error("Error insertando imagen como objeto:",i)})}setBackgroundColor(e){let t=this.canvas();if(!t)return;let i=this.dimensionesVisuales();this.imageService.setBackgroundColor(t,e,i),console.log("Color de fondo aplicado:",e),this.storageService.programarAutoGuardado(t)}clearBackgroundColor(){let e=this.canvas();if(!e)return;let t=this.dimensionesVisuales();this.imageService.clearBackgroundColor(e,t),console.log("Color de fondo removido"),this.storageService.programarAutoGuardado(e)}exportToJSON(){let e=this.canvas();if(e)try{let t=e.getObjects().filter(i=>"excludeFromExport"in i&&i.excludeFromExport);t.forEach(i=>e.remove(i)),this.convertirImagenesABase64().then(i=>{t.forEach(b=>e.add(b));let o={version:"1.0",timestamp:new Date().toISOString(),canvasData:i,dimensionesActuales:this.dimensionesActuales(),dimensionesVisuales:this.dimensionesVisuales(),currentScale:this.currentScale(),backgroundColor:e.backgroundColor,hasBackgroundImage:!!e.backgroundImage},n=JSON.stringify(o,null,2),r=new Blob([n],{type:"application/json"}),c=URL.createObjectURL(r),l=document.createElement("a");l.href=c,l.download=`certificado-${new Date().getTime()}.json`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(c),console.log("Canvas exportado a JSON exitosamente")}).catch(i=>{t.forEach(o=>e.add(o)),console.error("Error exportando canvas a JSON:",i)})}catch(t){console.error("Error exportando canvas a JSON:",t)}}convertirImagenesABase64(){return C(this,null,function*(){let e=this.canvas();if(!e)throw new Error("Canvas no disponible");let t=e.toJSON(),i=n=>new Promise((r,c)=>{if(!n.startsWith("blob:")){r(n);return}let l=new Image;l.crossOrigin="anonymous",l.onload=()=>{let b=document.createElement("canvas"),A=b.getContext("2d");if(!A){c(new Error("No se pudo obtener contexto del canvas"));return}b.width=l.width,b.height=l.height,A.drawImage(l,0,0);try{let I=b.toDataURL("image/png");r(I)}catch(I){c(I)}},l.onerror=()=>{console.warn(`No se pudo cargar imagen blob: ${n}, se mantendr\xE1 la URL original`),r(n)},l.src=n}),o=n=>C(this,null,function*(){if(n.type==="image"&&n.src&&n.src.startsWith("blob:"))try{n.src=yield i(n.src)}catch(r){console.warn("Error convirtiendo imagen a base64:",r)}if(n.objects&&Array.isArray(n.objects))for(let r=0;r<n.objects.length;r++)n.objects[r]=yield o(n.objects[r]);return n});if(t.objects&&Array.isArray(t.objects))for(let n=0;n<t.objects.length;n++)t.objects[n]=yield o(t.objects[n]);if(t.backgroundImage&&t.backgroundImage.src&&t.backgroundImage.src.startsWith("blob:"))try{t.backgroundImage.src=yield i(t.backgroundImage.src)}catch(n){console.warn("Error convirtiendo imagen de fondo a base64:",n)}return t})}importFromJSON(e){let t=this.canvas();if(!t)return;let i=new FileReader;i.onload=o=>{try{let n=o.target?.result,r=JSON.parse(n);if(!r.canvasData)throw new Error("Archivo JSON no v\xE1lido: falta canvasData");r.version&&r.version!=="1.0"&&console.warn(`Versi\xF3n del archivo (${r.version}) puede no ser compatible`),t.clear(),t.loadFromJSON(r.canvasData,()=>{setTimeout(()=>{if(r.dimensionesActuales&&r.dimensionesVisuales&&(this.dimensionesActuales.set(r.dimensionesActuales),this.dimensionesVisuales.set(r.dimensionesVisuales),t.setDimensions({width:r.dimensionesVisuales.width,height:r.dimensionesVisuales.height})),r.currentScale&&this.currentScale.set(r.currentScale),t.backgroundImage&&this.operacionesService.rescaleBackgroundImage(t),this.configuracionService.actualizarGridInteligente(t,this.dimensionesVisuales()),r.backgroundColor&&this.onBackgroundColorChange){let c=typeof r.backgroundColor=="string"?r.backgroundColor:"#ffffff";this.onBackgroundColorChange(c)}this.forzarActualizacionCanvas(t),console.log("Canvas importado desde JSON exitosamente")},100)})}catch(n){console.error("Error importando canvas desde JSON:",n),alert("Error al importar el archivo JSON. Verifique que el archivo sea v\xE1lido.")}},i.onerror=()=>{console.error("Error leyendo archivo JSON"),alert("Error al leer el archivo JSON.")},i.readAsText(e)}forzarActualizacionCanvas(e){e.getObjects().forEach(t=>{t.setCoords()}),e.requestRenderAll()}addText(e="Texto de muestra",t={}){let i=this.objetosBasicosFactory.crearTexto(e,t);this.agregarObjetoAlCanvas(i)}agregarRectangulo(e={}){let t=this.objetosBasicosFactory.crearRectangulo(e);this.agregarObjetoAlCanvas(t)}agregarCirculo(e={}){let t=this.objetosBasicosFactory.crearCirculo(e);this.agregarObjetoAlCanvas(t)}agregarLinea(e={}){let t=this.objetosBasicosFactory.crearLinea(e);this.agregarObjetoAlCanvas(t)}agregarQR(e){return C(this,null,function*(){try{let t=yield this.qrFactory.crearQR(e);this.agregarObjetoAlCanvas(t)}catch(t){console.error("Error al agregar QR al canvas:",t)}})}toggleDibujoLibre(e,t={}){let i=this.canvas();if(i){if(e){if(i.isDrawingMode=!0,i.freeDrawingBrush||(i.freeDrawingBrush=new Ae(i)),i.freeDrawingBrush){let o=t.strokeWidth||5,n=t.stroke||"#000000";i.freeDrawingBrush.width=o,i.freeDrawingBrush.color=n}i.selection=!1,i.defaultCursor="crosshair"}else i.isDrawingMode=!1,i.selection=!0,i.defaultCursor="default";i.requestRenderAll()}}limpiarDibujos(){let e=this.canvas();if(!e)return;e.getObjects().filter(o=>o.type==="path").forEach(o=>{e.remove(o)}),e.requestRenderAll()}actualizarObjetosSeleccionados(e){let t=this.canvas();if(!t)return;let i=t.getActiveObjects();i&&i.length>0&&i.forEach(o=>{e.fill!==void 0&&o.set("fill",e.fill),e.stroke!==void 0&&o.set("stroke",e.stroke),e.strokeWidth!==void 0&&o.set("strokeWidth",e.strokeWidth),t.fire("object:modified",{target:o})}),t.isDrawingMode&&t.freeDrawingBrush&&(e.stroke!==void 0&&(t.freeDrawingBrush.color=e.stroke),e.strokeWidth!==void 0&&(t.freeDrawingBrush.width=e.strokeWidth)),t.requestRenderAll()}agregarEstrella(e={}){let t=this.elementosDecorativosFactory.crearEstrella(e);this.agregarObjetoAlCanvas(t)}agregarSello(e={}){let t=this.elementosDecorativosFactory.crearSello(e);this.agregarObjetoAlCanvas(t)}agregarFlecha(e={}){let t=this.elementosDecorativosFactory.crearFlecha(e);this.agregarObjetoAlCanvas(t)}agregarMarcoOrnamental(e={}){let t=this.elementosDecorativosFactory.crearMarcoOrnamental(e);this.agregarObjetoAlCanvas(t)}agregarFirmaEstilizada(e={}){let t=this.elementosDecorativosFactory.crearFirmaEstilizada(e);this.agregarObjetoAlCanvas(t)}agregarObjetoAlCanvas(e){let t=this.canvas();t&&(t.add(e),t.setActiveObject(e),t.requestRenderAll())}enviarAlFrente(){let e=this.canvas();e&&this.operacionesService.enviarAlFrente(e)}enviarAlFondo(){let e=this.canvas();e&&this.operacionesService.enviarAlFondo(e)}eliminarSeleccionado(){let e=this.canvas();e&&this.operacionesService.eliminarSeleccionado(e)}deleteSelectedObjects(){let e=this.canvas();if(!e)return;let t=e.getActiveObjects();t.length!==0&&(t.forEach(i=>{e.remove(i)}),e.discardActiveObject(),e.requestRenderAll(),console.log(`Eliminados ${t.length} objeto(s)`))}getSelectedObjectsCount(){let e=this.canvas();return e?e.getActiveObjects().length:0}centrarHorizontalmente(){let e=this.canvas();if(!e)return;let t=e.getActiveObject();t&&(e.centerObjectH(t),e.requestRenderAll())}centrarVerticalmente(){let e=this.canvas();if(!e)return;let t=e.getActiveObject();t&&(e.centerObjectV(t),e.requestRenderAll())}centerOnCanvas(){let e=this.canvas();e&&(e.absolutePan(new L(0,0)),e.requestRenderAll())}exportarComoImagen(e="png",t=1){let i=this.canvas();return i?this.operacionesService.exportarComoImagen(i,e,t,this.currentScale()):null}exportarComoBlob(e="png",t=1){return C(this,null,function*(){let i=this.canvas();return i?yield this.operacionesService.exportarComoBlob(i,e,t,this.currentScale()):null})}obtenerDimensionesMM(){let e=this.configuracion(),t=this.dimensionesActuales();return this.calculosService.obtenerDimensionesMM(t,e.formato.dpi)}obtenerEstadoCanvas(){let e=this.canvas(),t=this.configuracion(),i=this.dimensionesActuales(),o=this.obtenerDimensionesMM();return{inicializado:!!e,formato:t.formato.nombre,orientacion:t.orientacion,dimensionesPx:i,dimensionesMM:o,objetosEnCanvas:e?.getObjects().length||0,dpi:t.formato.dpi}}guardarEnStorage(){let e=this.canvas();e&&this.storageService.guardarCanvas(e)}cargarDesdeStorage(){return C(this,null,function*(){let e=this.canvas();return e?yield this.storageService.cargarCanvas(e):!1})}exportarComoJSON(){let e=this.canvas();e&&this.storageService.exportarComoArchivo(e)}importarDesdeJSON(e){return C(this,null,function*(){let t=this.canvas();return t?yield this.storageService.importarDesdeArchivo(t,e):!1})}limpiarStorage(){return C(this,null,function*(){yield this.storageService.limpiarStorage()})}tieneDataGuardada(){return C(this,null,function*(){return yield this.storageService.tieneDataGuardada()})}obtenerInfoDataGuardada(){return C(this,null,function*(){return yield this.storageService.obtenerInfoDataGuardada()})}redimensionarCanvas(){let e=this.canvas();if(!e)return;let t=this.calculosService.calcularDimensionesCanvas(this.configuracion()),i=this.calculosService.calcularDimensionesVisuales(t),o=this.calculosService.calcularEscalaOptima(t),n=this.dimensionesVisuales(),r=this.currentScale();this.operacionesService.redimensionarCanvas(e,n,i,r,o),this.dimensionesActuales.set(t),this.dimensionesVisuales.set(i),this.currentScale.set(o),this.configuracionService.actualizarGridInteligente(e,i)}toggleGrid(){let e=this.canvas();if(!e)return;let t=!this.isGridVisible();if(this.isGridVisible.set(t),t)this.configuracionService.actualizarGridInteligente(e,this.dimensionesVisuales());else{let i=e.backgroundColor;e.backgroundColor&&typeof e.backgroundColor=="object"&&(e.backgroundColor="#ffffff"),e.getObjects().forEach(n=>{"excludeFromExport"in n&&n.excludeFromExport&&e.remove(n)}),typeof i=="string"&&(e.backgroundColor=i)}e.renderAll()}clearCanvas(){let e=this.canvas();if(!e)return;let t=e.getObjects().filter(i=>"excludeFromExport"in i&&i.excludeFromExport);e.clear(),t.forEach(i=>e.add(i)),e.requestRenderAll()}newCanvas(){let e=this.canvas();e&&(e.clear(),e.backgroundColor="#ffffff",e.backgroundImage=void 0,this.configuracionService.configurarGrid(e,this.dimensionesVisuales()),e.requestRenderAll(),console.log("Nuevo canvas creado"))}undo(){}redo(){}exportAsPDF(){let e=this.canvas();if(e)try{let t=this.configuracion(),i=this.obtenerDimensionesMM(),o=e.toDataURL({format:"png",quality:1,multiplier:3,enableRetinaScaling:!0,filter:X=>!("excludeFromExport"in X&&X.excludeFromExport)}),n=t.orientacion==="horizontal"?"landscape":"portrait",r=t.formato.nombre.toLowerCase(),c=new xe({orientation:n,unit:"mm",format:r}),l=c.internal.pageSize.getWidth(),b=c.internal.pageSize.getHeight();c.addImage(o,"PNG",0,0,l,b,"certificado","FAST");let A=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5),I=`certificado_${t.formato.nombre}_${t.orientacion}_${A}.pdf`;c.save(I),console.log(`\u2705 PDF exportado: ${I}`)}catch(t){console.error("\u274C Error al exportar PDF:",t),alert("Error al generar el PDF. Por favor, int\xE9ntelo de nuevo.")}}togglePanZoom(e){let t=this.canvas();t&&(e?(t.selection=!1,t.defaultCursor="grab",t.hoverCursor="grab",t.moveCursor="grabbing",t.getObjects().forEach(i=>{i.selectable=!1,i.evented=!1}),this.configurarPanZoomNativo(t,!0)):(t.selection=!0,t.defaultCursor="default",t.hoverCursor="move",t.moveCursor="move",t.getObjects().forEach(i=>{"excludeFromExport"in i&&i.excludeFromExport||(i.selectable=!0,i.evented=!0)}),this.configurarPanZoomNativo(t,!1)),t.renderAll())}togglePan(e){let t=this.canvas();t&&(this.limpiarTodosLosEventos(t),e?(t.selection=!1,t.defaultCursor="grab",t.hoverCursor="grab",t.moveCursor="grabbing",t.getObjects().forEach(i=>{i.selectable=!1,i.evented=!1}),this.configurarPanNativo(t,!0)):(t.selection=!0,t.defaultCursor="default",t.hoverCursor="move",t.moveCursor="move",t.getObjects().forEach(i=>{"excludeFromExport"in i&&i.excludeFromExport||(i.selectable=!0,i.evented=!0)})),t.requestRenderAll())}toggleZoom(e){let t=this.canvas();t&&(this.limpiarTodosLosEventos(t),e?(t.selection=!1,t.defaultCursor="default",t.getObjects().forEach(i=>{i.selectable=!1,i.evented=!1}),this.configurarZoomNativo(t,!0)):(t.selection=!0,t.defaultCursor="default",t.getObjects().forEach(i=>{"excludeFromExport"in i&&i.excludeFromExport||(i.selectable=!0,i.evented=!0)})),t.requestRenderAll())}toggleHandMode(e){this.scrollDragService.toggleHandMode(e)}resetViewport(){let e=this.canvas();e&&this.zoomService.resetViewport(e)}setActiveObjectProperty(e,t){let i=this.canvas();if(!i)return;let o=i.getActiveObject();o&&this.isTextObject(o)&&(o.set(e,t),i.requestRenderAll(),i.fire("object:modified",{target:o}))}getActiveObjectProperty(e){let t=this.canvas();if(!t)return null;let i=t.getActiveObject();return i&&(i.type==="i-text"||i.type==="text"||i.type==="textbox")?i.get(e):null}isTextObject(e){return e.type==="i-text"||e.type==="text"||e.type==="textbox"}hasTextObjectSelected(){let e=this.canvas();if(!e)return!1;let t=e.getActiveObject();return t?this.isTextObject(t):!1}hasActiveTextObject(){let e=this.canvas();if(!e)return!1;let t=e.getActiveObject();return!!(t&&this.isTextObject(t))}configurarPanZoomNativo(e,t){e.off("mouse:wheel",this.onMouseWheelNativo),e.off("mouse:down",this.onMouseDownPan),e.off("mouse:move",this.onMouseMovePan),e.off("mouse:up",this.onMouseUpPan),t&&(e.on("mouse:wheel",this.onMouseWheelNativo),e.on("mouse:down",this.onMouseDownPan),e.on("mouse:move",this.onMouseMovePan),e.on("mouse:up",this.onMouseUpPan))}limpiarTodosLosEventos(e){e.off("mouse:wheel",this.onMouseWheelNativo),e.off("mouse:down",this.onMouseDownPan),e.off("mouse:move",this.onMouseMovePan),e.off("mouse:up",this.onMouseUpPan)}configurarPanNativo(e,t){e.off("mouse:down",this.onMouseDownPan),e.off("mouse:move",this.onMouseMovePan),e.off("mouse:up",this.onMouseUpPan),t&&(e.on("mouse:down",this.onMouseDownPan),e.on("mouse:move",this.onMouseMovePan),e.on("mouse:up",this.onMouseUpPan))}configurarZoomNativo(e,t){e.off("mouse:wheel",this.onMouseWheelNativo),t&&e.on("mouse:wheel",this.onMouseWheelNativo)}isPanningNativo=!1;lastPanPoint={x:0,y:0};onMouseWheelNativo=e=>{let t=this.canvas();if(!t)return;let i=e.e.deltaY,o=t.getZoom();o*=.999**i,o=this.zoomService.aplicarLimitesZoom(o);let n=new L(e.e.offsetX,e.e.offsetY);t.zoomToPoint(n,o),e.e.preventDefault(),e.e.stopPropagation()};onMouseDownPan=e=>{let t=this.canvas();if(!t||e.target)return;this.isPanningNativo=!0;let i="clientX"in e.e?e.e.clientX:e.e.touches[0]?.clientX||0,o="clientY"in e.e?e.e.clientY:e.e.touches[0]?.clientY||0;this.lastPanPoint={x:i,y:o},t.defaultCursor="grabbing"};onMouseMovePan=e=>{let t=this.canvas();if(!t||!this.isPanningNativo)return;let i="clientX"in e.e?e.e.clientX:e.e.touches[0]?.clientX||0,o="clientY"in e.e?e.e.clientY:e.e.touches[0]?.clientY||0,n=i-this.lastPanPoint.x,r=o-this.lastPanPoint.y;t.relativePan(new L(n,r)),this.lastPanPoint={x:i,y:o}};onMouseUpPan=()=>{let e=this.canvas();e&&(this.isPanningNativo=!1,e.defaultCursor="grab")};configurarEventosSeleccion(e){e.on("selection:created",()=>{this.notificarCambioSeleccion(),this.emitirPropiedadesObjetoSeleccionado()}),e.on("selection:updated",()=>{this.notificarCambioSeleccion(),this.emitirPropiedadesObjetoSeleccionado()}),e.on("selection:cleared",()=>{this.notificarCambioSeleccion()}),e.on("path:created",t=>{let i=t.path;i&&(i.set({selectable:!0,hasControls:!0,hasBorders:!0}),e.requestRenderAll())}),e.on("object:modified",()=>{e.requestRenderAll()}),e.on("object:moving",()=>{e.requestRenderAll()}),e.on("object:scaling",()=>{e.requestRenderAll()}),e.on("object:rotating",()=>{e.requestRenderAll()})}emitirPropiedadesObjetoSeleccionado(){let e=this.canvas();if(!e)return;let t=e.getActiveObject();if(!t)return;this.objectSelected.emit(t);let i={fill:t.fill,stroke:t.stroke,strokeWidth:t.strokeWidth||.05};this.objectPropertiesChanged.emit(i)}configurarEventosTeclado(e){let t=!1;e.on("text:editing:entered",()=>{t=!0}),e.on("text:editing:exited",()=>{t=!1});let i=o=>{let n=e.getElement();if(!(!n||!document.contains(n))){if(o.key==="Delete"&&!t){let r=e.getActiveObjects();r&&r.length>0&&(o.preventDefault(),this.deleteSelectedObjects())}if(o.ctrlKey&&o.key==="a"){o.preventDefault();let r=e.getObjects().filter(c=>!("excludeFromExport"in c&&c.excludeFromExport)&&c.selectable!==!1);if(r.length>0){if(e.discardActiveObject(),r.length===1)e.setActiveObject(r[0]);else{let c=new Fe(r,{canvas:e});e.setActiveObject(c)}e.requestRenderAll()}}o.key==="Escape"&&(e.discardActiveObject(),e.requestRenderAll())}};document.addEventListener("keydown",i),e._customKeydownHandler=i}configurarAutoGuardado(e){e.on("object:added",()=>{this.storageService.programarAutoGuardado(e)}),e.on("object:removed",()=>{this.storageService.programarAutoGuardado(e)}),e.on("object:modified",()=>{this.storageService.programarAutoGuardado(e)}),e.on("object:moving",()=>{this.storageService.programarAutoGuardado(e)}),e.on("object:scaling",()=>{this.storageService.programarAutoGuardado(e)}),e.on("object:rotating",()=>{this.storageService.programarAutoGuardado(e)})}cargarDatosGuardados(e){return C(this,null,function*(){try{if(yield this.storageService.tieneDataGuardada()){let i=yield this.storageService.obtenerInfoDataGuardada();i&&(console.log(`Cargando datos guardados del ${new Date(i.timestamp).toLocaleString()}`),yield this.storageService.cargarCanvas(e))}}catch(t){console.error("Error al cargar datos guardados:",t)}})}notificarCambioSeleccion(){let e=this.canvas(),t=e?e.getActiveObjects().length:0;this.onSelectionChange&&this.onSelectionChange(),this.onSelectionCountChange&&this.onSelectionCountChange(t)}getSelectedTextProperties(){let e=this.canvas();if(!e)return null;let t=e.getActiveObject();return!t||!this.hasActiveTextObject()?null:{fontFamily:t.get("fontFamily")||"Arial",fontSize:t.get("fontSize")||24,fontWeight:t.get("fontWeight")||"normal",fontStyle:t.get("fontStyle")||"normal",underline:t.get("underline")||!1,fill:t.get("fill")||"#000000",textAlign:t.get("textAlign")||"left"}}getHandModeState(){return this.scrollDragService.getHandModeState()}bringObjectToFront(){let e=this.canvas();return e?this.configuracionService.traerAlFrente(e):(console.warn("Canvas no inicializado"),!1)}sendObjectToBack(){let e=this.canvas();return e?this.configuracionService.enviarAtras(e):(console.warn("Canvas no inicializado"),!1)}hasObjectForLayering(){let e=this.canvas();return e?e.getActiveObject()!==null:!1}limpiarRecursos(){this.scrollDragService.limpiarRecursos();let e=this.canvas();e&&(e._customKeydownHandler&&(document.removeEventListener("keydown",e._customKeydownHandler),delete e._customKeydownHandler),e.dispose(),this.canvas.set(null))}static \u0275fac=function(t){return new(t||d)};static \u0275cmp=B({type:d,selectors:[["app-editor-canvas"]],viewQuery:function(t,i){if(t&1&&R(Re,7),t&2){let o;N(o=V())&&(i.canvasRef=o.first)}},outputs:{objectPropertiesChanged:"objectPropertiesChanged",objectSelected:"objectSelected"},decls:3,vars:0,consts:[["canvasElement",""],[1,"p-3","bg-white","d-flex","justify-content-center"],[1,"border","shadow-sm"]],template:function(t,i){t&1&&(pe(0,"div",1),Ce(1,"canvas",2,0),be())},encapsulation:2,changeDetection:0})};var Ne=["imageInput"],Ve=["jsonInput"],ze=["objectImageInput"],Le=["archivoInput"];function Be(d,e){if(d&1){let t=z();a(0,"button",139),v("click",function(){u(t);let o=M();return m(o.limpiarDibujos())}),g(1,"i",140),a(2,"span",26),h(3,"Limpiar"),s()()}}function qe(d,e){if(d&1){let t=z();a(0,"div",53)(1,"small",54),h(2,"Relleno"),s(),a(3,"input",141),v("change",function(o){u(t);let n=M();return m(n.updateShapeConfig("fill",o))}),s()()}if(d&2){let t=M();f(3),E("value",t.shapeConfig().fill)}}function He(d,e){if(d&1){let t=z();a(0,"button",142),v("click",function(){u(t);let o=M();return m(o.deleteSelectedObjects())}),g(1,"i",143),s()}}function Ge(d,e){if(d&1){let t=z();a(0,"div",66)(1,"button",144),v("click",function(){u(t);let o=M();return m(o.bringToFront())}),g(2,"i",145),s(),a(3,"button",146),v("click",function(){u(t);let o=M();return m(o.sendToBack())}),g(4,"i",147),s()()}}function Ze(d,e){if(d&1){let t=z();a(0,"div",103)(1,"label",99),h(2),s(),a(3,"input",148),v("input",function(o){u(t);let n=M();return m(n.updateQrConfig("borderWidth",o))}),s()()}if(d&2){let t=M();f(2),q("Grosor: ",t.qrConfig().borderWidth),f(),E("value",t.qrConfig().borderWidth)}}function We(d,e){d&1&&h(0,"s")}function Ye(d,e){if(d&1&&(a(0,"span",136),h(1),j(2,We,1,0),s()),d&2){let t=M();f(),q("",t.selectedObjectsCount()," seleccionado"),f(),P(t.selectedObjectsCount()>1?2:-1)}}var ue=class d{destroyRef=w(T);injector=w(fe);canvasComponent;imageInput;jsonInput;objectImageInput;archivoInput;canvasReady=p(!1);isPanActive=p(!1);isZoomActive=p(!1);isHandModeActive=p(!1);isDibujoLibreActive=p(!1);hasDrawingSelected=p(!1);selectedObjectsCount=p(0);hasSelectedObjects=y(()=>this.selectedObjectsCount()>0);backgroundColor=p("#ffffff");shapeConfig=p({fill:"#007bff",stroke:"#000000",strokeWidth:5});qrConfig=p({url:"{{qr-url}}",codigo:"{{qr-code}}",size:80,fontSize:14,fontFamily:"Arial",showBorder:!0,borderWidth:1});currentShapeType=p("");hasActiveModes=y(()=>this.isPanActive()||this.isZoomActive()||this.isHandModeActive(),{equal:(e,t)=>e===t});canvasHandModeState=Ee({source:this.isHandModeActive,computation:e=>({isActive:e,timestamp:Date.now(),cursorState:e?"grab":"default"})});handModeEffect=K(e=>{if(!this.canvasReady())return;let t=this.isHandModeActive(),i=this.canvasHandModeState();if(this.canvasComponent&&i.isActive!==t){console.warn("Hand mode state desync detected, correcting...");let o=setTimeout(()=>{this.validateAndSyncHandModeState()},0);e(()=>{clearTimeout(o)})}});constructor(){Q(()=>{this.canvasReady.set(!0),setTimeout(()=>{this.setupCanvasSelectionCallbacks(),this.updateStorageState()},100)}),this.destroyRef.onDestroy(()=>{this.canvasComponent&&(this.canvasComponent.onSelectionChange=void 0,this.canvasComponent.onSelectionCountChange=void 0,this.canvasComponent.onBackgroundColorChange=void 0)})}setupCanvasSelectionCallbacks(){if(!this.canvasComponent){console.warn("Canvas component not available for selection callbacks setup");return}this.canvasComponent.onSelectionChange=()=>{this.updateTextControlsFromSelection()},this.canvasComponent.onSelectionCountChange=e=>{this.selectedObjectsCount.set(e)},this.canvasComponent.onBackgroundColorChange=e=>{this.backgroundColor.set(e)}}selectedFontFamily=p("Arial");selectedFontSize=p(24);isBold=p(!1);isItalic=p(!1);isUnderline=p(!1);selectedTextColor=p("#000000");hasStoredData=p(!1);lastSavedTimestamp=p(null);formattedSavedDate=y(()=>{let e=this.lastSavedTimestamp();return e?new Date(e).toLocaleString():""});textAlign=p("left");hasTextSelected=y(()=>this.hasSelectedObjects()&&this.canvasComponent?.hasTextObjectSelected()||!1,{equal:(e,t)=>e===t});get currentFormat(){return this.canvasReady()&&this.canvasComponent?.currentFormat()||"A4"}get currentOrientation(){return this.canvasReady()&&this.canvasComponent?.currentOrientation()||"horizontal"}get zoomPercentage(){return this.canvasReady()&&this.canvasComponent?.zoomPercentage()||100}get isGridVisible(){return this.canvasReady()&&this.canvasComponent?.isGridVisible()||!0}cambiarFormato(e){if(!this.canvasReady()||!this.canvasComponent){console.warn("Canvas component not ready for format change");return}console.log("Cambiar formato:",e),this.canvasComponent.cambiarFormato(e)}cambiarOrientacion(e){if(!this.canvasReady()||!this.canvasComponent){console.warn("Canvas component not ready for orientation change");return}console.log("Cambiar orientaci\xF3n:",e),this.canvasComponent.cambiarOrientacion(e)}zoomIn(){if(!this.canvasComponent){console.warn("Canvas component not initialized");return}console.log("Zoom in"),this.canvasComponent.zoomIn()}zoomOut(){if(!this.canvasComponent){console.warn("Canvas component not initialized");return}console.log("Zoom out"),this.canvasComponent.zoomOut()}toggleGrid(){console.log("Toggle grid"),this.canvasComponent?.toggleGrid()}centerCanvas(){console.log("Centrar canvas"),this.canvasComponent?.centerOnCanvas()}fitToWindow(){console.log("Ajustar a ventana"),this.canvasComponent?.resetearZoom()}clearCanvas(){console.log("Limpiar canvas"),confirm("\xBFEst\xE1s seguro de que quieres limpiar todo el canvas?")&&(this.canvasComponent?.clearCanvas(),this.imageInput?.nativeElement&&(this.imageInput.nativeElement.value=""),this.jsonInput?.nativeElement&&(this.jsonInput.nativeElement.value=""),this.objectImageInput?.nativeElement&&(this.objectImageInput.nativeElement.value=""))}newCanvas(){console.log("Crear nuevo canvas"),confirm("\xBFEst\xE1s seguro de que quieres crear un nuevo canvas? Se perder\xE1n todos los cambios no guardados.")&&(this.canvasComponent?.newCanvas(),this.backgroundColor.set("#ffffff"),this.selectedObjectsCount.set(0),this.imageInput?.nativeElement&&(this.imageInput.nativeElement.value=""),this.jsonInput?.nativeElement&&(this.jsonInput.nativeElement.value=""),this.objectImageInput?.nativeElement&&(this.objectImageInput.nativeElement.value=""))}undo(){console.log("undo"),this.canvasComponent?.undo()}redo(){console.log("redo"),this.canvasComponent?.redo()}deleteSelectedObjects(){if(!this.canvasReady()||!this.canvasComponent){console.warn("Canvas component not ready for deletion");return}let e=this.selectedObjectsCount();if(e===0){console.warn("No objects selected for deletion");return}let t=e===1?"\xBFEst\xE1s seguro de que quieres eliminar el objeto seleccionado?":`\xBFEst\xE1s seguro de que quieres eliminar los ${e} objetos seleccionados?`;confirm(t)&&(console.log(`Eliminar ${e} objeto(s) seleccionado(s)`),this.canvasComponent.deleteSelectedObjects())}bringToFront(){if(!this.canvasReady()||!this.canvasComponent){console.warn("Canvas component not ready for layer operations");return}if(this.selectedObjectsCount()===0){console.warn("No objects selected for bring to front");return}console.log("Traer al frente objeto seleccionado"),this.canvasComponent.bringObjectToFront()}sendToBack(){if(!this.canvasReady()||!this.canvasComponent){console.warn("Canvas component not ready for layer operations");return}if(this.selectedObjectsCount()===0){console.warn("No objects selected for send to back");return}console.log("Enviar atr\xE1s objeto seleccionado"),this.canvasComponent.sendObjectToBack()}exportPNG(){console.log("Exportar PNG");let e=this.canvasComponent?.exportarComoImagen("png",1);if(e){let t=Date.now()+Math.random().toString(36).substr(2,5),i=document.createElement("a");i.download=`certificado_${t}.png`,i.href=e,i.click()}}exportPDF(){console.log("Exportar PDF"),this.canvasComponent?.exportAsPDF()}insertText(){if(!this.canvasReady()||!this.canvasComponent){console.warn("Canvas component not ready for text insertion");return}console.log("Insertar texto"),this.setupSelectionCallback(),this.canvasComponent.insertText()}onBackgroundImageSelected(e){let t=e.target;if(t.files&&t.files.length>0){let i=t.files[0];if(console.log("Insertar imagen de fondo:",i.name),!this.canvasComponent){console.warn("Canvas component not initialized");return}this.backgroundColor.set("#ffffff"),this.canvasComponent.insertBackgroundImage(i),t.value=""}}onObjectImageSelected(e){let t=e.target;if(t.files&&t.files.length>0){let i=t.files[0];if(console.log("Insertar imagen como objeto:",i.name),!this.canvasComponent){console.warn("Canvas component not initialized");return}let o=new FileReader;o.onload=n=>{let r=n.target?.result;r&&this.canvasComponent&&this.canvasComponent.insertImageAsObject(r)},o.onerror=n=>{console.error("Error leyendo archivo de imagen:",n)},o.readAsDataURL(i),this.objectImageInput?.nativeElement&&(this.objectImageInput.nativeElement.value="")}}clearBackgroundImage(){if(!this.canvasComponent){console.warn("Canvas component not initialized");return}console.log("Limpiar imagen de fondo"),this.canvasComponent.clearBackgroundImage(),this.backgroundColor.set("#ffffff"),this.imageInput?.nativeElement&&(this.imageInput.nativeElement.value="")}onBackgroundColorChange(e){let i=e.target.value;if(this.backgroundColor.set(i),!this.canvasComponent){console.warn("Canvas component not initialized");return}console.log("Cambiar color de fondo:",i),this.canvasComponent.setBackgroundColor(i)}clearBackgroundColor(){if(!this.canvasComponent){console.warn("Canvas component not initialized");return}this.backgroundColor.set("#ffffff"),console.log("Limpiar color de fondo"),this.canvasComponent.clearBackgroundColor()}exportToJSON(){if(!this.canvasComponent){console.warn("Canvas component not initialized");return}console.log("Exportar canvas a JSON"),this.canvasComponent.exportToJSON()}onJSONFileSelected(e){let t=e.target;if(t.files&&t.files.length>0){let i=t.files[0];if(console.log("Importar canvas desde JSON:",i.name),!this.canvasComponent){console.warn("Canvas component not initialized");return}this.canvasComponent.importFromJSON(i),this.jsonInput?.nativeElement&&(this.jsonInput.nativeElement.value="")}}togglePan(){let e=!this.isPanActive();this.isPanActive.set(e),e&&(this.isZoomActive.set(!1),this.isHandModeActive.set(!1),this.canvasComponent?.toggleZoom(!1),this.canvasComponent?.toggleHandMode(!1)),console.log("Toggle Pan:",e),this.canvasComponent?.togglePan(e)}toggleZoom(){let e=!this.isZoomActive();this.isZoomActive.set(e),e&&(this.isPanActive.set(!1),this.isHandModeActive.set(!1),this.canvasComponent?.togglePan(!1),this.canvasComponent?.toggleHandMode(!1)),console.log("Toggle Zoom:",e),this.canvasComponent?.toggleZoom(e)}toggleHandMode(){if(!this.validateCanvasComponent()){console.warn("Canvas component not ready for hand mode toggle");return}let e=!this.isHandModeActive();this.isHandModeActive.set(e),e&&this.deactivateOtherModes(),this.applyHandModeToCanvas(e),console.log(`Toggle Hand Mode: ${e} at ${new Date().toISOString()}`)}deactivateOtherModes(){(this.isPanActive()||this.isZoomActive()||this.isDibujoLibreActive())&&(this.isPanActive.set(!1),this.isZoomActive.set(!1),this.isDibujoLibreActive.set(!1),this.canvasComponent?.togglePan(!1),this.canvasComponent?.toggleZoom(!1),this.canvasComponent?.toggleDibujoLibre(!1))}applyHandModeToCanvas(e){try{this.canvasComponent?.toggleHandMode(e),setTimeout(()=>{this.verifyHandModeState(e)},0)}catch(t){console.error("Error applying hand mode to canvas:",t),this.isHandModeActive.set(!e)}}validateCanvasComponent(){return!this.canvasReady()||!this.canvasComponent?(console.warn("Canvas component not ready"),!1):$(()=>this.canvasComponent?.getHandModeState?.()!==void 0)}verifyHandModeState(e){let t=$(()=>this.canvasComponent?.getHandModeState?.());t!==e&&(console.warn(`Hand mode state mismatch. Expected: ${e}, Actual: ${t}`),this.isHandModeActive.set(t??!1))}validateAndSyncHandModeState(){let e=$(()=>this.canvasComponent?.getHandModeState?.()),t=this.isHandModeActive();e!==void 0&&e!==t&&(this.isHandModeActive.set(e),console.log(`Hand mode state synchronized to: ${e}`))}resetViewport(){console.log("Resetear viewport"),this.canvasComponent?.resetViewport()}onFontFamilyChange(e){this.setupSelectionCallback();let i=e.target.value;this.selectedFontFamily.set(i),console.log("Cambiar familia de fuente:",i),this.canvasComponent?.setActiveObjectProperty("fontFamily",i)}onFontSizeChange(e){let t=e.target,i=parseInt(t.value);i&&i>0&&(this.selectedFontSize.set(i),console.log("Cambiar tama\xF1o de fuente:",i),this.canvasComponent?.setActiveObjectProperty("fontSize",i))}toggleBold(){let e=!this.isBold();this.isBold.set(e);let t=e?"bold":"normal";console.log("Toggle negrita:",t),this.canvasComponent?.setActiveObjectProperty("fontWeight",t)}toggleItalic(){let e=!this.isItalic();this.isItalic.set(e);let t=e?"italic":"normal";console.log("Toggle it\xE1lica:",t),this.canvasComponent?.setActiveObjectProperty("fontStyle",t)}toggleUnderline(){let e=!this.isUnderline();this.isUnderline.set(e),console.log("Toggle subrayado:",e),this.canvasComponent?.setActiveObjectProperty("underline",e)}onTextColorChange(e){let i=e.target.value;this.selectedTextColor.set(i),console.log("Cambiar color de texto:",i),this.canvasComponent?.setActiveObjectProperty("fill",i)}setTextAlign(e){this.textAlign.set(e),console.log("Cambiar alineaci\xF3n de texto:",e),this.canvasComponent?.setActiveObjectProperty("textAlign",e)}updateTextControlsFromSelection(){if(!this.canvasReady()||!this.canvasComponent)return;let e=this.canvasComponent.getSelectedTextProperties();e?Promise.resolve().then(()=>{this.selectedFontFamily.set(e.fontFamily),this.selectedFontSize.set(e.fontSize),this.isBold.set(e.fontWeight==="bold"),this.isItalic.set(e.fontStyle==="italic"),this.isUnderline.set(e.underline),this.selectedTextColor.set(e.fill),this.textAlign.set(e.textAlign)}):Promise.resolve().then(()=>{this.selectedFontFamily.set("Arial"),this.selectedFontSize.set(24),this.isBold.set(!1),this.isItalic.set(!1),this.isUnderline.set(!1),this.selectedTextColor.set("#000000"),this.textAlign.set("left")})}setupSelectionCallback(){(!this.canvasReady()||!this.canvasComponent)&&console.warn("Canvas not ready for selection callback setup")}ngOnDestroy(){}updateShapeConfig(e,t){let i=t.target,o=i.type==="range"?parseFloat(i.value):i.value,n=S({},this.shapeConfig());n[e]=o,this.shapeConfig.set(n),this.actualizarObjetosSeleccionados()}updateQrConfig(e,t){let i=t.target,o;i.type==="range"||i.type==="number"?o=parseFloat(i.value):i.type==="checkbox"?o=i.checked:o=i.value;let n=S({},this.qrConfig());n[e]=o,this.qrConfig.set(n)}generarQR(){let e=this.qrConfig();if(!e.url){console.warn("URL requerida para generar QR");return}if(!this.canvasComponent){console.warn("Canvas component not initialized");return}this.canvasComponent.agregarQR(e)}applyShapeConfig(e){let t=e||this.currentShapeType(),i=this.shapeConfig();if(!this.canvasComponent){console.warn("Canvas component not initialized");return}switch(t){case"circulo":this.canvasComponent.agregarCirculo(i);break;case"rectangulo":this.canvasComponent.agregarRectangulo(i);break;case"linea":this.canvasComponent.agregarLinea(i);break;default:console.warn("Tipo de forma no reconocido:",t)}}agregarCirculo(){this.applyShapeConfig("circulo")}agregarRectangulo(){this.applyShapeConfig("rectangulo")}agregarLinea(){this.applyShapeConfig("linea")}toggleDibujoLibre(){let e=!this.isDibujoLibreActive();if(this.isDibujoLibreActive.set(e),e&&(this.isHandModeActive.set(!1),this.isPanActive.set(!1)),!this.canvasComponent){console.warn("Canvas component not initialized");return}this.canvasComponent.toggleDibujoLibre(e,this.shapeConfig())}limpiarDibujos(){if(!this.canvasComponent){console.warn("Canvas component not initialized");return}this.canvasComponent.limpiarDibujos()}actualizarObjetosSeleccionados(){let e=this.shapeConfig();if(!this.canvasComponent){console.warn("Canvas component not initialized");return}this.canvasComponent.actualizarObjetosSeleccionados(e)}onObjectPropertiesChanged(e){let t=this.shapeConfig(),i=S(S({},t),e);this.shapeConfig.set(i)}onObjectSelected(e){if(!e){this.hasDrawingSelected.set(!1),this.currentShapeType.set("");return}this.currentShapeType.set(e.type||""),e.type==="path"?(this.hasDrawingSelected.set(!0),this.shapeConfig.set({fill:e.fill||"#007bff",stroke:e.stroke||"#000000",strokeWidth:e.strokeWidth||5})):this.hasDrawingSelected.set(!1),e.isQRGroup&&e.qrData&&this.qrConfig.set({url:e.qrData.url,codigo:e.qrData.codigo,size:e.qrData.size,fontSize:e.qrData.fontSize||14,fontFamily:e.qrData.fontFamily||"Arial",showBorder:e.qrData.showBorder!==void 0?e.qrData.showBorder:!0,borderWidth:e.qrData.borderWidth||1})}actualizarQRSeleccionado(){return C(this,null,function*(){if(!this.canvasComponent)return;let e=this.canvasComponent.canvas();if(!e)return;let t=e.getActiveObject();if(!(!t||!t.isQRGroup))try{let i=yield this.canvasComponent.qrFactory.crearQR(this.qrConfig());i.set({left:t.left,top:t.top}),e.remove(t),e.add(i),e.setActiveObject(i),e.requestRenderAll()}catch(i){console.error("Error al actualizar QR:",i)}})}actualizarTrazoSeleccionado(){if(!this.canvasComponent)return;let e=this.canvasComponent.canvas();if(!e)return;let t=e.getActiveObject();if(!(!t||t.type!=="path"))try{let i=this.shapeConfig();t.set({stroke:i.stroke,strokeWidth:i.strokeWidth,fill:i.fill}),e.requestRenderAll(),e.fire("object:modified",{target:t})}catch(i){console.error("Error al actualizar trazo:",i)}}guardarEnStorage(){this.canvasComponent&&this.canvasComponent.guardarEnStorage()}cargarDesdeStorage(){return C(this,null,function*(){if(this.canvasComponent)try{(yield this.canvasComponent.cargarDesdeStorage())?(console.log("Canvas cargado exitosamente"),yield this.updateStorageState()):console.warn("No se pudo cargar el canvas desde IndexedDB")}catch(e){console.error("Error al cargar desde storage:",e)}})}exportarComoJSON(){this.canvasComponent&&this.canvasComponent.exportarComoJSON()}onArchivoJSONSelected(e){return C(this,null,function*(){let t=e.target,i=t.files?.[0];if(!(!i||!this.canvasComponent))try{(yield this.canvasComponent.importarDesdeJSON(i))?console.log("Canvas importado exitosamente"):console.error("Error al importar canvas desde JSON")}catch(o){console.error("Error al procesar archivo JSON:",o)}finally{t.value=""}})}updateStorageState(){return C(this,null,function*(){if(this.canvasComponent)try{let e=yield this.canvasComponent.tieneDataGuardada();if(this.hasStoredData.set(e),e){let t=yield this.canvasComponent.obtenerInfoDataGuardada();this.lastSavedTimestamp.set(t?.timestamp||null)}else this.lastSavedTimestamp.set(null)}catch(e){console.error("Error al actualizar estado del storage:",e),this.hasStoredData.set(!1),this.lastSavedTimestamp.set(null)}})}limpiarStorage(){return C(this,null,function*(){this.canvasComponent&&confirm("\xBFEst\xE1s seguro de que quieres eliminar los datos guardados?")&&(yield this.canvasComponent.limpiarStorage(),yield this.updateStorageState())})}tieneDataGuardada(){return this.hasStoredData()}obtenerFechaGuardado(){return this.formattedSavedDate()}hasShapeSelected(){return this.hasSelectedObjects()&&!this.hasTextSelected()}hasLineSelected(){return this.currentShapeType()==="line"}getContextualColor(){return this.hasTextSelected()?this.selectedTextColor():this.shapeConfig().stroke}setContextualColor(e){this.hasTextSelected()?this.onTextColorChange(e):this.updateShapeConfig("stroke",e)}getColorLabel(){return this.hasTextSelected()?"Texto":"Borde"}getColorTooltip(){return this.hasTextSelected()?"Color de texto":"Color de borde"}getContextualThickness(){return this.shapeConfig().strokeWidth}setContextualThickness(e){this.updateShapeConfig("strokeWidth",e)}getThicknessMin(){return this.isDibujoLibreActive()||this.hasDrawingSelected()?.5:.05}getThicknessMax(){return this.isDibujoLibreActive()||this.hasDrawingSelected()?20:10}static \u0275fac=function(t){return new(t||d)};static \u0275cmp=B({type:d,selectors:[["app-fabric-editor"]],viewQuery:function(t,i){if(t&1&&(R(U,5),R(Ne,5),R(Ve,5),R(ze,5),R(Le,5)),t&2){let o;N(o=V())&&(i.canvasComponent=o.first),N(o=V())&&(i.imageInput=o.first),N(o=V())&&(i.jsonInput=o.first),N(o=V())&&(i.objectImageInput=o.first),N(o=V())&&(i.archivoInput=o.first)}},decls:283,vars:83,consts:[["jsonInput",""],["imageInput",""],["objectImageInput",""],["archivoInput",""],[1,"container-fluid"],[1,"row"],[1,"col-12"],[1,"d-flex","flex-wrap","gap-1","align-items-center","py-2","border-bottom","bg-light"],[1,"nav-item","dropdown"],["data-bs-toggle","dropdown","type","button",1,"btn","btn-outline-primary","btn-sm","dropdown-toggle"],[1,"bi","bi-file-earmark"],[1,"d-none","d-sm-inline"],[1,"dropdown-menu","shadow-sm"],[1,"dropdown-item",3,"click"],[1,"bi","bi-file-plus","text-success","me-2"],[1,"dropdown-divider"],[1,"bi","bi-upload","text-info","me-2"],[1,"bi","bi-download","text-info","me-2"],[1,"bi","bi-image","text-success","me-2"],[1,"bi","bi-filetype-pdf","text-danger","me-2"],[1,"dropdown-item","text-danger",3,"click"],[1,"bi","bi-trash","me-2"],["type","file","accept",".json",2,"display","none",3,"change"],[1,"nav-item","dropdown","d-none","d-md-block"],["data-bs-toggle","dropdown","type","button",1,"btn","btn-outline-secondary","btn-sm","dropdown-toggle"],[1,"bi","bi-layout-text-window-reverse"],[1,"d-none","d-lg-inline"],[1,"dropdown-header"],[1,"bi","bi-file-earmark","me-2"],[1,"bi","bi-file-earmark-plus","me-2"],[1,"bi","bi-phone","me-2"],[1,"bi","bi-phone-landscape","me-2"],[1,"vr","d-none","d-lg-block"],[1,"btn","btn-primary","btn-sm",3,"click","disabled"],[1,"bi","bi-type"],[1,"btn","btn-success","btn-sm",3,"click","disabled"],[1,"bi","bi-image"],["data-bs-toggle","dropdown","type","button",1,"btn","btn-warning","btn-sm","dropdown-toggle",3,"disabled"],[1,"bi","bi-square"],[1,"dropdown-menu","shadow-sm","p-2"],[1,"mb-2"],[1,"form-label","small","fw-bold","mb-1"],[1,"row","g-1"],[1,"col-4"],[1,"btn","btn-outline-primary","btn-sm","w-100",3,"click"],[1,"bi","bi-circle"],[1,"small"],[1,"btn","btn-outline-success","btn-sm","w-100",3,"click"],[1,"btn","btn-outline-dark","btn-sm","w-100",3,"click"],[1,"bi","bi-dash-lg"],[1,"btn","btn-sm",3,"click"],[1,"bi","bi-pencil"],[1,"btn","btn-outline-danger","btn-sm"],[1,"d-flex","align-items-center","gap-1"],[1,"text-muted","d-none","d-md-inline"],["type","color",1,"form-control","form-control-color","btn-sm",2,"width","35px","height","31px",3,"change","value","title"],[1,"text-muted"],["type","range","step","0.5",1,"form-range",2,"width","80px",3,"input","min","max","value"],["title","Fuente",1,"form-select","form-select-sm",2,"width","120px",3,"change","value"],["value","Arial"],["value","Helvetica"],["value","Times New Roman"],["value","Georgia"],["value","Verdana"],["value","Courier New"],["type","number","min","8","max","200","step","1","title","Tama\xF1o",1,"form-control","form-control-sm",2,"width","70px",3,"change","value"],["role","group",1,"btn-group"],["type","button","title","Negrita",1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"bi","bi-type-bold"],["type","button","title","Cursiva",1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"bi","bi-type-italic"],["type","button","title","Subrayado",1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"bi","bi-type-underline"],["type","button","title","Alinear izquierda",1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"bi","bi-text-left"],["type","button","title","Centrar",1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"bi","bi-text-center"],["type","button","title","Alinear derecha",1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"bi","bi-text-right"],["type","button","title","Deshacer",1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],[1,"bi","bi-arrow-counterclockwise"],["type","button","title","Rehacer",1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],[1,"bi","bi-arrow-clockwise"],["type","button","title","Eliminar selecci\xF3n",1,"btn","btn-outline-danger","btn-sm"],["role","group",1,"btn-group","d-none","d-md-flex"],["type","button","title","Acercar",1,"btn","btn-outline-info","btn-sm",3,"click"],[1,"bi","bi-zoom-in"],["type","button","title","Alejar",1,"btn","btn-outline-info","btn-sm",3,"click"],[1,"bi","bi-zoom-out"],[1,"nav-item","dropdown","d-none","d-lg-block"],["data-bs-toggle","dropdown","type","button",1,"btn","btn-outline-dark","btn-sm","dropdown-toggle"],[1,"bi","bi-eye"],[1,"bi","bi-aspect-ratio","text-info","me-2"],[1,"bi","bi-bullseye","text-primary","me-2"],[1,"bi","bi-grid","me-2"],["data-bs-toggle","dropdown","type","button",1,"btn","btn-outline-secondary","btn-sm","dropdown-toggle",3,"disabled"],[1,"bi","bi-qr-code"],[1,"dropdown-menu","shadow-sm","p-2",2,"min-width","280px"],[1,"mb-1"],[1,"form-label","small","mb-1"],["type","url",1,"form-control","form-control-sm",3,"input","value","placeholder"],["type","text",1,"form-control","form-control-sm",3,"input","value","placeholder"],[1,"row","g-1","mb-1"],[1,"col-6"],["type","range","min","50","max","300","step","10",1,"form-range",3,"input","value"],["type","range","min","8","max","32","step","1",1,"form-range",3,"input","value"],[1,"form-select","form-select-sm",3,"change","value"],[1,"row","g-1","mb-2"],[1,"form-check"],["type","checkbox",1,"form-check-input",3,"change","checked"],[1,"form-check-label","small"],[1,"d-grid","gap-1"],[1,"bi","bi-qr-code","me-1"],[1,"btn","btn-outline-warning","btn-sm",3,"click","disabled"],[1,"bi","bi-arrow-clockwise","me-1"],["data-bs-toggle","dropdown","type","button",1,"btn","btn-outline-warning","btn-sm","dropdown-toggle"],[1,"bi","bi-palette"],[1,"dropdown-menu","shadow-sm","p-3",2,"min-width","250px"],[1,"mb-3"],[1,"form-label","small"],[1,"d-flex","gap-2"],["type","color",1,"form-control","form-control-color","form-control-sm","flex-grow-1",3,"change","value"],["type","button","title","Limpiar color",1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"bi","bi-x-circle"],["type","button",1,"btn","btn-outline-primary","btn-sm","flex-grow-1",3,"click"],[1,"bi","bi-image","me-1"],["type","button","title","Quitar imagen",1,"btn","btn-outline-secondary","btn-sm",3,"click"],["role","group",1,"btn-group","d-none","d-lg-flex"],["type","button","title","Modo arrastrar",1,"btn","btn-outline-info","btn-sm",3,"click","disabled"],[1,"bi","bi-arrows-move"],["type","button","title","Modo zoom",1,"btn","btn-outline-info","btn-sm",3,"click","disabled"],[1,"bi","bi-search"],["type","button","title","Modo mano",1,"btn","btn-outline-warning","btn-sm",3,"click","disabled"],[1,"bi"],["type","file","accept","image/*",2,"display","none",3,"change"],[1,"ms-auto","d-flex","align-items-center","gap-2"],[1,"badge","bg-primary"],[1,"p-3","bg-white","d-flex","justify-content-center"],[3,"objectPropertiesChanged","objectSelected"],[1,"btn","btn-outline-danger","btn-sm",3,"click"],[1,"bi","bi-eraser"],["type","color","title","Color de relleno",1,"form-control","form-control-color","btn-sm",2,"width","35px","height","31px",3,"change","value"],["type","button","title","Eliminar selecci\xF3n",1,"btn","btn-outline-danger","btn-sm",3,"click"],[1,"bi","bi-trash"],["type","button","title","Traer al frente",1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"bi","bi-arrow-up-square"],["type","button","title","Enviar atr\xE1s",1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"bi","bi-arrow-down-square"],["type","range","min","0","max","5","step","0.5",1,"form-range",3,"input","value"]],template:function(t,i){if(t&1){let o=z();a(0,"div",4)(1,"div",5)(2,"div",6)(3,"div",7)(4,"div",8)(5,"button",9),g(6,"i",10),a(7,"span",11),h(8,"Archivo"),s()(),a(9,"ul",12)(10,"li")(11,"a",13),v("click",function(){return u(o),m(i.newCanvas())}),g(12,"i",14),h(13,"Nuevo Canvas "),s()(),a(14,"li"),g(15,"hr",15),s(),a(16,"li")(17,"a",13),v("click",function(){u(o);let r=J(41);return m(r.click())}),g(18,"i",16),h(19,"Importar JSON "),s()(),a(20,"li")(21,"a",13),v("click",function(){return u(o),m(i.exportToJSON())}),g(22,"i",17),h(23,"Exportar JSON "),s()(),a(24,"li"),g(25,"hr",15),s(),a(26,"li")(27,"a",13),v("click",function(){return u(o),m(i.exportPNG())}),g(28,"i",18),h(29,"Exportar PNG "),s()(),a(30,"li")(31,"a",13),v("click",function(){return u(o),m(i.exportPDF())}),g(32,"i",19),h(33,"Exportar PDF "),s()(),a(34,"li"),g(35,"hr",15),s(),a(36,"li")(37,"a",20),v("click",function(){return u(o),m(i.clearCanvas())}),g(38,"i",21),h(39,"Limpiar Todo "),s()()(),a(40,"input",22,0),v("change",function(r){return u(o),m(i.onJSONFileSelected(r))}),s()(),a(42,"div",23)(43,"button",24),g(44,"i",25),a(45,"span",26),h(46,"Formato"),s()(),a(47,"ul",12)(48,"li")(49,"h6",27),h(50,"Tama\xF1o del papel"),s()(),a(51,"li")(52,"a",13),v("click",function(){return u(o),m(i.cambiarFormato("A4"))}),g(53,"i",28),h(54,"A4 (210\xD7297mm) "),s()(),a(55,"li")(56,"a",13),v("click",function(){return u(o),m(i.cambiarFormato("A3"))}),g(57,"i",29),h(58,"A3 (297\xD7420mm) "),s()(),a(59,"li"),g(60,"hr",15),s(),a(61,"li")(62,"h6",27),h(63,"Orientaci\xF3n"),s()(),a(64,"li")(65,"a",13),v("click",function(){return u(o),m(i.cambiarOrientacion("vertical"))}),g(66,"i",30),h(67,"Vertical "),s()(),a(68,"li")(69,"a",13),v("click",function(){return u(o),m(i.cambiarOrientacion("horizontal"))}),g(70,"i",31),h(71,"Horizontal "),s()()()(),g(72,"div",32),a(73,"button",33),v("click",function(){return u(o),m(i.insertText())}),g(74,"i",34),a(75,"span",11),h(76,"Texto"),s()(),a(77,"button",35),v("click",function(){u(o);let r=J(272);return m(r.click())}),g(78,"i",36),a(79,"span",11),h(80,"Imagen"),s()(),a(81,"div",8)(82,"button",37),g(83,"i",38),a(84,"span",11),h(85,"Formas"),s()(),a(86,"div",39)(87,"div",40)(88,"label",41),h(89,"Crear Forma"),s(),a(90,"div",42)(91,"div",43)(92,"button",44),v("click",function(){return u(o),m(i.agregarCirculo())}),g(93,"i",45),a(94,"div",46),h(95,"C\xEDrculo"),s()()(),a(96,"div",43)(97,"button",47),v("click",function(){return u(o),m(i.agregarRectangulo())}),g(98,"i",38),a(99,"div",46),h(100,"Rect\xE1ngulo"),s()()(),a(101,"div",43)(102,"button",48),v("click",function(){return u(o),m(i.agregarLinea())}),g(103,"i",49),a(104,"div",46),h(105,"L\xEDnea"),s()()()()()()(),a(106,"button",50),v("click",function(){return u(o),m(i.toggleDibujoLibre())}),g(107,"i",51),a(108,"span",11),h(109),s()(),j(110,Be,4,0,"button",52),g(111,"div",32),a(112,"div",53)(113,"small",54),h(114),s(),a(115,"input",55),v("change",function(r){return u(o),m(i.setContextualColor(r))}),s()(),j(116,qe,4,1,"div",53),a(117,"div",53)(118,"small",56),h(119),s(),a(120,"input",57),v("input",function(r){return u(o),m(i.setContextualThickness(r))}),s()(),g(121,"div",32),a(122,"select",58),v("change",function(r){return u(o),m(i.onFontFamilyChange(r))}),a(123,"option",59),h(124,"Arial"),s(),a(125,"option",60),h(126,"Helvetica"),s(),a(127,"option",61),h(128,"Times New Roman"),s(),a(129,"option",62),h(130,"Georgia"),s(),a(131,"option",63),h(132,"Verdana"),s(),a(133,"option",64),h(134,"Courier New"),s()(),a(135,"input",65),v("change",function(r){return u(o),m(i.onFontSizeChange(r))}),s(),a(136,"div",66)(137,"button",67),v("click",function(){return u(o),m(i.toggleBold())}),g(138,"i",68),s(),a(139,"button",69),v("click",function(){return u(o),m(i.toggleItalic())}),g(140,"i",70),s(),a(141,"button",71),v("click",function(){return u(o),m(i.toggleUnderline())}),g(142,"i",72),s()(),a(143,"div",66)(144,"button",73),v("click",function(){return u(o),m(i.setTextAlign("left"))}),g(145,"i",74),s(),a(146,"button",75),v("click",function(){return u(o),m(i.setTextAlign("center"))}),g(147,"i",76),s(),a(148,"button",77),v("click",function(){return u(o),m(i.setTextAlign("right"))}),g(149,"i",78),s()(),g(150,"div",32),a(151,"div",66)(152,"button",79),v("click",function(){return u(o),m(i.undo())}),g(153,"i",80),s(),a(154,"button",81),v("click",function(){return u(o),m(i.redo())}),g(155,"i",82),s()(),j(156,He,2,0,"button",83),j(157,Ge,5,0,"div",66),g(158,"div",32),a(159,"div",84)(160,"button",85),v("click",function(){return u(o),m(i.zoomIn())}),g(161,"i",86),s(),a(162,"button",87),v("click",function(){return u(o),m(i.zoomOut())}),g(163,"i",88),s()(),a(164,"div",89)(165,"button",90),g(166,"i",91),h(167," Vista "),s(),a(168,"ul",12)(169,"li")(170,"a",13),v("click",function(){return u(o),m(i.fitToWindow())}),g(171,"i",92),h(172,"Ajustar a ventana "),s()(),a(173,"li")(174,"a",13),v("click",function(){return u(o),m(i.centerCanvas())}),g(175,"i",93),h(176,"Centrar canvas "),s()(),a(177,"li"),g(178,"hr",15),s(),a(179,"li")(180,"a",13),v("click",function(){return u(o),m(i.toggleGrid())}),g(181,"i",94),h(182,"Mostrar grid "),s()()()(),g(183,"div",32),a(184,"div",8)(185,"button",95),g(186,"i",96),a(187,"span",11),h(188,"QR"),s()(),a(189,"div",97)(190,"div",40)(191,"label",41),h(192,"Generar C\xF3digo QR"),s(),a(193,"div",98)(194,"label",99),h(195,"URL"),s(),a(196,"input",100),v("input",function(r){return u(o),m(i.updateQrConfig("url",r))}),s()(),a(197,"div",98)(198,"label",99),h(199,"C\xF3digo"),s(),a(200,"input",101),v("input",function(r){return u(o),m(i.updateQrConfig("codigo",r))}),s()(),a(201,"div",102)(202,"div",103)(203,"label",99),h(204),s(),a(205,"input",104),v("input",function(r){return u(o),m(i.updateQrConfig("size",r))}),s()(),a(206,"div",103)(207,"label",99),h(208),s(),a(209,"input",105),v("input",function(r){return u(o),m(i.updateQrConfig("fontSize",r))}),s()()(),a(210,"div",98)(211,"label",99),h(212,"Tipograf\xEDa"),s(),a(213,"select",106),v("change",function(r){return u(o),m(i.updateQrConfig("fontFamily",r))}),a(214,"option",59),h(215,"Arial"),s(),a(216,"option",61),h(217,"Times New Roman"),s(),a(218,"option",60),h(219,"Helvetica"),s(),a(220,"option",62),h(221,"Georgia"),s(),a(222,"option",63),h(223,"Verdana"),s(),a(224,"option",64),h(225,"Courier New"),s()()(),a(226,"div",107)(227,"div",103)(228,"div",108)(229,"input",109),v("change",function(r){return u(o),m(i.updateQrConfig("showBorder",r))}),s(),a(230,"label",110),h(231," Marco "),s()()(),j(232,Ze,4,2,"div",103),s(),a(233,"div",111)(234,"button",33),v("click",function(){return u(o),m(i.generarQR())}),g(235,"i",112),h(236,"Generar "),s(),a(237,"button",113),v("click",function(){return u(o),m(i.actualizarQRSeleccionado())}),g(238,"i",114),h(239,"Actualizar Selecci\xF3n "),s()()()()(),a(240,"div",8)(241,"button",115),g(242,"i",116),a(243,"span",11),h(244,"Fondo"),s()(),a(245,"div",117)(246,"div",118)(247,"label",119),h(248,"Color de fondo"),s(),a(249,"div",120)(250,"input",121),v("change",function(r){return u(o),m(i.onBackgroundColorChange(r))}),s(),a(251,"button",122),v("click",function(){return u(o),m(i.clearBackgroundColor())}),g(252,"i",123),s()()(),a(253,"div",40)(254,"label",119),h(255,"Imagen de fondo"),s(),a(256,"div",120)(257,"button",124),v("click",function(){u(o);let r=J(270);return m(r.click())}),g(258,"i",125),h(259,"Seleccionar "),s(),a(260,"button",126),v("click",function(){return u(o),m(i.clearBackgroundImage())}),g(261,"i",123),s()()()()(),a(262,"div",127)(263,"button",128),v("click",function(){return u(o),m(i.togglePan())}),g(264,"i",129),s(),a(265,"button",130),v("click",function(){return u(o),m(i.toggleZoom())}),g(266,"i",131),s(),a(267,"button",132),v("click",function(){return u(o),m(i.toggleHandMode())}),g(268,"i",133),s()(),a(269,"input",134,1),v("change",function(r){return u(o),m(i.onBackgroundImageSelected(r))}),s(),a(271,"input",134,2),v("change",function(r){return u(o),m(i.onObjectImageSelected(r))}),s(),a(273,"input",22,3),v("change",function(r){return u(o),m(i.onArchivoJSONSelected(r))}),s(),a(275,"div",135)(276,"small",54),h(277),s(),j(278,Ye,3,2,"span",136),s()()()(),a(279,"div",5)(280,"div",6)(281,"div",137)(282,"app-editor-canvas",138),v("objectPropertiesChanged",function(r){return u(o),m(i.onObjectPropertiesChanged(r))})("objectSelected",function(r){return u(o),m(i.onObjectSelected(r))}),s()()()()()}t&2&&(f(52),D("active",i.currentFormat==="A4"),f(4),D("active",i.currentFormat==="A3"),f(9),D("active",i.currentOrientation==="vertical"),f(4),D("active",i.currentOrientation==="horizontal"),f(4),E("disabled",i.isDibujoLibreActive()),f(4),E("disabled",i.isDibujoLibreActive()),f(5),E("disabled",i.isDibujoLibreActive()),f(24),D("btn-info",i.isDibujoLibreActive())("btn-outline-info",!i.isDibujoLibreActive())("text-white",i.isDibujoLibreActive()),f(3),he(i.isDibujoLibreActive()?"Dibujo ON":"Dibujo"),f(),P(i.isDibujoLibreActive()?110:-1),f(4),he(i.getColorLabel()),f(),E("value",i.getContextualColor())("title",i.getColorTooltip()),f(),P(!i.isDibujoLibreActive()&&!i.hasDrawingSelected()&&!i.hasLineSelected()?116:-1),f(3),q("",i.getContextualThickness(),"px"),f(),E("min",i.getThicknessMin())("max",i.getThicknessMax())("value",i.getContextualThickness()),f(2),E("value",i.selectedFontFamily()),f(13),E("value",i.selectedFontSize()),f(2),D("active",i.isBold()),f(2),D("active",i.isItalic()),f(2),D("active",i.isUnderline()),f(3),D("active",i.textAlign()==="left"),f(2),D("active",i.textAlign()==="center"),f(2),D("active",i.textAlign()==="right"),f(4),E("disabled",i.isDibujoLibreActive()),f(2),E("disabled",i.isDibujoLibreActive()),f(2),P(i.hasSelectedObjects()?156:-1),f(),P(i.hasSelectedObjects()?157:-1),f(23),D("active",i.isGridVisible),f(5),E("disabled",i.isDibujoLibreActive()),f(11),E("placeholder",ve("","{{","qr-url","}}"))("value",i.qrConfig().url),f(4),E("placeholder",ve("","{{","qr-code","}}"))("value",i.qrConfig().codigo),f(4),q("Imagen: ",i.qrConfig().size,"px"),f(),E("value",i.qrConfig().size),f(3),q("Texto: ",i.qrConfig().fontSize,"px"),f(),E("value",i.qrConfig().fontSize),f(4),E("value",i.qrConfig().fontFamily),f(16),E("checked",i.qrConfig().showBorder),f(3),P(i.qrConfig().showBorder?232:-1),f(2),E("disabled",!i.qrConfig().url),f(3),E("disabled",!i.qrConfig().url),f(13),E("value",i.backgroundColor()),f(13),D("active",i.isPanActive()),E("disabled",i.isDibujoLibreActive()),f(2),D("active",i.isZoomActive()),E("disabled",i.isDibujoLibreActive()),f(2),D("active",i.isHandModeActive()),E("disabled",i.isDibujoLibreActive()),f(),D("bi-hand-index",!i.isHandModeActive())("bi-hand-index-fill",i.isHandModeActive()),f(9),Se(" ",i.currentFormat," \u2022 ",i.currentOrientation==="horizontal"?"Horizontal":"Vertical"," \u2022 ",i.zoomPercentage,"% "),f(),P(i.hasSelectedObjects()?278:-1))},dependencies:[U],encapsulation:2,changeDetection:0})};var Ie=class d{static \u0275fac=function(t){return new(t||d)};static \u0275cmp=B({type:d,selectors:[["app-certificate-editor"]],decls:2,vars:0,consts:[["editor",""]],template:function(t,i){t&1&&g(0,"app-fabric-editor",null,0)},dependencies:[we,ue],encapsulation:2})};export{Ie as CertificateEditorComponent};

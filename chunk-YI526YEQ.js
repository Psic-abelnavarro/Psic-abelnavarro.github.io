import{a as I}from"./chunk-IYGYDPGO.js";import{a as ae}from"./chunk-GFCFUV6K.js";import{$a as T,$b as p,A as S,Ac as se,Bb as f,Ca as W,Cb as k,D as O,Da as r,Eb as ee,Fb as v,Gb as M,H as N,Hb as te,Na as K,Pb as ie,Q as B,Ra as Q,S as L,Sb as ne,Ta as m,U as P,_ as F,bb as g,cb as _,da as u,ea as c,eb as U,f as R,fa as $,fb as Y,gb as C,hb as l,ia as H,ib as d,jb as w,k as x,ma as h,pb as q,qb as D,rb as y,sa as j,tb as s,vb as J,vc as oe,wb as X,x as z,xb as Z,za as G}from"./chunk-6O7NOF42.js";var le=["inputElement"],de=(n,e)=>({$implicit:n,index:e});function pe(n,e){return this.getTrackByValue(e,n)}function ue(n,e){if(n&1){let t=D();l(0,"button",5),y("mousedown",function(o){u(t);let a=s();return c(a.clearInput(o))})("click",function(o){u(t);let a=s();return c(a.clearInput(o))}),$(),l(1,"svg",6),w(2,"line",7)(3,"line",8),d()()}n&2&&f("right","8px")("top","50%")("transform","translateY(-50%)")("background","white")("border","none")("padding","4px")("width","24px")("height","24px")("display","flex")("align-items","center")("justify-content","center")("z-index","1")}function ce(n,e){n&1&&v(0," Buscando opciones... ")}function he(n,e){if(n&1&&v(0),n&2){let t=s(2);te(" ",t.suggestions().length," opciones disponibles ")}}function me(n,e){if(n&1&&(l(0,"div",11),w(1,"div",13),l(2,"span",14),v(3),d()()),n&2){let t=s(2);r(3),M(t.loadingMessage)}}function ge(n,e){if(n&1&&(l(0,"div",12)(1,"div",15),w(2,"i",16),l(3,"span",14),v(4),d()()()),n&2){let t=s(2);r(4),M(t.noResultsMessage)}}function _e(n,e){n&1&&q(0)}function fe(n,e){if(n&1&&Q(0,_e,1,0,"ng-container",20),n&2){let t=s(),i=t.$implicit,o=t.$index,a=s(3);C("ngTemplateOutlet",a.optionTemplate)("ngTemplateOutletContext",ne(2,de,i,o))}}function be(n,e){if(n&1&&w(0,"span",22),n&2){let t=s(2).$implicit,i=s(3);C("innerHTML",i.highlightText(i.getDisplayText(t),i.inputText()),G)}}function xe(n,e){if(n&1&&(l(0,"span"),v(1),d()),n&2){let t=s(2).$implicit,i=s(3);r(),M(i.getDisplayText(t))}}function Ce(n,e){if(n&1&&(l(0,"div",21),g(1,be,1,1,"span",22)(2,xe,2,1,"span"),d()),n&2){let t=s(4);f("color","inherit"),r(),_(t.highlightSearch&&t.inputText()?1:2)}}function ve(n,e){if(n&1){let t=D();l(0,"button",18),y("mousedown",function(){let o=u(t).$implicit,a=s(3);return c(a.selectOption(o))})("mouseover",function(){let o=u(t).$index,a=s(3);return c(a.setFocusedIndex(o))})("mouseout",function(){u(t);let o=s(3);return c(o.resetFocusedIndex())}),g(1,fe,1,5,"ng-container")(2,Ce,3,3,"div",19),d()}if(n&2){let t=e.$index,i=s(3);f("min-height",i.isMobile()?"44px":"36px")("padding",i.isMobile()?"12px 16px":"8px 12px")("font-size",i.isMobile()?"16px":null)("color",t===i.focusedIndex()?"#0d6efd":"#212529")("background-color",t===i.focusedIndex()?"#e7f3ff":"transparent")("transition","all 0.15s ease-in-out")("cursor","pointer"),C("id",i.getOptionId(t)),T("aria-selected",t===i.focusedIndex()),r(),_(i.optionTemplate?1:2)}}function we(n,e){if(n&1&&U(0,ve,3,17,"button",17,pe,!0),n&2){let t=s(2);Y(t.suggestions())}}function ye(n,e){if(n&1&&(l(0,"div",9)(1,"div",10),g(2,ce,1,0)(3,he,1,1),d(),g(4,me,4,1,"div",11)(5,ge,5,1,"div",12)(6,we,2,0),d()),n&2){let t=s();f("max-height",t.maxHeight)("overflow-y","auto")("z-index",t.zIndex)("border-radius",t.isMobile()?"12px":"6px")("box-shadow",t.isMobile()?"0 10px 40px rgba(0,0,0,0.15)":null)("max-width",t.isMobile()?"100vw":null)("left",t.isMobile()?"0":null)("right",t.isMobile()?"0":null),k("dropdown-menu-end",!1),C("id",t.dropdownId),r(),T("aria-live","polite")("aria-atomic",!0),r(),_(t.loading()?2:3),r(2),_(t.loading()?4:t.suggestions().length===0?5:6)}}var re=class n{inputElement;elementRef=F(j);destroyRef=F(H);placeholder="";type="text";required=!1;disabled=!1;readonly=!1;autocomplete="off";maxHeight="300px";zIndex=1050;ariaDescribedBy="";inputClass="";size="";inInputGroup=!1;minChars=2;debounceMs=300;searchLimit=10;enableCaching=!0;cacheSize=50;highlightSearch=!0;enableVirtualScroll=!1;itemHeight=40;maxVisibleItems=10;options=[];searchFn=null;preloadFn=null;enablePreload=!1;displayFn=null;trackByFn=null;optionTemplate=null;noResultsMessage="No se encontraron resultados";loadingMessage="Buscando...";valueChange=new m;optionSelected=new m;textChange=new m;opened=new m;closed=new m;cleared=new m;_value=h(null);_inputText=h("");_isOpen=h(!1);_loading=h(!1);_suggestions=h([]);_focusedIndex=h(-1);_preloadedData=h([]);searchCache=new Map;_isMobile=h(!1);value=p(()=>this._value());inputText=p(()=>this._inputText());isOpen=p(()=>this._isOpen());loading=p(()=>this._loading());suggestions=p(()=>this._suggestions());focusedIndex=p(()=>this._focusedIndex());preloadedData=p(()=>this._preloadedData());isMobile=p(()=>this._isMobile());isRemoteMode=p(()=>this.searchFn!==null);dropdownId=`autocomplete-dropdown-${Math.random().toString(36).substring(2,9)}`;detectMobile(){return typeof window>"u"?!1:window.innerWidth<768||"ontouchstart"in window}computedClasses=p(()=>{let e=[];return this.inputClass.includes("form-control")||e.push("form-control"),this.size==="sm"&&e.push("form-control-sm"),this.size==="lg"&&e.push("form-control-lg"),this.inInputGroup&&e.push("rounded-start-0","flex-grow-1"),this.inputClass&&e.push(...this.inputClass.split(" ").filter(t=>t.trim())),e.join(" ")});searchSubject=new R;onChange=()=>{};onTouched=()=>{};writeValue(e){this._value.set(e||null),this._inputText.set(this.getDisplayText(e))}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this.disabled=e}ngOnInit(){this.initializeSearchStream(),this.preloadInitialData(),this.detectDeviceType()}ngOnDestroy(){this.searchCache.clear()}detectDeviceType(){this._isMobile.set(this.detectMobile()),typeof window<"u"&&z(window,"resize").pipe(O(100),I(this.destroyRef)).subscribe(()=>{this._isMobile.set(this.detectMobile())})}initializeSearchStream(){this.isRemoteMode()&&this.searchSubject.pipe(O(this.debounceMs),N(),B(e=>this.performSearch(e)),I(this.destroyRef)).subscribe(e=>{this._suggestions.set(e),this._loading.set(!1)})}preloadInitialData(){!this.enablePreload||!this.preloadFn||!this.isRemoteMode()||(this._loading.set(!0),this.preloadFn().pipe(S(e=>(console.error("Autocomplete preload error:",e),x([]))),I(this.destroyRef)).subscribe(e=>{this._preloadedData.set(e),this._loading.set(!1)}))}performSearch(e){if(!e||e.length<this.minChars)return x(this.enablePreload?this.preloadedData():[]);if(this.enableCaching&&this.searchCache.has(e))return x(this.searchCache.get(e));if(this.isRemoteMode()&&this.searchFn)return this.searchFn(e,this.searchLimit).pipe(L(t=>{if(this.enableCaching){if(this.searchCache.size>=this.cacheSize){let i=this.searchCache.keys().next().value;i&&this.searchCache.delete(i)}this.searchCache.set(e,t)}}),S(t=>(console.error("Autocomplete remote search error:",t),x([]))));{let t=this.filterLocalOptions(e);return this.enableCaching&&this.searchCache.set(e,t),x(t)}}filterLocalOptions(e){let t=e.toLowerCase().trim();return(this.options.length>0?this.options:this.preloadedData()).filter(o=>this.getDisplayText(o).toLowerCase().includes(t)).sort((o,a)=>{let b=this.getDisplayText(o).toLowerCase(),E=this.getDisplayText(a).toLowerCase(),A=b.startsWith(t),V=E.startsWith(t);return A&&!V?-1:!A&&V?1:b.localeCompare(E)})}onInput(e){let i=e.target.value;this._inputText.set(i),i.length>=this.minChars?(this.isRemoteMode()?(this._loading.set(!0),this.searchSubject.next(i)):this.updateSuggestions(i),this.openDropdown()):this.isRemoteMode()&&this.enablePreload&&i.length===0?(this._suggestions.set(this.preloadedData()),this.openDropdown()):(this._suggestions.set([]),this.closeDropdown()),this.textChange.emit(i)}onBlur(){setTimeout(()=>{this.closeDropdown(),this.onTouched()},150)}onFocus(){let e=this._inputText();e.length>=this.minChars?(this.isRemoteMode()?(this._loading.set(!0),this.searchSubject.next(e)):this.updateSuggestions(e),this.openDropdown()):this.isRemoteMode()&&this.enablePreload&&e.length===0&&(this._suggestions.set(this.preloadedData()),this.openDropdown())}onKeyDown(e){let t=this._suggestions();switch(e.key){case"ArrowDown":e.preventDefault(),this._focusedIndex.update(i=>i<t.length-1?i+1:0),this.scrollToFocusedOption();break;case"ArrowUp":e.preventDefault(),this._focusedIndex.update(i=>i>0?i-1:t.length-1),this.scrollToFocusedOption();break;case"Enter":if(this._isOpen()&&t.length>0){e.preventDefault();let i=this._focusedIndex();i>=0&&i<t.length?this.selectOption(t[i]):t.length===1&&this.selectOption(t[0])}break;case"Escape":this._isOpen()?(e.preventDefault(),this.closeDropdown()):this._inputText()&&(e.preventDefault(),this.clearInput(new MouseEvent("click")));break;case"Tab":this.closeDropdown();break}}onDocumentClick(e){this.elementRef.nativeElement.contains(e.target)||this.closeDropdown()}scrollToFocusedOption(){setTimeout(()=>{let e=this._focusedIndex();if(e>=0){let t=document.getElementById(this.getOptionId(e));t&&t.scrollIntoView({block:"nearest"})}},0)}selectOption(e){this._value.set(e),this._inputText.set(this.getDisplayText(e)),this.closeDropdown(),this.valueChange.emit(e),this.optionSelected.emit(e),this.onChange(e),this.onTouched(),this.inputElement.nativeElement.focus()}updateSuggestions(e){if(!e||e.length<this.minChars){this._suggestions.set([]);return}if(this.isRemoteMode())return;this._loading.set(!0);let t=this.filterLocalOptions(e);setTimeout(()=>{this._suggestions.set(t),this._loading.set(!1)},100)}openDropdown(){this._isOpen()||this.disabled||this.readonly||(this._isOpen.set(!0),this._focusedIndex.set(-1),this.opened.emit())}closeDropdown(){this._isOpen()&&(this._isOpen.set(!1),this._focusedIndex.set(-1),this.closed.emit())}getDisplayText(e){return e?this.displayFn?this.displayFn(e):String(e):""}getTrackByValue(e,t){return this.trackByFn?this.trackByFn(t,e):t}getOptionId(e){return`${this.dropdownId}-option-${e}`}setFocusedIndex(e){this._focusedIndex.set(e)}resetFocusedIndex(){this._focusedIndex.set(-1)}highlightText(e,t){if(!this.highlightSearch||!t||!e)return e;let i=new RegExp(`(${this.escapeRegex(t)})`,"gi");return e.replace(i,'<mark class="bg-warning text-dark fw-medium rounded px-1">$1</mark>')}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}clearCache(){this.searchCache.clear()}clearInput(e){e.preventDefault(),e.stopPropagation(),this._value.set(null),this._inputText.set(""),this.onChange(null),this.valueChange.emit(null),this.cleared.emit(),this.isRemoteMode()&&this.enablePreload?(this._suggestions.set(this.preloadedData()),this.openDropdown()):(this._suggestions.set([]),this.closeDropdown()),this.inputElement.nativeElement.focus()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=K({type:n,selectors:[["app-autocomplete"]],viewQuery:function(t,i){if(t&1&&J(le,5),t&2){let o;X(o=Z())&&(i.inputElement=o.first)}},hostAttrs:[1,"position-relative"],hostVars:6,hostBindings:function(t,i){t&1&&y("click",function(a){return i.onDocumentClick(a)},W),t&2&&(f("min-width",i.inInputGroup?"0":null),k("flex-fill",!i.inInputGroup)("flex-grow-1",i.inInputGroup))},inputs:{placeholder:"placeholder",type:"type",required:"required",disabled:"disabled",readonly:"readonly",autocomplete:"autocomplete",maxHeight:"maxHeight",zIndex:"zIndex",ariaDescribedBy:"ariaDescribedBy",inputClass:"inputClass",size:"size",inInputGroup:"inInputGroup",minChars:"minChars",debounceMs:"debounceMs",searchLimit:"searchLimit",enableCaching:"enableCaching",cacheSize:"cacheSize",highlightSearch:"highlightSearch",enableVirtualScroll:"enableVirtualScroll",itemHeight:"itemHeight",maxVisibleItems:"maxVisibleItems",options:"options",searchFn:"searchFn",preloadFn:"preloadFn",enablePreload:"enablePreload",displayFn:"displayFn",trackByFn:"trackByFn",optionTemplate:"optionTemplate",noResultsMessage:"noResultsMessage",loadingMessage:"loadingMessage"},outputs:{valueChange:"valueChange",optionSelected:"optionSelected",textChange:"textChange",opened:"opened",closed:"closed",cleared:"cleared"},features:[ie([{provide:ae,useExisting:P(()=>n),multi:!0}])],decls:5,vars:18,consts:[["inputElement",""],[1,"position-relative","d-flex","align-items-center"],["role","combobox",3,"input","blur","focus","keydown","type","placeholder","required","disabled","readonly","autocomplete","value"],["type","button","title","Limpiar","aria-label","Limpiar campo",1,"btn","position-absolute",3,"right","top","transform","background","border","padding","width","height","display","align-items","justify-content","z-index"],[1,"dropdown-menu","show","position-absolute","start-0","top-100","w-100","mt-1","border","shadow-lg",3,"id","dropdown-menu-end","max-height","overflow-y","z-index","border-radius","box-shadow","max-width","left","right"],["type","button","title","Limpiar","aria-label","Limpiar campo",1,"btn","position-absolute",3,"mousedown","click"],["width","14","height","14","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["x1","18","y1","6","x2","6","y2","18"],["x1","6","y1","6","x2","18","y2","18"],[1,"dropdown-menu","show","position-absolute","start-0","top-100","w-100","mt-1","border","shadow-lg",3,"id"],[1,"visually-hidden"],[1,"d-flex","align-items-center","justify-content-center","py-3","text-muted"],[1,"text-center","py-3","text-muted"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2","text-primary"],[1,"small"],[1,"d-flex","flex-column","align-items-center"],[1,"bi","bi-search","fs-4","mb-2","opacity-50"],["type","button",1,"dropdown-item","d-flex","align-items-center","border-0",2,"outline","none",3,"id","min-height","padding","font-size","color","background-color","transition","cursor"],["type","button",1,"dropdown-item","d-flex","align-items-center","border-0",2,"outline","none",3,"mousedown","mouseover","mouseout","id"],[1,"w-100",3,"color"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"w-100"],[3,"innerHTML"]],template:function(t,i){if(t&1){let o=D();l(0,"div",1)(1,"input",2,0),y("input",function(b){return u(o),c(i.onInput(b))})("blur",function(){return u(o),c(i.onBlur())})("focus",function(){return u(o),c(i.onFocus())})("keydown",function(b){return u(o),c(i.onKeyDown(b))}),d(),g(3,ue,4,24,"button",3),d(),g(4,ye,7,23,"div",4)}t&2&&(r(),ee(i.computedClasses()),f("padding-right",i.inputText()?"40px":null),C("type",i.type)("placeholder",i.placeholder)("required",i.required)("disabled",i.disabled)("readonly",i.readonly)("autocomplete",i.autocomplete)("value",i.inputText()),T("aria-expanded",i.isOpen())("aria-autocomplete","list")("aria-controls",i.dropdownId)("aria-owns",i.dropdownId)("aria-describedby",i.ariaDescribedBy||null),r(2),_(i.inputText()&&!i.disabled&&!i.readonly?3:-1),r(),_(i.isOpen()?4:-1))},dependencies:[se,oe],encapsulation:2,changeDetection:0})};export{re as a};

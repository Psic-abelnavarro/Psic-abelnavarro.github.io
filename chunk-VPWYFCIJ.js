import{a as k}from"./chunk-RVKZ6242.js";import{$ as u,A as x,Ha as y,L as m,M as h,Ma as w,U as t,V as i,W as s,X as _,_ as v,ha as o,ia as C,l as E,m as p,n as b,s as c,wa as f,x as d}from"./chunk-OKHREPWG.js";import"./chunk-X5YLR3NI.js";import{i as l}from"./chunk-ODN5LVDJ.js";function P(a,e){a&1&&(t(0,"div",5)(1,"div",6)(2,"span",7),o(3,"Processing authentication..."),i()(),t(4,"h5",8),o(5,"Procesando autenticaci\xF3n"),i(),t(6,"p",9),o(7,"Verificando tus credenciales con Google..."),i(),t(8,"div",10),s(9,"div",11),i()())}function A(a,e){if(a&1){let r=_();t(0,"div",5),s(1,"i",12),t(2,"h5",13),o(3,"Error de autenticaci\xF3n"),i(),t(4,"div",14)(5,"small"),o(6),i()(),t(7,"div",15)(8,"button",16),v("click",function(){p(r);let g=u();return b(g.retry())}),s(9,"i",17),o(10," Intentar de nuevo "),i(),t(11,"button",18),v("click",function(){p(r);let g=u();return b(g.goToLogin())}),s(12,"i",19),o(13," Volver al login "),i()()()}if(a&2){let r=u();d(6),C(r.errorMessage())}}function T(a,e){a&1&&(t(0,"div",5),s(1,"i",20),t(2,"h5",21),o(3,"\xA1Autenticaci\xF3n exitosa!"),i(),t(4,"p",9),o(5,"Redirigiendo..."),i(),t(6,"div",10),s(7,"div",22),i()())}var S=class a{router=E(w);authService=E(k);DEFAULT_REDIRECT="/certificate";isProcessing=c(!0);hasError=c(!1);errorMessage=c(null);isAuthenticated=this.authService.isAuthenticated;authLoading=this.authService.loading;authError=this.authService.error;constructor(){f(()=>{this.isAuthenticated()&&(this.isProcessing.set(!1),this.hasError.set(!1),setTimeout(()=>{this.redirectToIntendedDestination()},1e3))}),f(()=>{let e=this.authError();e&&!this.isAuthenticated()&&(this.isProcessing.set(!1),this.hasError.set(!0),this.errorMessage.set(e))})}ngOnInit(){return l(this,null,function*(){yield this.handleAuthCallback()})}handleAuthCallback(){return l(this,null,function*(){try{this.isProcessing.set(!0),this.hasError.set(!1),this.authService.clearError();let{searchParams:e}=new URL(window.location.href);if(e.has("code")||e.has("access_token")||e.has("error")){let n=e.get("error");if(n)throw new Error(`OAuth error: ${n} - ${e.get("error_description")||"Error desconocido"}`)}if(yield new Promise(n=>setTimeout(n,1500)),yield this.authService.checkSession(),!this.isAuthenticated())throw new Error("Error de verificaci\xF3n de autenticaci\xF3n. Por favor, int\xE9ntalo de nuevo.")}catch(e){this.isProcessing.set(!1),this.hasError.set(!0),this.errorMessage.set(e?.message||"Error al completar la autenticaci\xF3n")}})}retry(){return l(this,null,function*(){yield this.handleAuthCallback()})}goToLogin(){this.router.navigate(["/login"])}redirectToIntendedDestination(){let r=sessionStorage.getItem("intended-url")||this.DEFAULT_REDIRECT;sessionStorage.removeItem("intended-url"),this.router.navigateByUrl(r)}static \u0275fac=function(r){return new(r||a)};static \u0275cmp=x({type:a,selectors:[["app-callback"]],decls:8,vars:3,consts:[[1,"container-fluid","vh-100","d-flex","justify-content-center","align-items-center","bg-light"],[1,"row","justify-content-center","w-100"],[1,"col-12","col-sm-8","col-md-6","col-lg-4"],[1,"card","shadow","border-0"],[1,"card-body","p-4","text-center"],[1,"mb-4"],["role","status",1,"spinner-border","text-primary","mb-3",2,"width","3rem","height","3rem"],[1,"visually-hidden"],[1,"text-primary","mb-2"],[1,"text-muted","small"],[1,"progress",2,"height","4px"],["role","progressbar",1,"progress-bar","progress-bar-striped","progress-bar-animated",2,"width","100%"],[1,"bi","bi-exclamation-triangle-fill","text-danger","display-4","mb-3"],[1,"text-danger","mb-2"],[1,"alert","alert-danger","text-start"],[1,"d-grid","gap-2"],[1,"btn","btn-outline-danger",3,"click"],[1,"bi","bi-arrow-clockwise","me-2"],[1,"btn","btn-link","text-muted",3,"click"],[1,"bi","bi-arrow-left","me-1"],[1,"bi","bi-check-circle-fill","text-success","display-4","mb-3"],[1,"text-success","mb-2"],["role","progressbar",1,"progress-bar","bg-success","progress-bar-striped","progress-bar-animated",2,"width","100%"]],template:function(r,n){r&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),m(5,P,10,0,"div",5),m(6,A,14,1,"div",5),m(7,T,8,0,"div",5),i()()()()()),r&2&&(d(5),h(n.isProcessing()?5:-1),d(),h(n.hasError()?6:-1),d(),h(n.isAuthenticated()?7:-1))},dependencies:[y],encapsulation:2})};export{S as Callback};

import{a as B}from"./chunk-XWK4RG2M.js";import{a as L}from"./chunk-3TEKDMWT.js";import"./chunk-T4GT6RDP.js";import{$ as u,A as D,Ca as F,Ha as V,L as f,M as y,Ma as R,N as I,O as w,P,Pa as A,Q as p,R as n,S as t,Sa as $,T as m,X as M,Z as c,fa as C,ha as r,ia as b,ja as U,l as S,la as N,m as h,n as _,s as v,va as x,x as o}from"./chunk-APCKJ7FH.js";import"./chunk-X5YLR3NI.js";import{a as T,b as k,i as E}from"./chunk-ODN5LVDJ.js";var j=(s,i)=>i.id;function q(s,i){s&1&&(n(0,"div",47)(1,"div",70)(2,"span",71),r(3,"Cargando..."),t()(),n(4,"p",72),r(5,"Cargando usuarios..."),t()())}function G(s,i){s&1&&(n(0,"div",47),m(1,"i",73),n(2,"h5",74),r(3,"No hay usuarios"),t(),n(4,"p",75),r(5,"No se encontraron usuarios con los filtros aplicados"),t()())}function H(s,i){if(s&1&&(n(0,"div",85),r(1),t()),s&2){let e=u().$implicit;o(),b(e.display_name)}}function J(s,i){if(s&1){let e=M();n(0,"tr",80)(1,"td",81)(2,"div",4)(3,"div",82),m(4,"i",83),t(),n(5,"div")(6,"div",84),r(7),t(),f(8,H,2,1,"div",85),t()()(),n(9,"td",81)(10,"span",86),r(11),t()(),n(12,"td",81)(13,"span",86),r(14),t()(),n(15,"td",81)(16,"small",87),r(17),t()(),n(18,"td",88)(19,"div",89)(20,"button",90),c("click",function(){let l=h(e).$implicit,d=u(2);return _(d.openEditModal(l))}),m(21,"i",91),t(),n(22,"button",92),c("click",function(){let l=h(e).$implicit,d=u(2);return _(d.toggleUserStatus(l))}),m(23,"i",93),t(),n(24,"button",94),c("click",function(){let l=h(e).$implicit,d=u(2);return _(d.openDeleteModal(l))}),m(25,"i",95),t()()()()}if(s&2){let e=i.$implicit,a=u(2);o(7),b(e.email),o(),y(e.display_name?8:-1),o(2),p("ngClass",a.getRoleBadgeClass(e.role)),o(),U(" ",e.role," "),o(2),p("ngClass",a.getStatusBadgeClass(e.active)),o(),U(" ",e.active?"Activo":"Inactivo"," "),o(3),b(a.formatDate(e.created_at)),o(5),p("ngClass",e.active?"btn-outline-warning":"btn-outline-success")("title",e.active?"Desactivar usuario":"Activar usuario"),o(),p("ngClass",e.active?"bi-pause":"bi-play")}}function K(s,i){if(s&1&&(n(0,"div",48)(1,"table",76)(2,"thead",77)(3,"tr")(4,"th",78),r(5,"Usuario"),t(),n(6,"th",78),r(7,"Rol"),t(),n(8,"th",78),r(9,"Estado"),t(),n(10,"th",78),r(11,"Fecha"),t(),n(12,"th",79),r(13,"Acciones"),t()()(),n(14,"tbody"),w(15,J,26,10,"tr",80,j),t()()()),s&2){let e=u();o(15),P(e.filteredUsers())}}function Q(s,i){if(s&1){let e=M();n(0,"li",100)(1,"button",105),c("click",function(){let l=h(e).$implicit,d=u(2);return _(d.goToPage(l))}),r(2),t()()}if(s&2){let e=i.$implicit,a=u(2);C("active",e===a.currentPage()),o(2),b(e)}}function W(s,i){if(s&1){let e=M();n(0,"div",49)(1,"div",96)(2,"div",32)(3,"small",87),r(4),t()(),n(5,"div",97)(6,"nav",98)(7,"ul",99)(8,"li",100)(9,"button",101),c("click",function(){h(e);let l=u();return _(l.goToPage(l.currentPage()-1))}),m(10,"i",102),t()(),w(11,Q,3,3,"li",103,I),n(13,"li",100)(14,"button",101),c("click",function(){h(e);let l=u();return _(l.goToPage(l.currentPage()+1))}),m(15,"i",104),t()()()()()()()}if(s&2){let e=u();o(4),N(" Mostrando ",e.getStartItem()," - ",e.getEndItem()," de ",e.totalUsers()," usuarios "),o(4),C("disabled",!e.hasPreviousPage()),o(),p("disabled",!e.hasPreviousPage()),o(2),P(e.getPaginationRange()),o(2),C("disabled",!e.hasNextPage()),o(),p("disabled",!e.hasNextPage())}}function X(s,i){if(s&1&&(n(0,"p",106),r(1,"\xBFEst\xE1 seguro de que desea eliminar el usuario:"),t(),n(2,"p",107),r(3),t(),n(4,"small",108),r(5,"Esta acci\xF3n no se puede deshacer."),t()),s&2){let e=u();o(3),b(e.userToDelete().email)}}var O=class s{userService=S($);router=S(R);notificationService=S(B);userModal;deleteModal;loading=v(!1);users=v([]);searchTerm=v("");selectedRole=v("");selectedStatus=v("");currentPage=v(1);totalUsers=v(0);itemsPerPage=10;isEditMode=v(!1);userToEdit=v(null);userToDelete=v(null);filteredUsers=x(()=>{let i=this.users(),e=this.searchTerm().toLowerCase(),a=this.selectedRole(),l=this.selectedStatus(),d=i;if(e&&(d=d.filter(g=>g.email.toLowerCase().includes(e)||g.username?.toLowerCase().includes(e)||g.display_name?.toLowerCase().includes(e))),a&&(d=d.filter(g=>g.role===a)),l){let g=l==="active";d=d.filter(z=>z.active===g)}return d});userStats=x(()=>{let i=this.users();return{total:i.length,active:i.filter(e=>e.active).length,inactive:i.filter(e=>!e.active).length,admins:i.filter(e=>e.role==="admin").length}});totalPages=x(()=>Math.ceil(this.filteredUsers().length/this.itemsPerPage));paginatedUsers=x(()=>{let i=(this.currentPage()-1)*this.itemsPerPage,e=i+this.itemsPerPage;return this.filteredUsers().slice(i,e)});hasPreviousPage=x(()=>this.currentPage()>1);hasNextPage=x(()=>this.currentPage()<this.totalPages());ngOnInit(){this.loadUsers(),this.initializeModals()}ngOnDestroy(){this.userModal?.dispose(),this.deleteModal?.dispose()}initializeModals(){let i=document.getElementById("userModal"),e=document.getElementById("deleteModal");i&&(this.userModal=new bootstrap.Modal(i)),e&&(this.deleteModal=new bootstrap.Modal(e))}loadUsers(){return E(this,null,function*(){try{this.loading.set(!0);let i=yield this.userService.getUsers({page:1,limit:1e3});this.users.set(i.data),this.totalUsers.set(i.total)}catch{this.notificationService.showCustom("Error al cargar usuarios","error")}finally{this.loading.set(!1)}})}openCreateModal(){this.isEditMode.set(!1),this.userToEdit.set(null),this.userModal?.show()}openEditModal(i){this.isEditMode.set(!0),this.userToEdit.set(i),this.userModal?.show()}closeUserModal(){this.userModal?.hide(),this.isEditMode.set(!1),this.userToEdit.set(null)}onUserSaved(){this.closeUserModal(),this.loadUsers();let i=this.isEditMode()?"Usuario actualizado exitosamente":"Usuario creado exitosamente";this.notificationService.showCustom(i,"success")}onModalClosed(){this.closeUserModal()}toggleUserStatus(i){return E(this,null,function*(){if(i.id)try{yield this.userService.updateUser({id:i.id,active:!i.active});let e=this.users().map(a=>a.id===i.id?k(T({},a),{active:!a.active}):a);this.users.set(e),this.notificationService.showCustom(`Usuario ${i.active?"desactivado":"activado"} correctamente`,"success")}catch{this.notificationService.showCustom("Error al cambiar el estado del usuario","error")}})}openDeleteModal(i){this.userToDelete.set(i),this.deleteModal?.show()}confirmDelete(){return E(this,null,function*(){let i=this.userToDelete();if(i?.id)try{yield this.userService.deleteUser(i.id);let e=this.users().filter(a=>a.id!==i.id);this.users.set(e),this.totalUsers.set(this.totalUsers()-1),this.notificationService.showCustom("Usuario eliminado correctamente","success"),this.userToDelete.set(null),this.deleteModal?.hide()}catch{this.notificationService.showCustom("Error al eliminar el usuario","error")}})}onSearchInput(i){let e=i.target;this.searchTerm.set(e.value),this.currentPage.set(1)}applyFilters(){this.currentPage.set(1)}goToPage(i){i>=1&&i<=this.totalPages()&&this.currentPage.set(i)}getPaginationRange(){let i=this.totalPages(),e=this.currentPage(),a=[],l=Math.max(1,e-2),d=Math.min(i,e+2);for(let g=l;g<=d;g++)a.push(g);return a}getStartItem(){return(this.currentPage()-1)*this.itemsPerPage+1}getEndItem(){let i=this.currentPage()*this.itemsPerPage;return Math.min(i,this.filteredUsers().length)}getRoleBadgeClass(i){return{admin:"bg-danger",user:"bg-primary",guest:"bg-secondary"}[i]||"bg-secondary"}getStatusBadgeClass(i){return i?"bg-success":"bg-secondary"}formatDate(i){return new Date(i).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=D({type:s,selectors:[["app-user-management"]],decls:119,vars:15,consts:[[1,"min-vh-100","bg-light","py-3"],[1,"container-fluid"],[1,"row","align-items-center","mb-4"],[1,"col-12","col-md-8"],[1,"d-flex","align-items-center"],[1,"bg-dark","bg-opacity-10","rounded-circle","p-2","me-3"],[1,"bi","bi-people-fill","text-dark","fs-5"],[1,"h4","mb-1","text-dark","fw-bold"],[1,"text-muted","small","mb-0"],[1,"col-12","col-md-4","text-md-end","mt-3","mt-md-0"],["type","button",1,"btn","btn-dark","btn-sm",3,"click"],[1,"bi","bi-person-plus","me-1"],[1,"row","g-3","mb-4"],[1,"col-6","col-lg-3"],[1,"card","border-0","bg-white","shadow-sm","h-100"],[1,"card-body","p-3"],[1,"flex-grow-1"],[1,"text-muted","small","text-uppercase","fw-medium","mb-1"],[1,"h5","mb-0","fw-bold","text-dark"],[1,"bg-dark","bg-opacity-10","rounded-circle","p-2"],[1,"bi","bi-people","text-dark"],[1,"h5","mb-0","fw-bold","text-success"],[1,"bg-success","bg-opacity-10","rounded-circle","p-2"],[1,"bi","bi-person-check","text-success"],[1,"h5","mb-0","fw-bold","text-secondary"],[1,"bg-secondary","bg-opacity-10","rounded-circle","p-2"],[1,"bi","bi-person-x","text-secondary"],[1,"h5","mb-0","fw-bold","text-danger"],[1,"bg-danger","bg-opacity-10","rounded-circle","p-2"],[1,"bi","bi-shield-fill-check","text-danger"],[1,"card","border-0","shadow-sm","mb-4"],[1,"row","g-3","align-items-center"],[1,"col-12","col-md-6"],[1,"input-group","input-group-sm"],[1,"input-group-text","bg-light","border-end-0"],[1,"bi","bi-search","text-muted"],["type","text","placeholder","Buscar por email, usuario o nombre...",1,"form-control","border-start-0",3,"input","value"],[1,"col-6","col-md-3"],[1,"form-select","form-select-sm",3,"change","value"],["value",""],["value","admin"],["value","user"],["value","guest"],["value","active"],["value","inactive"],[1,"card","border-0","shadow-sm"],[1,"card-body","p-0"],[1,"text-center","py-5"],[1,"table-responsive"],[1,"card-footer","bg-light","border-0","py-3"],["id","deleteModal","tabindex","-1","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-sm"],[1,"modal-content","border-0","shadow"],[1,"modal-header","bg-danger","text-white"],[1,"modal-title","fw-medium"],[1,"bi","bi-exclamation-triangle","me-2"],["type","button","data-bs-dismiss","modal",1,"btn-close","btn-close-white"],[1,"modal-body","p-4"],[1,"modal-footer","bg-light","border-0"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary","btn-sm"],["type","button",1,"btn","btn-danger","btn-sm",3,"click"],[1,"bi","bi-trash","me-1"],["id","userModal","tabindex","-1","aria-labelledby","userModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-lg","modal-dialog-scrollable"],[1,"modal-header","bg-dark","text-white"],["id","userModalLabel",1,"modal-title","fw-medium"],[1,"bi","me-2",3,"ngClass"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close","btn-close-white"],[1,"modal-body","p-0"],[3,"userSaved","modalClosed","isModal","editMode","userToEdit"],["role","status",1,"spinner-border","spinner-border-sm","text-dark"],[1,"visually-hidden"],[1,"text-muted","mt-2","mb-0","small"],[1,"bi","bi-people","display-1","text-muted","opacity-25"],[1,"text-muted","mt-3"],[1,"text-muted","small"],[1,"table","table-hover","table-sm","mb-0"],[1,"table-dark"],[1,"fw-medium","small","px-3","py-3"],[1,"fw-medium","small","px-3","py-3","text-center"],[1,"border-bottom"],[1,"px-3","py-3"],[1,"bg-dark","bg-opacity-10","rounded-circle","d-flex","align-items-center","justify-content-center","me-2",2,"width","32px","height","32px"],[1,"bi","bi-person-fill","text-dark","small"],[1,"fw-medium","small","text-dark"],[1,"text-muted",2,"font-size","0.75rem"],[1,"badge","rounded-pill",3,"ngClass"],[1,"text-muted"],[1,"px-3","py-3","text-center"],[1,"btn-group","btn-group-sm"],["type","button","title","Editar usuario",1,"btn","btn-outline-dark","btn-sm",3,"click"],[1,"bi","bi-pencil"],["type","button",1,"btn",3,"click","ngClass","title"],[1,"bi",3,"ngClass"],["type","button","title","Eliminar usuario",1,"btn","btn-outline-danger","btn-sm",3,"click"],[1,"bi","bi-trash"],[1,"row","align-items-center"],[1,"col-12","col-md-6","mt-2","mt-md-0"],[1,"d-flex","justify-content-md-end"],[1,"pagination","pagination-sm","mb-0"],[1,"page-item"],[1,"page-link","border-0",3,"click","disabled"],[1,"bi","bi-chevron-left"],[1,"page-item",3,"active"],[1,"bi","bi-chevron-right"],[1,"page-link","border-0",3,"click"],[1,"mb-2","small"],[1,"fw-medium","text-dark","mb-2"],[1,"text-danger"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),m(6,"i",6),t(),n(7,"div")(8,"h1",7),r(9,"Gesti\xF3n de Usuarios"),t(),n(10,"p",8),r(11,"Administrar usuarios y permisos del sistema"),t()()()(),n(12,"div",9)(13,"button",10),c("click",function(){return a.openCreateModal()}),m(14,"i",11),r(15," Nuevo Usuario "),t()()(),n(16,"div",12)(17,"div",13)(18,"div",14)(19,"div",15)(20,"div",4)(21,"div",16)(22,"div",17),r(23,"Total"),t(),n(24,"div",18),r(25),t()(),n(26,"div",19),m(27,"i",20),t()()()()(),n(28,"div",13)(29,"div",14)(30,"div",15)(31,"div",4)(32,"div",16)(33,"div",17),r(34,"Activos"),t(),n(35,"div",21),r(36),t()(),n(37,"div",22),m(38,"i",23),t()()()()(),n(39,"div",13)(40,"div",14)(41,"div",15)(42,"div",4)(43,"div",16)(44,"div",17),r(45,"Inactivos"),t(),n(46,"div",24),r(47),t()(),n(48,"div",25),m(49,"i",26),t()()()()(),n(50,"div",13)(51,"div",14)(52,"div",15)(53,"div",4)(54,"div",16)(55,"div",17),r(56,"Admins"),t(),n(57,"div",27),r(58),t()(),n(59,"div",28),m(60,"i",29),t()()()()()(),n(61,"div",30)(62,"div",15)(63,"div",31)(64,"div",32)(65,"div",33)(66,"span",34),m(67,"i",35),t(),n(68,"input",36),c("input",function(d){return a.onSearchInput(d)}),t()()(),n(69,"div",37)(70,"select",38),c("change",function(d){return a.selectedRole.set(d.target.value),a.applyFilters()}),n(71,"option",39),r(72,"Todos los roles"),t(),n(73,"option",40),r(74,"Administrador"),t(),n(75,"option",41),r(76,"Usuario"),t(),n(77,"option",42),r(78,"Invitado"),t()()(),n(79,"div",37)(80,"select",38),c("change",function(d){return a.selectedStatus.set(d.target.value),a.applyFilters()}),n(81,"option",39),r(82,"Todos los estados"),t(),n(83,"option",43),r(84,"Activos"),t(),n(85,"option",44),r(86,"Inactivos"),t()()()()()(),n(87,"div",45)(88,"div",46),f(89,q,6,0,"div",47)(90,G,6,0,"div",47)(91,K,17,0,"div",48),t(),f(92,W,16,9,"div",49),t()()(),n(93,"div",50)(94,"div",51)(95,"div",52)(96,"div",53)(97,"h6",54),m(98,"i",55),r(99," Confirmar eliminaci\xF3n "),t(),m(100,"button",56),t(),n(101,"div",57),f(102,X,6,1),t(),n(103,"div",58)(104,"button",59),r(105," Cancelar "),t(),n(106,"button",60),c("click",function(){return a.confirmDelete()}),m(107,"i",61),r(108," Eliminar "),t()()()()(),n(109,"div",62)(110,"div",63)(111,"div",52)(112,"div",64)(113,"h5",65),m(114,"i",66),r(115),t(),m(116,"button",67),t(),n(117,"div",68)(118,"app-user",69),c("userSaved",function(){return a.onUserSaved()})("modalClosed",function(){return a.closeUserModal()}),t()()()()()),e&2&&(o(25),b(a.userStats().total),o(11),b(a.userStats().active),o(11),b(a.userStats().inactive),o(11),b(a.userStats().admins),o(10),p("value",a.searchTerm()),o(2),p("value",a.selectedRole()),o(10),p("value",a.selectedStatus()),o(9),y(a.loading()?89:a.filteredUsers().length===0?90:91),o(3),y(a.totalUsers()>0?92:-1),o(10),y(a.userToDelete()?102:-1),o(12),p("ngClass",a.isEditMode()?"bi-pencil":"bi-person-plus"),o(),U(" ",a.isEditMode()?"Editar Usuario":"Nuevo Usuario"," "),o(3),p("isModal",!0)("editMode",a.isEditMode())("userToEdit",a.userToEdit()))},dependencies:[V,F,A,L],encapsulation:2})};export{O as UserManagement};

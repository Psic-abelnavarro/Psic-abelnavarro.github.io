import{b as N}from"./chunk-RI2EYGR4.js";import{a as F}from"./chunk-JJ6L3UIW.js";import{a as p}from"./chunk-IYGYDPGO.js";import{a as P}from"./chunk-MPC7SZEK.js";import"./chunk-CF2QCA26.js";import{f as T,h as M,i as A,l as L}from"./chunk-NUA5R5QO.js";import{Ab as _,Ac as w,Da as r,Eb as h,Fb as i,Gb as l,Hb as S,Ib as D,Na as I,Ra as g,Rb as R,Xb as k,_ as x,da as u,ea as f,gb as c,hb as t,ia as C,ib as n,ma as E,qb as y,rb as b,tb as m,uc as V}from"./chunk-6O7NOF42.js";import"./chunk-LJ5XHLMQ.js";import"./chunk-FK42CRUA.js";var O=s=>["/eventos",s,"editar"];function U(s,a){if(s&1&&(t(0,"p",36),i(1),n()),s&2){let e=m().ngIf;r(),l(e.shortDescription)}}function j(s,a){s&1&&(t(0,"p",36),i(1,"Sin descripci\xF3n corta."),n())}function H(s,a){if(s&1&&(t(0,"span"),i(1),n()),s&2){let e=m().ngIf;r(),S(" / ",e.maxParticipants)}}function G(s,a){if(s&1&&(t(0,"div")(1,"ul",37)(2,"li"),i(3,"Total inscripciones: "),t(4,"strong"),i(5),n()(),t(6,"li"),i(7,"Confirmadas: "),t(8,"strong"),i(9),n()(),t(10,"li"),i(11,"Asistieron: "),t(12,"strong"),i(13),n()(),t(14,"li"),i(15,"Tasa asistencia: "),t(16,"strong"),i(17),n()(),t(18,"li"),i(19,"Certificados emitidos: "),t(20,"strong"),i(21),n()()()()),s&2){let e=a.ngIf;r(5),l(e.totalRegistrations),r(4),l(e.confirmedRegistrations),r(4),l(e.attendedCount),r(4),S("",e.attendanceRate,"%"),r(4),l(e.certificatesIssued)}}function q(s,a){s&1&&(t(0,"div",38),i(1,"No hay estad\xEDsticas disponibles."),n())}function z(s,a){if(s&1){let e=y();t(0,"div",3)(1,"app-confirm-modal",4,0),b("accepted",function(){u(e);let o=m();return f(o.onConfirmAccepted())})("cancelled",function(){u(e);let o=m();return f(o.onConfirmCancelled())}),n(),t(3,"nav",5)(4,"ol",6)(5,"li",7)(6,"a",8),i(7,"Inicio"),n()(),t(8,"li",7)(9,"a",9),i(10,"Eventos"),n()(),t(11,"li",10),i(12),n()()(),t(13,"div",11)(14,"div")(15,"h2",12),i(16),n(),t(17,"div")(18,"span",13),i(19),n(),t(20,"span",14),i(21),n()()(),t(22,"div",15)(23,"a",16),i(24,"Editar"),n(),t(25,"a",17),i(26,"Volver"),n()()(),t(27,"div",18)(28,"div",19)(29,"div",20)(30,"div",21)(31,"h5",22),i(32,"Descripci\xF3n"),n(),g(33,U,2,1,"p",23)(34,j,2,0,"p",23),n()(),t(35,"div",24)(36,"div",21)(37,"h5",22),i(38,"Detalles"),n(),t(39,"dl",25)(40,"dt",26),i(41,"Tipo"),n(),t(42,"dd",27),i(43),n(),t(44,"dt",26),i(45,"Ubicaci\xF3n"),n(),t(46,"dd",27),i(47),n(),t(48,"dt",26),i(49,"Aforo"),n(),t(50,"dd",27),i(51),g(52,H,2,1,"span",28),n(),t(53,"dt",26),i(54,"Registro"),n(),t(55,"dd",27)(56,"span",13),i(57),n()(),t(58,"dt",26),i(59,"Costo"),n(),t(60,"dd",27),i(61),n()()()()(),t(62,"div",29)(63,"div",20)(64,"div",21)(65,"h5",22),i(66,"Acciones"),n(),t(67,"div",30)(68,"button",31),b("click",function(){u(e);let o=_(2),v=m();return f(v.openConfirm(o,"Publicar evento","\xBFDeseas publicar este evento?","publish"))}),i(69,"Publicar"),n(),t(70,"button",32),b("click",function(){u(e);let o=_(2),v=m();return f(v.openConfirm(o,"Abrir inscripciones","\xBFAbrir inscripciones ahora?","open"))}),i(71,"Abrir inscripciones"),n(),t(72,"button",33),b("click",function(){u(e);let o=_(2),v=m();return f(v.openConfirm(o,"Cerrar inscripciones","\xBFCerrar inscripciones ahora?","close"))}),i(73,"Cerrar inscripciones"),n(),t(74,"button",34),b("click",function(){u(e);let o=_(2),v=m();return f(v.openConfirm(o,"Cancelar evento","Esta acci\xF3n no se puede deshacer. \xBFCancelar evento?","cancel"))}),i(75,"Cancelar"),n()()()(),t(76,"div",24)(77,"div",21)(78,"h5",22),i(79,"Estad\xEDsticas"),n(),g(80,G,22,5,"div",35)(81,q,2,0,"ng-template",null,1,k),n()()()()()}if(s&2){let e=a.ngIf,d=_(82),o=m();r(),c("title",o.confirmTitle)("message",o.confirmMessage),r(11),l(e.title),r(4),l(e.title),r(2),h("bg-"+e.statusColor),r(),l(e.statusLabel),r(2),D("",e.startDate," \u2192 ",e.endDate),r(2),c("routerLink",R(26,O,e.id)),r(10),c("ngIf",e.shortDescription),r(),c("ngIf",!e.shortDescription),r(9),l(e.eventType),r(4),l(e.location),r(4),l(e.currentParticipants),r(),c("ngIf",e.maxParticipants),r(4),h("bg-"+e.registrationStatusColor),r(),l(e.registrationStatusLabel),r(4),l(e.costLabel),r(7),c("disabled",!o.canPublish()),r(2),c("disabled",!o.canOpenReg()),r(2),c("disabled",!o.canCloseReg()),r(2),c("disabled",!o.canCancel()),r(6),c("ngIf",o.stats())("ngIfElse",d)}}var B=class s{route=x(T);router=x(M);destroyRef=x(C);eventService=x(N);eventId;eventVmSig=E(null);statsSig=E(null);confirmTitle="";confirmMessage="";pendingAction=null;ngOnInit(){this.route.paramMap.pipe(p(this.destroyRef)).subscribe(a=>{let e=a.get("id");if(!e){this.router.navigate(["/eventos"]);return}this.eventId=Number(e),this.load()})}load(){this.eventService.getEventById(this.eventId).pipe(p(this.destroyRef)).subscribe({next:a=>{let e=P.event.toCard(a);this.eventVmSig.set(e)},error:()=>this.router.navigate(["/eventos"])}),this.eventService.getEventStats(this.eventId).pipe(p(this.destroyRef)).subscribe(a=>this.statsSig.set(a))}event(){return this.eventVmSig()}stats(){return this.statsSig()}canPublish(){let a=this.eventVmSig();return!!a&&(a.status==="draft"||a.status==="published")}canOpenReg(){let a=this.eventVmSig();return!!a&&a.status==="published"}canCloseReg(){let a=this.eventVmSig();return!!a&&a.status==="reg_open"}canCancel(){let a=this.eventVmSig();return!!a&&a.status!=="cancelled"&&a.status!=="completed"}publish(){this.eventService.publishEvent(this.eventId).pipe(p(this.destroyRef)).subscribe(()=>this.load())}openReg(){this.eventService.openRegistrations(this.eventId).pipe(p(this.destroyRef)).subscribe(()=>this.load())}closeReg(){this.eventService.closeRegistrations(this.eventId).pipe(p(this.destroyRef)).subscribe(()=>this.load())}cancel(){this.eventService.changeEventStatus(this.eventId,"cancelled").pipe(p(this.destroyRef)).subscribe(()=>this.load())}openConfirm(a,e,d,o){this.confirmTitle=e,this.confirmMessage=d,this.pendingAction=o,a.show()}onConfirmAccepted(){switch(this.pendingAction){case"publish":this.publish();break;case"open":this.openReg();break;case"close":this.closeReg();break;case"cancel":this.cancel();break}this.pendingAction=null}onConfirmCancelled(){this.pendingAction=null}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=I({type:s,selectors:[["app-event-detail"]],decls:1,vars:1,consts:[["confirmModal",""],["nostats",""],["class","container py-3",4,"ngIf"],[1,"container","py-3"],[3,"accepted","cancelled","title","message"],["aria-label","breadcrumb",1,"mb-3"],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/"],["routerLink","/eventos"],["aria-current","page",1,"breadcrumb-item","active"],[1,"d-flex","justify-content-between","align-items-start","mb-3"],[1,"h4","mb-1"],[1,"badge"],[1,"badge","bg-light","text-dark","ms-1"],[1,"btn-group"],[1,"btn","btn-outline-secondary",3,"routerLink"],["routerLink","/events",1,"btn","btn-outline-primary"],[1,"row","g-3"],[1,"col-12","col-lg-8"],[1,"card","mb-3"],[1,"card-body"],[1,"card-title"],["class","mb-0",4,"ngIf"],[1,"card"],[1,"row","mb-0"],[1,"col-sm-4"],[1,"col-sm-8"],[4,"ngIf"],[1,"col-12","col-lg-4"],[1,"d-grid","gap-2"],[1,"btn","btn-outline-success",3,"click","disabled"],[1,"btn","btn-outline-primary",3,"click","disabled"],[1,"btn","btn-outline-warning",3,"click","disabled"],[1,"btn","btn-outline-danger",3,"click","disabled"],[4,"ngIf","ngIfElse"],[1,"mb-0"],[1,"list-unstyled","mb-0","small"],[1,"text-muted"]],template:function(e,d){e&1&&g(0,z,83,28,"div",2),e&2&&c("ngIf",d.event())},dependencies:[w,V,L,A,F],encapsulation:2})};export{B as EventDetailComponent};

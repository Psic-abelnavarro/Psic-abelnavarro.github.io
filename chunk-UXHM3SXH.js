import{b as le}from"./chunk-RI2EYGR4.js";import{a as v,c as U}from"./chunk-IYGYDPGO.js";import{b as H,c as j,d,e as z,f as K,h as Y,i as J,k as Q,l as W,m as X,n as Z,o as ee,p as te,q as ie,r as ne,s as re,u as oe}from"./chunk-GFCFUV6K.js";import{a as ae}from"./chunk-MXHSEERB.js";import"./chunk-MPC7SZEK.js";import{b as B}from"./chunk-CF2QCA26.js";import{f as w,h as G,i as O,l as $}from"./chunk-NUA5R5QO.js";import{Ab as _,Ac as M,Cb as p,Da as l,Fb as n,Gb as P,Na as g,Ra as h,Rb as k,Ub as F,Vb as A,Xb as R,_ as c,bb as C,cb as x,da as b,ea as y,eb as D,fb as T,gb as s,hb as i,ia as E,ib as t,jb as m,ma as S,qb as I,rb as q,tb as N,uc as V,yc as L}from"./chunk-6O7NOF42.js";import"./chunk-LJ5XHLMQ.js";import"./chunk-FK42CRUA.js";var se=a=>["/eventos",a],de=(a,e)=>e.key;function ce(a,e){if(a&1&&(i(0,"option",29),n(1),t()),a&2){let r=e.$implicit;s("value",r.key),l(),P(r.value.name)}}function pe(a,e){if(a&1&&(D(0,ce,2,2,"option",29,de),F(2,"keyvalue")),a&2){let r=N();T(A(2,0,r.eventTypes()))}}function ue(a,e){a&1&&(i(0,"span"),n(1,"Guardar"),t())}function ve(a,e){a&1&&(m(0,"span",45),n(1,"Guardando\u2026 "))}var me=class a{fb=c(re);router=c(G);route=c(w);destroyRef=c(E);staticData=c(ae);eventService=c(le);LocationType=B;form;eventId;submittingSig=S(!1);eventTypesSig=U(this.staticData.eventTypes$,{initialValue:null});ngOnInit(){this.form=this.fb.group({title:["",[d.required,d.minLength(5)]],shortDescription:[""],description:[""],eventTypeId:["",d.required],startDate:["",d.required],endDate:["",d.required],locationType:["",d.required],maxParticipants:[null],cost:[0,[d.min(0)]],isPublic:[!0],requiresApproval:[!1],requiresCertificate:[!1]}),this.staticData.loadEventTypes().pipe(v(this.destroyRef)).subscribe(),this.route.paramMap.pipe(v(this.destroyRef)).subscribe(e=>{let r=Number(e.get("id"));this.eventId=r,this.load()})}eventTypes(){return this.eventTypesSig()}isSubmitting(){return this.submittingSig()}invalid(e){let r=this.form.get(e);return!!r&&r.invalid&&(r.dirty||r.touched)}fromIso(e){if(!e)return null;let r=new Date(e),o=r.getFullYear(),u=String(r.getMonth()+1).padStart(2,"0"),f=String(r.getDate()).padStart(2,"0");return`${o}-${u}-${f}`}toIso(e){if(e)return new Date(e+"T00:00:00").toISOString()}load(){this.eventService.getEventById(this.eventId).pipe(v(this.destroyRef)).subscribe({next:e=>{this.form.patchValue({title:e.title,shortDescription:e.shortDescription||"",description:e.description||"",eventTypeId:e.eventTypeId,startDate:this.fromIso(e.startDate),endDate:this.fromIso(e.endDate),locationType:e.locationType,maxParticipants:e.maxParticipants||null,cost:e.cost||0,isPublic:e.isPublic,requiresApproval:e.requiresApproval,requiresCertificate:e.requiresCertificate})},error:()=>this.router.navigate(["/eventos"])})}onSubmit(){if(this.form.invalid||this.isSubmitting())return;this.submittingSig.set(!0);let e=this.form.value,r={title:e.title.trim(),shortDescription:e.shortDescription||void 0,description:e.description||void 0,eventTypeId:Number(e.eventTypeId),startDate:this.toIso(e.startDate),endDate:this.toIso(e.endDate),locationType:e.locationType,maxParticipants:e.maxParticipants?Number(e.maxParticipants):void 0,cost:e.cost!==null&&e.cost!==void 0?Number(e.cost):0,isPublic:!!e.isPublic,requiresApproval:!!e.requiresApproval,requiresCertificate:!!e.requiresCertificate};this.eventService.updateEvent(this.eventId,r).pipe(v(this.destroyRef)).subscribe({next:()=>{this.router.navigate(["/eventos",this.eventId])},error:o=>{console.error("Actualizar evento error",o),this.submittingSig.set(!1)},complete:()=>this.submittingSig.set(!1)})}static \u0275fac=function(r){return new(r||a)};static \u0275cmp=g({type:a,selectors:[["app-event-edit"]],decls:99,vars:21,consts:[["saving",""],[1,"container","py-3"],["aria-label","breadcrumb",1,"mb-3"],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/"],["routerLink","/eventos"],["aria-current","page",1,"breadcrumb-item","active"],[1,"h4","mb-3"],["novalidate","","aria-label","Formulario de edici\xF3n de evento",1,"needs-validation",3,"ngSubmit","formGroup"],[1,"row","g-3"],[1,"col-12","col-md-8"],[1,"card"],[1,"card-body"],[1,"mb-3"],[1,"form-label"],["type","text","formControlName","title","required","",1,"form-control"],[1,"invalid-feedback"],["type","text","formControlName","shortDescription","maxlength","160",1,"form-control"],["rows","4","formControlName","description",1,"form-control"],[1,"col-12","col-md-6"],["formControlName","eventTypeId","required","",1,"form-select"],["value",""],[1,"col-6","col-md-3"],["type","date","formControlName","startDate","required","",1,"form-control"],["type","date","formControlName","endDate","required","",1,"form-control"],[1,"row","g-3","mt-1"],[1,"col-12","col-md-4"],["formControlName","locationType","required","",1,"form-select"],[3,"value"],["type","number","min","1","formControlName","maxParticipants",1,"form-control"],["type","number","min","0","step","0.01","formControlName","cost",1,"form-control"],[1,"card","mb-3"],[1,"form-check","form-switch","mb-2"],["type","checkbox","id","isPublic","formControlName","isPublic",1,"form-check-input"],["for","isPublic",1,"form-check-label"],["type","checkbox","id","requiresApproval","formControlName","requiresApproval",1,"form-check-input"],["for","requiresApproval",1,"form-check-label"],[1,"form-check","form-switch"],["type","checkbox","id","requiresCertificate","formControlName","requiresCertificate",1,"form-check-input"],["for","requiresCertificate",1,"form-check-label"],[1,"d-grid","gap-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],[4,"ngIf","ngIfElse"],[1,"btn","btn-outline-secondary",3,"routerLink"],["aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"]],template:function(r,o){if(r&1){let u=I();i(0,"div",1)(1,"nav",2)(2,"ol",3)(3,"li",4)(4,"a",5),n(5,"Inicio"),t()(),i(6,"li",4)(7,"a",6),n(8,"Eventos"),t()(),i(9,"li",7),n(10,"Editar evento"),t()()(),i(11,"h2",8),n(12,"Editar evento"),t(),i(13,"form",9),q("ngSubmit",function(){return b(u),y(o.onSubmit())}),i(14,"div",10)(15,"div",11)(16,"div",12)(17,"div",13)(18,"div",14)(19,"label",15),n(20,"T\xEDtulo"),t(),m(21,"input",16),i(22,"div",17),n(23,"T\xEDtulo es requerido (m\xEDn. 5 caracteres)."),t()(),i(24,"div",14)(25,"label",15),n(26,"Descripci\xF3n corta"),t(),m(27,"input",18),t(),i(28,"div",14)(29,"label",15),n(30,"Descripci\xF3n"),t(),m(31,"textarea",19),t(),i(32,"div",10)(33,"div",20)(34,"label",15),n(35,"Tipo de evento"),t(),i(36,"select",21)(37,"option",22),n(38,"Seleccione\u2026"),t(),C(39,pe,3,2),t(),i(40,"div",17),n(41,"Seleccione un tipo."),t()(),i(42,"div",23)(43,"label",15),n(44,"Inicio"),t(),m(45,"input",24),i(46,"div",17),n(47,"Fecha de inicio requerida."),t()(),i(48,"div",23)(49,"label",15),n(50,"Fin"),t(),m(51,"input",25),i(52,"div",17),n(53,"Fecha de fin requerida."),t()()(),i(54,"div",26)(55,"div",27)(56,"label",15),n(57,"Ubicaci\xF3n"),t(),i(58,"select",28)(59,"option",22),n(60,"Seleccione\u2026"),t(),i(61,"option",29),n(62,"Presencial"),t(),i(63,"option",29),n(64,"Virtual"),t(),i(65,"option",29),n(66,"H\xEDbrido"),t()(),i(67,"div",17),n(68,"Seleccione la ubicaci\xF3n."),t()(),i(69,"div",27)(70,"label",15),n(71,"Aforo m\xE1ximo"),t(),m(72,"input",30),t(),i(73,"div",27)(74,"label",15),n(75,"Costo (PEN)"),t(),m(76,"input",31),t()()()()(),i(77,"div",27)(78,"div",32)(79,"div",13)(80,"div",33),m(81,"input",34),i(82,"label",35),n(83,"Evento p\xFAblico"),t()(),i(84,"div",33),m(85,"input",36),i(86,"label",37),n(87,"Requiere aprobaci\xF3n"),t()(),i(88,"div",38),m(89,"input",39),i(90,"label",40),n(91,"Emite certificado"),t()()()(),i(92,"div",41)(93,"button",42),h(94,ue,2,0,"span",43)(95,ve,2,0,"ng-template",null,0,R),t(),i(97,"a",44),n(98,"Cancelar"),t()()()()()()}if(r&2){let u=_(96);l(13),s("formGroup",o.form),l(8),p("is-invalid",o.invalid("title")),l(15),p("is-invalid",o.invalid("eventTypeId")),l(3),x(o.eventTypes()?39:-1),l(6),p("is-invalid",o.invalid("startDate")),l(6),p("is-invalid",o.invalid("endDate")),l(7),p("is-invalid",o.invalid("locationType")),l(3),s("value",o.LocationType.PRESENCIAL),l(2),s("value",o.LocationType.VIRTUAL),l(2),s("value",o.LocationType.HIBRIDO),l(28),s("disabled",o.isSubmitting()||o.form.invalid),l(),s("ngIf",!o.isSubmitting())("ngIfElse",u),l(3),s("routerLink",k(19,se,o.eventId))}},dependencies:[M,V,oe,Y,Z,ee,j,J,H,X,z,K,ie,ne,te,Q,W,$,O,L],encapsulation:2})};export{me as EventEditComponent};

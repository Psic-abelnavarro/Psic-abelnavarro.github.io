import{a as ue}from"./chunk-4XQXH5E7.js";import{a as fe}from"./chunk-W55XPYIR.js";import{b as X,c as Y,e as ee,f as te,h as ie,k as ne,l as oe,m as le,n as re,o as ae,s as se,t as de,u as me}from"./chunk-KBXA6SDK.js";import{b as ce}from"./chunk-7M4K7CII.js";import{a as pe}from"./chunk-CYLPXQIR.js";import"./chunk-MPC7SZEK.js";import{a as I}from"./chunk-TMGCMHHJ.js";import{c as A,d as M,j as N}from"./chunk-IIPOJGOQ.js";import{h as W,i as J,l as K}from"./chunk-C3HOFUSH.js";import{$a as O,Ab as G,Bb as q,Bc as Z,Cb as k,D as P,Da as o,Db as h,Fb as E,Gb as r,H as R,Hb as f,Ib as C,Na as j,Ra as z,Rb as D,Sb as F,_ as U,ab as V,ac as T,bb as p,cb as u,da as b,ea as v,eb as L,fb as y,gb as w,gc as H,hb as m,ia as B,ib as t,jb as i,kb as s,ma as _,rb as S,sb as x,ub as c,uc as Q,zb as $}from"./chunk-5W5GNUFO.js";import"./chunk-LJ5XHLMQ.js";import"./chunk-FK42CRUA.js";var _e=["confirmModal"],be=()=>[1,2,3,4,5,6,7,8],ve=l=>["/usuarios",l],xe=l=>["/usuarios",l,"editar"];function Ce(l,n){if(l&1&&(t(0,"span",16),r(1),i()),l&2){let e=c();o(),f(e.totalItems())}}function Se(l,n){l&1&&s(0,"span",20)}function ye(l,n){l&1&&s(0,"i",21)}function we(l,n){if(l&1){let e=S();t(0,"li")(1,"button",63),x("click",function(){b(e);let d=c(2);return v(d.exportSelectedToCSV())}),s(2,"i",65),t(3,"span",15),r(4),i()()()}if(l&2){let e=c(2);o(4),C("Solo seleccionados (",e.selectedUsers().length,")")}}function Ee(l,n){if(l&1){let e=S();t(0,"div",25)(1,"button",60),s(2,"i",61),t(3,"span",22),r(4,"Exportar"),i()(),t(5,"ul",62)(6,"li")(7,"button",63),x("click",function(){b(e);let d=c();return v(d.exportToCSV())}),s(8,"i",64),t(9,"span",15),r(10,"Todos los usuarios (CSV)"),i()()(),p(11,we,5,1,"li"),i()()}if(l&2){let e=c();o(11),u(e.selectedUsers().length>0?11:-1)}}function Te(l,n){if(l&1&&(t(0,"span",33),r(1),i()),l&2){let e=c();o(),f(e.activeFiltersCount())}}function Ue(l,n){if(l&1){let e=S();t(0,"button",66),x("click",function(){b(e);let d=c();return v(d.clearAllFilters())}),s(1,"i",67),i()}}function Ve(l,n){if(l&1){let e=S();t(0,"button",103),x("click",function(){b(e),c();let d=q(10);return c().clearSearch(),v(d.focus())}),s(1,"i",104),i()}}function Fe(l,n){if(l&1&&(t(0,"option",79),r(1),i()),l&2){let e=n.$implicit,a=c(2);m("value",e),o(),f(a.getUserRoleLabel(e))}}function Ie(l,n){if(l&1&&(t(0,"option",79),r(1),i()),l&2){let e=n.$implicit;m("value",e.code),o(),f(e.name)}}function Le(l,n){if(l&1&&(t(0,"div",38)(1,"form",68)(2,"div",69)(3,"div",70)(4,"label",71),r(5,"Buscar por texto"),i(),t(6,"div",72)(7,"span",73),s(8,"i",74),i(),s(9,"input",75,1),p(11,Ve,2,0,"button",76),i()(),t(12,"div",77)(13,"label",71),r(14,"Rol"),i(),t(15,"select",78)(16,"option",79),r(17,"Todos los roles"),i(),y(18,Fe,2,2,"option",79,V().trackByRole,!0),i()(),t(20,"div",80)(21,"label",71),r(22,"Departamento"),i(),t(23,"select",81)(24,"option",79),r(25,"Todos"),i(),y(26,Ie,2,2,"option",79,V().trackByDepartmentCode,!0),i()(),t(28,"div",77)(29,"label",71),r(30,"Estado"),i(),t(31,"select",82)(32,"option",79),r(33,"Todos"),i(),t(34,"option",79),r(35,"Activos"),i(),t(36,"option",79),r(37,"Inactivos"),i()()(),t(38,"div",83)(39,"label",71),r(40,"Email"),i(),t(41,"select",84)(42,"option",79),r(43,"Todos"),i(),t(44,"option",79),r(45,"\u2713"),i(),t(46,"option",79),r(47,"\u2717"),i()()(),t(48,"div",83)(49,"label",71),r(50,"Tel\xE9fono"),i(),t(51,"select",85)(52,"option",79),r(53,"Todos"),i(),t(54,"option",79),r(55,"\u2713"),i(),t(56,"option",79),r(57,"\u2717"),i()()(),t(58,"div",77)(59,"label",71),r(60,"Desde"),i(),s(61,"input",86),i(),t(62,"div",77)(63,"label",71),r(64,"Hasta"),i(),s(65,"input",87),i(),t(66,"div",88)(67,"label",71),r(68,"Filtros adicionales"),i(),t(69,"div",89)(70,"div",90),s(71,"input",91),t(72,"label",92),r(73," Solo perfiles completos "),i()()()(),t(74,"div",93)(75,"label",71),r(76,"Ordenar por"),i(),t(77,"div",94)(78,"select",95)(79,"option",96),r(80,"Fecha registro"),i(),t(81,"option",97),r(82,"Nombre"),i(),t(83,"option",98),r(84,"\xDAltimo acceso"),i(),t(85,"option",99),r(86,"Eventos asistidos"),i()(),t(87,"select",100)(88,"option",101),r(89,"Desc"),i(),t(90,"option",102),r(91,"Asc"),i()()()()()()()),l&2){let e,a=c();o(),m("formGroup",a.filtersForm),o(10),u((e=a.filtersForm.get("searchText"))!=null&&e.value?11:-1),o(5),m("value",null),o(2),w(a.userRoles),o(6),m("value",null),o(2),w(a.departments()),o(6),m("value",null),o(2),m("value",!0),o(2),m("value",!1),o(6),m("value",null),o(2),m("value",!0),o(2),m("value",!1),o(6),m("value",null),o(2),m("value",!0),o(2),m("value",!1),o(15),m("value",!0)}}function ke(l,n){if(l&1&&(t(0,"span",42),r(1),i()),l&2){let e=c();o(),f(e.totalItems())}}function De(l,n){if(l&1&&(t(0,"span",43),r(1),i()),l&2){let e=c();o(),C("",e.selectedUsers().length," seleccionados")}}function Ae(l,n){if(l&1&&(t(0,"option",79),r(1),i()),l&2){let e=n.$implicit;m("value",e),o(),f(e)}}function Me(l,n){l&1&&(t(0,"div",111)(1,"div",112)(2,"div",113)(3,"div",114),s(4,"span",115),t(5,"div",116),s(6,"span",117)(7,"span",118),i()()(),t(8,"div",38)(9,"div",119),s(10,"span",120),t(11,"div",121)(12,"div",122),s(13,"span",123)(14,"span",124),i()()(),t(15,"div",125)(16,"div",126),s(17,"span",127)(18,"span",128),i(),t(19,"div",126),s(20,"span",129)(21,"span",130),i(),t(22,"div",29),s(23,"span",131)(24,"span",132),i()(),t(25,"div",133)(26,"div",134),s(27,"span",135)(28,"span",136),i(),t(29,"div",137),s(30,"span",138),i()()(),t(31,"div",139)(32,"div",140),s(33,"span",141)(34,"span",141)(35,"span",141),i()()()())}function Ne(l,n){l&1&&(t(0,"div",105),y(1,Me,36,0,"div",111,L),i()),l&2&&(o(),w(D(0,be)))}function Pe(l,n){l&1&&(t(0,"tr")(1,"td",150),s(2,"span",151),i(),t(3,"td",150)(4,"div",29),s(5,"span",152),t(6,"div",121)(7,"div",122),s(8,"span",153)(9,"span",124),i()()()(),t(10,"td",154),s(11,"span",155),i(),t(12,"td",156)(13,"div",122),s(14,"span",157),i()(),t(15,"td",150)(16,"div",158),s(17,"span",159)(18,"span",160),i()(),t(19,"td",161)(20,"div",134),s(21,"span",130)(22,"span",136),i(),t(23,"div",137),s(24,"span",162),i()(),t(25,"td",150)(26,"div",116),s(27,"span",141)(28,"span",141)(29,"span",141),i()()())}function Re(l,n){l&1&&(t(0,"div",106)(1,"table",142)(2,"thead",143)(3,"tr")(4,"th",144),r(5,"Sel."),i(),t(6,"th",145),r(7,"Usuario"),i(),t(8,"th",146),r(9,"Rol"),i(),t(10,"th",147),r(11,"Departamento"),i(),t(12,"th",145),r(13,"Estado"),i(),t(14,"th",148),r(15,"Perfil"),i(),t(16,"th",149),r(17,"Acciones"),i()()(),t(18,"tbody"),y(19,Pe,30,0,"tr",null,L),i()()()),l&2&&(o(19),w(D(0,be)))}function Be(l,n){if(l&1&&(t(0,"div",57),p(1,Ne,3,1,"div",105)(2,Re,21,1,"div",106),t(3,"div",107)(4,"div",108)(5,"span",109),r(6,"Cargando..."),i()(),t(7,"span",110),r(8,"Cargando usuarios..."),i()()()),l&2){let e=c();o(),u(e.viewMode()==="cards"?1:2)}}function je(l,n){if(l&1){let e=S();t(0,"h5",165),r(1,"No se encontraron usuarios"),i(),t(2,"p",163),r(3,"Intenta ajustar los filtros de b\xFAsqueda"),i(),t(4,"button",166),x("click",function(){b(e);let d=c(2);return v(d.clearAllFilters())}),s(5,"i",167),r(6,"Limpiar filtros "),i()}}function ze(l,n){l&1&&(t(0,"h5",165),r(1,"No hay usuarios registrados"),i(),t(2,"p",163),r(3,"Comienza creando el primer usuario"),i(),t(4,"a",168),s(5,"i",169),r(6,"Nuevo Usuario "),i())}function Oe(l,n){if(l&1&&(t(0,"div",58)(1,"div",163),s(2,"i",164),i(),p(3,je,7,0)(4,ze,7,0),i()),l&2){let e=c();o(3),u(e.hasActiveFilters()?3:4)}}function $e(l,n){if(l&1&&(t(0,"div",126),s(1,"i",194),t(2,"span",195),r(3),i()()),l&2){let e=c().$implicit;o(2),m("title",e.institution),o(),C(" ",e.institution," ")}}function Ge(l,n){if(l&1&&(t(0,"div",126),s(1,"i",196),t(2,"span",195),r(3),i()()),l&2){let e=c().$implicit;o(2),m("title",e.jobTitle),o(),C(" ",e.jobTitle," ")}}function qe(l,n){if(l&1&&(t(0,"div",126),s(1,"i",197),t(2,"span",198),r(3),i()()),l&2){let e=c().$implicit;o(3),f(e.departmentName)}}function He(l,n){if(l&1){let e=S();t(0,"div",111)(1,"div",172)(2,"div",173)(3,"div",174)(4,"input",175),x("change",function(){let d=b(e).$implicit,g=c(3);return v(g.toggleSelection(d.id))}),i(),t(5,"label",176),r(6," Seleccionar usuario "),i()(),t(7,"span",177),r(8),i()(),t(9,"div",38)(10,"div",119)(11,"div",178)(12,"span",179),r(13),i()(),t(14,"div",180)(15,"h6",181),r(16),i(),t(17,"p",182),r(18),i()()(),t(19,"div",133),p(20,$e,4,2,"div",126),p(21,Ge,4,2,"div",126),p(22,qe,4,1,"div",126),i(),t(23,"div",133)(24,"div",126)(25,"span",183),r(26),i()(),t(27,"div",184)(28,"div"),s(29,"i",36),i(),t(30,"div"),s(31,"i",36),i(),t(32,"div",121)(33,"div",185),s(34,"div",186),i()()()(),t(35,"div",187)(36,"div")(37,"div",188),r(38),i(),t(39,"div"),r(40,"Eventos"),i()(),t(41,"div")(42,"div",188),r(43),i(),t(44,"div"),r(45,"Certificados"),i()(),t(46,"div")(47,"div",188),r(48),i(),t(49,"div"),r(50,"Perfil"),i()()()(),t(51,"div",189)(52,"div",140)(53,"button",190),s(54,"i",191),i(),t(55,"button",192),s(56,"i",193),i()()()()()}if(l&2){let e=n.$implicit,a=c(3);o(),E(a.getTableRowClass(e)),h("border-primary",a.selectedUsers().includes(e.id))("shadow",a.selectedUsers().includes(e.id)),o(3),m("id","card-select-"+e.id)("checked",a.selectedUsers().includes(e.id)),o(),m("for","card-select-"+e.id),o(2),E(a.getRoleBadgeClass(e.role)),o(),C(" ",a.getUserRoleLabel(e.role)," "),o(5),f(a.getUserInitials(e.fullName)),o(3),f(e.fullName),o(2),f(e.email),o(2),u(e.institution?20:-1),o(),u(e.jobTitle?21:-1),o(),u(e.departmentName?22:-1),o(3),E(a.getUserStatusBadgeClass(e)),o(),C(" ",a.getUserStatusText(e)," "),o(2),h("text-success",e.emailVerified)("text-muted",!e.emailVerified),o(),h("bi-envelope-check-fill",e.emailVerified)("bi-envelope-x",!e.emailVerified),o(),h("text-success",e.phoneVerified)("text-muted",!e.phoneVerified),o(),h("bi-telephone-check-fill",e.phoneVerified)("bi-telephone-x",!e.phoneVerified),o(2),m("title","Perfil "+e.profileCompletion+"% completo"),o(),k("width",e.profileCompletion,"%"),h("bg-success",e.profileCompletion>=80)("bg-warning",e.profileCompletion>=50&&e.profileCompletion<80)("bg-danger",e.profileCompletion<50),o(4),f(e.eventsCount),o(5),f(e.certificatesCount),o(5),C("",e.profileCompletion,"%"),o(5),m("routerLink",F(51,ve,e.id)),o(2),m("routerLink",F(53,xe,e.id))}}function Qe(l,n){if(l&1&&(t(0,"div",170)(1,"div",171),y(2,He,57,55,"div",111,V().trackByUserId,!0),i()()),l&2){let e=c(2);o(2),w(e.users())}}function Ze(l,n){if(l&1&&(t(0,"div",211),s(1,"i",213),r(2),i()),l&2){let e=c().$implicit;o(2),C("",e.institution," ")}}function We(l,n){if(l&1&&(t(0,"div",214),r(1),i(),t(2,"small",110),r(3),i()),l&2){let e=c().$implicit,a=c(3);o(),f(e.documentNumber),o(2),f(a.getDocumentTypeLabel(e.documentType))}}function Je(l,n){l&1&&(t(0,"span",198),r(1,"Sin informaci\xF3n"),i())}function Ke(l,n){if(l&1&&(t(0,"div",214),r(1),i(),t(2,"small",110),s(3,"i",36),r(4),i()),l&2){let e=c().$implicit;o(),f(e.phone),o(),h("text-success",e.phoneVerified)("text-warning",!e.phoneVerified),o(),h("bi-check-circle-fill",e.phoneVerified)("bi-exclamation-circle-fill",!e.phoneVerified),o(),C(" ",e.phoneVerified?"Verificado":"Sin verificar"," ")}}function Xe(l,n){l&1&&(t(0,"span",198),r(1,"No registrado"),i())}function Ye(l,n){if(l&1&&(t(0,"span",198),r(1),i()),l&2){let e=c().$implicit;o(),f(e.lastActivity)}}function et(l,n){l&1&&(t(0,"span",198),r(1,"Nunca"),i())}function tt(l,n){if(l&1){let e=S();t(0,"tr")(1,"td",150)(2,"div",201)(3,"input",175),x("change",function(){let d=b(e).$implicit,g=c(3);return v(g.toggleSelection(d.id))}),i(),t(4,"label",176),r(5," Seleccionar usuario "),i()()(),t(6,"td",150)(7,"div",206)(8,"div",207)(9,"span",179),r(10),i()(),t(11,"div",208)(12,"div",209),r(13),i(),t(14,"div",210),r(15),i(),p(16,Ze,3,1,"div",211),i()()(),t(17,"td",156),p(18,We,4,2)(19,Je,2,0,"span",198),i(),t(20,"td",161),p(21,Ke,5,10)(22,Xe,2,0,"span",198),i(),t(23,"td",150)(24,"span",177),r(25),i()(),t(26,"td",161)(27,"span",110),r(28),i()(),t(29,"td",156)(30,"div",158)(31,"small"),s(32,"i",36),r(33),i(),t(34,"div",185),s(35,"div",186),i()()(),t(36,"td",150)(37,"span",177),r(38),i()(),t(39,"td",156)(40,"span",198),r(41),i()(),t(42,"td",161),p(43,Ye,2,1,"span",198)(44,et,2,0,"span",198),i(),t(45,"td",150)(46,"div",212)(47,"button",190),s(48,"i",191),i(),t(49,"button",192),s(50,"i",193),i()()()()}if(l&2){let e=n.$implicit,a=c(3);E(a.getTableRowClass(e)),h("table-active",a.selectedUsers().includes(e.id)),o(3),m("id","select-"+e.id)("checked",a.selectedUsers().includes(e.id)),o(),m("for","select-"+e.id),o(6),f(a.getUserInitials(e.fullName)),o(3),f(e.fullName),o(2),f(e.email),o(),u(e.institution?16:-1),o(2),u(e.documentType&&e.documentNumber?18:19),o(3),u(e.phone?21:22),o(3),E(a.getRoleBadgeClass(e.role)),o(),C(" ",a.getUserRoleLabel(e.role)," "),o(3),f(e.departmentName||"N/A"),o(3),h("text-success",e.emailVerified)("text-warning",!e.emailVerified),o(),h("bi-envelope-check-fill",e.emailVerified)("bi-envelope-exclamation-fill",!e.emailVerified),o(),C(" Email ",e.emailVerified?"verificado":"sin verificar"," "),o(),m("title","Perfil "+e.profileCompletion+"% completo"),o(),k("width",e.profileCompletion,"%"),h("bg-success",e.profileCompletion>=80)("bg-warning",e.profileCompletion>=50&&e.profileCompletion<80)("bg-danger",e.profileCompletion<50),o(2),E(a.getUserStatusBadgeClass(e)),o(),C(" ",a.getUserStatusText(e)," "),o(3),f(e.joinedDate),o(2),u(e.lastActivity?43:44),o(4),m("routerLink",F(42,ve,e.id)),o(2),m("routerLink",F(44,xe,e.id))}}function it(l,n){if(l&1){let e=S();t(0,"div",106)(1,"table",199)(2,"thead",143)(3,"tr")(4,"th",200)(5,"div",201)(6,"input",202),x("change",function(){b(e);let d=c(2);return v(d.toggleSelectAll())}),i(),t(7,"label",203),r(8," Seleccionar todos "),i()()(),t(9,"th",145),r(10,"Usuario"),i(),t(11,"th",147),r(12,"Documento"),i(),t(13,"th",148),r(14,"Tel\xE9fono"),i(),t(15,"th",145),r(16,"Rol"),i(),t(17,"th",148),r(18,"Departamento"),i(),t(19,"th",147),r(20,"Verificaci\xF3n"),i(),t(21,"th",145),r(22,"Estado"),i(),t(23,"th",147),r(24,"Registro"),i(),t(25,"th",148),r(26,"\xDAltimo acceso"),i(),t(27,"th",204),r(28,"Acciones"),i()()(),t(29,"tbody"),y(30,tt,51,46,"tr",205,V().trackByUserId,!0),i()()()}if(l&2){let e=c(2);o(6),m("checked",e.areAllSelected())("indeterminate",e.areSomeSelected()),o(24),w(e.users())}}function nt(l,n){if(l&1&&(p(0,Qe,4,0,"div",170),p(1,it,32,2,"div",106)),l&2){let e=c();u(e.viewMode()==="cards"?0:-1),o(),u(e.viewMode()==="table"?1:-1)}}function ot(l,n){if(l&1){let e=S();t(0,"div",59)(1,"app-pagination",215),x("pageChange",function(d){b(e);let g=c();return v(g.goToPage(d))})("pageSizeChange",function(d){b(e);let g=c();return v(g.onPageSizeChange(d))}),i()()}if(l&2){let e=c();o(),m("totalItems",e.totalItems())("pageSize",e.pageSize())("currentPage",e.currentPage())("showPageSizeSelector",!0)("pageSizeOptions",e.pageSizeOptions)("showGoToPage",!0)("showRangeInfo",!0)("showFirstLastButtons",!0)("maxVisiblePages",5)("density","compact")}}var ge=class l{fb=U(se);router=U(W);destroyRef=U(B);userService=U(ce);staticDataService=U(pe);confirmModal=H("confirmModal");pageSizeOptions=N.pagination.pageSizeOptions;loadingState=_("idle");loading=T(()=>this.loadingState()==="loading");error=_(null);showFilters=_(!1);viewMode=_("cards");currentPage=_(1);pageSize=_(N.pagination.defaultPageSize);totalItems=_(0);totalPages=T(()=>Math.ceil(this.totalItems()/this.pageSize()));users=_([]);departments=_([]);selectedUsers=_([]);filtersForm=this.fb.group({searchText:this.fb.control(null),role:this.fb.control(null),departmentId:this.fb.control(null),isActive:this.fb.control(null),emailVerified:this.fb.control(null),phoneVerified:this.fb.control(null),profileCompleted:this.fb.control(null),dateFrom:this.fb.control(null),dateTo:this.fb.control(null),sortBy:this.fb.control("created_at"),sortDirection:this.fb.control("desc")});userRoles=Object.values(A);documentTypes=Object.values(M);UserRole=A;DocumentType=M;confirmAction=_({title:"Confirmar Acci\xF3n",message:"\xBFEst\xE1 seguro?",confirmText:"Confirmar",callback:()=>{}});formFilters=_({searchText:null,role:null,departmentId:null,isActive:null,emailVerified:null,phoneVerified:null,profileCompleted:null,dateFrom:null,dateTo:null,sortBy:null,sortDirection:null});hasActiveFilters=T(()=>{let n=this.formFilters();return!!(n.searchText?.trim()||n.role||n.departmentId||n.isActive!==null||n.emailVerified!==null||n.phoneVerified!==null||n.profileCompleted!==null||n.dateFrom||n.dateTo)});activeFiltersCount=T(()=>{let n=this.formFilters(),e=0;return n.searchText?.trim()&&e++,n.role&&e++,n.departmentId&&e++,n.isActive!==null&&e++,n.emailVerified!==null&&e++,n.phoneVerified!==null&&e++,n.profileCompleted!==null&&e++,(n.dateFrom||n.dateTo)&&e++,e});areAllSelected=T(()=>{let n=this.users(),e=this.selectedUsers();return n.length>0&&n.every(a=>e.includes(a.id))});areSomeSelected=T(()=>{let n=this.users(),e=this.selectedUsers();return n.some(a=>e.includes(a.id))&&!this.areAllSelected()});trackByUserId=(n,e)=>e.id;trackByDepartmentCode=(n,e)=>e.code;trackByRole=(n,e)=>e;Math=Math;ngOnInit(){this.formFilters.set(this.filtersForm.value),this.loadInitialData(),this.setupSubscriptions(),this.loadViewMode()}loadInitialData(){this.staticDataService.getDepartmentsList().pipe(I(this.destroyRef)).subscribe({next:n=>{this.departments.set(n)},error:n=>console.error("Error loading departments:",n)}),this.loadUsers()}setupSubscriptions(){this.filtersForm.valueChanges.pipe(P(300),R(),I(this.destroyRef)).subscribe(n=>{this.formFilters.set(n),this.currentPage.set(1),this.loadUsers()})}loadViewMode(){let n=localStorage.getItem("user-view-mode");n&&this.viewMode.set(n)}loadUsers(){this.loadingState.set("loading"),this.error.set(null);let n=this.buildFilters();this.userService.getUsers(this.currentPage(),this.pageSize(),n,this.filtersForm.value.sortBy||"created_at",this.filtersForm.value.sortDirection||"desc").pipe(I(this.destroyRef)).subscribe({next:e=>{this.users.set(e.items),this.totalItems.set(e.pagination.totalItems),this.loadingState.set("success")},error:e=>{console.error("Error loading users:",e),this.error.set("Error al cargar los usuarios"),this.loadingState.set("error")}})}buildFilters(){let n=this.filtersForm.value,e={};return n.searchText?.trim()&&(e.search=n.searchText.trim()),n.role&&(e.role=n.role),n.departmentId&&(e.departmentId=n.departmentId),n.isActive!==null&&n.isActive!==void 0&&(e.isActive=n.isActive),n.emailVerified!==null&&n.emailVerified!==void 0&&(e.emailVerified=n.emailVerified),n.phoneVerified!==null&&n.phoneVerified!==void 0&&(e.phoneVerified=n.phoneVerified),n.profileCompleted!==null&&n.profileCompleted!==void 0&&(e.profileCompleted=n.profileCompleted),n.dateFrom&&(e.dateFrom=n.dateFrom),n.dateTo&&(e.dateTo=n.dateTo),e}toggleFiltersPanel(){this.showFilters.update(n=>!n)}clearAllFilters(){this.filtersForm.reset({sortBy:"created_at",sortDirection:"desc"}),this.selectedUsers.set([]),this.currentPage.set(1),this.formFilters.set({searchText:null,role:null,departmentId:null,isActive:null,emailVerified:null,phoneVerified:null,profileCompleted:null,dateFrom:null,dateTo:null,sortBy:"created_at",sortDirection:"desc"}),this.loadUsers()}clearSearch(){this.filtersForm.patchValue({searchText:""})}onSortChange(n){let e=n.target,[a,d]=e.value.split("|");this.filtersForm.patchValue({sortBy:a,sortDirection:d})}onPageSizeChange(n){if(typeof n=="number")this.pageSize.set(n);else{let e=n.target;this.pageSize.set(Number(e.value))}this.currentPage.set(1),this.loadUsers()}goToPage(n){n>=1&&n<=this.totalPages()&&(this.currentPage.set(n),this.loadUsers())}onPageChange(n){this.goToPage(n)}setViewMode(n){this.viewMode.set(n),localStorage.setItem("user-view-mode",n)}toggleSelection(n){this.selectedUsers.update(e=>e.indexOf(n)>=0?e.filter(d=>d!==n):[...e,n])}toggleSelectAll(){this.areAllSelected()?this.selectedUsers.set([]):this.selectedUsers.set(this.users().map(e=>e.id))}isSelected(n){return this.selectedUsers().includes(n)}getUserRoleLabel(n){return{admin:"Administrador",organizer:"Organizador",participant:"Participante"}[n]||n}getDocumentTypeLabel(n){return{DNI:"DNI",CE:"Carn\xE9 de Extranjer\xEDa",PASSPORT:"Pasaporte",RUC:"RUC"}[n]||n}getUserStatusBadgeClass(n){return n.isActive?"bg-success-subtle text-success-emphasis":"bg-danger-subtle text-danger-emphasis"}getUserStatusText(n){return n.isActive?"Activo":"Inactivo"}getRoleBadgeClass(n){return{admin:"bg-primary-subtle text-primary-emphasis",organizer:"bg-info-subtle text-info-emphasis",participant:"bg-secondary-subtle text-secondary-emphasis"}[n]||"bg-secondary-subtle text-secondary-emphasis"}getTableRowClass(n){return n.isActive?n.emailVerified?n.profileCompletion<50?"table-danger":"":"table-warning":"table-secondary"}getUserInitials(n){return n.split(" ").slice(0,2).map(e=>e.charAt(0).toUpperCase()).join("")}formatDate(n){if(!n)return"N/A";try{return new Date(n).toLocaleDateString("es-PE",{day:"2-digit",month:"2-digit",year:"numeric"})}catch{return n}}formatDateTime(n){if(!n)return"N/A";try{return new Date(n).toLocaleString("es-PE",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return n}}exportToCSV(){let n=this.generateCSVData(this.users());this.downloadCSV(n,"usuarios.csv")}exportSelectedToCSV(){let n=this.users().filter(a=>this.selectedUsers().includes(a.id)),e=this.generateCSVData(n);this.downloadCSV(e,"usuarios_seleccionados.csv")}generateCSVData(n){let a=[["ID","Nombre Completo","Email","Documento","N\xFAmero Documento","Tel\xE9fono","Instituci\xF3n","Cargo","Rol","Departamento","Estado","Email Verificado","Tel\xE9fono Verificado","Eventos Asistidos","Certificados","Fecha Registro","\xDAltimo Acceso"].join(",")];return n.forEach(d=>{let g=[d.id,`"${d.fullName}"`,d.email,d.documentType||"",d.documentNumber||"",d.phone||"",`"${d.institution||""}"`,`"${d.jobTitle||""}"`,this.getUserRoleLabel(d.role),`"${d.departmentName||""}"`,this.getUserStatusText(d),d.emailVerified?"S\xED":"No",d.phoneVerified?"S\xED":"No",d.eventsCount,d.certificatesCount,d.joinedDate,d.lastActivity||"Nunca"];a.push(g.join(","))}),a.join(`
`)}downloadCSV(n,e){let a=new Blob([n],{type:"text/csv;charset=utf-8;"}),d=document.createElement("a"),g=URL.createObjectURL(a);d.setAttribute("href",g),d.setAttribute("download",e),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d)}refreshData(){this.loadUsers()}onConfirmAccepted(){this.confirmAction().callback()}onConfirmCancelled(){}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=j({type:l,selectors:[["app-user-list"]],viewQuery:function(e,a){e&1&&$(a.confirmModal,_e,5),e&2&&G()},decls:77,vars:27,consts:[["confirmModal",""],["searchInput",""],[1,"container-fluid","py-3"],[3,"accepted","cancelled","title","message","confirmText"],["aria-label","breadcrumb",1,"mb-3"],[1,"breadcrumb","mb-0","small"],[1,"breadcrumb-item"],["routerLink","/",1,"text-decoration-none","link-primary"],[1,"bi","bi-house-door","me-1"],[1,"d-none","d-sm-inline"],["aria-current","page",1,"breadcrumb-item","active"],[1,"d-flex","flex-column","flex-md-row","align-items-start","align-items-md-center","justify-content-between","gap-3","mb-4"],[1,"order-1","order-md-0"],[1,"h6","mb-1","fw-normal","d-flex","align-items-center"],[1,"bi","bi-people","me-2","text-primary"],[1,"small"],[1,"badge","text-bg-primary","ms-2","small"],[1,"text-muted","small","mb-0"],[1,"d-flex","flex-wrap","gap-2","order-0","order-md-1"],["type","button","title","Actualizar datos",1,"btn","btn-outline-secondary","btn-sm","d-flex","align-items-center",3,"click","disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-1"],[1,"bi","bi-arrow-clockwise","me-1"],[1,"d-none","d-sm-inline","small"],["routerLink","/usuarios/nuevo","title","Crear nuevo usuario",1,"btn","btn-primary","btn-sm","d-flex","align-items-center"],[1,"bi","bi-plus-circle","me-1"],["role","group",1,"btn-group"],[1,"card","border-0","shadow-sm","mb-4"],[1,"card-header","bg-light","border-bottom","py-2"],[1,"d-flex","align-items-center","justify-content-between"],[1,"d-flex","align-items-center","gap-2"],[1,"d-flex","align-items-center","gap-1"],[1,"bi","bi-funnel","text-primary"],[1,"mb-0","fw-normal","small"],[1,"badge","text-bg-primary","rounded-pill","small"],["role","group",1,"btn-group","btn-group-sm"],["type","button",1,"btn","btn-outline-secondary","border-0","btn-sm",3,"click","title"],[1,"bi"],["type","button","title","Limpiar todos los filtros",1,"btn","btn-outline-danger","border-0","btn-sm"],[1,"card-body","py-3"],[1,"card","border-0","shadow-sm"],[1,"d-flex","align-items-center","gap-2","flex-grow-1","overflow-hidden"],[1,"bi","bi-list-ul","text-primary"],[1,"badge","text-bg-info","small"],[1,"badge","text-bg-primary","small"],[1,"d-flex","align-items-center","gap-1","ms-auto","me-2"],[1,"form-label","mb-0","text-muted","small","d-none","d-md-inline"],[1,"form-select","form-select-sm","small",2,"width","auto","min-width","70px",3,"change","value"],[3,"value",4,"ngFor","ngForOf","ngForTrackBy"],["role","group","aria-label","Modo de vista",1,"btn-group","btn-group-sm","flex-shrink-0"],["type","radio","name","viewMode","id","cardsView","autocomplete","off",1,"btn-check",3,"change","checked"],["for","cardsView","title","Vista tarjetas",1,"btn","btn-outline-primary","btn-sm","px-2"],[1,"bi","bi-grid-3x3-gap"],[1,"d-none","d-xl-inline","ms-1","small"],["type","radio","name","viewMode","id","tableView","autocomplete","off",1,"btn-check",3,"change","checked"],["for","tableView","title","Vista tabla",1,"btn","btn-outline-primary","btn-sm","px-2"],[1,"bi","bi-table"],[1,"card-body","p-0"],[1,"p-3"],[1,"text-center","py-5"],[1,"card-footer","bg-light","border-top","py-2"],["type","button","data-bs-toggle","dropdown","aria-expanded","false","title","Opciones de exportaci\xF3n",1,"btn","btn-success","btn-sm","dropdown-toggle","d-flex","align-items-center"],[1,"bi","bi-download","me-1"],[1,"dropdown-menu"],["type","button",1,"dropdown-item",3,"click"],[1,"bi","bi-file-earmark-spreadsheet","me-2"],[1,"bi","bi-file-earmark-check","me-2"],["type","button","title","Limpiar todos los filtros",1,"btn","btn-outline-danger","border-0","btn-sm",3,"click"],[1,"bi","bi-x-circle"],[3,"formGroup"],[1,"row","g-2"],[1,"col-12","col-md-6","col-lg-4","col-xl-3"],[1,"form-label","fw-normal","small","mb-1"],[1,"input-group","input-group-sm"],[1,"input-group-text","bg-light","border-end-0"],[1,"bi","bi-search","text-muted"],["type","text","placeholder","Nombre, email, documento...","formControlName","searchText",1,"form-control","border-start-0","bg-light","form-control-sm"],["type","button","title","Limpiar b\xFAsqueda",1,"btn","btn-outline-secondary","border-start-0","btn-sm"],[1,"col-6","col-md-3","col-lg-2","col-xl-2"],["formControlName","role",1,"form-select","bg-light","form-select-sm"],[3,"value"],[1,"col-6","col-md-3","col-lg-3","col-xl-2"],["formControlName","departmentId",1,"form-select","bg-light","form-select-sm"],["formControlName","isActive",1,"form-select","bg-light","form-select-sm"],[1,"col-6","col-md-3","col-lg-2","col-xl-1"],["formControlName","emailVerified","title","Email verificado",1,"form-select","bg-light","form-select-sm"],["formControlName","phoneVerified","title","Tel\xE9fono verificado",1,"form-select","bg-light","form-select-sm"],["type","date","formControlName","dateFrom",1,"form-control","bg-light","form-control-sm"],["type","date","formControlName","dateTo",1,"form-control","bg-light","form-control-sm"],[1,"col-12"],[1,"d-flex","flex-wrap","gap-2","mt-1"],[1,"form-check","form-check-sm"],["type","checkbox","id","profileCompleted","formControlName","profileCompleted",1,"form-check-input","form-check-input-sm",3,"value"],["for","profileCompleted",1,"form-check-label","small"],[1,"col-12","col-md-6","col-lg-3"],[1,"d-flex","gap-2"],["formControlName","sortBy",1,"form-select","bg-light","form-select-sm"],["value","created_at"],["value","full_name"],["value","last_login"],["value","events_attended"],["formControlName","sortDirection",1,"form-select","bg-light","form-select-sm",2,"width","auto","min-width","100px"],["value","desc"],["value","asc"],["type","button","title","Limpiar b\xFAsqueda",1,"btn","btn-outline-secondary","border-start-0","btn-sm",3,"click"],[1,"bi","bi-x"],[1,"row","row-cols-1","row-cols-sm-2","row-cols-md-3","row-cols-lg-4","row-cols-xl-5","g-3"],[1,"table-responsive"],[1,"text-center","mt-4"],["role","status",1,"spinner-border","text-primary","me-2",2,"width","1.25rem","height","1.25rem"],[1,"visually-hidden"],[1,"text-muted"],[1,"col"],[1,"card","h-100","border-0","shadow-sm"],[1,"card-header","bg-light","py-2"],[1,"d-flex","justify-content-between","align-items-center"],[1,"placeholder","col-2","bg-secondary","rounded",2,"height","16px"],[1,"d-flex","gap-1"],[1,"placeholder","bg-success","rounded-pill",2,"width","60px","height","18px"],[1,"placeholder","bg-info","rounded-pill",2,"width","50px","height","18px"],[1,"d-flex","align-items-start","gap-3","mb-3"],[1,"placeholder","text-bg-primary","rounded-circle","flex-shrink-0",2,"width","40px","height","40px"],[1,"flex-grow-1"],[1,"placeholder-glow"],[1,"placeholder","col-8","mb-1","fw-bold",2,"height","18px"],[1,"placeholder","col-10"],[1,"placeholder-glow","mb-3"],[1,"d-flex","align-items-center","gap-2","mb-2"],[1,"placeholder","bg-primary","rounded-circle",2,"width","16px","height","16px"],[1,"placeholder","col-6"],[1,"placeholder","bg-secondary","rounded-circle",2,"width","16px","height","16px"],[1,"placeholder","col-4"],[1,"placeholder","bg-info","rounded-circle",2,"width","16px","height","16px"],[1,"placeholder","col-8"],[1,"mb-3"],[1,"d-flex","justify-content-between","align-items-center","mb-1"],[1,"placeholder","col-5"],[1,"placeholder","col-3"],[1,"progress",2,"height","4px"],[1,"placeholder","bg-success","w-75",2,"height","4px"],[1,"card-footer","bg-transparent","py-2"],[1,"d-flex","gap-1","justify-content-end"],[1,"placeholder","bg-secondary","rounded",2,"width","32px","height","28px"],[1,"table","table-hover","mb-0","table-sm"],[1,"table-light"],["scope","col",1,"border-0",2,"width","40px"],["scope","col",1,"fw-semibold","border-0"],["scope","col",1,"fw-semibold","border-0","d-none","d-md-table-cell"],["scope","col",1,"fw-semibold","border-0","d-none","d-lg-table-cell"],["scope","col",1,"fw-semibold","border-0","d-none","d-xl-table-cell"],["scope","col",1,"fw-semibold","border-0",2,"width","120px"],[1,"border-0"],[1,"placeholder","bg-secondary","rounded",2,"width","16px","height","16px"],[1,"placeholder","text-bg-primary","rounded-circle",2,"width","32px","height","32px"],[1,"placeholder","col-8","mb-1","fw-bold"],[1,"border-0","d-none","d-md-table-cell"],[1,"placeholder","bg-primary","rounded-pill",2,"width","80px","height","20px"],[1,"border-0","d-none","d-lg-table-cell"],[1,"placeholder","col-9"],[1,"d-flex","flex-column","gap-1"],[1,"placeholder","bg-success","rounded-pill",2,"width","70px","height","18px"],[1,"placeholder","bg-info","rounded-pill",2,"width","60px","height","16px"],[1,"border-0","d-none","d-xl-table-cell"],[1,"placeholder","bg-warning","w-50",2,"height","4px"],[1,"text-muted","mb-4"],[1,"bi","bi-people","display-1","opacity-25"],[1,"text-muted","mb-2"],[1,"btn","btn-outline-primary",3,"click"],[1,"bi","bi-funnel","me-2"],["routerLink","/usuarios/nuevo",1,"btn","btn-primary"],[1,"bi","bi-plus-circle","me-2"],[1,"p-3","p-md-4"],[1,"row","row-cols-1","row-cols-sm-2","row-cols-md-3","row-cols-lg-4","row-cols-xl-5","row-cols-xxl-6","g-3"],[1,"card","h-100","border-0","shadow-sm","position-relative"],[1,"card-header","bg-light","border-bottom-0","py-2","d-flex","align-items-center","justify-content-between"],[1,"form-check","mb-0"],["type","checkbox",1,"form-check-input",3,"change","id","checked"],[1,"form-check-label","visually-hidden",3,"for"],[1,"badge","rounded-pill"],[1,"avatar","text-bg-primary","rounded-circle","d-flex","align-items-center","justify-content-center","flex-shrink-0",2,"width","40px","height","40px"],[1,"fw-bold","small"],[1,"flex-grow-1","overflow-hidden"],[1,"card-title","mb-1","text-truncate","fw-semibold"],[1,"text-muted","small","mb-0","text-truncate"],[1,"badge"],[1,"d-flex","align-items-center","gap-3","small"],[1,"progress",2,"height","4px",3,"title"],["role","progressbar",1,"progress-bar"],[1,"d-flex","justify-content-between","text-center","small","text-muted"],[1,"fw-semibold"],[1,"card-footer","bg-transparent","border-top","py-2"],["title","Ver detalles",1,"btn","btn-outline-info","btn-sm",3,"routerLink"],[1,"bi","bi-eye"],["title","Editar",1,"btn","btn-outline-primary","btn-sm",3,"routerLink"],[1,"bi","bi-pencil"],[1,"bi","bi-building","text-muted","small"],[1,"text-muted","small","text-truncate",3,"title"],[1,"bi","bi-briefcase","text-muted","small"],[1,"bi","bi-geo-alt","text-muted","small"],[1,"text-muted","small"],[1,"table","table-hover","mb-0"],["scope","col",1,"border-0",2,"width","50px"],[1,"form-check"],["type","checkbox","id","selectAll",1,"form-check-input",3,"change","checked","indeterminate"],["for","selectAll",1,"form-check-label","visually-hidden"],["scope","col",1,"fw-semibold","border-0",2,"width","140px"],[3,"table-active","class"],[1,"d-flex","align-items-center","gap-3"],[1,"avatar","text-bg-primary","rounded-circle","d-flex","align-items-center","justify-content-center","flex-shrink-0",2,"width","36px","height","36px"],[1,"overflow-hidden"],[1,"fw-medium","text-truncate"],[1,"text-muted","small","text-truncate"],[1,"text-muted","small","d-none","d-xl-block","text-truncate"],[1,"btn-group","btn-group-sm"],[1,"bi","bi-building","me-1"],[1,"fw-medium","text-nowrap"],["containerClass","justify-content-between align-items-center",1,"mb-0",3,"pageChange","pageSizeChange","totalItems","pageSize","currentPage","showPageSizeSelector","pageSizeOptions","showGoToPage","showRangeInfo","showFirstLastButtons","maxVisiblePages","density"]],template:function(e,a){if(e&1){let d=S();t(0,"div",2)(1,"app-confirm-modal",3,0),x("accepted",function(){return b(d),v(a.onConfirmAccepted())})("cancelled",function(){return b(d),v(a.onConfirmCancelled())}),i(),t(3,"nav",4)(4,"ol",5)(5,"li",6)(6,"a",7),s(7,"i",8),t(8,"span",9),r(9,"Inicio"),i()()(),t(10,"li",10),r(11,"Usuarios"),i()()(),t(12,"div",11)(13,"div",12)(14,"h1",13),s(15,"i",14),t(16,"span",15),r(17,"Gesti\xF3n de Usuarios"),i(),p(18,Ce,2,1,"span",16),i(),t(19,"p",17),r(20,"Administra los usuarios del sistema"),i()(),t(21,"div",18)(22,"button",19),x("click",function(){return b(d),v(a.refreshData())}),p(23,Se,1,0,"span",20)(24,ye,1,0,"i",21),t(25,"span",22),r(26,"Actualizar"),i()(),t(27,"button",23),s(28,"i",24),t(29,"span",15),r(30,"Nuevo"),i()(),p(31,Ee,12,1,"div",25),i()(),t(32,"div",26)(33,"div",27)(34,"div",28)(35,"div",29)(36,"div",30),s(37,"i",31),t(38,"h6",32),r(39,"Filtros"),i()(),p(40,Te,2,1,"span",33),i(),t(41,"div",34)(42,"button",35),x("click",function(){return b(d),v(a.toggleFiltersPanel())}),s(43,"i",36),i(),p(44,Ue,2,0,"button",37),i()()(),p(45,Le,92,14,"div",38),i(),t(46,"div",39)(47,"div",27)(48,"div",28)(49,"div",40)(50,"div",30),s(51,"i",41),t(52,"h6",32),r(53,"Usuarios"),i()(),p(54,ke,2,1,"span",42),p(55,De,2,1,"span",43),t(56,"div",44)(57,"label",45),r(58,"Mostrar:"),i(),t(59,"select",46),x("change",function(he){return b(d),v(a.onPageSizeChange(he))}),z(60,Ae,2,2,"option",47),i()()(),t(61,"div",48)(62,"input",49),x("change",function(){return b(d),v(a.setViewMode("cards"))}),i(),t(63,"label",50),s(64,"i",51),t(65,"span",52),r(66,"Tarjetas"),i()(),t(67,"input",53),x("change",function(){return b(d),v(a.setViewMode("table"))}),i(),t(68,"label",54),s(69,"i",55),t(70,"span",52),r(71,"Tabla"),i()()()()(),t(72,"div",56),p(73,Be,9,1,"div",57)(74,Oe,5,1,"div",58)(75,nt,2,2),i(),p(76,ot,2,10,"div",59),i()()}e&2&&(o(),m("title",a.confirmAction().title)("message",a.confirmAction().message)("confirmText",a.confirmAction().confirmText),o(17),u(a.totalItems()>0?18:-1),o(4),m("disabled",a.loading()),o(),u(a.loading()?23:24),o(8),u(a.users().length>0?31:-1),o(),h("border-primary",a.hasActiveFilters()),o(8),u(a.hasActiveFilters()?40:-1),o(2),m("title",a.showFilters()?"Ocultar filtros":"Mostrar filtros"),O("aria-expanded",a.showFilters()),o(),h("bi-chevron-up",a.showFilters())("bi-chevron-down",!a.showFilters()),o(),u(a.hasActiveFilters()?44:-1),o(),u(a.showFilters()?45:-1),o(9),u(a.totalItems()>0?54:-1),o(),u(a.selectedUsers().length>0?55:-1),o(4),m("value",a.pageSize()),o(),m("ngForOf",a.pageSizeOptions)("ngForTrackBy",a.trackByUserId),o(2),m("checked",a.viewMode()==="cards"),o(5),m("checked",a.viewMode()==="table"),o(6),u(a.loading()?73:a.users().length===0?74:75),o(3),u(a.totalPages()>1?76:-1))},dependencies:[Z,Q,K,J,me,ie,re,ae,Y,X,le,ee,te,ne,oe,de,ue,fe],encapsulation:2,changeDetection:0})};export{ge as UserListComponent};

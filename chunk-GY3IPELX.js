import{b as R}from"./chunk-PZ46FPEX.js";import{A as l,I as p,M as S,O as v,S as u,V as y,Z as T,g as o,k as s,l as c,p as g,q as i,r as d,w as f}from"./chunk-DCXCOY7M.js";import{a as m,b as h}from"./chunk-FK42CRUA.js";function C(n,t){return t[n.toString()]||null}function D(n,t){return t[n.toString()]||null}function E(n,t){return t[n.toString()]||null}function O(n,t){return t[n.toString()]||null}function j(n,t){return Object.values(t).filter(e=>e.region===n)}function b(n,t){let e={valid:!0,errors:[],warnings:[],dataType:t};if(!n||typeof n!="object")return e.valid=!1,e.errors.push("Datos no v\xE1lidos o no encontrados"),e;switch(t){case"departments":Object.entries(n).forEach(([a,r])=>{(!r.code||!r.name||!r.region)&&e.errors.push(`Departamento ${a}: faltan campos requeridos`)});break;case"eventTypes":Object.entries(n).forEach(([a,r])=>{(!r.name||!r.durationDefaultHours)&&e.errors.push(`Tipo de evento ${a}: faltan campos requeridos`)});break;case"participantRoles":Object.entries(n).forEach(([a,r])=>{(!r.name||!r.certificateTitle)&&e.errors.push(`Rol ${a}: faltan campos requeridos`)});break;case"certificateTemplates":Object.entries(n).forEach(([a,r])=>{(!r.name||!r.templateUrl||!r.eventTypeId)&&e.errors.push(`Plantilla ${a}: faltan campos requeridos`)});break}return e.errors.length>0&&(e.valid=!1),e}var x=class n{constructor(t){this.http=t;this.config=m({},this.DEFAULT_CONFIG),this.startCacheCleanupTimer(),this.initialize().subscribe({next:e=>{},error:e=>{console.error("\u274C Error inicializando StaticDataService:",e)}})}DEFAULT_CONFIG={baseUrl:"/data",enableCache:!0,cacheExpiry:60,fallbackEnabled:!0};RETRY_CONFIG={maxRetries:3,retryDelay:1e3,timeoutMs:1e4};CACHE_CLEANUP_INTERVAL=30*60*1e3;config;cache={departments:null,eventTypes:null,participantRoles:null,certificateTemplates:null,systemSettings:null,registrationStates:null,lastUpdated:{}};cacheStats={hits:0,misses:0,size:0,hitRate:0,lastCleanup:new Date};departmentsSubject=new o(null);eventTypesSubject=new o(null);participantRolesSubject=new o(null);certificateTemplatesSubject=new o(null);systemSettingsSubject=new o(null);registrationStatesSubject=new o(null);loadingStateSubject=new o({departments:!1,eventTypes:!1,participantRoles:!1,certificateTemplates:!1,systemSettings:!1,registrationStates:!1});isInitializedSubject=new o(!1);departments$=this.departmentsSubject.asObservable();eventTypes$=this.eventTypesSubject.asObservable();participantRoles$=this.participantRolesSubject.asObservable();certificateTemplates$=this.certificateTemplatesSubject.asObservable();systemSettings$=this.systemSettingsSubject.asObservable();registrationStates$=this.registrationStatesSubject.asObservable();loadingState$=this.loadingStateSubject.asObservable();isInitialized$=this.isInitializedSubject.asObservable();initialize(t){return t&&(this.config=m(m({},this.config),t)),this.loadAllStaticData().pipe(i(()=>(this.isInitializedSubject.next(!0),!0)),l(e=>(console.error("Error inicializando StaticDataService:",e),this.isInitializedSubject.next(!1),s(!1))))}loadAllStaticData(){let t=[this.loadDepartments(),this.loadEventTypes(),this.loadParticipantRoles(),this.loadCertificateTemplates(),this.loadSystemSettings(),this.loadRegistrationStates()];return f(t)}loadDepartments(t=!1){return!t&&this.isCacheValid("departments")?(this.cacheStats.hits++,s(this.cache.departments)):(this.setLoadingState("departments",!0),this.cacheStats.misses++,this.loadJsonFile("departments.json").pipe(i(e=>{if(!e||typeof e!="object")throw new Error("Datos de departamentos inv\xE1lidos: formato incorrecto");return this.cache.departments=e,this.cache.lastUpdated.departments=new Date,this.departmentsSubject.next(e),this.updateCacheStats(),e}),l(e=>(console.error("Error cargando departamentos:",e),this.config.fallbackEnabled?this.getFallbackDepartments():c(()=>e))),p(()=>this.setLoadingState("departments",!1))))}loadEventTypes(t=!1){return!t&&this.isCacheValid("eventTypes")?(this.cacheStats.hits++,s(this.cache.eventTypes)):(this.setLoadingState("eventTypes",!0),this.cacheStats.misses++,this.loadJsonFile("event_types.json").pipe(i(e=>{let a=b(e,"eventTypes");if(!a.valid)throw new Error(`Datos de tipos de eventos inv\xE1lidos: ${a.errors.join(", ")}`);return this.cache.eventTypes=e,this.cache.lastUpdated.eventTypes=new Date,this.eventTypesSubject.next(e),this.updateCacheStats(),e}),l(e=>(console.error("Error cargando tipos de eventos:",e),this.config.fallbackEnabled?this.getFallbackEventTypes():c(()=>e))),p(()=>this.setLoadingState("eventTypes",!1))))}loadParticipantRoles(t=!1){return!t&&this.isCacheValid("participantRoles")?(this.cacheStats.hits++,s(this.cache.participantRoles)):(this.setLoadingState("participantRoles",!0),this.cacheStats.misses++,this.loadJsonFile("participant_roles.json").pipe(i(e=>{let a=b(e,"participantRoles");if(!a.valid)throw new Error(`Datos de roles inv\xE1lidos: ${a.errors.join(", ")}`);return this.cache.participantRoles=e,this.cache.lastUpdated.participantRoles=new Date,this.participantRolesSubject.next(e),this.updateCacheStats(),e}),l(e=>(console.error("Error cargando roles de participantes:",e),this.config.fallbackEnabled?this.getFallbackParticipantRoles():c(()=>e))),p(()=>this.setLoadingState("participantRoles",!1))))}loadCertificateTemplates(t=!1){return!t&&this.isCacheValid("certificateTemplates")?(this.cacheStats.hits++,s(this.cache.certificateTemplates)):(this.setLoadingState("certificateTemplates",!0),this.cacheStats.misses++,this.loadJsonFile("certificate_templates.json").pipe(i(e=>{let a=b(e,"certificateTemplates");if(!a.valid)throw new Error(`Datos de plantillas inv\xE1lidos: ${a.errors.join(", ")}`);return this.cache.certificateTemplates=e,this.cache.lastUpdated.certificateTemplates=new Date,this.certificateTemplatesSubject.next(e),this.updateCacheStats(),e}),l(e=>(console.error("Error cargando plantillas de certificados:",e),this.config.fallbackEnabled?this.getFallbackCertificateTemplates():c(()=>e))),p(()=>this.setLoadingState("certificateTemplates",!1))))}loadSystemSettings(t=!1){return!t&&this.isCacheValid("systemSettings")?(this.cacheStats.hits++,s(this.cache.systemSettings)):(this.setLoadingState("systemSettings",!0),this.cacheStats.misses++,this.loadJsonFile("system_settings.json").pipe(i(e=>(this.cache.systemSettings=e,this.cache.lastUpdated.systemSettings=new Date,this.systemSettingsSubject.next(e),this.updateCacheStats(),e)),l(e=>(console.error("Error cargando configuraci\xF3n del sistema:",e),this.config.fallbackEnabled?this.getFallbackSystemSettings():c(()=>e))),p(()=>this.setLoadingState("systemSettings",!1))))}loadRegistrationStates(t=!1){return!t&&this.isCacheValid("registrationStates")?(this.cacheStats.hits++,s(this.cache.registrationStates)):(this.setLoadingState("registrationStates",!0),this.cacheStats.misses++,this.loadJsonFile("registration_states.json").pipe(i(e=>(this.cache.registrationStates=e,this.cache.lastUpdated.registrationStates=new Date,this.registrationStatesSubject.next(e),this.updateCacheStats(),e)),l(e=>(console.error("Error cargando estados de inscripci\xF3n:",e),this.config.fallbackEnabled?this.getFallbackRegistrationStates():c(()=>e))),p(()=>this.setLoadingState("registrationStates",!1))))}getDepartment(t){return this.departments$.pipe(i(e=>e?C(t,e):null))}getDepartmentsByRegion(t){return this.departments$.pipe(i(e=>e?j(t,e):[]))}getDepartmentsList(){return this.cache.departments?this.departments$.pipe(i(t=>t?Object.values(t):[])):this.loadDepartments().pipe(i(t=>Object.values(t)))}getEventType(t){return this.eventTypes$.pipe(i(e=>e?D(t,e):null))}getEventTypesList(){return this.eventTypes$.pipe(i(t=>t?Object.values(t):[]))}getParticipantRole(t){return this.participantRoles$.pipe(i(e=>e?E(t,e):null))}getParticipantRolesList(){return this.participantRoles$.pipe(i(t=>t?Object.values(t):[]))}getCertificateTemplate(t){return this.certificateTemplates$.pipe(i(e=>e?O(t,e):null))}getCertificateTemplatesList(){return this.certificateTemplates$.pipe(i(t=>t?Object.values(t):[]))}getSystemSettings(){return this.systemSettings$}getRegistrationStates(){return this.registrationStates$}getRegistrationStatesArray(){return this.registrationStates$.pipe(i(t=>t?Object.values(t).filter(e=>e.isActive).sort((e,a)=>e.sortOrder-a.sortOrder):[]))}getRegistrationState(t){return this.registrationStates$.pipe(i(e=>e&&e[t.toString()]||null))}searchDepartments(t){return this.departments$.pipe(i(e=>{if(!e||!t.trim())return[];let a=t.toLowerCase().trim();return Object.values(e).filter(r=>r.name.toLowerCase().includes(a)||r.code.toLowerCase().includes(a))}))}searchEventTypes(t){return this.eventTypes$.pipe(i(e=>{if(!e||!t.trim())return[];let a=t.toLowerCase().trim();return Object.values(e).filter(r=>r.name.toLowerCase().includes(a)||r.description.toLowerCase().includes(a))}))}getEventTypesByDuration(t,e){return this.eventTypes$.pipe(i(a=>a?Object.values(a).filter(r=>!(t!==void 0&&r.durationDefaultHours<t||e!==void 0&&r.durationDefaultHours>e)):[]))}getCertificateTemplatesByEventType(t){return d([this.eventTypes$,this.certificateTemplates$]).pipe(i(([e,a])=>!e||!a?[]:e[t.toString()]?Object.values(a):[]))}refreshAll(){return this.clearCache(),this.loadAllStaticData().pipe(i(()=>!0),l(()=>s(!1)))}clearCache(){this.cache={departments:null,eventTypes:null,participantRoles:null,certificateTemplates:null,systemSettings:null,registrationStates:null,lastUpdated:{}},this.cacheStats={hits:0,misses:0,size:0,hitRate:0,lastCleanup:new Date},this.departmentsSubject.next(null),this.eventTypesSubject.next(null),this.participantRolesSubject.next(null),this.certificateTemplatesSubject.next(null),this.systemSettingsSubject.next(null),this.registrationStatesSubject.next(null)}getCacheStats(){return m({},this.cacheStats)}isDataAvailable(){return d([this.departments$,this.eventTypes$,this.participantRoles$,this.certificateTemplates$]).pipe(i(([t,e,a,r])=>!!(t&&e&&a&&r)))}loadJsonFile(t){let e=`${this.config.baseUrl}/${t}`;return this.http.get(e).pipe(g(this.RETRY_CONFIG.timeoutMs),S({count:this.RETRY_CONFIG.maxRetries,delay:this.RETRY_CONFIG.retryDelay}),v(1))}isCacheValid(t){if(!this.config.enableCache||!this.cache[t]||!this.cache.lastUpdated[t])return!1;let e=this.config.cacheExpiry*60*1e3;return Date.now()-this.cache.lastUpdated[t].getTime()<e}setLoadingState(t,e){let a=this.loadingStateSubject.value;this.loadingStateSubject.next(h(m({},a),{[t]:e}))}updateCacheStats(){let t=this.cacheStats.hits+this.cacheStats.misses;this.cacheStats.hitRate=t>0?this.cacheStats.hits/t*100:0;let e=0;Object.values(this.cache).forEach(a=>{a&&typeof a=="object"&&(e+=JSON.stringify(a).length)}),this.cacheStats.size=e}startCacheCleanupTimer(){setInterval(()=>{this.cleanupExpiredCache()},this.CACHE_CLEANUP_INTERVAL)}cleanupExpiredCache(){["departments","eventTypes","participantRoles","certificateTemplates","systemSettings"].forEach(e=>{this.isCacheValid(e)||(this.cache[e]=null,delete this.cache.lastUpdated[e])}),this.cacheStats.lastCleanup=new Date}getFallbackDepartments(){return s({15:{code:"15",name:"Lima",region:"centro",capital:"Lima",timezone:"America/Lima",ubigeoPrefix:"15"},7:{code:"07",name:"Callao",region:"centro",capital:"Callao",timezone:"America/Lima",ubigeoPrefix:"07"}}).pipe(u(e=>{this.cache.departments=e,this.cache.lastUpdated.departments=new Date,this.departmentsSubject.next(e)}))}getFallbackEventTypes(){return s({1:{name:"Conferencia",description:"Presentaci\xF3n formal ante una audiencia",durationDefaultHours:8,templateUrlDefault:"/template/conferencia-default.json",minAttendancePercentage:80,typicalCapacity:100,icon:"conference",color:"#2563eb"},2:{name:"Taller",description:"Actividad pr\xE1ctica y participativa",durationDefaultHours:4,templateUrlDefault:"/template/taller-default.json",minAttendancePercentage:90,typicalCapacity:30,icon:"workshop",color:"#dc2626"}}).pipe(u(e=>{this.cache.eventTypes=e,this.cache.lastUpdated.eventTypes=new Date,this.eventTypesSubject.next(e)}))}getFallbackParticipantRoles(){return s({1:{name:"Participante",description:"Asistente regular al evento",certificateTitle:"Certificado de Participaci\xF3n",certificateTextTemplate:"Por su participaci\xF3n en el evento {{eventTitle}}",templateId:1,sortOrder:1,isDefault:!0,icon:"user",color:"#059669"},2:{name:"Ponente",description:"Expositor o presentador",certificateTitle:"Certificado de Ponencia",certificateTextTemplate:"Por su participaci\xF3n como ponente en {{eventTitle}}",templateId:2,sortOrder:2,isDefault:!1,icon:"microphone",color:"#7c3aed"}}).pipe(u(e=>{this.cache.participantRoles=e,this.cache.lastUpdated.participantRoles=new Date,this.participantRolesSubject.next(e)}))}getFallbackCertificateTemplates(){return s({1:{name:"Plantilla Est\xE1ndar",description:"Plantilla b\xE1sica para certificados de participaci\xF3n",templateUrl:"/template/participacion.json",eventTypeId:1},2:{name:"Plantilla Ponencia",description:"Plantilla para certificados de ponentes",templateUrl:"/template/ponencia.json",eventTypeId:2}}).pipe(u(e=>{this.cache.certificateTemplates=e,this.cache.lastUpdated.certificateTemplates=new Date,this.certificateTemplatesSubject.next(e)}))}getFallbackSystemSettings(){return s({organizationName:"Gesti\xF3n de Eventos Per\xFA",organizationLogo:"/assets/images/logo.png",organizationUrl:"https://gestion-eventos.pe",contactEmail:"contacto@gestion-eventos.pe",supportEmail:"soporte@gestion-eventos.pe",certificateSettings:{defaultTemplateId:1,verificationBaseUrl:"https://gestion-eventos.pe/verify",downloadEnabled:!0,expirationDays:365,watermarkEnabled:!0,qrCodeEnabled:!0},paymentSettings:{enabled:!0,currency:"PEN",taxPercentage:18,paymentMethods:{culqi:{enabled:!0,publicKey:"pk_test_example"},yape:{enabled:!0,phoneNumber:"+51987654321"},transfer:{enabled:!0,bankAccounts:[]}}},notificationSettings:{email:{enabled:!0,templates:{registration:"registration_template",confirmation:"confirmation_template",reminder:"reminder_template",certificate:"certificate_template"}},sms:{enabled:!1,provider:"twilio"},push:{enabled:!0}},uiSettings:{theme:"light",primaryColor:"#2563eb",secondaryColor:"#64748b",logoUrl:"/assets/images/logo.png",faviconUrl:"/assets/images/favicon.ico",showPoweredBy:!0},limits:{maxEventsPerOrganizer:50,maxParticipantsPerEvent:1e3,maxFileUploadSize:10,certificateRetentionDays:365},security:{requireEmailVerification:!0,requirePhoneVerification:!1,maxLoginAttempts:5,sessionTimeout:480,passwordMinLength:8}}).pipe(u(e=>{this.cache.systemSettings=e,this.cache.lastUpdated.systemSettings=new Date,this.systemSettingsSubject.next(e)}))}getFallbackRegistrationStates(){return s({1:{stateKey:"draft",displayName:"Borrador",description:"Registro iniciado pero no completado",sortOrder:1,color:"#6b7280",icon:"fas fa-edit",isActive:!0},2:{stateKey:"pending_validation",displayName:"Pendiente Validaci\xF3n",description:"Esperando validaci\xF3n de datos",sortOrder:2,color:"#f59e0b",icon:"fas fa-clock",isActive:!0},3:{stateKey:"confirmed",displayName:"Confirmado",description:"Inscripci\xF3n confirmada y v\xE1lida",sortOrder:3,color:"#10b981",icon:"fas fa-check-circle",isActive:!0}}).pipe(u(e=>{this.cache.registrationStates=e,this.cache.lastUpdated.registrationStates=new Date,this.registrationStatesSubject.next(e)}))}static \u0275fac=function(e){return new(e||n)(T(R))};static \u0275prov=y({token:n,factory:n.\u0275fac,providedIn:"root"})};export{x as a};

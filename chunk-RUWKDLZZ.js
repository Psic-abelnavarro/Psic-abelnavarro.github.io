import{c as L,d as _,e as $,f as q,h as B,k as z,l as H,m as Z,n as J,o as K,r as Q,s as W,t as X,u as Y}from"./chunk-GFCFUV6K.js";import{b as ee}from"./chunk-PJLGVUHH.js";import{a as te}from"./chunk-MXHSEERB.js";import"./chunk-MPC7SZEK.js";import{c as I,d as y}from"./chunk-CF2QCA26.js";import{f as M,h as O,i as A,l as G}from"./chunk-NUA5R5QO.js";import{Ac as P,Cb as v,Da as o,Fb as a,Gb as T,Ha as x,Hb as p,Ib as U,Na as F,Q as C,R as h,Ra as c,Tb as N,Ub as D,Wb as k,da as f,ea as b,f as S,gb as d,hb as r,ib as i,jb as s,qb as E,rb as g,sc as w,tb as m,tc as j,uc as R,xc as V}from"./chunk-6O7NOF42.js";import"./chunk-LJ5XHLMQ.js";import"./chunk-FK42CRUA.js";var ne=(n,t,e)=>({"bg-danger":n,"bg-warning":t,"bg-info":e});function re(n,t){if(n&1&&(r(0,"p",51),a(1),i()),n&2){let e=m(2);o(),U("",e.user.fullName," - ",e.user.email)}}function oe(n,t){n&1&&(r(0,"div",52),s(1,"i",53),r(2,"div"),a(3," Usuario actualizado exitosamente. Redirigiendo... "),i()())}function ae(n,t){if(n&1&&(r(0,"div",54),s(1,"i",55),r(2,"div"),a(3),i()()),n&2){let e=m(2);o(3),T(e.error)}}function le(n,t){if(n&1&&(r(0,"div",56),a(1),i()),n&2){let e=m(2);o(),p(" ",e.getFieldError("fullName")," ")}}function de(n,t){if(n&1&&(r(0,"option",57),a(1),i()),n&2){let e=t.$implicit,l=m(2);d("value",e),o(),p(" ",l.getDocumentTypeLabel(e)," ")}}function se(n,t){if(n&1&&(r(0,"div",56),a(1),i()),n&2){let e=m(2);o(),p(" ",e.getFieldError("documentType")," ")}}function me(n,t){if(n&1&&(r(0,"div",56),a(1),i()),n&2){let e=m(2);o(),p(" ",e.getFieldError("documentNumber")," ")}}function ce(n,t){if(n&1&&(r(0,"div",56),a(1),i()),n&2){let e=m(2);o(),p(" ",e.getFieldError("phone")," ")}}function pe(n,t){if(n&1&&(r(0,"option",57),a(1),i()),n&2){let e=t.$implicit,l=t.index;d("value",l+1),o(),p(" ",e.name," ")}}function ue(n,t){if(n&1&&(r(0,"div",56),a(1),i()),n&2){let e=m(2);o(),p(" ",e.getFieldError("departmentId")," ")}}function ve(n,t){if(n&1&&(r(0,"div",56),a(1),i()),n&2){let e=m(2);o(),p(" ",e.getFieldError("institution")," ")}}function fe(n,t){if(n&1&&(r(0,"div",56),a(1),i()),n&2){let e=m(2);o(),p(" ",e.getFieldError("jobTitle")," ")}}function be(n,t){n&1&&s(0,"span",58)}function xe(n,t){n&1&&s(0,"i",59)}function ge(n,t){n&1&&(r(0,"span",71),s(1,"i",72),a(2,"Verificado "),i())}function _e(n,t){if(n&1&&(r(0,"div",60)(1,"div",61)(2,"h6",15),s(3,"i",62),a(4,"Informaci\xF3n del Usuario "),i()(),r(5,"div",17)(6,"div",63)(7,"div",64)(8,"div",65)(9,"strong"),a(10,"Email:"),i()(),r(11,"div",66),a(12),c(13,ge,3,0,"span",67),i()(),r(14,"div",64)(15,"div",65)(16,"strong"),a(17,"Rol:"),i()(),r(18,"div",66)(19,"span",68),a(20),i()()(),r(21,"div",64)(22,"div",65)(23,"strong"),a(24,"Estado:"),i()(),r(25,"div",66)(26,"span",68),a(27),i()()(),r(28,"div",64)(29,"div",65)(30,"strong"),a(31,"Creado:"),i()(),r(32,"div",66),a(33),D(34,"date"),i()(),r(35,"div",69),s(36,"i",70),r(37,"strong"),a(38,"Nota:"),i(),a(39," Los cambios en el rol del usuario deben realizarse desde las opciones administrativas. "),i()()()()),n&2){let e=m(2);o(12),p(" ",e.user.email," "),o(),d("ngIf",e.user.emailVerified),o(6),d("ngClass",N(10,ne,e.user.role===e.UserRole.ADMIN,e.user.role===e.UserRole.ORGANIZER,e.user.role===e.UserRole.PARTICIPANT)),o(),p(" ",e.user.role," "),o(6),d("ngClass",e.user.isActive?"bg-success":"bg-secondary"),o(),p(" ",e.user.isActive?"Activo":"Inactivo"," "),o(6),p(" ",k(34,7,e.user.createdAt,"dd/MM/yyyy HH:mm")," ")}}function he(n,t){if(n&1){let e=E();r(0,"div",2)(1,"div",3)(2,"div",4)(3,"button",5),g("click",function(){f(e);let u=m();return b(u.cancelEdit())}),s(4,"i",6),i(),r(5,"div")(6,"h2",7),a(7,"Editar Usuario"),i(),c(8,re,2,2,"p",8),i()()(),c(9,oe,4,0,"div",9)(10,ae,4,1,"div",10),r(11,"div",11)(12,"div",12)(13,"div",13)(14,"div",14)(15,"h5",15),s(16,"i",16),a(17,"Editar Informaci\xF3n "),i()(),r(18,"div",17)(19,"form",18),g("ngSubmit",function(){f(e);let u=m();return b(u.onSubmit())}),r(20,"div",19)(21,"h6",20),a(22,"Informaci\xF3n Personal"),i(),r(23,"div",11)(24,"div",21)(25,"label",22),a(26," Nombre completo "),r(27,"span",23),a(28,"*"),i()(),s(29,"input",24),c(30,le,2,1,"div",25),i(),r(31,"div",26)(32,"label",27),a(33," Tipo de documento "),r(34,"span",23),a(35,"*"),i()(),r(36,"select",28),c(37,de,2,2,"option",29),i(),c(38,se,2,1,"div",25),i(),r(39,"div",26)(40,"label",30),a(41,"N\xFAmero de documento"),i(),s(42,"input",31),c(43,me,2,1,"div",25),i(),r(44,"div",21)(45,"label",32),a(46,"Tel\xE9fono"),i(),s(47,"input",33),c(48,ce,2,1,"div",25),i()()(),r(49,"div",19)(50,"h6",20),a(51,"Ubicaci\xF3n"),i(),r(52,"div",11)(53,"div",21)(54,"label",34),a(55,"Departamento"),i(),r(56,"select",35)(57,"option",36),a(58,"Seleccione un departamento"),i(),c(59,pe,2,2,"option",29),i(),c(60,ue,2,1,"div",25),i()()(),r(61,"div",19)(62,"h6",20),a(63,"Informaci\xF3n Profesional"),i(),r(64,"div",11)(65,"div",21)(66,"label",37),a(67,"Instituci\xF3n"),i(),s(68,"input",38),c(69,ve,2,1,"div",25),i(),r(70,"div",21)(71,"label",39),a(72,"Cargo"),i(),s(73,"input",40),c(74,fe,2,1,"div",25),i()()(),r(75,"div",41)(76,"button",42),c(77,be,1,0,"span",43)(78,xe,1,0,"i",44),a(79),i(),r(80,"button",45),g("click",function(){f(e);let u=m();return b(u.resetForm())}),s(81,"i",46),a(82," Restablecer "),i(),r(83,"button",47),g("click",function(){f(e);let u=m();return b(u.cancelEdit())}),s(84,"i",48),a(85," Cancelar "),i()()()()()(),r(86,"div",49),c(87,_e,40,14,"div",50),i()()()}if(n&2){let e=m();o(8),d("ngIf",e.user),o(),d("ngIf",e.success),o(),d("ngIf",e.error),o(9),d("formGroup",e.userForm),o(10),v("is-invalid",e.isFieldInvalid("fullName")),o(),d("ngIf",e.isFieldInvalid("fullName")),o(6),v("is-invalid",e.isFieldInvalid("documentType")),o(),d("ngForOf",e.documentTypes),o(),d("ngIf",e.isFieldInvalid("documentType")),o(4),v("is-invalid",e.isFieldInvalid("documentNumber")),o(),d("ngIf",e.isFieldInvalid("documentNumber")),o(4),v("is-invalid",e.isFieldInvalid("phone")),o(),d("ngIf",e.isFieldInvalid("phone")),o(8),v("is-invalid",e.isFieldInvalid("departmentId")),o(3),d("ngForOf",e.departments),o(),d("ngIf",e.isFieldInvalid("departmentId")),o(8),v("is-invalid",e.isFieldInvalid("institution")),o(),d("ngIf",e.isFieldInvalid("institution")),o(4),v("is-invalid",e.isFieldInvalid("jobTitle")),o(),d("ngIf",e.isFieldInvalid("jobTitle")),o(2),d("disabled",e.saving),o(),d("ngIf",e.saving),o(),d("ngIf",!e.saving),o(),p(" ",e.saving?"Guardando...":"Guardar Cambios"," "),o(),d("disabled",e.saving),o(3),d("disabled",e.saving),o(4),d("ngIf",e.user)}}function Ee(n,t){n&1&&(r(0,"div",73)(1,"div",74)(2,"div",75)(3,"div",76)(4,"span",77),a(5,"Cargando..."),i()(),r(6,"p",78),a(7,"Cargando informaci\xF3n del usuario..."),i()()()())}function Ie(n,t){if(n&1){let e=E();r(0,"div",73)(1,"div",74)(2,"div",75)(3,"div",79),s(4,"i",80),a(5),i(),r(6,"button",81),g("click",function(){f(e);let u=m();return b(u.loadUser())}),s(7,"i",46),a(8," Reintentar "),i(),r(9,"a",82),s(10,"i",83),a(11," Volver a la lista "),i()()()()}if(n&2){let e=m();o(5),p(" ",e.error," ")}}var ie=class n{constructor(t,e,l,u,ye){this.fb=t;this.router=e;this.route=l;this.userService=u;this.staticDataService=ye;this.userForm=this.createForm()}destroy$=new S;userForm;user=null;loading=!1;saving=!1;error=null;success=!1;userId=null;departments=[];departmentMap={};userRoles=Object.values(I);documentTypes=Object.values(y);UserRole=I;DocumentType=y;ngOnInit(){this.loadUser(),this.loadStaticData()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}createForm(){return this.fb.group({fullName:["",[_.required,_.minLength(2),_.maxLength(100)]],documentType:["DNI",_.required],documentNumber:[""],phone:[""],departmentId:[""],institution:[""],jobTitle:[""]})}loadUser(){this.route.params.pipe(C(t=>{if(this.userId=+t.id,!this.userId)throw new Error("ID de usuario no v\xE1lido");return this.loading=!0,this.error=null,this.userService.getUserById(this.userId)}),h(this.destroy$)).subscribe({next:t=>{this.user=t,this.loading=!1,this.populateForm(t)},error:t=>{this.error=t.message||"Error cargando usuario",this.loading=!1,console.error("Error cargando usuario:",t)}})}loadStaticData(){this.staticDataService.getDepartmentsList().pipe(h(this.destroy$)).subscribe(t=>{this.departments=t,this.departmentMap={},t.forEach((e,l)=>{let u=l+1;this.departmentMap[u]=e})})}populateForm(t){this.userForm.patchValue({fullName:t.fullName,documentType:t.documentType||"DNI",documentNumber:t.documentNumber||"",phone:t.phone||"",departmentId:t.departmentId||"",institution:t.institution||"",jobTitle:t.jobTitle||""})}onSubmit(){this.userForm.valid&&this.userId?this.updateUser():this.markFormGroupTouched(this.userForm)}updateUser(){if(!this.userId)return;this.saving=!0,this.error=null;let t=this.userForm.value,e={fullName:t.fullName,documentType:t.documentType,documentNumber:t.documentNumber||void 0,phone:t.phone||void 0,departmentId:t.departmentId?+t.departmentId:void 0,institution:t.institution||void 0,jobTitle:t.jobTitle||void 0};this.userService.updateUserProfile(this.userId,e).pipe(h(this.destroy$)).subscribe({next:l=>{this.user=l,this.success=!0,this.saving=!1,setTimeout(()=>{this.router.navigate(["/usuarios",this.userId])},2e3)},error:l=>{this.error=l.message||"Error actualizando usuario",this.saving=!1,console.error("Error actualizando usuario:",l)}})}markFormGroupTouched(t){Object.keys(t.controls).forEach(e=>{let l=t.get(e);l?.markAsTouched(),l&&typeof l=="object"&&"controls"in l&&this.markFormGroupTouched(l)})}isFieldInvalid(t){let e=this.userForm.get(t);return!!(e&&e.invalid&&(e.dirty||e.touched))}getFieldError(t){let e=this.userForm.get(t);if(e&&e.errors&&(e.dirty||e.touched)){if(e.errors.required)return"Este campo es requerido";if(e.errors.email)return"Ingrese un email v\xE1lido";if(e.errors.minlength)return`M\xEDnimo ${e.errors.minlength.requiredLength} caracteres`;if(e.errors.maxlength)return`M\xE1ximo ${e.errors.maxlength.requiredLength} caracteres`}return""}getDocumentTypeLabel(t){return{DNI:"DNI",CE:"Carn\xE9 de Extranjer\xEDa",PASSPORT:"Pasaporte",RUC:"RUC"}[t]||t}cancelEdit(){this.userId?this.router.navigate(["/usuarios",this.userId]):this.router.navigate(["/usuarios"])}resetForm(){this.user&&(this.populateForm(this.user),this.error=null,this.success=!1)}static \u0275fac=function(e){return new(e||n)(x(W),x(O),x(M),x(ee),x(te))};static \u0275cmp=F({type:n,selectors:[["app-user-edit"]],decls:3,vars:3,consts:[["class","container-fluid py-4",4,"ngIf"],["class","container-fluid py-5",4,"ngIf"],[1,"container-fluid","py-4"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"d-flex","align-items-center"],["type","button",1,"btn","btn-outline-secondary","me-3",3,"click"],[1,"bi","bi-arrow-left"],[1,"h4","mb-0"],["class","text-muted small mb-0",4,"ngIf"],["class","alert alert-success d-flex align-items-center mb-4","role","alert",4,"ngIf"],["class","alert alert-danger d-flex align-items-center mb-4","role","alert",4,"ngIf"],[1,"row"],[1,"col-12","col-lg-8","col-xl-6"],[1,"card"],[1,"card-header","bg-light"],[1,"card-title","mb-0"],[1,"bi","bi-person-gear","me-2"],[1,"card-body"],["novalidate","",3,"ngSubmit","formGroup"],[1,"mb-4"],[1,"text-primary","border-bottom","pb-2"],[1,"col-12","mb-3"],["for","fullName",1,"form-label"],[1,"text-danger"],["type","text","id","fullName","formControlName","fullName","placeholder","Ingrese el nombre completo","maxlength","100",1,"form-control"],["class","invalid-feedback",4,"ngIf"],[1,"col-md-6","mb-3"],["for","documentType",1,"form-label"],["id","documentType","formControlName","documentType",1,"form-select"],[3,"value",4,"ngFor","ngForOf"],["for","documentNumber",1,"form-label"],["type","text","id","documentNumber","formControlName","documentNumber","placeholder","12345678",1,"form-control"],["for","phone",1,"form-label"],["type","tel","id","phone","formControlName","phone","placeholder","+51 999 999 999",1,"form-control"],["for","departmentId",1,"form-label"],["id","departmentId","formControlName","departmentId",1,"form-select"],["value",""],["for","institution",1,"form-label"],["type","text","id","institution","formControlName","institution","placeholder","Nombre de la instituci\xF3n",1,"form-control"],["for","jobTitle",1,"form-label"],["type","text","id","jobTitle","formControlName","jobTitle","placeholder","Cargo o puesto de trabajo",1,"form-control"],[1,"d-flex","gap-2","pt-3","border-top"],["type","submit",1,"btn","btn-primary",3,"disabled"],["class","spinner-border spinner-border-sm me-2","role","status",4,"ngIf"],["class","bi bi-check-lg me-1",4,"ngIf"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],[1,"bi","bi-arrow-clockwise","me-1"],["type","button",1,"btn","btn-outline-danger","ms-auto",3,"click","disabled"],[1,"bi","bi-x-lg","me-1"],[1,"col-12","col-lg-4","col-xl-6"],["class","card bg-light",4,"ngIf"],[1,"text-muted","small","mb-0"],["role","alert",1,"alert","alert-success","d-flex","align-items-center","mb-4"],[1,"bi","bi-check-circle-fill","me-2"],["role","alert",1,"alert","alert-danger","d-flex","align-items-center","mb-4"],[1,"bi","bi-exclamation-triangle-fill","me-2"],[1,"invalid-feedback"],[3,"value"],["role","status",1,"spinner-border","spinner-border-sm","me-2"],[1,"bi","bi-check-lg","me-1"],[1,"card","bg-light"],[1,"card-header"],[1,"bi","bi-info-circle","me-2"],[1,"small"],[1,"row","mb-3"],[1,"col-sm-4"],[1,"col-sm-8"],["class","badge bg-success ms-2",4,"ngIf"],[1,"badge",3,"ngClass"],[1,"alert","alert-info","mb-0"],[1,"bi","bi-lightbulb","me-2"],[1,"badge","bg-success","ms-2"],[1,"bi","bi-check-circle","me-1"],[1,"container-fluid","py-5"],[1,"row","justify-content-center"],[1,"col-md-6","text-center"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-3","mb-0","text-muted"],["role","alert",1,"alert","alert-danger"],[1,"bi","bi-exclamation-triangle","me-2"],["type","button",1,"btn","btn-outline-primary","me-2",3,"click"],["routerLink","/usuarios",1,"btn","btn-outline-secondary"],[1,"bi","bi-arrow-left","me-1"]],template:function(e,l){e&1&&c(0,he,88,34,"div",0)(1,Ee,8,0,"div",1)(2,Ie,12,1,"div",1),e&2&&(d("ngIf",!l.loading&&!l.error),o(),d("ngIf",l.loading),o(),d("ngIf",l.error&&!l.loading&&!l.user))},dependencies:[P,w,j,R,X,B,J,K,L,Z,$,q,Q,Y,z,H,G,A,V],encapsulation:2})};export{ie as UserEditComponent};

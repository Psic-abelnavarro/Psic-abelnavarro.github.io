import{b as ae}from"./chunk-MQP2EC7J.js";import{b as ne}from"./chunk-PHSVAKCK.js";import{b as ie}from"./chunk-22IHSIXM.js";import{b as ee}from"./chunk-7M4K7CII.js";import{a as te}from"./chunk-CYLPXQIR.js";import"./chunk-MPC7SZEK.js";import{a as R}from"./chunk-TMGCMHHJ.js";import{g as J,l as X}from"./chunk-IIPOJGOQ.js";import{f as Q,h as W,i as q,l as Z}from"./chunk-C3HOFUSH.js";import{A as D,Aa as U,Bc as Y,Da as o,Db as $,Fb as f,Gb as r,Hb as g,I as w,Ib as u,Na as G,Ob as H,Q as L,S as B,_ as x,ab as N,ac as v,bb as m,cb as p,da as _,ea as C,fb as A,gb as V,hb as E,ia as O,ib as i,jb as n,k as y,kb as s,ma as S,rb as I,sb as b,ub as d,wb as z,xb as j,yb as K}from"./chunk-5W5GNUFO.js";import"./chunk-LJ5XHLMQ.js";import{a as k,b as M}from"./chunk-FK42CRUA.js";var re=["actionButtonContainer"];function le(a,t){a&1&&(i(0,"div",2)(1,"div",6)(2,"div",7)(3,"span",8),r(4,"Cargando..."),n()(),i(5,"p",9),r(6,"Cargando detalles de inscripci\xF3n..."),n()()())}function ce(a,t){if(a&1&&(i(0,"div",3),s(1,"i",10),i(2,"span",11),r(3),n()()),a&2){let e=d();o(3),g(e.error())}}function de(a,t){if(a&1&&(i(0,"div",4),s(1,"i",12),i(2,"span",11),r(3),n()()),a&2){let e=d();o(3),g(e.success())}}function se(a,t){if(a&1&&(i(0,"span",54),s(1,"i",55),r(2),n()),a&2){let e=d(2);f(e.registrationStateInfo().badgeClass+" d-flex align-items-center gap-1 small"),o(),f("bi-"+e.registrationStateInfo().icon),o(),u(" ",e.registrationStateInfo().name," ")}}function me(a,t){a&1&&s(0,"span",34)}function pe(a,t){a&1&&s(0,"i",35)}function ge(a,t){if(a&1&&(i(0,"div",77),s(1,"i",82),r(2),n()),a&2){let e=d(4);o(2),u(" ",e.userInfo().institution," ")}}function ue(a,t){if(a&1&&(i(0,"div"),s(1,"i",83),r(2),n()),a&2){let e=d(4);o(2),u(" ",e.userInfo().documentNumber," ")}}function fe(a,t){if(a&1){let e=I();i(0,"div",61)(1,"div",73)(2,"span",74),r(3),n()(),i(4,"div",75)(5,"h6",76),r(6),n(),i(7,"div",30)(8,"div",77),s(9,"i",78),i(10,"a",79),r(11),n()(),m(12,ge,3,1,"div",77),m(13,ue,3,1,"div"),n()(),i(14,"button",80),b("click",function(){_(e);let c=d(3);return C(c.goToUser())}),s(15,"i",81),n()()}if(a&2){let e=d(3);o(3),g(e.userInfo().initials),o(3),g(e.userInfo().fullName),o(4),E("href",H("mailto:",e.userInfo().email),U),o(),u(" ",e.userInfo().email," "),o(),p(e.userInfo().hasInstitution?12:-1),o(),p(e.userInfo().hasDocumentNumber?13:-1)}}function ve(a,t){if(a&1&&(i(0,"div",77),s(1,"i",88),r(2),n()),a&2){let e=d(4);o(2),u(" ",e.formatCurrency(e.eventInfo().cost)," ")}}function xe(a,t){if(a&1&&(i(0,"div"),s(1,"i",55),i(2,"span"),r(3),n()()),a&2){let e=d(4);o(),f(e.getEventStatusInfo().class),o(),f(e.getEventStatusInfo().class),o(),g(e.getEventStatusInfo().text)}}function _e(a,t){if(a&1){let e=I();i(0,"div",61)(1,"div",84),s(2,"i",85),n(),i(3,"div",75)(4,"h6",76),r(5),n(),i(6,"div",30)(7,"div",77),s(8,"i",86),r(9),n(),m(10,ve,3,1,"div",77),m(11,xe,4,5,"div"),n()(),i(12,"button",87),b("click",function(){_(e);let c=d(3);return C(c.goToEvent())}),s(13,"i",81),n()()}if(a&2){let e=d(3);o(5),g(e.eventInfo().title),o(4),u(" ",e.formatDate(e.eventInfo().startDate)," "),o(),p(e.eventInfo().cost&&e.eventInfo().cost>0?10:-1),o(),p(e.getEventStatusInfo()?11:-1)}}function Ce(a,t){if(a&1&&(i(0,"p",92),r(1),n()),a&2){let e=d(4);o(),g(e.registrationStateInfo().description)}}function be(a,t){if(a&1&&(i(0,"div",67)(1,"div",89)(2,"div",90),s(3,"i",91),n()(),i(4,"h6",27),r(5),n(),m(6,Ce,2,1,"p",92),n()),a&2){let e=d(3);o(3),f("bi-"+e.registrationStateInfo().icon+" text-"+e.registrationStateInfo().color),o(2),g(e.registrationStateInfo().name),o(),p(e.registrationStateInfo().description?6:-1)}}function he(a,t){if(a&1&&(i(0,"div",70)(1,"label",71),r(2,"Fecha de Confirmaci\xF3n"),n(),i(3,"p",72),r(4),n()()),a&2){let e=d(3);o(4),g(e.formatDate(e.registration().confirmationDate))}}function Se(a,t){if(a&1&&(i(0,"div",70)(1,"label",71),r(2,"Fecha de Check-in"),n(),i(3,"p",72),r(4),n()()),a&2){let e=d(3);o(4),g(e.formatDate(e.registration().checkInDate))}}function Ee(a,t){if(a&1&&(i(0,"div",70)(1,"label",71),r(2,"Asistencia Verificada"),n(),i(3,"p",72),r(4),i(5,"span",93),r(6),n()()()),a&2){let e=d(3);o(4),u(" ",e.formatDate(e.registration().attendanceVerifiedDate)," "),o(2),u("",e.registration().attendancePercentage,"%")}}function Ie(a,t){if(a&1&&(i(0,"div",66)(1,"label",71),r(2,"M\xE9todo de Pago"),n(),i(3,"p",98),r(4),n()()),a&2){let e=d(4);o(4),g(e.paymentInfo().paymentMethod)}}function ye(a,t){if(a&1&&(i(0,"div",66)(1,"label",71),r(2,"Referencia"),n(),i(3,"p",99),r(4),n()()),a&2){let e=d(4);o(4),g(e.paymentInfo().paymentReference)}}function De(a,t){if(a&1&&(i(0,"div",66)(1,"label",100),r(2,"Fecha de Pago"),n(),i(3,"p",101),r(4),n()()),a&2){let e=d(4);o(4),g(e.formatDate(e.paymentInfo().paymentDate))}}function we(a,t){if(a&1&&(i(0,"div",52)(1,"div",63)(2,"div",58)(3,"h6",59),s(4,"i",94),r(5," Informaci\xF3n de Pago "),n()(),i(6,"div",40)(7,"div",69)(8,"div",95)(9,"label",71),r(10,"Costo del Evento"),n(),i(11,"p",72),r(12),n()(),i(13,"div",95)(14,"label",71),r(15,"Monto Pagado"),n(),i(16,"p",96),r(17),n()(),i(18,"div",95)(19,"label",71),r(20,"Monto Pendiente"),n(),i(21,"p",72),r(22),n()(),i(23,"div",95)(24,"label",71),r(25,"Estado"),n(),i(26,"span",97),r(27),n()(),m(28,Ie,5,1,"div",66),m(29,ye,5,1,"div",66),m(30,De,5,1,"div",66),n()()()()),a&2){let e=d(3);o(12),g(e.formatCurrency(e.paymentInfo().eventCost,e.paymentInfo().currency)),o(5),g(e.formatCurrency(e.paymentInfo().amountPaid,e.paymentInfo().currency)),o(4),f(e.paymentInfo().pendingAmount>0?"text-warning":"text-success"),o(),u(" ",e.formatCurrency(e.paymentInfo().pendingAmount,e.paymentInfo().currency)," "),o(4),f(e.paymentInfo().isFullyPaid?"text-bg-success":"text-bg-warning"),o(),u(" ",e.paymentInfo().isFullyPaid?"Pagado Completo":"Pago Pendiente"," "),o(),p(e.paymentInfo().paymentMethod?28:-1),o(),p(e.paymentInfo().paymentReference?29:-1),o(),p(e.paymentInfo().paymentDate?30:-1)}}function Re(a,t){if(a&1&&(i(0,"div",56)(1,"div",57)(2,"div",58)(3,"h6",59),s(4,"i",60),r(5," Informaci\xF3n del Participante "),n()(),i(6,"div",40),m(7,fe,16,7,"div",61),n()()(),i(8,"div",56)(9,"div",57)(10,"div",58)(11,"h6",59),s(12,"i",62),r(13," Informaci\xF3n del Evento "),n()(),i(14,"div",40),m(15,_e,14,4,"div",61),n()()(),i(16,"div",52)(17,"div",63)(18,"div",58)(19,"h6",59),s(20,"i",64),r(21," Estado de la Inscripci\xF3n "),n()(),i(22,"div",40)(23,"div",65)(24,"div",66),m(25,be,7,4,"div",67),n(),i(26,"div",68)(27,"div",69)(28,"div",70)(29,"label",71),r(30,"Fecha de Registro"),n(),i(31,"p",72),r(32),n()(),m(33,he,5,1,"div",70),m(34,Se,5,1,"div",70),m(35,Ee,7,2,"div",70),n()()()()()(),m(36,we,31,11,"div",52)),a&2){let e=d(2);o(7),p(e.userInfo()?7:-1),o(8),p(e.eventInfo()?15:-1),o(10),p(e.registrationStateInfo()?25:-1),o(7),g(e.formatDate(e.registration().registrationDate)),o(),p(e.registration().confirmationDate?33:-1),o(),p(e.registration().checkInDate?34:-1),o(),p(e.registration().attendanceVerifiedDate?35:-1),o(),p(e.paymentInfo()&&(e.paymentInfo().eventCost>0||e.paymentInfo().hasPayment)?36:-1)}}function Te(a,t){if(a&1&&(i(0,"p",9),r(1),n()),a&2){let e=d().$implicit;o(),g(e.description)}}function ke(a,t){a&1&&(i(0,"span",113),r(1,"Estado Actual"),n())}function Me(a,t){if(a&1&&(i(0,"div",106)(1,"div",107)(2,"div",108),s(3,"i",109),n()(),i(4,"div",75)(5,"div",110)(6,"div",40)(7,"div",111)(8,"h6",72),r(9),n(),i(10,"small",112),r(11),n()(),m(12,Te,2,1,"p",9),m(13,ke,2,0,"span",113),n()()()()),a&2){let e=t.$implicit,l=d(4);o(2),f("bg-"+e.color),$("border-primary",e.isCurrentState),o(),f("bi-"+e.icon),o(6),g(e.title),o(2),g(l.formatDateShort(e.date)),o(),p(e.description?12:-1),o(),p(e.isCurrentState?13:-1)}}function Ne(a,t){if(a&1&&(i(0,"div",103),s(1,"div",105),A(2,Me,14,10,"div",106,N().trackByTimelineId,!0),n()),a&2){let e=d(3);o(2),V(e.timeline())}}function Ae(a,t){a&1&&(i(0,"div",104),s(1,"i",114),i(2,"p",112),r(3,"No hay eventos en la cronolog\xEDa"),n()())}function Ve(a,t){if(a&1&&(i(0,"div",52)(1,"div",63)(2,"div",58)(3,"h6",59),s(4,"i",102),r(5," Cronolog\xEDa de Estados "),n()(),i(6,"div",40),m(7,Ne,4,0,"div",103)(8,Ae,4,0,"div",104),n()()()),a&2){let e=d(2);o(7),p(e.timeline().length>0?7:8)}}function Pe(a,t){if(a&1&&(i(0,"tr")(1,"td",119),r(2,"Estado Anterior ID:"),n(),i(3,"td",120),r(4),n()()),a&2){let e=d(3);o(4),g(e.registration().previousStateId)}}function Fe(a,t){if(a&1&&(i(0,"tr")(1,"td",119),r(2,"Estado Cambiado:"),n(),i(3,"td",120),r(4),n()()),a&2){let e=d(3);o(4),g(e.formatDate(e.registration().stateChangedAt))}}function Le(a,t){if(a&1&&(i(0,"div",52)(1,"label",71),r(2,"Notas:"),n(),i(3,"div",123)(4,"p",98),r(5),n()()()),a&2){let e=d(3);o(5),g(e.registration().notes)}}function Be(a,t){if(a&1&&(i(0,"div",52)(1,"div",63)(2,"div",58)(3,"h6",59),s(4,"i",115),r(5," Informaci\xF3n T\xE9cnica "),n()(),i(6,"div",40)(7,"div",69)(8,"div",116)(9,"div",117)(10,"table",118)(11,"tbody")(12,"tr")(13,"td",119),r(14,"ID de Inscripci\xF3n:"),n(),i(15,"td",120),r(16),n()(),i(17,"tr")(18,"td",119),r(19,"ID de Usuario:"),n(),i(20,"td",120),r(21),n()(),i(22,"tr")(23,"td",119),r(24,"ID de Evento:"),n(),i(25,"td",120),r(26),n()(),i(27,"tr")(28,"td",119),r(29,"Rol Participante:"),n(),i(30,"td",120),r(31),n()(),i(32,"tr")(33,"td",119),r(34,"Estado Actual ID:"),n(),i(35,"td",120),r(36),n()(),m(37,Pe,5,1,"tr"),n()()()(),i(38,"div",116)(39,"div",117)(40,"table",118)(41,"tbody")(42,"tr")(43,"td",119),r(44,"Creado:"),n(),i(45,"td",120),r(46),n()(),i(47,"tr")(48,"td",119),r(49,"Actualizado:"),n(),i(50,"td",120),r(51),n()(),m(52,Fe,5,1,"tr"),i(53,"tr")(54,"td",119),r(55,"Elegible Certificado:"),n(),i(56,"td",121)(57,"span",122),r(58),n()()(),i(59,"tr")(60,"td",119),r(61,"Certificado Emitido:"),n(),i(62,"td",121)(63,"span",122),r(64),n()()(),i(65,"tr")(66,"td",119),r(67,"Asistencia Verificada:"),n(),i(68,"td",121)(69,"span",122),r(70),n()()()()()()(),m(71,Le,6,1,"div",52),n()()()()),a&2){let e=d(2);o(16),u("#",e.registration().id),o(5),g(e.registration().userId),o(5),g(e.registration().eventId),o(5),g(e.registration().participantRoleId),o(5),g(e.registration().currentStateId),o(),p(e.registration().previousStateId?37:-1),o(9),g(e.formatDate(e.registration().createdAt)),o(5),g(e.formatDate(e.registration().updatedAt)),o(),p(e.registration().stateChangedAt?52:-1),o(5),f(e.registration().certificateEligible?"text-bg-success":"text-bg-secondary"),o(),u(" ",e.registration().certificateEligible?"S\xED":"No"," "),o(5),f(e.registration().certificateIssued?"text-bg-success":"text-bg-secondary"),o(),u(" ",e.registration().certificateIssued?"S\xED":"No"," "),o(5),f(e.registration().attendanceVerified?"text-bg-success":"text-bg-secondary"),o(),u(" ",e.registration().attendanceVerified?"S\xED":"No"," "),o(),p(e.registration().notes?71:-1)}}function Oe(a,t){a&1&&s(0,"span",34)}function Ue(a,t){if(a&1&&s(0,"i",130),a&2){let e=d().$implicit;f("bi-"+e.icon)}}function Ge(a,t){if(a&1){let e=I();i(0,"button",128),b("click",function(){let c=_(e).$implicit;return C(c.action())}),m(1,Oe,1,0,"span",34)(2,Ue,1,2,"i",129),i(3,"span",11),r(4),n()()}if(a&2){let e=t.$implicit,l=d(3);f("btn-"+(e.variant==="danger"?"outline-"+e.variant:e.variant)),E("disabled",e.loading||l.actionLoading()),o(),p(e.loading?1:2),o(3),g(e.label)}}function ze(a,t){if(a&1&&(i(0,"div",53,0)(2,"div",124)(3,"h6",125),s(4,"i",50),r(5," Acciones Disponibles "),n()(),i(6,"div",40)(7,"div",126),A(8,Ge,5,5,"button",127,N().trackByActionId,!0),n()()()),a&2){let e=d(2);o(8),V(e.actionButtons())}}function je(a,t){if(a&1){let e=I();i(0,"nav",13)(1,"ol",14)(2,"li",15)(3,"a",16),s(4,"i",17),i(5,"span",18),r(6,"Inicio"),n()()(),i(7,"li",15)(8,"a",19),s(9,"i",20),i(10,"span",18),r(11,"Inscripciones"),n()()(),i(12,"li",21),r(13),n()()(),i(14,"div",22)(15,"div",23)(16,"div",24)(17,"div",25),s(18,"i",26),n(),i(19,"div")(20,"h6",27),r(21),n(),i(22,"div",28),m(23,se,3,5,"span",29),i(24,"small",30),s(25,"i",31),r(26),n()()()()(),i(27,"div",32)(28,"button",33),b("click",function(){_(e);let c=d();return C(c.refreshData())}),m(29,me,1,0,"span",34)(30,pe,1,0,"i",35),i(31,"span",36),r(32,"Actualizar"),n()(),i(33,"button",37),b("click",function(){_(e);let c=d();return C(c.navigateBack())}),s(34,"i",38),i(35,"span",36),r(36,"Volver"),n()()()(),i(37,"div",39)(38,"div",40)(39,"div",41)(40,"input",42),b("change",function(){_(e);let c=d();return C(c.changeViewMode("overview"))}),n(),i(41,"label",43),s(42,"i",44),i(43,"span",36),r(44,"Vista General"),n()(),i(45,"input",45),b("change",function(){_(e);let c=d();return C(c.changeViewMode("timeline"))}),n(),i(46,"label",46),s(47,"i",47),i(48,"span",36),r(49,"Cronolog\xEDa"),n()(),i(50,"input",48),b("change",function(){_(e);let c=d();return C(c.changeViewMode("technical"))}),n(),i(51,"label",49),s(52,"i",50),i(53,"span",36),r(54,"T\xE9cnico"),n()()()()(),i(55,"div",51),m(56,Re,37,8),m(57,Ve,9,1,"div",52),m(58,Be,72,19,"div",52),n(),m(59,ze,10,0,"div",53)}if(a&2){let e=d();o(13),u(" Detalle #",e.registration().id," "),o(8),u(" Inscripci\xF3n #",e.registration().id," "),o(2),p(e.registrationStateInfo()?23:-1),o(3),u(" Creado ",e.formatDateShort(e.registration().createdAt)," "),o(2),E("disabled",e.loading()),o(),p(e.loading()?29:30),o(11),E("checked",e.viewMode()==="overview"),o(5),E("checked",e.viewMode()==="timeline"),o(5),E("checked",e.viewMode()==="technical"),o(6),p(e.viewMode()==="overview"?56:-1),o(),p(e.viewMode()==="timeline"?57:-1),o(),p(e.viewMode()==="technical"?58:-1),o(),p(e.actionButtons().length>0?59:-1)}}function Ke(a,t){if(a&1){let e=I();i(0,"div",5)(1,"div",6),s(2,"i",131),i(3,"h6",76),r(4,"Inscripci\xF3n no encontrada"),n(),i(5,"p",132),r(6,"No se pudo cargar la informaci\xF3n de la inscripci\xF3n solicitada."),n(),i(7,"button",133),b("click",function(){_(e);let c=d();return C(c.navigateBack())}),s(8,"i",38),i(9,"span",11),r(10,"Volver a Inscripciones"),n()()()()}}var oe=class a{destroyRef=x(O);route=x(Q);router=x(W);registrationService=x(ne);eventService=x(ie);userService=x(ee);certificateService=x(ae);authService=x(X);staticDataService=x(te);actionButtonContainer=S(null);loadingState=S({main:!1,action:!1,certificate:!1,stateChange:!1});loading=v(()=>this.loadingState().main);actionLoading=v(()=>this.loadingState().action||this.loadingState().certificate||this.loadingState().stateChange);error=S(null);success=S(null);registrationId=S(null);viewMode=S("overview");registration=S(null);currentUser=v(()=>this.authService.currentUser);permissions=v(()=>{let t=this.registration(),e=this.currentUser();if(!t||!e)return{canEdit:!1,canCancel:!1,canConfirm:!1,canCheckIn:!1,canMarkAttended:!1,canMarkNoShow:!1,canGenerateCertificate:!1,canChangeState:!1,reason:"Informaci\xF3n no disponible"};let l=e.role==="admin",c=e.role==="organizer",T=e.id===t.userId,h=t.currentState?.stateKey,P=t.event?.endDate?new Date>new Date(t.event.endDate):!1,F=t.event?.startDate?new Date>new Date(t.event.startDate):!1;return{canEdit:(l||c||T)&&J.includes(h),canCancel:(l||c||T)&&["draft","pending_validation","confirmed","payment_pending"].includes(h),canConfirm:(l||c)&&h==="pending_validation",canCheckIn:(l||c)&&h==="confirmed"&&F&&!P,canMarkAttended:(l||c)&&h==="checked_in"&&F,canMarkNoShow:(l||c)&&["confirmed","checked_in"].includes(h)&&P,canGenerateCertificate:(l||c)&&t.certificateEligible&&!t.certificateIssued&&h==="attended",canChangeState:l||c}});registrationStateInfo=v(()=>{let t=this.registration();if(!t?.currentState?.stateKey)return null;let e=t.currentState.stateKey,c={draft:{color:"secondary",icon:"file-text"},pending_validation:{color:"warning",icon:"clock"},payment_required:{color:"danger",icon:"credit-card"},payment_pending:{color:"warning",icon:"hourglass-split"},payment_failed:{color:"danger",icon:"x-circle"},confirmed:{color:"success",icon:"check-circle"},waitlist:{color:"info",icon:"list-ul"},checked_in:{color:"info",icon:"box-arrow-in-right"},attended:{color:"success",icon:"check-all"},no_show:{color:"danger",icon:"x-octagon"},cancelled_by_user:{color:"secondary",icon:"x-circle"},cancelled_by_admin:{color:"dark",icon:"ban"}}[e]||{color:"secondary",icon:"circle"};return{key:e,name:t.currentState.displayName||e,description:t.currentState.description,color:c.color,icon:c.icon,badgeClass:`bg-${c.color}`}});eventInfo=v(()=>{let t=this.registration();if(!t?.event)return null;let e=new Date,l=new Date(t.event.startDate),c=new Date(t.event.endDate);return M(k({},t.event),{hasStarted:e>=l,hasEnded:e>c,isOngoing:e>=l&&e<=c,daysUntilStart:Math.ceil((l.getTime()-e.getTime())/(1e3*60*60*24)),daysSinceEnd:Math.ceil((e.getTime()-c.getTime())/(1e3*60*60*24))})});userInfo=v(()=>{let t=this.registration();return t?.user?M(k({},t.user),{initials:this.getUserInitials(t.user.fullName),hasInstitution:!!t.user.institution,hasDocumentNumber:!!t.user.documentNumber}):null});paymentInfo=v(()=>{let t=this.registration();if(!t)return null;let e=t.event?.cost||0,l=t.amountPaid||0,c=Math.max(0,e-l);return{eventCost:e,amountPaid:l,pendingAmount:c,isFullyPaid:c===0,hasPayment:l>0,paymentMethod:t.paymentMethod,paymentReference:t.paymentReference,paymentDate:t.paymentDate,currency:t.currency||"PEN"}});actionButtons=v(()=>{let t=this.permissions(),e=this.actionLoading();return[{id:"edit",label:"Editar",icon:"pencil-square",variant:"primary",action:()=>this.goToEdit(),visible:t.canEdit},{id:"confirm",label:"Confirmar",icon:"check-circle",variant:"success",action:()=>this.confirmRegistration(),visible:t.canConfirm,loading:this.loadingState().stateChange},{id:"checkin",label:"Check-in",icon:"box-arrow-in-right",variant:"info",action:()=>this.checkInRegistration(),visible:t.canCheckIn,loading:this.loadingState().stateChange},{id:"attended",label:"Marcar Asistido",icon:"check-all",variant:"success",action:()=>this.markAsAttended(),visible:t.canMarkAttended,loading:this.loadingState().stateChange},{id:"noshow",label:"Marcar No Show",icon:"x-octagon",variant:"warning",action:()=>this.markAsNoShow(),visible:t.canMarkNoShow,loading:this.loadingState().stateChange},{id:"certificate",label:"Generar Certificado",icon:"award",variant:"info",action:()=>this.generateCertificate(),visible:t.canGenerateCertificate,loading:this.loadingState().certificate},{id:"cancel",label:"Cancelar Inscripci\xF3n",icon:"x-circle",variant:"danger",action:()=>this.cancelRegistration(),visible:t.canCancel,loading:this.loadingState().stateChange}].filter(l=>l.visible)});timeline=v(()=>{let t=this.registration();if(!t)return[];let e=[],l=t.currentState?.stateKey;e.push({id:"registration",title:"Inscripci\xF3n Creada",description:"Se cre\xF3 la inscripci\xF3n en el sistema",date:t.registrationDate,icon:"plus-circle",color:"primary"}),t.confirmationDate&&e.push({id:"confirmation",title:"Inscripci\xF3n Confirmada",description:"La inscripci\xF3n fue confirmada oficialmente",date:t.confirmationDate,icon:"check-circle",color:"success"}),t.paymentDate&&e.push({id:"payment",title:"Pago Procesado",description:`Pago de ${this.formatCurrency(t.amountPaid)} procesado exitosamente`,date:t.paymentDate,icon:"credit-card",color:"info"}),t.checkInDate&&e.push({id:"checkin",title:"Check-in Realizado",description:"El participante se registr\xF3 en el evento",date:t.checkInDate,icon:"box-arrow-in-right",color:"info"}),t.attendanceVerifiedDate&&e.push({id:"attendance",title:"Asistencia Verificada",description:`Asistencia del ${t.attendancePercentage}% verificada`,date:t.attendanceVerifiedDate,icon:"check-all",color:"success"});let c=e[e.length-1];return c&&(c.isCurrentState=!0),e.sort((T,h)=>new Date(T.date).getTime()-new Date(h.date).getTime())});hasUnsavedChanges=v(()=>!1);ngOnInit(){this.loadRegistration()}loadRegistration(){this.setLoadingState("main",!0),this.error.set(null),this.route.params.pipe(B(t=>{let e=parseInt(t.id,10);this.registrationId.set(e)}),L(t=>{let e=parseInt(t.id,10);if(isNaN(e))throw new Error("ID de inscripci\xF3n inv\xE1lido");return this.registrationService.getRegistrationById(e)}),D(t=>(console.error("Error loading registration:",t),this.error.set(t.message||"Error al cargar los detalles de la inscripci\xF3n. Por favor, intente nuevamente."),y(null))),w(()=>this.setLoadingState("main",!1)),R(this.destroyRef)).subscribe(t=>{this.registration.set(t)})}refreshData(){let t=this.registrationId();t&&(this.setLoadingState("main",!0),this.registrationService.getRegistrationById(t).pipe(D(e=>(console.error("Error refreshing registration:",e),this.error.set("Error al actualizar los datos"),y(null))),w(()=>this.setLoadingState("main",!1)),R(this.destroyRef)).subscribe(e=>{this.registration.set(e),this.success.set("Datos actualizados exitosamente"),setTimeout(()=>this.success.set(null),3e3)}))}confirmRegistration(){this.changeRegistrationState("confirmed","Inscripci\xF3n confirmada exitosamente")}checkInRegistration(){this.changeRegistrationState("checked_in","Check-in realizado exitosamente")}markAsAttended(){this.changeRegistrationState("attended","Asistencia registrada exitosamente")}markAsNoShow(){confirm('\xBFEst\xE1 seguro de marcar esta inscripci\xF3n como "No Show"? Esta acci\xF3n no se puede deshacer.')&&this.changeRegistrationState("no_show",'Inscripci\xF3n marcada como "No Show"')}cancelRegistration(){confirm("\xBFEst\xE1 seguro de cancelar esta inscripci\xF3n? Esta acci\xF3n no se puede deshacer.")&&this.changeRegistrationState("cancelled_by_admin","Inscripci\xF3n cancelada exitosamente")}changeRegistrationState(t,e){let l=this.registration();l&&(this.setLoadingState("stateChange",!0),this.error.set(null),this.registrationService.changeRegistrationState(l.id,t).pipe(D(c=>(console.error("Error changing registration state:",c),this.error.set(c.error?.message||"Error al cambiar el estado de la inscripci\xF3n. Por favor, intente nuevamente."),y(null))),w(()=>this.setLoadingState("stateChange",!1)),R(this.destroyRef)).subscribe(c=>{c?.success?(this.success.set(e),this.refreshData()):c?.message&&this.error.set(c.message)}))}generateCertificate(){let t=this.registration();if(!t)return;this.setLoadingState("certificate",!0),this.error.set(null);let e={userId:t.userId,eventId:t.eventId,participantRoleId:t.participantRoleId};this.certificateService.generateCertificate(e).pipe(D(l=>(console.error("Error generating certificate:",l),this.error.set(l.error?.message||"Error al generar el certificado. Por favor, intente nuevamente."),y(null))),w(()=>this.setLoadingState("certificate",!1)),R(this.destroyRef)).subscribe(l=>{l&&(this.success.set("Certificado generado exitosamente"),this.refreshData())})}goToEdit(){let t=this.registration();t&&this.router.navigate(["/inscripciones",t.id,"editar"])}goToEvent(){let t=this.registration();t?.event&&this.router.navigate(["/eventos",t.event.id])}goToUser(){let t=this.registration();t?.user&&this.router.navigate(["/usuarios",t.user.id])}navigateBack(){this.router.navigate(["/inscripciones"])}setLoadingState(t,e){this.loadingState.update(l=>M(k({},l),{[t]:e}))}changeViewMode(t){this.viewMode.set(t)}formatDate(t){return t?new Intl.DateTimeFormat("es-PE",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(t)):"No disponible"}formatDateShort(t){return t?new Intl.DateTimeFormat("es-PE",{year:"numeric",month:"short",day:"numeric"}).format(new Date(t)):"No disponible"}formatCurrency(t,e="PEN"){return new Intl.NumberFormat("es-PE",{style:"currency",currency:e}).format(t)}getUserInitials(t){if(!t)return"U";let e=t.trim().split(" ");return e.length>=2?(e[0][0]+e[1][0]).toUpperCase():e[0][0].toUpperCase()}getEventStatusInfo(){let t=this.eventInfo();if(!t)return null;if(t.isOngoing)return{text:"En curso",class:"text-success",icon:"play-circle"};if(t.hasEnded)return{text:"Finalizado",class:"text-muted",icon:"stop-circle"};if(t.hasStarted)return{text:"Iniciado",class:"text-info",icon:"play"};{let e=t.daysUntilStart;return e===0?{text:"Hoy",class:"text-warning",icon:"calendar-event"}:e===1?{text:"Ma\xF1ana",class:"text-warning",icon:"calendar-plus"}:e>0?{text:`En ${e} d\xEDas`,class:"text-primary",icon:"calendar"}:{text:"Fecha pasada",class:"text-danger",icon:"calendar-x"}}}trackByActionId(t,e){return e.id}trackByTimelineId(t,e){return e.id}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=G({type:a,selectors:[["app-registration-detail"]],viewQuery:function(e,l){if(e&1&&z(re,5),e&2){let c;j(c=K())&&(l.actionButtonContainer=c.first)}},decls:6,vars:3,consts:[["actionButtonContainer",""],[1,"container-fluid","py-3"],[1,"d-flex","justify-content-center","align-items-center",2,"min-height","40vh"],["role","alert",1,"alert","alert-danger","border-0","shadow-sm","d-flex","align-items-center","py-2"],["role","alert",1,"alert","alert-success","border-0","shadow-sm","d-flex","align-items-center","py-2"],[1,"d-flex","justify-content-center","align-items-center",2,"min-height","50vh"],[1,"text-center"],["role","status",1,"spinner-border","text-primary","mb-2",2,"width","2.5rem","height","2.5rem"],[1,"visually-hidden"],[1,"text-muted","small","mb-0"],[1,"bi","bi-exclamation-triangle","me-1","fs-6"],[1,"small"],[1,"bi","bi-check-circle","me-1","fs-6"],["aria-label","breadcrumb",1,"mb-3"],[1,"breadcrumb","mb-0","fs-7"],[1,"breadcrumb-item"],["routerLink","/",1,"text-decoration-none","link-primary"],[1,"bi","bi-house-door","me-1"],[1,"d-none","d-sm-inline"],["routerLink","/inscripciones",1,"text-decoration-none","link-primary"],[1,"bi","bi-person-badge","me-1"],["aria-current","page",1,"breadcrumb-item","active"],[1,"d-flex","flex-column","flex-sm-row","align-items-start","align-items-sm-center","justify-content-between","gap-2","mb-3"],[1,"order-1","order-sm-0"],[1,"d-flex","align-items-center","gap-2"],[1,"bg-primary","rounded-circle","p-2","d-flex","align-items-center","justify-content-center",2,"width","48px","height","48px"],[1,"bi","bi-person-badge","text-white","fs-5"],[1,"fw-normal","small","mb-1"],[1,"d-flex","flex-wrap","align-items-center","gap-1"],[1,"badge",3,"class"],[1,"text-muted","fs-8"],[1,"bi","bi-calendar","me-1"],[1,"d-flex","flex-wrap","gap-1","order-0","order-sm-1"],["type","button","title","Actualizar datos",1,"btn","btn-outline-secondary","btn-sm","px-2",3,"click","disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-1"],[1,"bi","bi-arrow-clockwise","me-1"],[1,"d-none","d-sm-inline","small"],["type","button","title","Volver a la lista",1,"btn","btn-outline-secondary","btn-sm","px-2",3,"click"],[1,"bi","bi-arrow-left","me-1"],[1,"card","border-0","shadow-sm","mb-3"],[1,"card-body","py-2"],["role","group","aria-label","Modos de vista",1,"btn-group","w-100"],["type","radio","id","overview","autocomplete","off",1,"btn-check",3,"change","checked"],["for","overview",1,"btn","btn-outline-primary","btn-sm"],[1,"bi","bi-grid-3x3-gap","me-1"],["type","radio","id","timeline","autocomplete","off",1,"btn-check",3,"change","checked"],["for","timeline",1,"btn","btn-outline-primary","btn-sm"],[1,"bi","bi-clock-history","me-1"],["type","radio","id","technical","autocomplete","off",1,"btn-check",3,"change","checked"],["for","technical",1,"btn","btn-outline-primary","btn-sm"],[1,"bi","bi-gear","me-1"],[1,"row","g-3"],[1,"col-12"],[1,"card","border-0","shadow-sm","mt-4"],[1,"badge"],[1,"bi"],[1,"col-12","col-lg-6"],[1,"card","border-0","shadow-sm","h-100"],[1,"card-header","bg-light","border-0","py-2"],[1,"card-title","mb-0","d-flex","align-items-center","fw-normal","small"],[1,"bi","bi-person","me-1","text-primary"],[1,"d-flex","align-items-start","gap-2"],[1,"bi","bi-calendar-event","me-1","text-primary"],[1,"card","border-0","shadow-sm"],[1,"bi","bi-clipboard-check","me-1","text-primary"],[1,"row","g-3","align-items-center"],[1,"col-12","col-md-4"],[1,"text-center","py-3","bg-light","rounded"],[1,"col-12","col-md-8"],[1,"row","g-2"],[1,"col-6"],[1,"form-label","text-muted","fs-8","mb-1"],[1,"mb-0","fw-normal","small"],[1,"bg-primary","rounded-circle","d-flex","align-items-center","justify-content-center","text-white","flex-shrink-0","fw-normal",2,"width","48px","height","48px"],[1,"fs-7"],[1,"flex-grow-1"],[1,"mb-2","fw-normal","small"],[1,"mb-1"],[1,"bi","bi-envelope","me-1","text-primary"],[1,"text-decoration-none",3,"href"],["type","button","title","Ver perfil completo",1,"btn","btn-outline-primary","btn-sm","px-2",3,"click"],[1,"bi","bi-arrow-right"],[1,"bi","bi-building","me-1","text-primary"],[1,"bi","bi-card-text","me-1","text-primary"],[1,"bg-success","rounded-circle","p-1","d-flex","align-items-center","justify-content-center","flex-shrink-0",2,"width","40px","height","40px"],[1,"bi","bi-calendar-event","text-white","fs-7"],[1,"bi","bi-calendar","me-1","text-success"],["type","button","title","Ver evento completo",1,"btn","btn-outline-success","btn-sm","px-2",3,"click"],[1,"bi","bi-credit-card","me-1","text-success"],[1,"mb-2"],[1,"bg-white","rounded-circle","p-2","d-inline-flex","align-items-center","justify-content-center","shadow-sm",2,"width","64px","height","64px"],[1,"bi","fs-3"],[1,"text-muted","fs-8","mb-0"],[1,"badge","text-bg-success","ms-1","small"],[1,"bi","bi-credit-card","me-1","text-primary"],[1,"col-12","col-md-3"],[1,"mb-0","fw-normal","small","text-success"],[1,"badge","small"],[1,"mb-0","fs-8"],[1,"mb-0","font-monospace"],[1,"form-label","text-muted","small","mb-1"],[1,"mb-0"],[1,"bi","bi-clock-history","me-1","text-primary"],[1,"position-relative"],[1,"text-center","py-5"],[1,"position-absolute","start-0","top-0","bottom-0","bg-primary","opacity-25",2,"width","2px","left","19px"],[1,"d-flex","gap-2","mb-3","position-relative"],[1,"flex-shrink-0","position-relative"],[1,"rounded-circle","d-flex","align-items-center","justify-content-center","border","border-2","border-white","shadow-sm",2,"width","40px","height","40px"],[1,"bi","text-white","fs-7"],[1,"card","border-0","bg-light"],[1,"d-flex","justify-content-between","align-items-start","mb-1"],[1,"text-muted"],[1,"badge","bg-primary","mt-2"],[1,"bi","bi-clock-history","text-muted","mb-3",2,"font-size","3rem"],[1,"bi","bi-gear","me-1","text-primary"],[1,"col-12","col-md-6"],[1,"table-responsive"],[1,"table","table-sm"],[1,"text-muted","border-0","ps-0","fs-8"],[1,"border-0","pe-0","fw-normal","small"],[1,"border-0","pe-0"],[1,"small","px-1","rounded"],[1,"p-2","bg-light","rounded"],[1,"card-header","bg-primary","text-white","py-2"],[1,"mb-0","fw-normal","small","d-flex","align-items-center"],[1,"d-flex","flex-wrap","gap-2"],["type","button",1,"btn","btn-sm","px-2",3,"class","disabled"],["type","button",1,"btn","btn-sm","px-2",3,"click","disabled"],[1,"bi","me-1",3,"class"],[1,"bi","me-1"],[1,"bi","bi-exclamation-triangle","text-warning","mb-3",2,"font-size","2.5rem"],[1,"text-muted","fs-8","mb-3"],[1,"btn","btn-primary","btn-sm","px-2",3,"click"]],template:function(e,l){e&1&&(i(0,"div",1),m(1,le,7,0,"div",2)(2,ce,4,1,"div",3),m(3,de,4,1,"div",4),m(4,je,60,13)(5,Ke,11,0,"div",5),n()),e&2&&(o(),p(l.loading()?1:l.error()?2:-1),o(2),p(l.success()?3:-1),o(),p(l.registration()?4:l.loading()?-1:5))},dependencies:[Y,Z,q],encapsulation:2,changeDetection:0})};export{oe as RegistrationDetailComponent};

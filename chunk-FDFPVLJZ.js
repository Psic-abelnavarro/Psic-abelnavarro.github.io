import{a as fe}from"./chunk-XEAQFPKZ.js";import"./chunk-VF5TSERA.js";import"./chunk-YUNYRAF7.js";import"./chunk-FK6H3RFT.js";import{b as ue}from"./chunk-MQP2EC7J.js";import{a as me}from"./chunk-4XQXH5E7.js";import{a as pe}from"./chunk-W55XPYIR.js";import{c as Y,e as Z,f as ee,h as te,k as ie,l as ne,m as ae,n as re,o as oe,s as le,t as se,u as ce}from"./chunk-KBXA6SDK.js";import{a as de}from"./chunk-CYLPXQIR.js";import{a as I}from"./chunk-TMGCMHHJ.js";import{e as W,j as A}from"./chunk-IIPOJGOQ.js";import{h as U,i as Q,l as J}from"./chunk-C3HOFUSH.js";import{$a as j,Ab as G,Bb as X,Bc as H,D as N,Da as o,Db as k,Fb as E,Gb as l,H as O,Hb as C,Ib as V,Na as B,Rb as P,Vb as T,Xb as F,_ as y,ab as M,ac as x,bb as b,cb as _,da as p,ea as u,eb as L,fb as S,gb as w,gc as K,hb as f,ia as z,ib as i,jb as n,kb as c,ma as h,rb as v,sb as g,ub as d,yc as q,zb as $}from"./chunk-5W5GNUFO.js";import"./chunk-LJ5XHLMQ.js";import{h as D}from"./chunk-FK42CRUA.js";var be=["confirmModal"],Ce=()=>[1,2,3,4,5,6,7,8],_e=(r,t)=>t.value;function ve(r,t){if(r&1&&(i(0,"span",16),l(1),n()),r&2){let e=d();o(),C(e.totalItems())}}function he(r,t){r&1&&c(0,"span",20)}function xe(r,t){r&1&&c(0,"i",21)}function Se(r,t){if(r&1){let e=v();i(0,"li")(1,"button",62),g("click",function(){p(e);let s=d(2);return u(s.exportSelectedToCSV())}),c(2,"i",64),i(3,"span",15),l(4),n()()()}if(r&2){let e=d(2);o(4),V("Solo seleccionados (",e.selectedCertificates().length,")")}}function we(r,t){if(r&1){let e=v();i(0,"div",25)(1,"button",59),c(2,"i",60),i(3,"span",22),l(4,"Exportar"),n()(),i(5,"ul",61)(6,"li")(7,"button",62),g("click",function(){p(e);let s=d();return u(s.exportToCSV())}),c(8,"i",63),i(9,"span",15),l(10,"Todos los certificados"),n()()(),b(11,Se,5,1,"li"),n()()}if(r&2){let e=d();o(11),_(e.selectedCertificates().length>0?11:-1)}}function ye(r,t){if(r&1&&(i(0,"span",33),l(1),n()),r&2){let e=d();o(),C(e.activeFiltersCount())}}function Ee(r,t){if(r&1){let e=v();i(0,"button",65),g("click",function(){p(e);let s=d();return u(s.clearAllFilters())}),c(1,"i",66),n()}}function Ve(r,t){if(r&1){let e=v();i(0,"button",81),g("click",function(){p(e),d();let s=X(10);return d().clearSearch(),u(s.focus())}),c(1,"i",82),n()}}function Te(r,t){if(r&1&&(i(0,"option",46),l(1),n()),r&2){let e=t.$implicit;f("value",e.value),o(),C(e.label)}}function Fe(r,t){if(r&1&&(i(0,"option",46),l(1),n()),r&2){let e=t.$implicit;f("value",e.id),o(),C(e.name)}}function ke(r,t){if(r&1&&(i(0,"div",38)(1,"form",67)(2,"div",68)(3,"div",69)(4,"label",70),l(5,"Buscar por texto"),n(),i(6,"div",71)(7,"span",72),c(8,"i",73),n(),c(9,"input",74,1),b(11,Ve,2,0,"button",75),n()(),i(12,"div",69)(13,"label",70),l(14,"Estado"),n(),i(15,"select",76)(16,"option",46),l(17,"Todos los estados"),n(),S(18,Te,2,2,"option",46,_e),n()(),i(20,"div",69)(21,"label",70),l(22,"Plantilla"),n(),i(23,"select",77)(24,"option",46),l(25,"Todas las plantillas"),n(),S(26,Fe,2,2,"option",46,M().trackByTemplateId,!0),n()(),i(28,"div",78)(29,"label",70),l(30,"Desde"),n(),c(31,"input",79),n(),i(32,"div",78)(33,"label",70),l(34,"Hasta"),n(),c(35,"input",80),n()()()()),r&2){let e,a=d();o(),f("formGroup",a.filtersForm),o(10),_((e=a.filtersForm.get("searchText"))!=null&&e.value?11:-1),o(5),f("value",null),o(2),w(a.statusOptions()),o(6),f("value",null),o(2),w(a.templates())}}function Ie(r,t){if(r&1&&(i(0,"span",42),l(1),n()),r&2){let e=d();o(),C(e.totalItems())}}function De(r,t){if(r&1&&(i(0,"option",46),l(1),n()),r&2){let e=t.$implicit;f("value",e),o(),C(e)}}function Me(r,t){r&1&&(i(0,"div",89)(1,"div",90)(2,"div",91)(3,"div",28),c(4,"span",92),i(5,"div",93),c(6,"span",94)(7,"span",95),n()()(),i(8,"div",96)(9,"div",97),c(10,"span",98),i(11,"div",99)(12,"div",100),c(13,"span",101)(14,"span",102),n(),i(15,"div",103),c(16,"span",104)(17,"span",105),n()()(),i(18,"div",106)(19,"div"),c(20,"span",107)(21,"div",108),n(),i(22,"div"),c(23,"span",107)(24,"div",108),n(),i(25,"div"),c(26,"span",107)(27,"div",108),n()()(),i(28,"div",109)(29,"div",110),c(30,"span",111)(31,"span",111)(32,"span",111),n()()()())}function Le(r,t){r&1&&(i(0,"div",83),S(1,Me,33,0,"div",89,L),n()),r&2&&(o(),w(P(0,Ce)))}function Re(r,t){r&1&&(i(0,"tr")(1,"td",120),c(2,"span",121),n(),i(3,"td",120)(4,"div",29),c(5,"span",122),i(6,"div",99)(7,"div",100),c(8,"span",123)(9,"span",124),n()()()(),i(10,"td",125)(11,"div",100),c(12,"span",126)(13,"span",127),n()(),i(14,"td",128),c(15,"span",129),n(),i(16,"td",120),c(17,"span",130),n(),i(18,"td",131)(19,"div",100),c(20,"span",124),n()(),i(21,"td",120)(22,"div",93),c(23,"span",111)(24,"span",111)(25,"span",111),n()()())}function Pe(r,t){r&1&&(i(0,"div",84)(1,"table",112)(2,"thead",113)(3,"tr")(4,"th",114),l(5,"Sel."),n(),i(6,"th",115),l(7,"Certificado"),n(),i(8,"th",116),l(9,"Evento"),n(),i(10,"th",117),l(11,"Rol"),n(),i(12,"th",115),l(13,"Estado"),n(),i(14,"th",118),l(15,"Fecha"),n(),i(16,"th",119),l(17,"Acciones"),n()()(),i(18,"tbody"),S(19,Re,26,0,"tr",null,L),n()()()),r&2&&(o(19),w(P(0,Ce)))}function Ae(r,t){if(r&1&&(i(0,"div",56),b(1,Le,3,1,"div",83)(2,Pe,21,1,"div",84),i(3,"div",85)(4,"div",86)(5,"span",87),l(6,"Cargando..."),n()(),i(7,"span",88),l(8,"Cargando certificados..."),n()()()),r&2){let e=d();o(),_(e.viewMode()==="cards"?1:2)}}function Ne(r,t){if(r&1){let e=v();i(0,"div")(1,"h6",134),l(2,"No se encontraron certificados"),n(),i(3,"p",135),l(4," No hay certificados que coincidan con los filtros aplicados. "),n(),i(5,"div",136)(6,"button",137),g("click",function(){p(e);let s=d(2);return u(s.clearAllFilters())}),c(7,"i",138),l(8,"Limpiar filtros "),n(),i(9,"button",139),g("click",function(){p(e);let s=d(2);return u(s.refreshData())}),c(10,"i",21),l(11,"Actualizar "),n()()()}}function Oe(r,t){r&1&&(i(0,"div")(1,"h6",134),l(2,"No hay certificados"),n(),i(3,"p",135),l(4," A\xFAn no se han generado certificados."),c(5,"br"),l(6," Comienza creando los primeros certificados. "),n(),i(7,"a",140),c(8,"i",24),l(9,"Generar Certificados "),n()())}function ze(r,t){if(r&1&&(i(0,"div",57)(1,"div",132),c(2,"i",133),n(),b(3,Ne,12,0,"div")(4,Oe,10,0,"div"),n()),r&2){let e=d();o(3),_(e.hasActiveFilters()?3:4)}}function Be(r,t){if(r&1){let e=v();i(0,"button",164),g("click",function(){p(e);let s=d().$implicit,m=d(3);return u(m.confirmRegenerateCertificate(s))}),c(1,"i",165),n()}}function je(r,t){if(r&1){let e=v();i(0,"button",166),g("click",function(){p(e);let s=d().$implicit,m=d(3);return u(m.confirmRevokeCertificate(s))}),c(1,"i",66),n()}if(r&2){let e=d(4);f("disabled",e.loading())}}function $e(r,t){if(r&1){let e=v();i(0,"div",89)(1,"div",90)(2,"div",141)(3,"div",142)(4,"input",143),g("change",function(){let s=p(e).$implicit,m=d(3);return u(m.toggleSelection(s.id))}),n()(),i(5,"span",144),c(6,"i",36),n()(),i(7,"div",96)(8,"div",145)(9,"div",146),c(10,"i",147),n(),i(11,"div",148)(12,"div",149),l(13),n(),i(14,"div",150),l(15),n()()(),i(16,"div",151)(17,"div",152),c(18,"i",153),i(19,"span",154),l(20),n()(),i(21,"div",155)(22,"span"),l(23),T(24,"date"),n(),i(25,"span",156),l(26),n()()(),i(27,"div",106)(28,"div")(29,"div",157),l(30),n(),i(31,"div",158),l(32,"Descargas"),n()(),i(33,"div")(34,"div",157),l(35),n(),i(36,"div",158),l(37,"Verificaciones"),n()(),i(38,"div")(39,"div",157),l(40),n(),i(41,"div",158),l(42,"Emitido"),n()()()(),i(43,"div",109)(44,"div",159)(45,"button",160),g("click",function(){let s=p(e).$implicit,m=d(3);return u(m.confirmDownloadCertificate(s))}),c(46,"i",161),n(),b(47,Be,2,0,"button",162),b(48,je,2,1,"button",163),n()()()()}if(r&2){let e=t.$implicit,a=d(3);o(),E(a.getTableRowClass(e.status)),k("border-primary",a.selectedCertificates().includes(e.id))("bg-primary-subtle",a.selectedCertificates().includes(e.id)),o(3),f("id","card-select-"+e.id)("checked",a.selectedCertificates().includes(e.id)),o(),E(a.getStatusBadgeClass(e.status)),o(),E("bi-"+a.getStatusIcon(e.status)),o(7),C(e.participantName),o(2),C(e.participantEmail),o(4),f("title",e.eventTitle),o(),V(" ",e.eventTitle," "),o(3),C(F(24,24,e.eventDate,"dd/MM/yyyy")),o(3),C(e.roleName),o(4),C(e.downloadCount),o(5),C(e.verificationCount),o(5),C(a.formatDate(e.issuedAt)),o(5),f("disabled",!a.canDownload(e)),o(2),_(a.canRegenerate(e)?47:-1),o(),_(a.canRevoke(e)?48:-1)}}function Ge(r,t){if(r&1&&(i(0,"div",56)(1,"div",83),S(2,$e,49,27,"div",89,M().trackByCertificateId,!0),n()()),r&2){let e=d(2);o(2),w(e.certificates())}}function Xe(r,t){if(r&1){let e=v();i(0,"button",164),g("click",function(){p(e);let s=d().$implicit,m=d(3);return u(m.confirmRegenerateCertificate(s))}),c(1,"i",165),n()}}function Ke(r,t){if(r&1){let e=v();i(0,"button",166),g("click",function(){p(e);let s=d().$implicit,m=d(3);return u(m.confirmRevokeCertificate(s))}),c(1,"i",66),n()}if(r&2){let e=d(4);f("disabled",e.loading())}}function qe(r,t){if(r&1){let e=v();i(0,"tr")(1,"td",120)(2,"div",169)(3,"input",143),g("change",function(){let s=p(e).$implicit,m=d(3);return u(m.toggleSelection(s.id))}),n()()(),i(4,"td",120)(5,"div",29)(6,"div",177),c(7,"i",147),n(),i(8,"div",178)(9,"div",149),l(10),n(),i(11,"div",179),l(12),n(),i(13,"div",180),l(14),T(15,"date"),n()()()(),i(16,"td",125)(17,"div",178)(18,"div",181),l(19),n(),i(20,"div",88),l(21),T(22,"date"),n()()(),i(23,"td",128)(24,"span",42),l(25),n()(),i(26,"td",120)(27,"span",144),c(28,"i",36),i(29,"span",182),l(30),n()()(),i(31,"td",131)(32,"div",183)(33,"span",184),c(34,"i",60),l(35),n(),i(36,"span",184),c(37,"i",185),l(38),n()()(),i(39,"td",131)(40,"div",15)(41,"div",186),l(42),T(43,"date"),n(),i(44,"div",187),l(45),T(46,"date"),n()()(),i(47,"td",188)(48,"div",189)(49,"button",160),g("click",function(){let s=p(e).$implicit,m=d(3);return u(m.confirmDownloadCertificate(s))}),c(50,"i",161),n(),b(51,Xe,2,0,"button",162),b(52,Ke,2,1,"button",163),n()()()}if(r&2){let e=t.$implicit,a=d(3);E(a.getTableRowClass(e.status)),k("table-active",a.selectedCertificates().includes(e.id)),o(3),f("id","select-"+e.id)("checked",a.selectedCertificates().includes(e.id)),o(7),C(e.participantName),o(2),C(e.eventTitle),o(2),C(F(15,25,e.eventDate,"dd/MM/yyyy")),o(4),f("title",e.eventTitle),o(),V(" ",e.eventTitle," "),o(2),C(F(22,28,e.eventDate,"dd/MM/yyyy")),o(4),V(" ",e.roleName," "),o(2),E(a.getStatusBadgeClass(e.status)),o(),E("bi-"+a.getStatusIcon(e.status)),o(2),C(a.getStatusLabel(e.status)),o(5),V("",e.downloadCount," "),o(3),V("",e.verificationCount," "),o(4),C(F(43,31,e.issuedAt,"dd/MM/yyyy")),o(3),C(F(46,34,e.issuedAt,"HH:mm")),o(4),f("disabled",!a.canDownload(e)),o(2),_(a.canRegenerate(e)?51:-1),o(),_(a.canRevoke(e)?52:-1)}}function He(r,t){if(r&1){let e=v();i(0,"div",84)(1,"table",167)(2,"thead",113)(3,"tr")(4,"th",168)(5,"div",169)(6,"input",170),g("change",function(){p(e);let s=d(2);return u(s.toggleSelectAll())}),n()()(),i(7,"th",171),l(8,"Participante"),n(),i(9,"th",172),l(10,"Evento"),n(),i(11,"th",173),l(12,"Rol"),n(),i(13,"th",171),l(14,"Estado"),n(),i(15,"th",174),l(16,"Estad\xEDsticas"),n(),i(17,"th",174),l(18,"Fecha"),n(),i(19,"th",175),l(20,"Acciones"),n()()(),i(21,"tbody"),S(22,qe,53,37,"tr",176,M().trackByCertificateId,!0),n()()()}if(r&2){let e=d(2);o(6),f("checked",e.areAllSelected())("indeterminate",e.areSomeSelected()),o(16),w(e.certificates())}}function Ue(r,t){if(r&1&&(b(0,Ge,4,0,"div",56),b(1,He,24,2,"div",84)),r&2){let e=d();_(e.viewMode()==="cards"?0:-1),o(),_(e.viewMode()==="table"?1:-1)}}function Qe(r,t){if(r&1){let e=v();i(0,"div",58)(1,"app-pagination",190),g("pageChange",function(s){p(e);let m=d();return u(m.goToPage(s))})("pageSizeChange",function(s){p(e);let m=d();return u(m.onPageSizeChange(s))}),n()()}if(r&2){let e=d();o(),f("totalItems",e.totalItems())("pageSize",e.pageSize())("currentPage",e.currentPage())("showPageSizeSelector",!0)("pageSizeOptions",e.pageSizeOptions)("showGoToPage",!0)("showRangeInfo",!0)("showFirstLastButtons",!0)("maxVisiblePages",5)("density","compact")}}var ge=class r{fb=y(le);router=y(U);destroyRef=y(z);certificateService=y(ue);staticDataService=y(de);CertificateGeneratorService=y(fe);confirmModal=K("confirmModal");pageSizeOptions=A.pagination.pageSizeOptions;loadingState=h("idle");loading=x(()=>this.loadingState()==="loading");error=h(null);showFilters=h(!1);viewMode=h("cards");currentPage=h(1);pageSize=h(A.pagination.defaultPageSize);totalItems=h(0);totalPages=x(()=>Math.ceil(this.totalItems()/this.pageSize()));certificates=h([]);templates=h([]);selectedCertificates=h([]);sortOptions=h({field:"issued_at",direction:"desc"});filtersForm=this.fb.group({searchText:this.fb.control(null),status:this.fb.control(null),templateId:this.fb.control(null),issuedFrom:this.fb.control(null),issuedTo:this.fb.control(null)});CertificateStatus=W;confirmAction=h({title:"Confirmar Acci\xF3n",message:"\xBFEst\xE1 seguro?",confirmText:"Confirmar",callback:()=>{}});formFilters=h({searchText:null,status:null,templateId:null,issuedFrom:null,issuedTo:null});statusOptions=x(()=>[{value:"valid",label:"V\xE1lido"},{value:"revoked",label:"Revocado"},{value:"expired",label:"Expirado"}]);statusSelectItems=x(()=>this.statusOptions().map(t=>({id:t.value,label:t.label,badge:{text:t.label,color:this.getStatusBadgeColorForMultiSelect(t.value)},icon:this.getStatusIcon(t.value)})));hasActiveFilters=x(()=>{let t=this.formFilters();return!!(t.searchText?.trim()||t.status||t.templateId||t.issuedFrom||t.issuedTo)});activeFiltersCount=x(()=>{let t=this.formFilters(),e=0;return t.searchText?.trim()&&e++,t.status&&e++,t.templateId&&e++,(t.issuedFrom||t.issuedTo)&&e++,e});areAllSelected=x(()=>{let t=this.certificates(),e=this.selectedCertificates();return t.length>0&&t.every(a=>e.includes(a.id))});areSomeSelected=x(()=>{let t=this.certificates(),e=this.selectedCertificates();return t.some(a=>e.includes(a.id))&&!this.areAllSelected()});trackByCertificateId=(t,e)=>e.id;trackByTemplateId=(t,e)=>e.id;trackByStatusId=(t,e)=>e.id;Math=Math;ngOnInit(){this.formFilters.set(this.filtersForm.value),this.loadInitialData(),this.setupSubscriptions(),this.loadViewMode()}loadInitialData(){this.templates.set([{id:1,name:"Plantilla Est\xE1ndar",description:"Plantilla por defecto"},{id:2,name:"Plantilla Premium",description:"Plantilla con dise\xF1o premium"}]),this.loadCertificates()}setupSubscriptions(){this.filtersForm.valueChanges.pipe(N(300),O(),I(this.destroyRef)).subscribe(t=>{this.formFilters.set(t),this.currentPage.set(1),this.loadCertificates()})}loadViewMode(){let t=localStorage.getItem("certificate-view-mode");t&&this.viewMode.set(t)}loadCertificates(){this.loadingState.set("loading"),this.error.set(null);let t=this.buildFilters();this.certificateService.getCertificates(this.currentPage(),this.pageSize(),t,this.sortOptions()).pipe(I(this.destroyRef)).subscribe({next:e=>{this.certificates.set(e.items),this.totalItems.set(e.pagination.totalItems),this.loadingState.set("success")},error:e=>{console.error("Error loading certificates:",e),this.error.set("Error al cargar los certificados"),this.loadingState.set("error")}})}buildFilters(){let t=this.filtersForm.value,e={};return t.searchText?.trim()&&(e.search=t.searchText.trim()),t.status&&(e.status=[t.status]),t.templateId&&(e.templateId=t.templateId),t.issuedFrom&&(e.issuedFrom=t.issuedFrom),t.issuedTo&&(e.issuedTo=t.issuedTo),e}toggleFiltersPanel(){this.showFilters.update(t=>!t)}clearAllFilters(){this.selectedCertificates.set([]),this.currentPage.set(1),this.formFilters.set({searchText:null,status:null,templateId:null,issuedFrom:null,issuedTo:null}),this.filtersForm.reset()}clearSearch(){this.filtersForm.patchValue({searchText:""})}onSortChange(t){let e=t.target,[a,s]=e.value.split("|");this.sortOptions.set({field:a,direction:s}),this.loadCertificates()}onPageSizeChange(t){if(typeof t=="number")this.pageSize.set(t);else{let e=t.target;this.pageSize.set(Number(e.value))}this.currentPage.set(1),this.loadCertificates()}goToPage(t){t>=1&&t<=this.totalPages()&&(this.currentPage.set(t),this.loadCertificates())}onPageChange(t){this.goToPage(t)}setViewMode(t){this.viewMode.set(t),localStorage.setItem("certificate-view-mode",t)}setPageSize(t){this.pageSize.set(Number(t)),this.currentPage.set(1),this.loadCertificates()}toggleSelection(t){this.selectedCertificates.update(e=>e.indexOf(t)>=0?e.filter(s=>s!==t):[...e,t])}toggleSelectAll(){this.areAllSelected()?this.selectedCertificates.set([]):this.selectedCertificates.set(this.certificates().map(e=>e.id))}isSelected(t){return this.selectedCertificates().includes(t)}getStatusBadgeClass(t){switch(t){case"valid":return"bg-success-subtle text-success-emphasis border border-success-subtle";case"revoked":return"bg-danger-subtle text-danger-emphasis border border-danger-subtle";case"expired":return"bg-warning-subtle text-warning-emphasis border border-warning-subtle";default:return"bg-secondary-subtle text-secondary-emphasis border border-secondary-subtle"}}getStatusIcon(t){return{valid:"check-circle",revoked:"x-circle",expired:"clock"}[t]||"question-circle"}getStatusLabel(t){return{valid:"V\xE1lido",revoked:"Revocado",expired:"Expirado"}[t]||"Estado Desconocido"}getStatusBadgeColorForMultiSelect(t){switch(t){case"valid":return"success";case"revoked":return"danger";case"expired":return"warning";default:return"secondary"}}getTableRowClass(t){switch(t){case"valid":return"";case"revoked":return"table-danger";case"expired":return"table-warning";default:return""}}formatDate(t){try{return new Date(t).toLocaleDateString("es-PE",{day:"2-digit",month:"2-digit",year:"numeric"})}catch{return t}}formatDateTime(t){try{return new Date(t).toLocaleString("es-PE",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return t}}canDownload(t){return t.status==="valid"}canRegenerate(t){return t.status==="valid"||t.status==="expired"}canRevoke(t){return t.status==="valid"}exportToCSV(){let t=this.generateCSVData(this.certificates());this.downloadCSV(t,"certificados.csv")}exportSelectedToCSV(){let t=this.certificates().filter(a=>this.selectedCertificates().includes(a.id)),e=this.generateCSVData(t);this.downloadCSV(e,"certificados_seleccionados.csv")}generateCSVData(t){let a=[["ID","Participante","Email","Evento","Fecha Evento","Rol","Estado","C\xF3digo Verificaci\xF3n","Fecha Emisi\xF3n","Descargas","Verificaciones"].join(",")];return t.forEach(s=>{let m=[s.id,`"${s.participantName}"`,s.participantEmail,`"${s.eventTitle}"`,s.eventDate,`"${s.roleName}"`,this.getStatusLabel(s.status),s.verificationCode||"",s.issuedAt,s.downloadCount,s.verificationCount];a.push(m.join(","))}),a.join(`
`)}downloadCSV(t,e){let a=new Blob([t],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),m=URL.createObjectURL(a);s.setAttribute("href",m),s.setAttribute("download",e),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)}refreshData(){this.loadCertificates()}confirmDownloadCertificate(t){this.canDownload(t)&&(this.confirmAction.set({title:"Descargar Certificado",message:`\xBFDescargar el certificado de ${t.participantName}?`,confirmText:"S\xED, Descargar",callback:()=>D(this,null,function*(){return yield this.downloadCertificate(t.id)})}),this.confirmModal()?.show())}confirmRegenerateCertificate(t){this.canRegenerate(t)&&(this.confirmAction.set({title:"Regenerar Certificado",message:`\xBFRegenerar el certificado de ${t.participantName}? Esto crear\xE1 una nueva versi\xF3n.`,confirmText:"S\xED, Regenerar",callback:()=>this.regenerateCertificate(t.id)}),this.confirmModal()?.show())}confirmRevokeCertificate(t){this.canRevoke(t)&&(this.confirmAction.set({title:"Revocar Certificado",message:`\xBFRevocar el certificado de ${t.participantName}? Esta acci\xF3n no se puede deshacer.`,confirmText:"S\xED, Revocar",callback:()=>this.revokeCertificate(t.id)}),this.confirmModal()?.show())}downloadCertificate(t){return D(this,null,function*(){try{let e=this.certificates().find(R=>R.id===t);if(!e){console.error("Certificado no encontrado");return}let a=yield fetch("/template/certificado-1756515494650.json");if(!a.ok)throw new Error("No se pudo cargar la plantilla del certificado");let s=yield a.json(),m=yield this.CertificateGeneratorService.generarCertificadoPDFPorCodigo(s,e.shortCode,{formato:"A4",orientacion:"landscape",nombreArchivo:`certificado-${e.verificationCode}`});m.success?console.log("Certificado descargado exitosamente desde lista"):console.error("Error al generar certificado:",m.message)}catch(e){console.error("Error al descargar certificado:",e)}})}regenerateCertificate(t){this.certificateService.regenerateCertificate(t).pipe(I(this.destroyRef)).subscribe({next:e=>{e.success?this.loadCertificates():this.error.set(e.message||"Error al regenerar el certificado")},error:e=>{console.error("Error regenerating certificate:",e),this.error.set("Error al regenerar el certificado")}})}revokeCertificate(t){this.certificateService.revokeCertificate(t,"Revocado desde lista de certificados").pipe(I(this.destroyRef)).subscribe({next:e=>{e?this.loadCertificates():this.error.set("Error al revocar el certificado")},error:e=>{console.error("Error revoking certificate:",e),this.error.set("Error al revocar el certificado")}})}onConfirmAccepted(){return D(this,null,function*(){yield this.confirmAction().callback()})}onConfirmCancelled(){}exportCertificates(){this.exportToCSV()}generateBulkCertificates(){this.router.navigate(["/certificates/generate"])}refreshCertificates(){this.refreshData()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=B({type:r,selectors:[["app-certificate-list"]],viewQuery:function(e,a){e&1&&$(a.confirmModal,be,5),e&2&&G()},decls:77,vars:24,consts:[["confirmModal",""],["searchInput",""],[1,"container-fluid","py-3"],[3,"accepted","cancelled","title","message","confirmText"],["aria-label","breadcrumb",1,"mb-3"],[1,"breadcrumb","mb-0","small"],[1,"breadcrumb-item"],["routerLink","/",1,"text-decoration-none","link-primary"],[1,"bi","bi-house-door","me-1"],[1,"d-none","d-sm-inline"],["aria-current","page",1,"breadcrumb-item","active"],[1,"d-flex","flex-column","flex-md-row","align-items-start","align-items-md-center","justify-content-between","gap-3","mb-4"],[1,"order-1","order-md-0"],[1,"h6","mb-1","fw-normal","d-flex","align-items-center"],[1,"bi","bi-award","me-2","text-primary"],[1,"small"],[1,"badge","text-bg-primary","ms-2","small"],[1,"text-muted","small","mb-0"],[1,"d-flex","flex-wrap","gap-2","order-0","order-md-1"],["type","button","title","Actualizar datos",1,"btn","btn-outline-secondary","btn-sm","d-flex","align-items-center",3,"click","disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-1"],[1,"bi","bi-arrow-clockwise","me-1"],[1,"d-none","d-sm-inline","small"],["routerLink","/certificados/generar","title","Generar certificados",1,"btn","btn-primary","btn-sm","d-flex","align-items-center"],[1,"bi","bi-plus-circle","me-1"],["role","group",1,"btn-group"],[1,"card","border-0","shadow-sm","mb-4"],[1,"card-header","bg-light","border-bottom","py-2"],[1,"d-flex","align-items-center","justify-content-between"],[1,"d-flex","align-items-center","gap-2"],[1,"d-flex","align-items-center","gap-1"],[1,"bi","bi-funnel","text-primary"],[1,"mb-0","fw-normal","small"],[1,"badge","text-bg-primary","rounded-pill","small"],["role","group",1,"btn-group","btn-group-sm"],["type","button",1,"btn","btn-outline-secondary","border-0","btn-sm",3,"click","title"],[1,"bi"],["type","button","title","Limpiar todos los filtros",1,"btn","btn-outline-danger","border-0","btn-sm"],[1,"card-body","py-3"],[1,"card","border-0","shadow-sm"],[1,"d-flex","align-items-center","gap-2","flex-grow-1","overflow-hidden"],[1,"bi","bi-list-ul","text-primary"],[1,"badge","text-bg-info","small"],[1,"d-flex","align-items-center","gap-1","ms-auto","me-2"],[1,"form-label","mb-0","text-muted","small","d-none","d-md-inline"],["aria-label","Elementos por p\xE1gina",1,"form-select","form-select-sm","small",2,"width","auto","min-width","70px",3,"change","value"],[3,"value"],["role","group","aria-label","Modo de vista",1,"btn-group","btn-group-sm","flex-shrink-0"],["type","radio","name","viewMode","id","cardsView","autocomplete","off",1,"btn-check",3,"change","checked"],["for","cardsView","title","Vista tarjetas",1,"btn","btn-outline-primary","btn-sm","px-2"],[1,"bi","bi-grid-3x3-gap"],[1,"d-none","d-xl-inline","ms-1","small"],["type","radio","name","viewMode","id","tableView","autocomplete","off",1,"btn-check",3,"change","checked"],["for","tableView","title","Vista tabla",1,"btn","btn-outline-primary","btn-sm","px-2"],[1,"bi","bi-table"],[1,"card-body","p-0"],[1,"p-2"],[1,"text-center","py-4"],[1,"card-footer","bg-light","border-top","py-2"],["type","button","data-bs-toggle","dropdown","aria-expanded","false","title","Opciones de exportaci\xF3n",1,"btn","btn-success","btn-sm","dropdown-toggle","d-flex","align-items-center"],[1,"bi","bi-download","me-1"],[1,"dropdown-menu"],["type","button",1,"dropdown-item",3,"click"],[1,"bi","bi-file-earmark-spreadsheet","me-2"],[1,"bi","bi-file-earmark-check","me-2"],["type","button","title","Limpiar todos los filtros",1,"btn","btn-outline-danger","border-0","btn-sm",3,"click"],[1,"bi","bi-x-circle"],[3,"formGroup"],[1,"row","g-2"],[1,"col-12","col-md-6","col-lg-4","col-xl-3"],[1,"form-label","fw-normal","small","mb-1"],[1,"input-group","input-group-sm"],[1,"input-group-text","bg-light","border-end-0"],[1,"bi","bi-search","text-muted"],["type","text","placeholder","Participante, evento, c\xF3digo...","formControlName","searchText",1,"form-control","border-start-0","bg-light","form-control-sm"],["type","button","title","Limpiar b\xFAsqueda",1,"btn","btn-outline-secondary","border-start-0","btn-sm"],["formControlName","status",1,"form-select","bg-light","form-select-sm"],["formControlName","templateId",1,"form-select","bg-light","form-select-sm"],[1,"col-6","col-sm-3","col-lg-2"],["type","date","formControlName","issuedFrom",1,"form-control","bg-light","form-control-sm"],["type","date","formControlName","issuedTo",1,"form-control","bg-light","form-control-sm"],["type","button","title","Limpiar b\xFAsqueda",1,"btn","btn-outline-secondary","border-start-0","btn-sm",3,"click"],[1,"bi","bi-x"],[1,"row","row-cols-1","row-cols-sm-2","row-cols-lg-3","row-cols-xl-4","g-2"],[1,"table-responsive"],[1,"text-center","mt-3"],["role","status",1,"spinner-border","text-primary","me-2",2,"width","1rem","height","1rem"],[1,"visually-hidden"],[1,"text-muted","small"],[1,"col"],[1,"card","h-100","border-0","shadow-sm"],[1,"card-header","border-0","py-1"],[1,"placeholder","col-2","bg-secondary","rounded",2,"height","16px"],[1,"d-flex","gap-1"],[1,"placeholder","bg-success","rounded-pill",2,"width","50px","height","16px"],[1,"placeholder","bg-warning","rounded-pill",2,"width","40px","height","16px"],[1,"card-body","py-2"],[1,"d-flex","align-items-start","gap-2","mb-2"],[1,"placeholder","bg-primary","rounded-circle","flex-shrink-0",2,"width","28px","height","28px"],[1,"flex-grow-1"],[1,"placeholder-glow"],[1,"placeholder","col-9","mb-1","fw-bold",2,"height","16px"],[1,"placeholder","col-7","small",2,"height","14px"],[1,"d-flex","align-items-center","justify-content-between","small","mt-1"],[1,"placeholder","col-4",2,"height","12px"],[1,"placeholder","bg-info","rounded-pill",2,"width","50px","height","14px"],[1,"d-flex","justify-content-between","text-center","small","mb-2"],[1,"placeholder","col-8","mb-1",2,"height","12px"],[1,"placeholder","col-6",2,"height","10px"],[1,"card-footer","border-0","py-1"],[1,"d-flex","justify-content-end","gap-1"],[1,"placeholder","bg-secondary","rounded",2,"width","24px","height","24px"],[1,"table","table-hover","mb-0","table-sm"],[1,"table-light"],["scope","col",1,"border-0",2,"width","30px"],["scope","col",1,"fw-semibold","border-0"],["scope","col",1,"fw-semibold","border-0","d-none","d-md-table-cell"],["scope","col",1,"fw-semibold","border-0","d-none","d-lg-table-cell"],["scope","col",1,"fw-semibold","border-0","d-none","d-xl-table-cell"],["scope","col",1,"fw-semibold","border-0",2,"width","100px"],[1,"border-0"],[1,"placeholder","bg-secondary","rounded",2,"width","14px","height","14px"],[1,"placeholder","bg-primary","rounded-circle",2,"width","24px","height","24px"],[1,"placeholder","col-10","mb-1","small","fw-bold"],[1,"placeholder","col-8","small"],[1,"border-0","d-none","d-md-table-cell"],[1,"placeholder","col-9","mb-1","small"],[1,"placeholder","col-6","small"],[1,"border-0","d-none","d-lg-table-cell"],[1,"placeholder","bg-info","rounded-pill",2,"width","60px","height","18px"],[1,"placeholder","bg-success","rounded-pill",2,"width","70px","height","20px"],[1,"border-0","d-none","d-xl-table-cell"],[1,"text-muted","mb-3"],[1,"bi","bi-award",2,"font-size","3rem","opacity","0.3"],[1,"text-muted","mb-2"],[1,"text-muted","small","mb-3"],[1,"d-flex","gap-2","justify-content-center","flex-wrap"],[1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"bi","bi-funnel","me-1"],[1,"btn","btn-outline-secondary","btn-sm",3,"click"],["routerLink","/certificados/generar",1,"btn","btn-primary","btn-sm"],[1,"card-header","border-0","py-1","d-flex","align-items-center","justify-content-between"],[1,"form-check","form-check-sm","mb-0"],["type","checkbox",1,"form-check-input",3,"change","id","checked"],[1,"badge","rounded-pill","small"],[1,"d-flex","align-items-center","gap-2","mb-2"],[1,"bg-primary","bg-opacity-10","rounded-circle","d-flex","align-items-center","justify-content-center","flex-shrink-0",2,"width","32px","height","32px"],[1,"bi","bi-person-fill","text-primary","small"],[1,"min-w-0","flex-grow-1"],[1,"fw-medium","small","text-truncate"],[1,"text-muted","small","text-truncate"],[1,"mb-2"],[1,"d-flex","align-items-start","gap-1","mb-1"],[1,"bi","bi-calendar-event","text-primary","small","mt-1","flex-shrink-0"],[1,"small","text-truncate",3,"title"],[1,"d-flex","align-items-center","justify-content-between","small","text-muted"],[1,"badge","text-bg-info"],[1,"fw-medium","text-body"],[1,"text-muted",2,"font-size","0.7rem"],[1,"d-flex","gap-1","justify-content-center"],["title","Descargar",1,"btn","btn-outline-info","btn-sm",3,"click","disabled"],[1,"bi","bi-download"],["title","Regenerar",1,"btn","btn-outline-warning","btn-sm"],["title","Revocar",1,"btn","btn-outline-danger","btn-sm",3,"disabled"],["title","Regenerar",1,"btn","btn-outline-warning","btn-sm",3,"click"],[1,"bi","bi-arrow-repeat"],["title","Revocar",1,"btn","btn-outline-danger","btn-sm",3,"click","disabled"],[1,"table","table-hover","table-sm","align-middle","mb-0"],["scope","col",1,"border-0",2,"width","40px"],[1,"form-check","form-check-sm"],["type","checkbox","id","selectAll",1,"form-check-input",3,"change","checked","indeterminate"],["scope","col",1,"border-0","fw-medium"],["scope","col",1,"border-0","fw-medium","d-none","d-md-table-cell"],["scope","col",1,"border-0","fw-medium","d-none","d-lg-table-cell"],["scope","col",1,"border-0","fw-medium","d-none","d-xl-table-cell"],["scope","col",1,"border-0","text-center",2,"width","120px"],[3,"table-active","class"],[1,"bg-primary","bg-opacity-10","rounded-circle","d-flex","align-items-center","justify-content-center","flex-shrink-0",2,"width","28px","height","28px"],[1,"min-w-0"],[1,"text-muted","small","text-truncate","d-md-none"],[1,"text-muted","small","d-md-none"],[1,"fw-medium","small","text-truncate",3,"title"],[1,"d-none","d-lg-inline","ms-1"],[1,"d-flex","gap-2","small"],[1,"badge","bg-body-secondary","text-body"],[1,"bi","bi-shield-check","me-1"],[1,"fw-medium"],[1,"text-muted"],[1,"border-0","text-center"],[1,"btn-group","btn-group-sm"],["containerClass","justify-content-between align-items-center",1,"mb-0",3,"pageChange","pageSizeChange","totalItems","pageSize","currentPage","showPageSizeSelector","pageSizeOptions","showGoToPage","showRangeInfo","showFirstLastButtons","maxVisiblePages","density"]],template:function(e,a){if(e&1){let s=v();i(0,"div",2)(1,"app-confirm-modal",3,0),g("accepted",function(){return p(s),u(a.onConfirmAccepted())})("cancelled",function(){return p(s),u(a.onConfirmCancelled())}),n(),i(3,"nav",4)(4,"ol",5)(5,"li",6)(6,"a",7),c(7,"i",8),i(8,"span",9),l(9,"Inicio"),n()()(),i(10,"li",10),l(11,"Certificados"),n()()(),i(12,"div",11)(13,"div",12)(14,"h1",13),c(15,"i",14),i(16,"span",15),l(17,"Gesti\xF3n de Certificados"),n(),b(18,ve,2,1,"span",16),n(),i(19,"p",17),l(20,"Administra los certificados del sistema"),n()(),i(21,"div",18)(22,"button",19),g("click",function(){return p(s),u(a.refreshData())}),b(23,he,1,0,"span",20)(24,xe,1,0,"i",21),i(25,"span",22),l(26,"Actualizar"),n()(),i(27,"button",23),c(28,"i",24),i(29,"span",15),l(30,"Generar"),n()(),b(31,we,12,1,"div",25),n()(),i(32,"div",26)(33,"div",27)(34,"div",28)(35,"div",29)(36,"div",30),c(37,"i",31),i(38,"h6",32),l(39,"Filtros"),n()(),b(40,ye,2,1,"span",33),n(),i(41,"div",34)(42,"button",35),g("click",function(){return p(s),u(a.toggleFiltersPanel())}),c(43,"i",36),n(),b(44,Ee,2,0,"button",37),n()()(),b(45,ke,36,4,"div",38),n(),i(46,"div",39)(47,"div",27)(48,"div",28)(49,"div",40)(50,"div",30),c(51,"i",41),i(52,"h6",32),l(53,"Certificados"),n()(),b(54,Ie,2,1,"span",42),i(55,"div",43)(56,"label",44),l(57,"Mostrar:"),n(),i(58,"select",45),g("change",function(R){return p(s),u(a.setPageSize(R.target.value))}),S(59,De,2,2,"option",46,L),n()()(),i(61,"div",47)(62,"input",48),g("change",function(){return p(s),u(a.setViewMode("cards"))}),n(),i(63,"label",49),c(64,"i",50),i(65,"span",51),l(66,"Tarjetas"),n()(),i(67,"input",52),g("change",function(){return p(s),u(a.setViewMode("table"))}),n(),i(68,"label",53),c(69,"i",54),i(70,"span",51),l(71,"Tabla"),n()()()()(),i(72,"div",55),b(73,Ae,9,1,"div",56)(74,ze,5,1,"div",57)(75,Ue,2,2),n(),b(76,Qe,2,10,"div",58),n()()}e&2&&(o(),f("title",a.confirmAction().title)("message",a.confirmAction().message)("confirmText",a.confirmAction().confirmText),o(17),_(a.totalItems()>0?18:-1),o(4),f("disabled",a.loading()),o(),_(a.loading()?23:24),o(8),_(a.certificates().length>0?31:-1),o(),k("border-primary",a.hasActiveFilters()),o(8),_(a.hasActiveFilters()?40:-1),o(2),f("title",a.showFilters()?"Ocultar filtros":"Mostrar filtros"),j("aria-expanded",a.showFilters()),o(),k("bi-chevron-up",a.showFilters())("bi-chevron-down",!a.showFilters()),o(),_(a.hasActiveFilters()?44:-1),o(),_(a.showFilters()?45:-1),o(9),_(a.totalItems()>0?54:-1),o(4),f("value",a.pageSize()),o(),w(a.pageSizeOptions),o(3),f("checked",a.viewMode()==="cards"),o(5),f("checked",a.viewMode()==="table"),o(6),_(a.loading()?73:a.certificates().length===0?74:75),o(3),_(a.totalPages()>1?76:-1))},dependencies:[H,J,Q,ce,te,re,oe,Y,ae,Z,ee,ie,ne,se,pe,me,q],encapsulation:2,changeDetection:0})};export{ge as CertificateListComponent};

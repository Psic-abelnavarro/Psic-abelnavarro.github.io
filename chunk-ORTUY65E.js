import{c as K,d as E,e as Q,f as W,h as X,k as Y,l as ee,m as te,n as ie,o as ne,r as re,s as oe,t as ae,u as le}from"./chunk-KBXA6SDK.js";import{b as de}from"./chunk-7M4K7CII.js";import{a as se}from"./chunk-CYLPXQIR.js";import"./chunk-MPC7SZEK.js";import{a as T}from"./chunk-TMGCMHHJ.js";import{c as N,d as U}from"./chunk-IIPOJGOQ.js";import{f as H,h as Z,l as J}from"./chunk-C3HOFUSH.js";import{Bc as B,Da as l,Db as _,Gb as a,Hb as F,Ib as p,Jb as V,Na as w,Q as D,Ra as f,Ub as P,Vb as O,Xb as A,_ as b,ac as G,bb as u,cb as v,da as x,db as M,ea as C,fb as j,gb as R,hb as c,ia as k,ib as r,jb as n,kb as m,ma as g,rb as y,sb as S,tc as L,ub as s,uc as q,vc as $,yc as z}from"./chunk-5W5GNUFO.js";import"./chunk-LJ5XHLMQ.js";import"./chunk-FK42CRUA.js";var ce=(i,t,e)=>({"bg-danger":i,"bg-warning":t,"bg-info":e});function pe(i,t){i&1&&(r(0,"div",1)(1,"div",3)(2,"div",4)(3,"span",5),a(4,"Cargando..."),n()(),r(5,"p",6),a(6,"Cargando usuario..."),n()()())}function ue(i,t){if(i&1){let e=y();r(0,"div",2)(1,"div",7)(2,"div",8),m(3,"i",9),r(4,"div",10)(5,"h6",11),a(6,"Error al cargar"),n(),r(7,"p",12),a(8),n(),r(9,"button",13),S("click",function(){x(e);let d=s();return C(d.retry())}),m(10,"i",14),a(11," Reintentar "),n()()()()()}if(i&2){let e=s();l(8),F(e.error())}}function ve(i,t){if(i&1&&(r(0,"p",20),a(1),n()),i&2){let e=t;l(),V("",e.fullName," - ",e.email)}}function fe(i,t){i&1&&(r(0,"div",21),m(1,"i",63),r(2,"div"),a(3," Usuario actualizado exitosamente. Redirigiendo... "),n()())}function ge(i,t){if(i&1){let e=y();r(0,"div",22),m(1,"i",64),r(2,"div"),a(3),n(),r(4,"button",65),S("click",function(){x(e);let d=s(2);return C(d.clearError())}),n()()}if(i&2){let e=s(2);l(3),F(e.error())}}function _e(i,t){if(i&1&&(r(0,"div",66),a(1),n()),i&2){let e=s(2);l(),p(" ",e.getFieldError("fullName")," ")}}function be(i,t){if(i&1&&(r(0,"option",49),a(1),n()),i&2){let e=t.$implicit,o=s(2);c("value",e),l(),p(" ",o.getDocumentTypeLabel(e)," ")}}function xe(i,t){if(i&1&&(r(0,"div",66),a(1),n()),i&2){let e=s(2);l(),p(" ",e.getFieldError("documentType")," ")}}function Ce(i,t){if(i&1&&(r(0,"div",66),a(1),n()),i&2){let e=s(2);l(),p(" ",e.getFieldError("documentNumber")," ")}}function Se(i,t){if(i&1&&(r(0,"div",66),a(1),n()),i&2){let e=s(2);l(),p(" ",e.getFieldError("phone")," ")}}function Ee(i,t){if(i&1&&(r(0,"option",49),a(1),n()),i&2){let e=t.$implicit,o=t.$index;c("value",o+1),l(),p(" ",e.name," ")}}function he(i,t){if(i&1&&(r(0,"div",66),a(1),n()),i&2){let e=s(2);l(),p(" ",e.getFieldError("departmentId")," ")}}function Ie(i,t){if(i&1&&(r(0,"div",66),a(1),n()),i&2){let e=s(2);l(),p(" ",e.getFieldError("institution")," ")}}function ye(i,t){if(i&1&&(r(0,"div",66),a(1),n()),i&2){let e=s(2);l(),p(" ",e.getFieldError("jobTitle")," ")}}function Te(i,t){i&1&&m(0,"span",56)}function Fe(i,t){i&1&&m(0,"i",57)}function Ne(i,t){i&1&&(r(0,"span",77),m(1,"i",78),a(2,"Verificado "),n())}function Ue(i,t){if(i&1&&(a(0),u(1,Ne,3,0,"span",77)),i&2){let e=t;p(" ",e.email," "),l(),v(e.emailVerified?1:-1)}}function De(i,t){if(i&1&&(r(0,"span",74),a(1),n()),i&2){let e=t,o=s(3);c("ngClass",P(2,ce,e.role===o.UserRole.ADMIN,e.role===o.UserRole.ORGANIZER,e.role===o.UserRole.PARTICIPANT)),l(),p(" ",e.role," ")}}function ke(i,t){if(i&1&&(r(0,"span",74),a(1),n()),i&2){let e=t;c("ngClass",e.isActive?"bg-success":"bg-secondary"),l(),p(" ",e.isActive?"Activo":"Inactivo"," ")}}function we(i,t){i&1&&(a(0),O(1,"date")),i&2&&p(" ",A(1,1,t.createdAt,"dd/MM/yyyy HH:mm")," ")}function Me(i,t){if(i&1&&(r(0,"div",67)(1,"div",68)(2,"h6",27),m(3,"i",69),a(4,"Informaci\xF3n del Usuario "),n()(),r(5,"div",29)(6,"div",70)(7,"div",71)(8,"div",72)(9,"strong"),a(10,"Email:"),n()(),r(11,"div",73),u(12,Ue,2,2),n()(),r(13,"div",71)(14,"div",72)(15,"strong"),a(16,"Rol:"),n()(),r(17,"div",73),u(18,De,2,6,"span",74),n()(),r(19,"div",71)(20,"div",72)(21,"strong"),a(22,"Estado:"),n()(),r(23,"div",73),u(24,ke,2,2,"span",74),n()(),r(25,"div",71)(26,"div",72)(27,"strong"),a(28,"Creado:"),n()(),r(29,"div",73),u(30,we,2,4),n()(),r(31,"div",75),m(32,"i",76),r(33,"strong"),a(34,"Nota:"),n(),a(35," Los cambios en el rol del usuario deben realizarse desde las opciones administrativas. "),n()()()()),i&2){let e,o,d,h,I=s(2);l(12),v((e=I.user())?12:-1,e),l(6),v((o=I.user())?18:-1,o),l(6),v((d=I.user())?24:-1,d),l(6),v((h=I.user())?30:-1,h)}}function je(i,t){if(i&1){let e=y();r(0,"div",15)(1,"div",16)(2,"button",17),S("click",function(){x(e);let d=s();return C(d.cancelEdit())}),m(3,"i",18),n(),r(4,"div")(5,"h2",19),a(6,"Editar Usuario"),n(),u(7,ve,2,2,"p",20),n()()(),u(8,fe,4,0,"div",21),u(9,ge,5,1,"div",22),r(10,"div",23)(11,"div",24)(12,"div",25)(13,"div",26)(14,"h6",27),m(15,"i",28),a(16,"Editar Informaci\xF3n "),n()(),r(17,"div",29)(18,"form",30),S("ngSubmit",function(){x(e);let d=s();return C(d.onSubmit())}),r(19,"div",31)(20,"h6",32),a(21,"Informaci\xF3n Personal"),n(),r(22,"div",23)(23,"div",33)(24,"label",34),a(25," Nombre completo "),r(26,"span",35),a(27,"*"),n()(),m(28,"input",36),f(29,_e,2,1,"div",37),n(),r(30,"div",38)(31,"label",39),a(32," Tipo de documento "),r(33,"span",35),a(34,"*"),n()(),r(35,"select",40),f(36,be,2,2,"option",41),n(),f(37,xe,2,1,"div",37),n(),r(38,"div",38)(39,"label",42),a(40,"N\xFAmero de documento"),n(),m(41,"input",43),f(42,Ce,2,1,"div",37),n(),r(43,"div",33)(44,"label",44),a(45,"Tel\xE9fono"),n(),m(46,"input",45),f(47,Se,2,1,"div",37),n()()(),r(48,"div",31)(49,"h6",32),a(50,"Ubicaci\xF3n"),n(),r(51,"div",23)(52,"div",33)(53,"label",46),a(54,"Departamento"),n(),r(55,"select",47)(56,"option",48),a(57,"Seleccione un departamento"),n(),j(58,Ee,2,2,"option",49,M),n(),f(60,he,2,1,"div",37),n()()(),r(61,"div",31)(62,"h6",32),a(63,"Informaci\xF3n Profesional"),n(),r(64,"div",23)(65,"div",33)(66,"label",50),a(67,"Instituci\xF3n"),n(),m(68,"input",51),f(69,Ie,2,1,"div",37),n(),r(70,"div",33)(71,"label",52),a(72,"Cargo"),n(),m(73,"input",53),f(74,ye,2,1,"div",37),n()()(),r(75,"div",54)(76,"button",55),u(77,Te,1,0,"span",56)(78,Fe,1,0,"i",57),a(79),n(),r(80,"button",58),S("click",function(){x(e);let d=s();return C(d.resetForm())}),m(81,"i",14),a(82," Restablecer "),n(),r(83,"button",59),S("click",function(){x(e);let d=s();return C(d.cancelEdit())}),m(84,"i",60),a(85," Cancelar "),n()()()()()(),r(86,"div",61),f(87,Me,36,4,"div",62),n()()}if(i&2){let e,o=s();l(7),v((e=o.user())?7:-1,e),l(),v(o.success()?8:-1),l(),v(o.error()?9:-1),l(9),c("formGroup",o.userForm),l(10),_("is-invalid",o.isFieldInvalid("fullName")),l(),c("ngIf",o.isFieldInvalid("fullName")),l(6),_("is-invalid",o.isFieldInvalid("documentType")),l(),c("ngForOf",o.documentTypes),l(),c("ngIf",o.isFieldInvalid("documentType")),l(4),_("is-invalid",o.isFieldInvalid("documentNumber")),l(),c("ngIf",o.isFieldInvalid("documentNumber")),l(4),_("is-invalid",o.isFieldInvalid("phone")),l(),c("ngIf",o.isFieldInvalid("phone")),l(8),_("is-invalid",o.isFieldInvalid("departmentId")),l(3),R(o.departments()),l(2),c("ngIf",o.isFieldInvalid("departmentId")),l(8),_("is-invalid",o.isFieldInvalid("institution")),l(),c("ngIf",o.isFieldInvalid("institution")),l(4),_("is-invalid",o.isFieldInvalid("jobTitle")),l(),c("ngIf",o.isFieldInvalid("jobTitle")),l(2),c("disabled",o.saving()),l(),v(o.saving()?77:78),l(2),p(" ",o.saving()?"Guardando...":"Guardar Cambios"," "),l(),c("disabled",o.saving()),l(3),c("disabled",o.saving()),l(4),c("ngIf",o.user)}}var me=class i{fb=b(oe);router=b(Z);route=b(H);destroyRef=b(k);userService=b(de);staticDataService=b(se);userForm;userSig=g(null);loadingSig=g(!1);savingSig=g(!1);errorSig=g(null);successSig=g(!1);userIdSig=g(null);departmentsSig=g([]);departmentMapSig=G(()=>{let t=this.departmentsSig(),e={};return t.forEach((o,d)=>{let h=d+1;e[h]=o}),e});userRoles=Object.values(N);documentTypes=Object.values(U);UserRole=N;DocumentType=U;constructor(){this.userForm=this.createForm()}ngOnInit(){this.loadUser(),this.loadStaticData()}user(){return this.userSig()}loading(){return this.loadingSig()}saving(){return this.savingSig()}error(){return this.errorSig()}success(){return this.successSig()}userId(){return this.userIdSig()}departments(){return this.departmentsSig()}departmentMap(){return this.departmentMapSig()}retry(){this.loadUser()}clearError(){this.errorSig.set(null)}clearSuccess(){this.successSig.set(!1)}createForm(){return this.fb.group({fullName:["",[E.required,E.minLength(2),E.maxLength(100)]],documentType:["DNI",E.required],documentNumber:[""],phone:[""],departmentId:[""],institution:[""],jobTitle:[""]})}loadUser(){this.route.params.pipe(D(t=>{let e=+t.id;if(this.userIdSig.set(e),!e)throw new Error("ID de usuario no v\xE1lido");return this.loadingSig.set(!0),this.errorSig.set(null),this.userService.getUserById(e)}),T(this.destroyRef)).subscribe({next:t=>{this.userSig.set(t),this.loadingSig.set(!1),this.populateForm(t)},error:t=>{this.errorSig.set(t.message||"Error cargando usuario"),this.loadingSig.set(!1),console.error("Error cargando usuario:",t)}})}loadStaticData(){this.staticDataService.getDepartmentsList().pipe(T(this.destroyRef)).subscribe(t=>{this.departmentsSig.set(t)})}populateForm(t){this.userForm.patchValue({fullName:t.fullName,documentType:t.documentType||"DNI",documentNumber:t.documentNumber||"",phone:t.phone||"",departmentId:t.departmentId||"",institution:t.institution||"",jobTitle:t.jobTitle||""})}onSubmit(){this.userForm.valid&&this.userIdSig()?this.updateUser():this.markFormGroupTouched(this.userForm)}updateUser(){let t=this.userIdSig();if(!t)return;this.savingSig.set(!0),this.errorSig.set(null);let e=this.userForm.value,o={fullName:e.fullName,documentType:e.documentType,documentNumber:e.documentNumber||void 0,phone:e.phone||void 0,departmentId:e.departmentId?+e.departmentId:void 0,institution:e.institution||void 0,jobTitle:e.jobTitle||void 0};this.userService.updateUserProfile(t,o).pipe(T(this.destroyRef)).subscribe({next:d=>{this.userSig.set(d),this.successSig.set(!0),this.savingSig.set(!1),setTimeout(()=>{this.router.navigate(["/usuarios",t])},2e3)},error:d=>{this.errorSig.set(d.message||"Error actualizando usuario"),this.savingSig.set(!1),console.error("Error actualizando usuario:",d)}})}markFormGroupTouched(t){Object.keys(t.controls).forEach(e=>{let o=t.get(e);o?.markAsTouched(),o&&typeof o=="object"&&"controls"in o&&this.markFormGroupTouched(o)})}isFieldInvalid(t){let e=this.userForm.get(t);return!!(e&&e.invalid&&(e.dirty||e.touched))}getFieldError(t){let e=this.userForm.get(t);if(e&&e.errors&&(e.dirty||e.touched)){if(e.errors.required)return"Este campo es requerido";if(e.errors.email)return"Ingrese un email v\xE1lido";if(e.errors.minlength)return`M\xEDnimo ${e.errors.minlength.requiredLength} caracteres`;if(e.errors.maxlength)return`M\xE1ximo ${e.errors.maxlength.requiredLength} caracteres`}return""}getDocumentTypeLabel(t){return{DNI:"DNI",CE:"Carn\xE9 de Extranjer\xEDa",PASSPORT:"Pasaporte",RUC:"RUC"}[t]||t}cancelEdit(){let t=this.userIdSig();t?this.router.navigate(["/usuarios",t]):this.router.navigate(["/usuarios"])}resetForm(){let t=this.userSig();t&&(this.populateForm(t),this.errorSig.set(null),this.successSig.set(!1))}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=w({type:i,selectors:[["app-user-edit"]],decls:4,vars:1,consts:[[1,"container-fluid","py-3"],[1,"d-flex","justify-content-center","align-items-center","py-5",2,"min-height","400px"],[1,"row","justify-content-center"],[1,"text-center"],["role","status",1,"spinner-border","text-primary","mb-3",2,"width","3rem","height","3rem"],[1,"visually-hidden"],[1,"text-muted"],[1,"col-md-6"],["role","alert",1,"alert","alert-danger","d-flex","align-items-center"],[1,"bi","bi-exclamation-triangle-fill","me-3","fs-4"],[1,"flex-grow-1"],[1,"alert-heading","mb-1"],[1,"mb-2"],[1,"btn","btn-outline-danger","btn-sm",3,"click"],[1,"bi","bi-arrow-clockwise","me-1"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"d-flex","align-items-center"],["type","button",1,"btn","btn-outline-secondary","btn-sm","me-3",3,"click"],[1,"bi","bi-arrow-left"],[1,"h5","mb-0"],[1,"text-muted","small","mb-0"],["role","alert",1,"alert","alert-success","d-flex","align-items-center","mb-4"],["role","alert",1,"alert","alert-danger","d-flex","align-items-center","mb-4"],[1,"row"],[1,"col-12","col-lg-8","col-xl-6"],[1,"card"],[1,"card-header","bg-light"],[1,"card-title","mb-0"],[1,"bi","bi-person-gear","me-2"],[1,"card-body"],["novalidate","",3,"ngSubmit","formGroup"],[1,"mb-4"],[1,"text-primary","border-bottom","pb-2"],[1,"col-12","mb-3"],["for","fullName",1,"form-label","small"],[1,"text-danger"],["type","text","id","fullName","formControlName","fullName","placeholder","Ingrese el nombre completo","maxlength","100",1,"form-control","form-control-sm"],["class","invalid-feedback small",4,"ngIf"],[1,"col-md-6","mb-3"],["for","documentType",1,"form-label","small"],["id","documentType","formControlName","documentType",1,"form-select","form-select-sm"],[3,"value",4,"ngFor","ngForOf"],["for","documentNumber",1,"form-label","small"],["type","text","id","documentNumber","formControlName","documentNumber","placeholder","12345678",1,"form-control","form-control-sm"],["for","phone",1,"form-label","small"],["type","tel","id","phone","formControlName","phone","placeholder","+51 999 999 999",1,"form-control","form-control-sm"],["for","departmentId",1,"form-label","small"],["id","departmentId","formControlName","departmentId",1,"form-select","form-select-sm"],["value",""],[3,"value"],["for","institution",1,"form-label","small"],["type","text","id","institution","formControlName","institution","placeholder","Nombre de la instituci\xF3n",1,"form-control","form-control-sm"],["for","jobTitle",1,"form-label","small"],["type","text","id","jobTitle","formControlName","jobTitle","placeholder","Cargo o puesto de trabajo",1,"form-control","form-control-sm"],[1,"d-flex","gap-2","pt-3","border-top"],["type","submit",1,"btn","btn-primary","btn-sm",3,"disabled"],["role","status",1,"spinner-border","spinner-border-sm","me-1"],[1,"bi","bi-check-lg","me-1"],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],["type","button",1,"btn","btn-outline-danger","btn-sm","ms-auto",3,"click","disabled"],[1,"bi","bi-x-lg","me-1"],[1,"col-12","col-lg-4","col-xl-6"],["class","card bg-light",4,"ngIf"],[1,"bi","bi-check-circle-fill","me-2"],[1,"bi","bi-exclamation-triangle-fill","me-2"],["type","button","aria-label","Cerrar",1,"btn-close",3,"click"],[1,"invalid-feedback","small"],[1,"card","bg-light"],[1,"card-header"],[1,"bi","bi-info-circle","me-2"],[1,"small"],[1,"row","mb-3"],[1,"col-sm-4"],[1,"col-sm-8"],[1,"badge","small",3,"ngClass"],[1,"alert","alert-info","mb-0","small"],[1,"bi","bi-lightbulb","me-2"],[1,"badge","bg-success","small","ms-2"],[1,"bi","bi-check-circle","me-1"]],template:function(e,o){e&1&&(r(0,"div",0),u(1,pe,7,0,"div",1)(2,ue,12,1,"div",2)(3,je,88,32),n()),e&2&&(l(),v(o.loading()?1:o.error()&&!o.user()?2:o.user()?3:-1))},dependencies:[B,L,q,$,ae,X,ie,ne,K,te,Q,W,re,le,Y,ee,J,z],encapsulation:2})};export{me as UserEditComponent};

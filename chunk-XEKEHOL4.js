import{b as ae}from"./chunk-TO7S5C7C.js";import{b as ne}from"./chunk-NEQC2Z53.js";import{b as ie}from"./chunk-RI2EYGR4.js";import{a as R}from"./chunk-IYGYDPGO.js";import{b as ee}from"./chunk-PJLGVUHH.js";import{a as te}from"./chunk-MXHSEERB.js";import"./chunk-MPC7SZEK.js";import{g as J,l as X}from"./chunk-CF2QCA26.js";import{f as Q,h as W,i as q,l as Z}from"./chunk-NUA5R5QO.js";import{$b as v,A as y,Aa as U,Ac as Y,Cb as $,Da as o,Eb as f,Fb as r,Gb as p,Hb as u,I as w,Na as G,Nb as H,Q as L,S as B,_,ab as N,bb as m,cb as g,da as x,ea as C,eb as A,fb as V,gb as E,hb as i,ia as O,ib as n,jb as s,k as D,ma as S,qb as I,rb as b,tb as d,vb as z,wb as j,xb as K}from"./chunk-6O7NOF42.js";import"./chunk-LJ5XHLMQ.js";import{a as k,b as M}from"./chunk-FK42CRUA.js";var re=["actionButtonContainer"];function le(a,t){a&1&&(i(0,"div",2)(1,"div",5)(2,"div",6)(3,"span",7),r(4,"Cargando..."),n()(),i(5,"p",8),r(6,"Cargando detalles de inscripci\xF3n..."),n()()())}function ce(a,t){if(a&1&&(i(0,"div",3),s(1,"i",9),i(2,"span"),r(3),n()()),a&2){let e=d();o(3),p(e.error())}}function de(a,t){if(a&1&&(i(0,"div",4),s(1,"i",10),i(2,"span"),r(3),n()()),a&2){let e=d();o(3),p(e.success())}}function se(a,t){if(a&1&&(i(0,"span",51),s(1,"i",52),r(2),n()),a&2){let e=d(2);f(e.registrationStateInfo().badgeClass+" d-flex align-items-center gap-1"),o(),f("bi-"+e.registrationStateInfo().icon),o(),u(" ",e.registrationStateInfo().name," ")}}function me(a,t){a&1&&s(0,"span",32)}function ge(a,t){a&1&&s(0,"i",33)}function pe(a,t){if(a&1&&(i(0,"div",75),s(1,"i",80),r(2),n()),a&2){let e=d(4);o(2),u(" ",e.userInfo().institution," ")}}function ue(a,t){if(a&1&&(i(0,"div"),s(1,"i",81),r(2),n()),a&2){let e=d(4);o(2),u(" ",e.userInfo().documentNumber," ")}}function fe(a,t){if(a&1){let e=I();i(0,"div",59)(1,"div",71),r(2),n(),i(3,"div",72)(4,"h6",73),r(5),n(),i(6,"div",74)(7,"div",75),s(8,"i",76),i(9,"a",77),r(10),n()(),m(11,pe,3,1,"div",75),m(12,ue,3,1,"div"),n()(),i(13,"button",78),b("click",function(){x(e);let c=d(3);return C(c.goToUser())}),s(14,"i",79),n()()}if(a&2){let e=d(3);o(2),u(" ",e.userInfo().initials," "),o(3),p(e.userInfo().fullName),o(4),E("href",H("mailto:",e.userInfo().email),U),o(),u(" ",e.userInfo().email," "),o(),g(e.userInfo().hasInstitution?11:-1),o(),g(e.userInfo().hasDocumentNumber?12:-1)}}function ve(a,t){if(a&1&&(i(0,"div",75),s(1,"i",86),r(2),n()),a&2){let e=d(4);o(2),u(" ",e.formatCurrency(e.eventInfo().cost)," ")}}function _e(a,t){if(a&1&&(i(0,"div"),s(1,"i",52),i(2,"span"),r(3),n()()),a&2){let e=d(4);o(),f(e.getEventStatusInfo().class),o(),f(e.getEventStatusInfo().class),o(),p(e.getEventStatusInfo().text)}}function xe(a,t){if(a&1){let e=I();i(0,"div",59)(1,"div",82),s(2,"i",83),n(),i(3,"div",72)(4,"h6",73),r(5),n(),i(6,"div",74)(7,"div",75),s(8,"i",84),r(9),n(),m(10,ve,3,1,"div",75),m(11,_e,4,5,"div"),n()(),i(12,"button",85),b("click",function(){x(e);let c=d(3);return C(c.goToEvent())}),s(13,"i",79),n()()}if(a&2){let e=d(3);o(5),p(e.eventInfo().title),o(4),u(" ",e.formatDate(e.eventInfo().startDate)," "),o(),g(e.eventInfo().cost&&e.eventInfo().cost>0?10:-1),o(),g(e.getEventStatusInfo()?11:-1)}}function Ce(a,t){if(a&1&&(i(0,"p",91),r(1),n()),a&2){let e=d(4);o(),p(e.registrationStateInfo().description)}}function be(a,t){if(a&1&&(i(0,"div",65)(1,"div",87)(2,"div",88),s(3,"i",89),n()(),i(4,"h6",90),r(5),n(),m(6,Ce,2,1,"p",91),n()),a&2){let e=d(3);o(3),f("bi-"+e.registrationStateInfo().icon+" text-"+e.registrationStateInfo().color),o(2),p(e.registrationStateInfo().name),o(),g(e.registrationStateInfo().description?6:-1)}}function he(a,t){if(a&1&&(i(0,"div",68)(1,"label",69),r(2,"Fecha de Confirmaci\xF3n"),n(),i(3,"p",70),r(4),n()()),a&2){let e=d(3);o(4),p(e.formatDate(e.registration().confirmationDate))}}function Se(a,t){if(a&1&&(i(0,"div",68)(1,"label",69),r(2,"Fecha de Check-in"),n(),i(3,"p",70),r(4),n()()),a&2){let e=d(3);o(4),p(e.formatDate(e.registration().checkInDate))}}function Ee(a,t){if(a&1&&(i(0,"div",68)(1,"label",69),r(2,"Asistencia Verificada"),n(),i(3,"p",70),r(4),i(5,"span",92),r(6),n()()()),a&2){let e=d(3);o(4),u(" ",e.formatDate(e.registration().attendanceVerifiedDate)," "),o(2),u("",e.registration().attendancePercentage,"%")}}function Ie(a,t){if(a&1&&(i(0,"div",64)(1,"label",69),r(2,"M\xE9todo de Pago"),n(),i(3,"p",98),r(4),n()()),a&2){let e=d(4);o(4),p(e.paymentInfo().paymentMethod)}}function De(a,t){if(a&1&&(i(0,"div",64)(1,"label",69),r(2,"Referencia"),n(),i(3,"p",99),r(4),n()()),a&2){let e=d(4);o(4),p(e.paymentInfo().paymentReference)}}function ye(a,t){if(a&1&&(i(0,"div",64)(1,"label",69),r(2,"Fecha de Pago"),n(),i(3,"p",98),r(4),n()()),a&2){let e=d(4);o(4),p(e.formatDate(e.paymentInfo().paymentDate))}}function we(a,t){if(a&1&&(i(0,"div",49)(1,"div",61)(2,"div",55)(3,"h5",56),s(4,"i",93),r(5," Informaci\xF3n de Pago "),n()(),i(6,"div",58)(7,"div",67)(8,"div",94)(9,"label",69),r(10,"Costo del Evento"),n(),i(11,"p",95),r(12),n()(),i(13,"div",94)(14,"label",69),r(15,"Monto Pagado"),n(),i(16,"p",96),r(17),n()(),i(18,"div",94)(19,"label",69),r(20,"Monto Pendiente"),n(),i(21,"p",95),r(22),n()(),i(23,"div",94)(24,"label",69),r(25,"Estado"),n(),i(26,"span",97),r(27),n()(),m(28,Ie,5,1,"div",64),m(29,De,5,1,"div",64),m(30,ye,5,1,"div",64),n()()()()),a&2){let e=d(3);o(12),p(e.formatCurrency(e.paymentInfo().eventCost,e.paymentInfo().currency)),o(5),p(e.formatCurrency(e.paymentInfo().amountPaid,e.paymentInfo().currency)),o(4),f(e.paymentInfo().pendingAmount>0?"text-warning":"text-success"),o(),u(" ",e.formatCurrency(e.paymentInfo().pendingAmount,e.paymentInfo().currency)," "),o(4),f(e.paymentInfo().isFullyPaid?"bg-success":"bg-warning"),o(),u(" ",e.paymentInfo().isFullyPaid?"Pagado Completo":"Pago Pendiente"," "),o(),g(e.paymentInfo().paymentMethod?28:-1),o(),g(e.paymentInfo().paymentReference?29:-1),o(),g(e.paymentInfo().paymentDate?30:-1)}}function Re(a,t){if(a&1&&(i(0,"div",53)(1,"div",54)(2,"div",55)(3,"h5",56),s(4,"i",57),r(5," Informaci\xF3n del Participante "),n()(),i(6,"div",58),m(7,fe,15,7,"div",59),n()()(),i(8,"div",53)(9,"div",54)(10,"div",55)(11,"h5",56),s(12,"i",60),r(13," Informaci\xF3n del Evento "),n()(),i(14,"div",58),m(15,xe,14,4,"div",59),n()()(),i(16,"div",49)(17,"div",61)(18,"div",55)(19,"h5",56),s(20,"i",62),r(21," Estado de la Inscripci\xF3n "),n()(),i(22,"div",58)(23,"div",63)(24,"div",64),m(25,be,7,4,"div",65),n(),i(26,"div",66)(27,"div",67)(28,"div",68)(29,"label",69),r(30,"Fecha de Registro"),n(),i(31,"p",70),r(32),n()(),m(33,he,5,1,"div",68),m(34,Se,5,1,"div",68),m(35,Ee,7,2,"div",68),n()()()()()(),m(36,we,31,11,"div",49)),a&2){let e=d(2);o(7),g(e.userInfo()?7:-1),o(8),g(e.eventInfo()?15:-1),o(10),g(e.registrationStateInfo()?25:-1),o(7),p(e.formatDate(e.registration().registrationDate)),o(),g(e.registration().confirmationDate?33:-1),o(),g(e.registration().checkInDate?34:-1),o(),g(e.registration().attendanceVerifiedDate?35:-1),o(),g(e.paymentInfo()&&(e.paymentInfo().eventCost>0||e.paymentInfo().hasPayment)?36:-1)}}function Te(a,t){if(a&1&&(i(0,"p",91),r(1),n()),a&2){let e=d().$implicit;o(),p(e.description)}}function ke(a,t){a&1&&(i(0,"span",110),r(1,"Estado Actual"),n())}function Me(a,t){if(a&1&&(i(0,"div",104)(1,"div",105)(2,"div",106),s(3,"i",107),n()(),i(4,"div",72)(5,"div",108)(6,"div",37)(7,"div",109)(8,"h6",70),r(9),n(),i(10,"small",28),r(11),n()(),m(12,Te,2,1,"p",91),m(13,ke,2,0,"span",110),n()()()()),a&2){let e=t.$implicit,l=d(4);o(2),f("bg-"+e.color),$("border-primary",e.isCurrentState),o(),f("bi-"+e.icon),o(6),p(e.title),o(2),p(l.formatDateShort(e.date)),o(),g(e.description?12:-1),o(),g(e.isCurrentState?13:-1)}}function Ne(a,t){if(a&1&&(i(0,"div",101),s(1,"div",103),A(2,Me,14,10,"div",104,N().trackByTimelineId,!0),n()),a&2){let e=d(3);o(2),V(e.timeline())}}function Ae(a,t){a&1&&(i(0,"div",102),s(1,"i",111),i(2,"p",28),r(3,"No hay eventos en la cronolog\xEDa"),n()())}function Ve(a,t){if(a&1&&(i(0,"div",49)(1,"div",61)(2,"div",55)(3,"h5",56),s(4,"i",100),r(5," Cronolog\xEDa de Estados "),n()(),i(6,"div",58),m(7,Ne,4,0,"div",101)(8,Ae,4,0,"div",102),n()()()),a&2){let e=d(2);o(7),g(e.timeline().length>0?7:8)}}function Pe(a,t){if(a&1&&(i(0,"tr")(1,"td",116),r(2,"Estado Anterior ID:"),n(),i(3,"td",117),r(4),n()()),a&2){let e=d(3);o(4),p(e.registration().previousStateId)}}function Fe(a,t){if(a&1&&(i(0,"tr")(1,"td",116),r(2,"Estado Cambiado:"),n(),i(3,"td",117),r(4),n()()),a&2){let e=d(3);o(4),p(e.formatDate(e.registration().stateChangedAt))}}function Le(a,t){if(a&1&&(i(0,"div",49)(1,"label",69),r(2,"Notas:"),n(),i(3,"div",119)(4,"p",98),r(5),n()()()),a&2){let e=d(3);o(5),p(e.registration().notes)}}function Be(a,t){if(a&1&&(i(0,"div",49)(1,"div",61)(2,"div",55)(3,"h5",56),s(4,"i",112),r(5," Informaci\xF3n T\xE9cnica "),n()(),i(6,"div",58)(7,"div",67)(8,"div",113)(9,"div",114)(10,"table",115)(11,"tbody")(12,"tr")(13,"td",116),r(14,"ID de Inscripci\xF3n:"),n(),i(15,"td",117),r(16),n()(),i(17,"tr")(18,"td",116),r(19,"ID de Usuario:"),n(),i(20,"td",117),r(21),n()(),i(22,"tr")(23,"td",116),r(24,"ID de Evento:"),n(),i(25,"td",117),r(26),n()(),i(27,"tr")(28,"td",116),r(29,"Rol Participante:"),n(),i(30,"td",117),r(31),n()(),i(32,"tr")(33,"td",116),r(34,"Estado Actual ID:"),n(),i(35,"td",117),r(36),n()(),m(37,Pe,5,1,"tr"),n()()()(),i(38,"div",113)(39,"div",114)(40,"table",115)(41,"tbody")(42,"tr")(43,"td",116),r(44,"Creado:"),n(),i(45,"td",117),r(46),n()(),i(47,"tr")(48,"td",116),r(49,"Actualizado:"),n(),i(50,"td",117),r(51),n()(),m(52,Fe,5,1,"tr"),i(53,"tr")(54,"td",116),r(55,"Elegible Certificado:"),n(),i(56,"td",118)(57,"span",51),r(58),n()()(),i(59,"tr")(60,"td",116),r(61,"Certificado Emitido:"),n(),i(62,"td",118)(63,"span",51),r(64),n()()(),i(65,"tr")(66,"td",116),r(67,"Asistencia Verificada:"),n(),i(68,"td",118)(69,"span",51),r(70),n()()()()()()(),m(71,Le,6,1,"div",49),n()()()()),a&2){let e=d(2);o(16),u("#",e.registration().id),o(5),p(e.registration().userId),o(5),p(e.registration().eventId),o(5),p(e.registration().participantRoleId),o(5),p(e.registration().currentStateId),o(),g(e.registration().previousStateId?37:-1),o(9),p(e.formatDate(e.registration().createdAt)),o(5),p(e.formatDate(e.registration().updatedAt)),o(),g(e.registration().stateChangedAt?52:-1),o(5),f(e.registration().certificateEligible?"bg-success":"bg-secondary"),o(),u(" ",e.registration().certificateEligible?"S\xED":"No"," "),o(5),f(e.registration().certificateIssued?"bg-success":"bg-secondary"),o(),u(" ",e.registration().certificateIssued?"S\xED":"No"," "),o(5),f(e.registration().attendanceVerified?"bg-success":"bg-secondary"),o(),u(" ",e.registration().attendanceVerified?"S\xED":"No"," "),o(),g(e.registration().notes?71:-1)}}function Oe(a,t){a&1&&s(0,"span",126)}function Ue(a,t){if(a&1&&s(0,"i",128),a&2){let e=d().$implicit;f("bi-"+e.icon)}}function Ge(a,t){if(a&1){let e=I();i(0,"button",125),b("click",function(){let c=x(e).$implicit;return C(c.action())}),m(1,Oe,1,0,"span",126)(2,Ue,1,2,"i",127),r(3),n()}if(a&2){let e=t.$implicit,l=d(3);f("btn-"+(e.variant==="danger"?"outline-"+e.variant:e.variant)),E("disabled",e.loading||l.actionLoading()),o(),g(e.loading?1:2),o(2),u(" ",e.label," ")}}function ze(a,t){if(a&1&&(i(0,"div",50,0)(2,"div",120)(3,"h6",121),s(4,"i",122),r(5," Acciones Disponibles "),n()(),i(6,"div",58)(7,"div",123),A(8,Ge,4,5,"button",124,N().trackByActionId,!0),n()()()),a&2){let e=d(2);o(8),V(e.actionButtons())}}function je(a,t){if(a&1){let e=I();i(0,"nav",11)(1,"ol",12)(2,"li",13)(3,"a",14),s(4,"i",15),i(5,"span",16),r(6,"Inicio"),n()()(),i(7,"li",13)(8,"a",17),s(9,"i",18),i(10,"span",16),r(11,"Inscripciones"),n()()(),i(12,"li",19),r(13),n()()(),i(14,"div",20)(15,"div",21)(16,"div",22)(17,"div",23),s(18,"i",24),n(),i(19,"div")(20,"h1",25),r(21),n(),i(22,"div",26),m(23,se,3,5,"span",27),i(24,"small",28),s(25,"i",29),r(26),n()()()()(),i(27,"div",30)(28,"button",31),b("click",function(){x(e);let c=d();return C(c.refreshData())}),m(29,me,1,0,"span",32)(30,ge,1,0,"i",33),i(31,"span",16),r(32,"Actualizar"),n()(),i(33,"button",34),b("click",function(){x(e);let c=d();return C(c.navigateBack())}),s(34,"i",35),i(35,"span",16),r(36,"Volver"),n()()()(),i(37,"div",36)(38,"div",37)(39,"div",38)(40,"input",39),b("change",function(){x(e);let c=d();return C(c.changeViewMode("overview"))}),n(),i(41,"label",40),s(42,"i",41),i(43,"span",16),r(44,"Vista General"),n()(),i(45,"input",42),b("change",function(){x(e);let c=d();return C(c.changeViewMode("timeline"))}),n(),i(46,"label",43),s(47,"i",44),i(48,"span",16),r(49,"Cronolog\xEDa"),n()(),i(50,"input",45),b("change",function(){x(e);let c=d();return C(c.changeViewMode("technical"))}),n(),i(51,"label",46),s(52,"i",47),i(53,"span",16),r(54,"T\xE9cnico"),n()()()()(),i(55,"div",48),m(56,Re,37,8),m(57,Ve,9,1,"div",49),m(58,Be,72,19,"div",49),n(),m(59,ze,10,0,"div",50)}if(a&2){let e=d();o(13),u(" Detalle #",e.registration().id," "),o(8),u(" Inscripci\xF3n #",e.registration().id," "),o(2),g(e.registrationStateInfo()?23:-1),o(3),u(" Creado ",e.formatDateShort(e.registration().createdAt)," "),o(2),E("disabled",e.loading()),o(),g(e.loading()?29:30),o(11),E("checked",e.viewMode()==="overview"),o(5),E("checked",e.viewMode()==="timeline"),o(5),E("checked",e.viewMode()==="technical"),o(6),g(e.viewMode()==="overview"?56:-1),o(),g(e.viewMode()==="timeline"?57:-1),o(),g(e.viewMode()==="technical"?58:-1),o(),g(e.actionButtons().length>0?59:-1)}}function Ke(a,t){if(a&1){let e=I();i(0,"div",2)(1,"div",5),s(2,"i",129),i(3,"h4",87),r(4,"Inscripci\xF3n no encontrada"),n(),i(5,"p",130),r(6,"No se pudo cargar la informaci\xF3n de la inscripci\xF3n solicitada."),n(),i(7,"button",131),b("click",function(){x(e);let c=d();return C(c.navigateBack())}),s(8,"i",132),r(9," Volver a Inscripciones "),n()()()}}var oe=class a{destroyRef=_(O);route=_(Q);router=_(W);registrationService=_(ne);eventService=_(ie);userService=_(ee);certificateService=_(ae);authService=_(X);staticDataService=_(te);actionButtonContainer=S(null);loadingState=S({main:!1,action:!1,certificate:!1,stateChange:!1});loading=v(()=>this.loadingState().main);actionLoading=v(()=>this.loadingState().action||this.loadingState().certificate||this.loadingState().stateChange);error=S(null);success=S(null);registrationId=S(null);viewMode=S("overview");registration=S(null);currentUser=v(()=>this.authService.currentUser);permissions=v(()=>{let t=this.registration(),e=this.currentUser();if(!t||!e)return{canEdit:!1,canCancel:!1,canConfirm:!1,canCheckIn:!1,canMarkAttended:!1,canMarkNoShow:!1,canGenerateCertificate:!1,canChangeState:!1,reason:"Informaci\xF3n no disponible"};let l=e.role==="admin",c=e.role==="organizer",T=e.id===t.userId,h=t.currentState?.stateKey,P=t.event?.endDate?new Date>new Date(t.event.endDate):!1,F=t.event?.startDate?new Date>new Date(t.event.startDate):!1;return{canEdit:(l||c||T)&&J.includes(h),canCancel:(l||c||T)&&["draft","pending_validation","confirmed","payment_pending"].includes(h),canConfirm:(l||c)&&h==="pending_validation",canCheckIn:(l||c)&&h==="confirmed"&&F&&!P,canMarkAttended:(l||c)&&h==="checked_in"&&F,canMarkNoShow:(l||c)&&["confirmed","checked_in"].includes(h)&&P,canGenerateCertificate:(l||c)&&t.certificateEligible&&!t.certificateIssued&&h==="attended",canChangeState:l||c}});registrationStateInfo=v(()=>{let t=this.registration();if(!t?.currentState?.stateKey)return null;let e=t.currentState.stateKey,c={draft:{color:"secondary",icon:"file-text"},pending_validation:{color:"warning",icon:"clock"},payment_required:{color:"danger",icon:"credit-card"},payment_pending:{color:"warning",icon:"hourglass-split"},payment_failed:{color:"danger",icon:"x-circle"},confirmed:{color:"success",icon:"check-circle"},waitlist:{color:"info",icon:"list-ul"},checked_in:{color:"info",icon:"box-arrow-in-right"},attended:{color:"success",icon:"check-all"},no_show:{color:"danger",icon:"x-octagon"},cancelled_by_user:{color:"secondary",icon:"x-circle"},cancelled_by_admin:{color:"dark",icon:"ban"}}[e]||{color:"secondary",icon:"circle"};return{key:e,name:t.currentState.displayName||e,description:t.currentState.description,color:c.color,icon:c.icon,badgeClass:`bg-${c.color}`}});eventInfo=v(()=>{let t=this.registration();if(!t?.event)return null;let e=new Date,l=new Date(t.event.startDate),c=new Date(t.event.endDate);return M(k({},t.event),{hasStarted:e>=l,hasEnded:e>c,isOngoing:e>=l&&e<=c,daysUntilStart:Math.ceil((l.getTime()-e.getTime())/(1e3*60*60*24)),daysSinceEnd:Math.ceil((e.getTime()-c.getTime())/(1e3*60*60*24))})});userInfo=v(()=>{let t=this.registration();return t?.user?M(k({},t.user),{initials:this.getUserInitials(t.user.fullName),hasInstitution:!!t.user.institution,hasDocumentNumber:!!t.user.documentNumber}):null});paymentInfo=v(()=>{let t=this.registration();if(!t)return null;let e=t.event?.cost||0,l=t.amountPaid||0,c=Math.max(0,e-l);return{eventCost:e,amountPaid:l,pendingAmount:c,isFullyPaid:c===0,hasPayment:l>0,paymentMethod:t.paymentMethod,paymentReference:t.paymentReference,paymentDate:t.paymentDate,currency:t.currency||"PEN"}});actionButtons=v(()=>{let t=this.permissions(),e=this.actionLoading();return[{id:"edit",label:"Editar",icon:"pencil-square",variant:"primary",action:()=>this.goToEdit(),visible:t.canEdit},{id:"confirm",label:"Confirmar",icon:"check-circle",variant:"success",action:()=>this.confirmRegistration(),visible:t.canConfirm,loading:this.loadingState().stateChange},{id:"checkin",label:"Check-in",icon:"box-arrow-in-right",variant:"info",action:()=>this.checkInRegistration(),visible:t.canCheckIn,loading:this.loadingState().stateChange},{id:"attended",label:"Marcar Asistido",icon:"check-all",variant:"success",action:()=>this.markAsAttended(),visible:t.canMarkAttended,loading:this.loadingState().stateChange},{id:"noshow",label:"Marcar No Show",icon:"x-octagon",variant:"warning",action:()=>this.markAsNoShow(),visible:t.canMarkNoShow,loading:this.loadingState().stateChange},{id:"certificate",label:"Generar Certificado",icon:"award",variant:"info",action:()=>this.generateCertificate(),visible:t.canGenerateCertificate,loading:this.loadingState().certificate},{id:"cancel",label:"Cancelar Inscripci\xF3n",icon:"x-circle",variant:"danger",action:()=>this.cancelRegistration(),visible:t.canCancel,loading:this.loadingState().stateChange}].filter(l=>l.visible)});timeline=v(()=>{let t=this.registration();if(!t)return[];let e=[],l=t.currentState?.stateKey;e.push({id:"registration",title:"Inscripci\xF3n Creada",description:"Se cre\xF3 la inscripci\xF3n en el sistema",date:t.registrationDate,icon:"plus-circle",color:"primary"}),t.confirmationDate&&e.push({id:"confirmation",title:"Inscripci\xF3n Confirmada",description:"La inscripci\xF3n fue confirmada oficialmente",date:t.confirmationDate,icon:"check-circle",color:"success"}),t.paymentDate&&e.push({id:"payment",title:"Pago Procesado",description:`Pago de ${this.formatCurrency(t.amountPaid)} procesado exitosamente`,date:t.paymentDate,icon:"credit-card",color:"info"}),t.checkInDate&&e.push({id:"checkin",title:"Check-in Realizado",description:"El participante se registr\xF3 en el evento",date:t.checkInDate,icon:"box-arrow-in-right",color:"info"}),t.attendanceVerifiedDate&&e.push({id:"attendance",title:"Asistencia Verificada",description:`Asistencia del ${t.attendancePercentage}% verificada`,date:t.attendanceVerifiedDate,icon:"check-all",color:"success"});let c=e[e.length-1];return c&&(c.isCurrentState=!0),e.sort((T,h)=>new Date(T.date).getTime()-new Date(h.date).getTime())});hasUnsavedChanges=v(()=>!1);ngOnInit(){this.loadRegistration()}loadRegistration(){this.setLoadingState("main",!0),this.error.set(null),this.route.params.pipe(B(t=>{let e=parseInt(t.id,10);this.registrationId.set(e)}),L(t=>{let e=parseInt(t.id,10);if(isNaN(e))throw new Error("ID de inscripci\xF3n inv\xE1lido");return this.registrationService.getRegistrationById(e)}),y(t=>(console.error("Error loading registration:",t),this.error.set(t.message||"Error al cargar los detalles de la inscripci\xF3n. Por favor, intente nuevamente."),D(null))),w(()=>this.setLoadingState("main",!1)),R(this.destroyRef)).subscribe(t=>{this.registration.set(t)})}refreshData(){let t=this.registrationId();t&&(this.setLoadingState("main",!0),this.registrationService.getRegistrationById(t).pipe(y(e=>(console.error("Error refreshing registration:",e),this.error.set("Error al actualizar los datos"),D(null))),w(()=>this.setLoadingState("main",!1)),R(this.destroyRef)).subscribe(e=>{this.registration.set(e),this.success.set("Datos actualizados exitosamente"),setTimeout(()=>this.success.set(null),3e3)}))}confirmRegistration(){this.changeRegistrationState("confirmed","Inscripci\xF3n confirmada exitosamente")}checkInRegistration(){this.changeRegistrationState("checked_in","Check-in realizado exitosamente")}markAsAttended(){this.changeRegistrationState("attended","Asistencia registrada exitosamente")}markAsNoShow(){confirm('\xBFEst\xE1 seguro de marcar esta inscripci\xF3n como "No Show"? Esta acci\xF3n no se puede deshacer.')&&this.changeRegistrationState("no_show",'Inscripci\xF3n marcada como "No Show"')}cancelRegistration(){confirm("\xBFEst\xE1 seguro de cancelar esta inscripci\xF3n? Esta acci\xF3n no se puede deshacer.")&&this.changeRegistrationState("cancelled_by_admin","Inscripci\xF3n cancelada exitosamente")}changeRegistrationState(t,e){let l=this.registration();l&&(this.setLoadingState("stateChange",!0),this.error.set(null),this.registrationService.changeRegistrationState(l.id,t).pipe(y(c=>(console.error("Error changing registration state:",c),this.error.set(c.error?.message||"Error al cambiar el estado de la inscripci\xF3n. Por favor, intente nuevamente."),D(null))),w(()=>this.setLoadingState("stateChange",!1)),R(this.destroyRef)).subscribe(c=>{c?.success?(this.success.set(e),this.refreshData()):c?.message&&this.error.set(c.message)}))}generateCertificate(){let t=this.registration();if(!t)return;this.setLoadingState("certificate",!0),this.error.set(null);let e={userId:t.userId,eventId:t.eventId,participantRoleId:t.participantRoleId};this.certificateService.generateCertificate(e).pipe(y(l=>(console.error("Error generating certificate:",l),this.error.set(l.error?.message||"Error al generar el certificado. Por favor, intente nuevamente."),D(null))),w(()=>this.setLoadingState("certificate",!1)),R(this.destroyRef)).subscribe(l=>{l&&(this.success.set("Certificado generado exitosamente"),this.refreshData())})}goToEdit(){let t=this.registration();t&&this.router.navigate(["/inscripciones",t.id,"editar"])}goToEvent(){let t=this.registration();t?.event&&this.router.navigate(["/eventos",t.event.id])}goToUser(){let t=this.registration();t?.user&&this.router.navigate(["/usuarios",t.user.id])}navigateBack(){this.router.navigate(["/inscripciones"])}setLoadingState(t,e){this.loadingState.update(l=>M(k({},l),{[t]:e}))}changeViewMode(t){this.viewMode.set(t)}formatDate(t){return t?new Intl.DateTimeFormat("es-PE",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(t)):"No disponible"}formatDateShort(t){return t?new Intl.DateTimeFormat("es-PE",{year:"numeric",month:"short",day:"numeric"}).format(new Date(t)):"No disponible"}formatCurrency(t,e="PEN"){return new Intl.NumberFormat("es-PE",{style:"currency",currency:e}).format(t)}getUserInitials(t){if(!t)return"U";let e=t.trim().split(" ");return e.length>=2?(e[0][0]+e[1][0]).toUpperCase():e[0][0].toUpperCase()}getEventStatusInfo(){let t=this.eventInfo();if(!t)return null;if(t.isOngoing)return{text:"En curso",class:"text-success",icon:"play-circle"};if(t.hasEnded)return{text:"Finalizado",class:"text-muted",icon:"stop-circle"};if(t.hasStarted)return{text:"Iniciado",class:"text-info",icon:"play"};{let e=t.daysUntilStart;return e===0?{text:"Hoy",class:"text-warning",icon:"calendar-event"}:e===1?{text:"Ma\xF1ana",class:"text-warning",icon:"calendar-plus"}:e>0?{text:`En ${e} d\xEDas`,class:"text-primary",icon:"calendar"}:{text:"Fecha pasada",class:"text-danger",icon:"calendar-x"}}}trackByActionId(t,e){return e.id}trackByTimelineId(t,e){return e.id}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=G({type:a,selectors:[["app-registration-detail"]],viewQuery:function(e,l){if(e&1&&z(re,5),e&2){let c;j(c=K())&&(l.actionButtonContainer=c.first)}},decls:6,vars:3,consts:[["actionButtonContainer",""],[1,"container-fluid","py-3"],[1,"d-flex","justify-content-center","align-items-center",2,"min-height","50vh"],["role","alert",1,"alert","alert-danger","border-0","shadow-sm","d-flex","align-items-center"],["role","alert",1,"alert","alert-success","border-0","shadow-sm","d-flex","align-items-center"],[1,"text-center"],["role","status",1,"spinner-border","text-primary","mb-3",2,"width","3rem","height","3rem"],[1,"visually-hidden"],[1,"text-muted","mb-0"],[1,"bi","bi-exclamation-triangle","me-2","fs-5"],[1,"bi","bi-check-circle","me-2","fs-5"],["aria-label","breadcrumb",1,"mb-3"],[1,"breadcrumb","mb-0","fs-7"],[1,"breadcrumb-item"],["routerLink","/",1,"text-decoration-none","link-primary"],[1,"bi","bi-house-door","me-1"],[1,"d-none","d-sm-inline"],["routerLink","/inscripciones",1,"text-decoration-none","link-primary"],[1,"bi","bi-person-badge","me-1"],["aria-current","page",1,"breadcrumb-item","active"],[1,"d-flex","flex-column","flex-md-row","align-items-start","align-items-md-center","justify-content-between","gap-3","mb-4"],[1,"order-1","order-md-0"],[1,"d-flex","align-items-center","gap-3"],[1,"bg-primary","rounded-circle","p-3","d-flex","align-items-center","justify-content-center",2,"width","60px","height","60px"],[1,"bi","bi-person-badge","text-white","fs-4"],[1,"h4","mb-1","fw-semibold"],[1,"d-flex","flex-wrap","align-items-center","gap-2"],[1,"badge",3,"class"],[1,"text-muted"],[1,"bi","bi-calendar","me-1"],[1,"d-flex","flex-wrap","gap-2","order-0","order-md-1"],["type","button","title","Actualizar datos",1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-1"],[1,"bi","bi-arrow-clockwise","me-1"],["type","button","title","Volver a la lista",1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"bi","bi-arrow-left","me-1"],[1,"card","border-0","shadow-sm","mb-4"],[1,"card-body","py-3"],["role","group","aria-label","Modos de vista",1,"btn-group","w-100"],["type","radio","id","overview","autocomplete","off",1,"btn-check",3,"change","checked"],["for","overview",1,"btn","btn-outline-primary"],[1,"bi","bi-grid-3x3-gap","me-1"],["type","radio","id","timeline","autocomplete","off",1,"btn-check",3,"change","checked"],["for","timeline",1,"btn","btn-outline-primary"],[1,"bi","bi-clock-history","me-1"],["type","radio","id","technical","autocomplete","off",1,"btn-check",3,"change","checked"],["for","technical",1,"btn","btn-outline-primary"],[1,"bi","bi-gear","me-1"],[1,"row","g-4"],[1,"col-12"],[1,"card","border-0","shadow-sm","mt-4"],[1,"badge"],[1,"bi"],[1,"col-12","col-lg-6"],[1,"card","border-0","shadow-sm","h-100"],[1,"card-header","bg-light","border-0","py-3"],[1,"card-title","mb-0","d-flex","align-items-center"],[1,"bi","bi-person","me-2","text-primary"],[1,"card-body"],[1,"d-flex","align-items-start","gap-3"],[1,"bi","bi-calendar-event","me-2","text-primary"],[1,"card","border-0","shadow-sm"],[1,"bi","bi-clipboard-check","me-2","text-primary"],[1,"row","g-4","align-items-center"],[1,"col-12","col-md-4"],[1,"text-center","p-4","bg-light","rounded"],[1,"col-12","col-md-8"],[1,"row","g-3"],[1,"col-6"],[1,"form-label","text-muted","small","mb-1"],[1,"mb-0","fw-semibold"],[1,"bg-primary","rounded-circle","d-flex","align-items-center","justify-content-center","text-white","flex-shrink-0","fw-semibold",2,"width","60px","height","60px"],[1,"flex-grow-1"],[1,"mb-2","fw-semibold"],[1,"text-muted","small"],[1,"mb-2"],[1,"bi","bi-envelope","me-2","text-primary"],[1,"text-decoration-none",3,"href"],["type","button","title","Ver perfil completo",1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"bi","bi-arrow-right"],[1,"bi","bi-building","me-2","text-primary"],[1,"bi","bi-card-text","me-2","text-primary"],[1,"bg-success","rounded-circle","p-2","d-flex","align-items-center","justify-content-center","flex-shrink-0",2,"width","50px","height","50px"],[1,"bi","bi-calendar-event","text-white"],[1,"bi","bi-calendar","me-2","text-success"],["type","button","title","Ver evento completo",1,"btn","btn-outline-success","btn-sm",3,"click"],[1,"bi","bi-credit-card","me-2","text-success"],[1,"mb-3"],[1,"bg-white","rounded-circle","p-3","d-inline-flex","align-items-center","justify-content-center","shadow-sm",2,"width","80px","height","80px"],[1,"bi","fs-2"],[1,"fw-semibold","mb-2"],[1,"text-muted","small","mb-0"],[1,"badge","bg-success","ms-2"],[1,"bi","bi-credit-card","me-2","text-primary"],[1,"col-12","col-md-3"],[1,"mb-0","fw-semibold","fs-5"],[1,"mb-0","fw-semibold","fs-5","text-success"],[1,"badge","fs-6"],[1,"mb-0"],[1,"mb-0","font-monospace"],[1,"bi","bi-clock-history","me-2","text-primary"],[1,"position-relative"],[1,"text-center","py-5"],[1,"position-absolute","start-0","top-0","bottom-0","bg-primary","opacity-25",2,"width","2px","left","23px"],[1,"d-flex","gap-3","mb-4","position-relative"],[1,"flex-shrink-0","position-relative"],[1,"rounded-circle","d-flex","align-items-center","justify-content-center","border","border-3","border-white","shadow-sm",2,"width","48px","height","48px"],[1,"bi","text-white"],[1,"card","border-0","bg-light"],[1,"d-flex","justify-content-between","align-items-start","mb-2"],[1,"badge","bg-primary","mt-2"],[1,"bi","bi-clock-history","text-muted","mb-3",2,"font-size","3rem"],[1,"bi","bi-gear","me-2","text-primary"],[1,"col-12","col-md-6"],[1,"table-responsive"],[1,"table","table-sm"],[1,"text-muted","border-0","ps-0"],[1,"border-0","pe-0","fw-semibold"],[1,"border-0","pe-0"],[1,"p-3","bg-light","rounded"],[1,"card-header","bg-primary","text-white","py-3"],[1,"mb-0","fw-semibold","d-flex","align-items-center"],[1,"bi","bi-gear","me-2"],[1,"d-flex","flex-wrap","gap-2"],["type","button",1,"btn",3,"class","disabled"],["type","button",1,"btn",3,"click","disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"],[1,"bi","me-2",3,"class"],[1,"bi","me-2"],[1,"bi","bi-exclamation-triangle","text-warning","mb-3",2,"font-size","4rem"],[1,"text-muted","mb-4"],[1,"btn","btn-primary",3,"click"],[1,"bi","bi-arrow-left","me-2"]],template:function(e,l){e&1&&(i(0,"div",1),m(1,le,7,0,"div",2)(2,ce,4,1,"div",3),m(3,de,4,1,"div",4),m(4,je,60,13)(5,Ke,10,0,"div",2),n()),e&2&&(o(),g(l.loading()?1:l.error()?2:-1),o(2),g(l.success()?3:-1),o(),g(l.registration()?4:l.loading()?-1:5))},dependencies:[Y,Z,q],encapsulation:2,changeDetection:0})};export{oe as RegistrationDetailComponent};
